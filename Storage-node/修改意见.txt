æ ¹æ®ä¸‹é¢çš„ä¿®æ”¹æ„è§,å¯¹äºæ–‡ä»¶è¿›è¡Œä¿®æ”¹,è¿”å›ç»™æˆ‘å®Œæ•´çš„æ–‡ä»¶ä»£ç ,è¿˜æœ‰ä¸€ä¸ªæ–°çš„readmeæ–‡ä»¶

æˆ‘ç†è§£æ‚¨çš„éœ€æ±‚ã€‚è®©æˆ‘å…ˆæŸ¥çœ‹ç°æœ‰ä»£ç ï¼Œç„¶åç»™å‡ºå…·ä½“çš„ä¿®æ”¹æ„è§ä¾›æ‚¨å®¡æ ¸ã€‚å¥½çš„ï¼Œæˆ‘å·²ç»æŸ¥çœ‹äº†æ‚¨çš„ä»£ç ã€‚ç°åœ¨ç»™å‡ºè¯¦ç»†çš„ä¿®æ”¹æ„è§ä¾›æ‚¨å®¡æ ¸ï¼š

## ğŸ“‹ ä¿®æ”¹æ–¹æ¡ˆæ€»è§ˆ

æ ¹æ®è®ºæ–‡ä¸­çš„Setupç®—æ³•è¦æ±‚ï¼Œéœ€è¦ä¿®æ”¹3ä¸ªæ–‡ä»¶ï¼Œä¸»è¦æ¶‰åŠï¼š
1. **å¢åŠ å…¬å…±å‚æ•°æŒä¹…åŒ–åŠŸèƒ½**ï¼ˆä¿å­˜å’ŒåŠ è½½PPåˆ°JSONæ–‡ä»¶ï¼‰
2. **ä¿®æ”¹setup_cryptographyå‡½æ•°ç­¾å**ï¼ˆå¢åŠ å®‰å…¨å‚æ•°Îºå’Œå…¬å…±å‚æ•°è·¯å¾„ï¼‰
3. **è°ƒæ•´ä¸»ç¨‹åºåˆå§‹åŒ–æµç¨‹**

---

## ğŸ“ å…·ä½“ä¿®æ”¹æ„è§

### **æ–‡ä»¶1: storage_node.h** ï¼ˆéœ€è¦ä¿®æ”¹2å¤„ï¼‰

#### ä¿®æ”¹ç‚¹1.1ï¼šsetup_cryptography()å‡½æ•°å£°æ˜ï¼ˆç¬¬108è¡Œï¼‰

**å½“å‰ä»£ç ï¼š**
```cpp
bool setup_cryptography();
```

**ä¿®æ”¹ä¸ºï¼š**
```cpp
/**
 * setup_cryptography() - åˆå§‹åŒ–å¯†ç å­¦å‚æ•°å¹¶ç”Ÿæˆå…¬å…±å‚æ•°
 * @param security_param å®‰å…¨å‚æ•°Îºï¼ˆè®ºæ–‡ä¸­ä¸º512ä½ï¼‰
 * @param public_params_path å…¬å…±å‚æ•°ä¿å­˜è·¯å¾„
 * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
 */
bool setup_cryptography(int security_param = 512, 
                       const std::string& public_params_path = "");
```

**ç†ç”±ï¼š** è®ºæ–‡è¦æ±‚Setupç®—æ³•æ¥å—å®‰å…¨å‚æ•°Îºä½œä¸ºè¾“å…¥ï¼Œå¹¶è¾“å‡ºå…¬å…±å‚æ•°PP

---

#### ä¿®æ”¹ç‚¹1.2ï¼šå¢åŠ å…¬å…±å‚æ•°ç®¡ç†å‡½æ•°ï¼ˆåœ¨ç¬¬108è¡Œåæ–°å¢ï¼‰

**åœ¨ç¬¬108è¡Œçš„setup_cryptography()å£°æ˜åï¼Œå¢åŠ ï¼š**
```cpp
/**
 * save_public_params() - ä¿å­˜å…¬å…±å‚æ•°åˆ°JSONæ–‡ä»¶
 * @param filepath å…¬å…±å‚æ•°æ–‡ä»¶è·¯å¾„
 * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
 * 
 * ä¿å­˜å†…å®¹åŒ…æ‹¬ï¼šN, g, Î¼, é…å¯¹å‚æ•°, å“ˆå¸Œå‡½æ•°æè¿°, PRFæè¿°
 */
bool save_public_params(const std::string& filepath);

/**
 * load_public_params() - ä»JSONæ–‡ä»¶åŠ è½½å…¬å…±å‚æ•°
 * @param filepath å…¬å…±å‚æ•°æ–‡ä»¶è·¯å¾„
 * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
 * 
 * ç”¨äºéªŒè¯å’Œå±•ç¤ºå…¬å…±å‚æ•°ä¿¡æ¯
 */
bool load_public_params(const std::string& filepath);
```

**ç†ç”±ï¼š** å®ç°å…¬å…±å‚æ•°çš„æŒä¹…åŒ–ï¼Œç¬¦åˆè®ºæ–‡ä¸­Setupç®—æ³•è¾“å‡ºPPçš„è¦æ±‚

---

### **æ–‡ä»¶2: storage_node.cpp** ï¼ˆéœ€è¦ä¿®æ”¹1å¤„ + æ–°å¢2ä¸ªå‡½æ•°ï¼‰

#### ä¿®æ”¹ç‚¹2.1ï¼šsetup_cryptography()å‡½æ•°å®ç°ï¼ˆç¬¬35-68è¡Œï¼‰

**å½“å‰ä»£ç ï¼š**
```cpp
bool StorageNode::setup_cryptography() {
    std::cout << "ğŸ”§ åˆå§‹åŒ–å¯†ç å­¦å‚æ•°..." << std::endl;
    
    // ... ç°æœ‰åˆå§‹åŒ–ä»£ç  ...
    
    crypto_initialized = true;
    std::cout << "âœ… å¯†ç å­¦å‚æ•°åˆå§‹åŒ–æˆåŠŸ" << std::endl;
    
    return true;
}
```

**ä¿®æ”¹ä¸ºï¼š**
```cpp
bool StorageNode::setup_cryptography(int security_param, 
                                    const std::string& public_params_path) {
    std::cout << "ğŸ”§ åˆå§‹åŒ–å¯†ç å­¦å‚æ•° (Setupç®—æ³•)..." << std::endl;
    std::cout << "   å®‰å…¨å‚æ•° Îº: " << security_param << " bits" << std::endl;
    
    // åˆå§‹åŒ–é…å¯¹å‚æ•°ï¼ˆä½¿ç”¨ç°æœ‰å‚æ•°å­—ç¬¦ä¸²ï¼‰
    const char* param_str = 
        "type a\n"
        "q 8780710799663312522437781984754049815806883199414208211028653399266475630880222957078625179422662221423155858769582317459277713367317481324925129998224791\n"
        "h 12016012264891146079388821366740534204802954401251311822919615131047207289359704531102844802183906537786776\n"
        "r 730750818665451621361119245571504901405976559617\n"
        "exp2 159\n"
        "exp1 107\n"
        "sign1 1\n"
        "sign0 1\n";
    
    if (pairing_init_set_buf(pairing, param_str, strlen(param_str)) != 0) {
        std::cerr << "âŒ é…å¯¹å‚æ•°åˆå§‹åŒ–å¤±è´¥" << std::endl;
        return false;
    }
    
    // åˆå§‹åŒ–å…ƒç´ 
    element_init_G1(g, pairing);
    element_init_G1(mu, pairing);
    mpz_init(N);
    
    // éšæœºé€‰æ‹©ç”Ÿæˆå™¨gå’Œéšæœºå…ƒç´ Î¼ (è®ºæ–‡ç¬¬5é¡µ)
    element_random(g);
    element_random(mu);
    mpz_set_ui(N, 1000000007); // å¤§è´¨æ•°
    
    crypto_initialized = true;
    std::cout << "âœ… å¯†ç å­¦å‚æ•°åˆå§‹åŒ–æˆåŠŸ" << std::endl;
    
    // å¦‚æœæä¾›äº†å…¬å…±å‚æ•°è·¯å¾„ï¼Œåˆ™ä¿å­˜å…¬å…±å‚æ•°PP
    if (!public_params_path.empty()) {
        if (!save_public_params(public_params_path)) {
            std::cerr << "âš ï¸  å…¬å…±å‚æ•°ä¿å­˜å¤±è´¥ï¼Œä½†å¯†ç å­¦å·²åˆå§‹åŒ–" << std::endl;
        } else {
            std::cout << "âœ… å…¬å…±å‚æ•°å·²ä¿å­˜åˆ°: " << public_params_path << std::endl;
        }
    }
    
    return true;
}
```

**ç†ç”±ï¼š** 
- æ¥å—å®‰å…¨å‚æ•°ä½œä¸ºè¾“å…¥ï¼ˆç¬¦åˆè®ºæ–‡Setupç®—æ³•å®šä¹‰ï¼‰
- å¯é€‰ä¿å­˜å…¬å…±å‚æ•°åˆ°æ–‡ä»¶ï¼ˆå®ç°PPçš„æŒä¹…åŒ–ï¼‰

---

#### ä¿®æ”¹ç‚¹2.2ï¼šæ–°å¢save_public_params()å‡½æ•°ï¼ˆå»ºè®®æ’å…¥åœ¨ç¬¬68è¡Œåï¼‰

**æ–°å¢å‡½æ•°ï¼š**
```cpp
bool StorageNode::save_public_params(const std::string& filepath) {
    Json::Value root;
    
    // åŸºæœ¬ä¿¡æ¯
    root["version"] = "3.1";
    root["security_parameter"] = 512;
    root["created_at"] = get_current_timestamp();
    
    // å¯†ç å­¦å‚æ•° PP = {N, g, Î¼, é…å¯¹å‚æ•°, å“ˆå¸Œå‡½æ•°}
    Json::Value crypto;
    
    // N çš„å­—ç¬¦ä¸²è¡¨ç¤º
    char* n_str = mpz_get_str(NULL, 10, N);
    crypto["N"] = n_str;
    free(n_str);
    
    // g çš„åºåˆ—åŒ–ï¼ˆè½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼‰
    size_t g_len = element_length_in_bytes(g);
    unsigned char* g_bytes = new unsigned char[g_len];
    element_to_bytes(g_bytes, g);
    crypto["g_serialized"] = bytes_to_hex(g_bytes, g_len);
    delete[] g_bytes;
    
    // Î¼ çš„åºåˆ—åŒ–ï¼ˆè½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼‰
    size_t mu_len = element_length_in_bytes(mu);
    unsigned char* mu_bytes = new unsigned char[mu_len];
    element_to_bytes(mu_bytes, mu);
    crypto["mu_serialized"] = bytes_to_hex(mu_bytes, mu_len);
    delete[] mu_bytes;
    
    // é…å¯¹å‚æ•°
    crypto["pairing_type"] = "type_a";
    crypto["pairing_description"] = "Composite order bilinear pairing";
    
    root["crypto_params"] = crypto;
    
    // å“ˆå¸Œå‡½æ•°æè¿°ï¼ˆè®ºæ–‡ç¬¬5é¡µï¼‰
    Json::Value hash_funcs;
    hash_funcs["H1"]["algorithm"] = "SHA256";
    hash_funcs["H1"]["output_space"] = "ZN";
    hash_funcs["H1"]["description"] = "H1: {0,1}* â†’ ZN";
    
    hash_funcs["H2"]["algorithm"] = "SHA256 + element_from_hash";
    hash_funcs["H2"]["output_space"] = "G1";
    hash_funcs["H2"]["description"] = "H2: {0,1}* â†’ G1";
    
    hash_funcs["H3"]["algorithm"] = "SHA256";
    hash_funcs["H3"]["output_length_bits"] = 256;
    hash_funcs["H3"]["description"] = "H3: {0,1}* â†’ {0,1}^256";
    
    root["hash_functions"] = hash_funcs;
    
    // PRF æè¿°ï¼ˆè®ºæ–‡ç¬¬5é¡µï¼‰
    Json::Value prf;
    prf["name"] = "Pseudo-random function Ï€";
    prf["description"] = "Ï€(seed, input) = H1(seed||input) mod N";
    prf["output_space"] = "ZN";
    root["prf"] = prf;
    
    // åŒçº¿æ€§é…å¯¹æè¿°
    Json::Value pairing_info;
    pairing_info["type"] = "e: G1 Ã— G1 â†’ G2";
    pairing_info["properties"].append("bilinearity");
    pairing_info["properties"].append("non-degeneracy");
    pairing_info["properties"].append("computability");
    root["bilinear_pairing"] = pairing_info;
    
    return save_json_to_file(root, filepath);
}
```

**ç†ç”±ï¼š** ä¿å­˜å®Œæ•´çš„å…¬å…±å‚æ•°PPåˆ°JSONæ–‡ä»¶ï¼ŒåŒ…å«è®ºæ–‡è¦æ±‚çš„æ‰€æœ‰å…ƒç´ 

---

#### ä¿®æ”¹ç‚¹2.3ï¼šæ–°å¢load_public_params()å‡½æ•°ï¼ˆå»ºè®®æ’å…¥åœ¨save_public_params()åï¼‰

**æ–°å¢å‡½æ•°ï¼š**
```cpp
bool StorageNode::load_public_params(const std::string& filepath) {
    if (!file_exists(filepath)) {
        std::cerr << "âŒ å…¬å…±å‚æ•°æ–‡ä»¶ä¸å­˜åœ¨: " << filepath << std::endl;
        return false;
    }
    
    Json::Value root = load_json_from_file(filepath);
    
    std::cout << "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" << std::endl;
    std::cout << "ğŸ“– å…¬å…±å‚æ•° (PP) ä¿¡æ¯" << std::endl;
    std::cout << "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" << std::endl;
    std::cout << "ç‰ˆæœ¬:         " << root["version"].asString() << std::endl;
    std::cout << "å®‰å…¨å‚æ•° Îº:   " << root["security_parameter"].asInt() << " bits" << std::endl;
    std::cout << "åˆ›å»ºæ—¶é—´:     " << root["created_at"].asString() << std::endl;
    std::cout << "\n[å¯†ç å­¦å‚æ•°]" << std::endl;
    std::cout << "N:            " << root["crypto_params"]["N"].asString().substr(0, 20) << "..." << std::endl;
    std::cout << "g (åºåˆ—åŒ–):   " << root["crypto_params"]["g_serialized"].asString().substr(0, 40) << "..." << std::endl;
    std::cout << "Î¼ (åºåˆ—åŒ–):   " << root["crypto_params"]["mu_serialized"].asString().substr(0, 40) << "..." << std::endl;
    std::cout << "é…å¯¹ç±»å‹:     " << root["crypto_params"]["pairing_type"].asString() << std::endl;
    
    std::cout << "\n[å“ˆå¸Œå‡½æ•°]" << std::endl;
    std::cout << "H1:           " << root["hash_functions"]["H1"]["description"].asString() << std::endl;
    std::cout << "H2:           " << root["hash_functions"]["H2"]["description"].asString() << std::endl;
    std::cout << "H3:           " << root["hash_functions"]["H3"]["description"].asString() << std::endl;
    
    std::cout << "\n[ä¼ªéšæœºå‡½æ•°]" << std::endl;
    std::cout << "Ï€:            " << root["prf"]["description"].asString() << std::endl;
    
    std::cout << "\n[åŒçº¿æ€§é…å¯¹]" << std::endl;
    std::cout << "ç±»å‹:         " << root["bilinear_pairing"]["type"].asString() << std::endl;
    std::cout << "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" << std::endl;
    
    return true;
}
```

**ç†ç”±ï¼š** ç”¨äºéªŒè¯å’Œå±•ç¤ºå…¬å…±å‚æ•°ä¿¡æ¯ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œå®¡è®¡

---

### **æ–‡ä»¶3: main.cpp** ï¼ˆéœ€è¦ä¿®æ”¹1å¤„ï¼‰

#### ä¿®æ”¹ç‚¹3.1ï¼šsetup_cryptography()è°ƒç”¨ï¼ˆç¬¬379è¡Œï¼‰

**å½“å‰ä»£ç ï¼š**
```cpp
// æ­¥éª¤ 3: åˆå§‹åŒ–å¯†ç å­¦
std::cout << "\n[3/5] ğŸ”§ åˆå§‹åŒ–å¯†ç å­¦..." << std::endl;
if (!g_node->setup_cryptography()) {
    std::cerr << "âŒ å¯†ç å­¦åˆå§‹åŒ–å¤±è´¥" << std::endl;
    delete g_node;
    return 1;
}
```

**ä¿®æ”¹ä¸ºï¼š**
```cpp
// æ­¥éª¤ 3: åˆå§‹åŒ–å¯†ç å­¦ (Setupç®—æ³•)
std::cout << "\n[3/5] ğŸ”§ åˆå§‹åŒ–å¯†ç å­¦ (Setupç®—æ³•)..." << std::endl;
std::string public_params_path = g_node->get_data_dir() + "/public_params.json";
if (!g_node->setup_cryptography(512, public_params_path)) {
    std::cerr << "âŒ å¯†ç å­¦åˆå§‹åŒ–å¤±è´¥" << std::endl;
    delete g_node;
    return 1;
}
```

**ç†ç”±ï¼š** 
- ä¼ å…¥è®ºæ–‡è¦æ±‚çš„å®‰å…¨å‚æ•°Îº=512
- æŒ‡å®šå…¬å…±å‚æ•°ä¿å­˜è·¯å¾„ï¼ˆä¿å­˜åœ¨æ•°æ®ç›®å½•ä¸‹ï¼‰

---

## ğŸ¯ ä¿®æ”¹æ•ˆæœé¢„æœŸ

ä¿®æ”¹å®Œæˆåï¼š

1. âœ… **ç¬¦åˆè®ºæ–‡Setupç®—æ³•å®šä¹‰**ï¼šæ¥å—å®‰å…¨å‚æ•°Îºï¼Œè¾“å‡ºå…¬å…±å‚æ•°PP
2. âœ… **å…¬å…±å‚æ•°æŒä¹…åŒ–**ï¼šPPä¿å­˜åˆ°`./data/public_params.json`
3. âœ… **ä¾¿äºéªŒè¯å’Œå®¡è®¡**ï¼šå¯é€šè¿‡`load_public_params()`æŸ¥çœ‹PPå†…å®¹
4. âœ… **å‘åå…¼å®¹**ï¼š`setup_cryptography()`æœ‰é»˜è®¤å‚æ•°ï¼Œä¸å½±å“ç°æœ‰è°ƒç”¨

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **éœ€è¦get_current_timestamp()å‡½æ•°**ï¼šå¦‚æœstorage_node.cppä¸­æ²¡æœ‰è¿™ä¸ªå‡½æ•°ï¼Œéœ€è¦æ·»åŠ 
2. **JSONä¿å­˜è·¯å¾„**ï¼šç¡®ä¿æ•°æ®ç›®å½•å·²åˆ›å»ºï¼ˆinitialize_directories()åœ¨setup_cryptography()ä¹‹å‰è°ƒç”¨ï¼‰
3. **å…ƒç´ åºåˆ—åŒ–**ï¼šä½¿ç”¨PBCåº“çš„`element_to_bytes()`å’Œ`bytes_to_hex()`è¿›è¡Œåºåˆ—åŒ–

---

## ğŸ“Š ä¿®æ”¹ç»Ÿè®¡

- **storage_node.h**ï¼šä¿®æ”¹1å¤„ + æ–°å¢2ä¸ªå‡½æ•°å£°æ˜
- **storage_node.cpp**ï¼šä¿®æ”¹1å¤„ + æ–°å¢2ä¸ªå‡½æ•°å®ç°ï¼ˆçº¦90è¡Œä»£ç ï¼‰
- **main.cpp**ï¼šä¿®æ”¹1å¤„ï¼ˆ2è¡Œä»£ç ï¼‰

---

**è¯·å®¡æ ¸ä»¥ä¸Šä¿®æ”¹æ–¹æ¡ˆï¼Œå¦‚æœåŒæ„ï¼Œæˆ‘å°†ç«‹å³è¿›è¡Œä»£ç ä¿®æ”¹å¹¶ç”Ÿæˆå®Œæ•´æ–‡ä»¶ã€‚æœ‰ä»»ä½•éœ€è¦è°ƒæ•´çš„åœ°æ–¹è¯·å‘Šè¯‰æˆ‘ï¼** ğŸš€