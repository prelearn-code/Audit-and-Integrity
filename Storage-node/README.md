# å»ä¸­å¿ƒåŒ–å­˜å‚¨èŠ‚ç‚¹ v3.0 (æœ¬åœ°ç‰ˆ)

# å»ä¸­å¿ƒåŒ–å­˜å‚¨èŠ‚ç‚¹ v3.2

## ğŸ“‹ ç‰ˆæœ¬æ›´æ–°è¯´æ˜

### v3.2 æ–°å¢ç‰¹æ€§ (2024-11-09)

âœ¨ **å…¬å…±å‚æ•°æŒä¹…åŒ–åŠŸèƒ½**

* æ–°å¢ `setup_cryptography(security_param, public_params_path)` å‡½æ•°ï¼Œæ¥å—å®‰å…¨å‚æ•°Kä½œä¸ºè¾“å…¥
* è‡ªåŠ¨ç”Ÿæˆå¹¶ä¿å­˜å…¬å…±å‚æ•° PP = {p, q, G\_1, G\_2, e} åˆ° JSON æ–‡ä»¶
* æ–°å¢ `save_public_params()` å‡½æ•°ç”¨äºä¿å­˜å…¬å…±å‚æ•°
* æ–°å¢ `load_public_params()` å‡½æ•°ç”¨äºåŠ è½½å’ŒæŸ¥çœ‹å…¬å…±å‚æ•°
* å¯åŠ¨æ—¶å¯ä»æ§åˆ¶å°è¾“å…¥å®‰å…¨å‚æ•°Kï¼ˆé»˜è®¤512 bitsï¼‰
* ä¸»èœå•æ–°å¢"æŸ¥çœ‹å…¬å…±å‚æ•°"é€‰é¡¹ï¼ˆé€‰é¡¹10ï¼‰

### v3.1 ç‰¹æ€§

* å®¢æˆ·ç«¯å…¬é’¥ï¼ˆPKï¼‰èº«ä»½éªŒè¯
* æ–‡ä»¶çŠ¶æ€ç®¡ç†ï¼ˆvalid/invalidï¼‰
* å®Œå…¨æœ¬åœ°åŒ–å­˜å‚¨
* JSONæ–‡ä»¶æŒä¹…åŒ–
* äº¤äº’å¼æ§åˆ¶å°

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç³»ç»Ÿè¦æ±‚

* **æ“ä½œç³»ç»Ÿ**: Linux / macOS / Windows (WSL)
* **ç¼–è¯‘å™¨**: g++ æ”¯æŒ C++11 æˆ–æ›´é«˜ç‰ˆæœ¬
* **ä¾èµ–åº“**:
  * OpenSSL (libssl-dev)
  * PBC Library (libpbc-dev)
  * GMP Library (libgmp-dev)
  * JsonCpp (libjsoncpp-dev)

### 2. å®‰è£…ä¾èµ–

#### Ubuntu/Debian

```bash
sudo apt-get update
sudo apt-get install -y build-essential libssl-dev libpbc-dev libgmp-dev libjsoncpp-dev
```

#### macOS

```bash
brew install openssl pbc gmp jsoncpp
```

### 3. ç¼–è¯‘ç¨‹åº

```bash
# ç¼–è¯‘å‘½ä»¤
g++ -std=c++11 main.cpp storage_node.cpp -o storage_node \
    -lssl -lcrypto -lpbc -lgmp -ljsoncpp -lpthread

# æˆ–ä½¿ç”¨ Makefileï¼ˆå¦‚æœæä¾›ï¼‰
make
```

### 4. è¿è¡Œç¨‹åº

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®è¿è¡Œ
./storage_node

# æŒ‡å®šæ•°æ®ç›®å½•
./storage_node /path/to/data

# æŒ‡å®šæ•°æ®ç›®å½•å’Œç«¯å£
./storage_node /path/to/data 9000
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### å¯åŠ¨æµç¨‹

ç¨‹åºå¯åŠ¨æ—¶ä¼šæŒ‰ä»¥ä¸‹æ­¥éª¤åˆå§‹åŒ–ï¼š

1. **[1/6] åˆ›å»ºæ•°æ®ç›®å½•** - è‡ªåŠ¨åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„
2. **[2/6] åŠ è½½é…ç½®** - åŠ è½½æˆ–åˆ›å»ºé…ç½®æ–‡ä»¶
3. **[3/6] è®¾ç½®å®‰å…¨å‚æ•°** - ä»æ§åˆ¶å°è¾“å…¥å®‰å…¨å‚æ•°K
4. **[4/6] åˆå§‹åŒ–å¯†ç å­¦ç³»ç»Ÿ** - æ‰§è¡ŒSetupç®—æ³•ï¼Œç”Ÿæˆå…¬å…±å‚æ•°
5. **[5/6] åŠ è½½ç´¢å¼•æ•°æ®åº“** - åŠ è½½ç°æœ‰ç´¢å¼•æ•°æ®
6. **[6/6] åŠ è½½èŠ‚ç‚¹ä¿¡æ¯** - åŠ è½½èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯

#### å®‰å…¨å‚æ•°è¾“å…¥ç¤ºä¾‹

```
[3/6] ğŸ” è®¾ç½®å®‰å…¨å‚æ•°...
è¯·è¾“å…¥å®‰å…¨å‚æ•° K (å»ºè®®512æˆ–1024ï¼Œç›´æ¥å›è½¦ä½¿ç”¨é»˜è®¤512): 512
âœ… å®‰å…¨å‚æ•° K = 512 bits
```

å»ºè®®å€¼ï¼š

* **512 bits**: æ ‡å‡†å®‰å…¨çº§åˆ«ï¼ˆæ¨èï¼‰
* **1024 bits**: é«˜å®‰å…¨çº§åˆ«
* **128-2048 bits**: æœ‰æ•ˆèŒƒå›´

### ä¸»èœå•åŠŸèƒ½

å¯åŠ¨æˆåŠŸåï¼Œå°†æ˜¾ç¤ºä»¥ä¸‹èœå•ï¼š

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ ä¸»èœå•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  1. ğŸ“¤ æ’å…¥æ–‡ä»¶ (éœ€è¦JSONå‚æ•°æ–‡ä»¶)
  2. ğŸ” æœç´¢å…³é”®è¯ (éœ€è¦PKéªŒè¯)
  3. ğŸ“¥ æ£€ç´¢æ–‡ä»¶
  4. ğŸ—‘ï¸  åˆ é™¤æ–‡ä»¶ (éœ€è¦PKéªŒè¯)
  5. ğŸ” ç”Ÿæˆå®Œæ•´æ€§è¯æ˜
  6. ğŸ“Š æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
  7. ğŸ“‹ åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶
  8. ğŸ’¾ å¯¼å‡ºæ–‡ä»¶å…ƒæ•°æ®
  9. ğŸ“„ æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
  10. ğŸ”‘ æŸ¥çœ‹å…¬å…±å‚æ•°
  0. ğŸšª é€€å‡º
```

---

## ğŸ”‘ å…¬å…±å‚æ•°åŠŸèƒ½è¯¦è§£

### å…¬å…±å‚æ•°å†…å®¹

ç³»ç»Ÿåœ¨åˆå§‹åŒ–æ—¶è‡ªåŠ¨ç”Ÿæˆå¹¶ä¿å­˜ä»¥ä¸‹å…¬å…±å‚æ•°åˆ° `./data/public_params.json`ï¼š

* **p**: ä¸»è¦è´¨æ•°ï¼ˆç¾¤çš„é˜¶ï¼‰
* **q**: ç¾¤G1å’ŒG2çš„é˜¶ï¼ˆå¯¹äºtype aé…å¯¹ï¼Œp = qï¼‰
* **G\_1**: æ¤­åœ†æ›²çº¿ç¾¤ï¼ˆåŠ æ³•ç¾¤ï¼‰
  * ç±»å‹
  * é˜¶
  * ç”Ÿæˆå…ƒ g çš„åºåˆ—åŒ–è¡¨ç¤º
* **G\_2**: ç›®æ ‡ç¾¤ï¼ˆä¹˜æ³•ç¾¤ï¼‰
  * ç±»å‹
  * é˜¶
* **e**: åŒçº¿æ€§é…å¯¹å‡½æ•°
  * æ˜ å°„ç±»å‹ï¼še: G\_1 Ã— G\_1 â†’ G\_2
  * æ€§è´¨ï¼šåŒçº¿æ€§ã€éé€€åŒ–æ€§ã€å¯è®¡ç®—æ€§
  * é…å¯¹ç±»å‹ï¼štype\_a (å¯¹ç§°é…å¯¹)

### æŸ¥çœ‹å…¬å…±å‚æ•°

åœ¨ä¸»èœå•ä¸­é€‰æ‹©é€‰é¡¹ **10** å³å¯æŸ¥çœ‹å…¬å…±å‚æ•°ï¼š

```
[10] ğŸ”‘ æŸ¥çœ‹å…¬å…±å‚æ•°

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“– å…¬å…±å‚æ•° (Public Parameters)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç‰ˆæœ¬:         1.0
åˆ›å»ºæ—¶é—´:     2024-11-09T10:30:00Z
æè¿°:         Public Parameters for Decentralized Storage System

[ç¾¤é˜¶å‚æ•°]
p:            8780710799663312522437781984754049815...
q:            8780710799663312522437781984754049815...

[ç¾¤ G_1 ä¿¡æ¯]
ç±»å‹:         G1 (Elliptic Curve Group)
é˜¶:           87807107996633125224...
æè¿°:         Additive group on elliptic curve
ç”Ÿæˆå…ƒg:      0123456789abcdef...

[ç¾¤ G_2 ä¿¡æ¯]
ç±»å‹:         G_T (Target Group)
é˜¶:           87807107996633125224...
æè¿°:         Multiplicative target group for pairing

[åŒçº¿æ€§é…å¯¹ e]
ç±»å‹:         Bilinear Pairing
æ˜ å°„:         e: G_1 Ã— G_1 â†’ G_2
é…å¯¹ç±»å‹:     type_a (symmetric)
æ€§è´¨:         bilinearity non-degeneracy computability
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### å…¬å…±å‚æ•°æ–‡ä»¶ç¤ºä¾‹

`./data/public_params.json` æ–‡ä»¶å†…å®¹ï¼š

```json
{
    "version": "1.0",
    "created_at": "2024-11-09T10:30:00Z",
    "description": "Public Parameters for Decentralized Storage System",
    "public_params": {
        "p": "8780710799663312522437781984754049815806883199414208211028653399266475630880222957078625179422662221423155858769582317459277713367317481324925129998224791",
        "q": "8780710799663312522437781984754049815806883199414208211028653399266475630880222957078625179422662221423155858769582317459277713367317481324925129998224791",
        "G_1": {
            "type": "G1 (Elliptic Curve Group)",
            "order": "8780710799663312522437781984754049815806883199414208211028653399266475630880222957078625179422662221423155858769582317459277713367317481324925129998224791",
            "description": "Additive group on elliptic curve",
            "generator_g_hex": "..."
        },
        "G_2": {
            "type": "G_T (Target Group)",
            "order": "8780710799663312522437781984754049815806883199414208211028653399266475630880222957078625179422662221423155858769582317459277713367317481324925129998224791",
            "description": "Multiplicative target group for pairing"
        },
        "e": {
            "type": "Bilinear Pairing",
            "mapping": "e: G_1 Ã— G_1 â†’ G_2",
            "properties": [
                "bilinearity",
                "non-degeneracy",
                "computability"
            ],
            "pairing_type": "type_a (symmetric)"
        }
    }
}
```

---

## ğŸ“¤ æ–‡ä»¶æ“ä½œ

### 1. æ’å…¥æ–‡ä»¶

éœ€è¦å‡†å¤‡ä¸¤ä¸ªæ–‡ä»¶ï¼š

1. **å‚æ•°JSONæ–‡ä»¶** - åŒ…å«æ–‡ä»¶å…ƒæ•°æ®å’Œå…³é”®è¯
2. **åŠ å¯†æ–‡ä»¶** - å®é™…çš„åŠ å¯†æ•°æ®

#### å‚æ•°JSONæ ¼å¼

```json
{
    "PK": "å®¢æˆ·ç«¯å…¬é’¥ï¼ˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰",
    "ID_F": "æ–‡ä»¶å”¯ä¸€æ ‡è¯†ç¬¦",
    "ptr": "æ–‡ä»¶æŒ‡é’ˆ",
    "TS_F": "æ–‡ä»¶è®¤è¯æ ‡ç­¾",
    "state": "valid",
    "keywords": [
        {
            "T_i": "çŠ¶æ€ä»¤ç‰Œ1",
            "kt_i": "å…³é”®è¯1"
        },
        {
            "T_i": "çŠ¶æ€ä»¤ç‰Œ2",
            "kt_i": "å…³é”®è¯2"
        }
    ]
}
```

#### æ“ä½œæ­¥éª¤

1. åœ¨ä¸»èœå•é€‰æ‹© `1`
2. è¾“å…¥å‚æ•°JSONæ–‡ä»¶è·¯å¾„
3. è¾“å…¥åŠ å¯†æ–‡ä»¶è·¯å¾„
4. ç³»ç»Ÿè‡ªåŠ¨å¤„ç†å¹¶å­˜å‚¨

### 2. æœç´¢å…³é”®è¯

ä½¿ç”¨PKèº«ä»½éªŒè¯çš„å…³é”®è¯æœç´¢ï¼š

1. åœ¨ä¸»èœå•é€‰æ‹© `2`
2. è¾“å…¥å®¢æˆ·ç«¯å…¬é’¥ (PK)
3. è¾“å…¥æœç´¢ä»¤ç‰Œ (T\_i)
4. è¾“å…¥æœ€æ–°çŠ¶æ€ï¼ˆå¯é€‰ï¼‰
5. è¾“å…¥ç§å­ï¼ˆå¯é€‰ï¼‰
6. æŸ¥çœ‹æœç´¢ç»“æœ

**æ³¨æ„**:

* åªè¿”å›æŒ‡å®šPKçš„æ–‡ä»¶
* åªè¿”å›çŠ¶æ€ä¸º"valid"çš„æ–‡ä»¶

### 3. æ£€ç´¢æ–‡ä»¶

1. åœ¨ä¸»èœå•é€‰æ‹© `3`
2. è¾“å…¥æ–‡ä»¶ID
3. æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯
4. å¯é€‰ï¼šä¿å­˜å¯†æ–‡åˆ°æœ¬åœ°æ–‡ä»¶

### 4. åˆ é™¤æ–‡ä»¶

ä½¿ç”¨PKèº«ä»½éªŒè¯çš„æ–‡ä»¶åˆ é™¤ï¼š

1. åœ¨ä¸»èœå•é€‰æ‹© `4`
2. è¾“å…¥å®¢æˆ·ç«¯å…¬é’¥ (PK)
3. è¾“å…¥æ–‡ä»¶ID
4. è¾“å…¥åˆ é™¤è¯æ˜ï¼ˆå¯é€‰ï¼‰
5. ç¡®è®¤åˆ é™¤æ“ä½œ

**æ³¨æ„**:

* åªæœ‰æ–‡ä»¶æ‰€æœ‰è€…ï¼ˆPKåŒ¹é…ï¼‰æ‰èƒ½åˆ é™¤
* åˆ é™¤æ“ä½œå°†æ–‡ä»¶æ ‡è®°ä¸º"invalid"è€Œä¸æ˜¯ç‰©ç†åˆ é™¤

### 5. ç”Ÿæˆå®Œæ•´æ€§è¯æ˜

1. åœ¨ä¸»èœå•é€‰æ‹© `5`
2. è¾“å…¥æ–‡ä»¶ID
3. è¾“å…¥ç§å­ï¼ˆå¯é€‰ï¼‰
4. è·å–å®Œæ•´æ€§è¯æ˜
5. å¯é€‰ï¼šä¿å­˜è¯æ˜åˆ°æ–‡ä»¶

### 6. æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€

é€‰æ‹©é€‰é¡¹ `6` æŸ¥çœ‹èŠ‚ç‚¹åŸºæœ¬ä¿¡æ¯ï¼š

* èŠ‚ç‚¹ID
* æ•°æ®ç›®å½•
* ç«¯å£
* æ–‡ä»¶æ•°é‡
* ç´¢å¼•æ•°é‡
* å¯†ç å­¦åˆå§‹åŒ–çŠ¶æ€
* ç‰ˆæœ¬ä¿¡æ¯

### 7. åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶

é€‰æ‹©é€‰é¡¹ `7` æŸ¥çœ‹æ‰€æœ‰å­˜å‚¨çš„æ–‡ä»¶åˆ—è¡¨ï¼ŒåŒ…æ‹¬ï¼š

* æ–‡ä»¶ID
* å®¢æˆ·ç«¯PKï¼ˆå‰16ä½ï¼‰
* æ–‡ä»¶å¤§å°
* å…³é”®è¯æ•°é‡
* æ–‡ä»¶çŠ¶æ€
* æ’å…¥æ—¶é—´

### 8. å¯¼å‡ºæ–‡ä»¶å…ƒæ•°æ®

1. é€‰æ‹©é€‰é¡¹ `8`
2. è¾“å…¥æ–‡ä»¶ID
3. è¾“å…¥è¾“å‡ºæ–‡ä»¶è·¯å¾„
4. å…ƒæ•°æ®å°†ä»¥JSONæ ¼å¼å¯¼å‡º

### 9. æŸ¥çœ‹è¯¦ç»†çŠ¶æ€

é€‰æ‹©é€‰é¡¹ `9` æŸ¥çœ‹èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯ï¼š

* åŸºæœ¬ä¿¡æ¯
* å­˜å‚¨ç»Ÿè®¡ï¼ˆæ€»æ–‡ä»¶æ•°ã€æœ‰æ•ˆ/æ— æ•ˆæ–‡ä»¶æ•°ï¼‰
* å¯†ç å­¦çŠ¶æ€
* æ–‡ä»¶åˆ—è¡¨ï¼ˆæœ€å¤šæ˜¾ç¤º10ä¸ªï¼‰

### 10. æŸ¥çœ‹å…¬å…±å‚æ•°

é€‰æ‹©é€‰é¡¹ `10` æŸ¥çœ‹ç³»ç»Ÿå…¬å…±å‚æ•°ï¼š

* ç¾¤é˜¶å‚æ•° (p, q)
* G\_1 ç¾¤ä¿¡æ¯
* G\_2 ç¾¤ä¿¡æ¯
* åŒçº¿æ€§é…å¯¹ e çš„è¯¦ç»†ä¿¡æ¯

---

## ğŸ“ ç›®å½•ç»“æ„

ç¨‹åºè¿è¡Œåå°†åˆ›å»ºä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
./data/                          # æ•°æ®æ ¹ç›®å½•
â”œâ”€â”€ config.json                  # é…ç½®æ–‡ä»¶
â”œâ”€â”€ index_db.json                # ç´¢å¼•æ•°æ®åº“
â”œâ”€â”€ node_info.json               # èŠ‚ç‚¹ä¿¡æ¯
â”œâ”€â”€ public_params.json           # å…¬å…±å‚æ•°ï¼ˆv3.2æ–°å¢ï¼‰
â”œâ”€â”€ files/                       # åŠ å¯†æ–‡ä»¶å­˜å‚¨
â”‚   â”œâ”€â”€ file_id_1.enc
â”‚   â”œâ”€â”€ file_id_2.enc
â”‚   â””â”€â”€ ...
â””â”€â”€ metadata/                    # æ–‡ä»¶å…ƒæ•°æ®
    â”œâ”€â”€ file_id_1.json
    â”œâ”€â”€ file_id_2.json
    â””â”€â”€ ...
```

---

## ğŸ” å®‰å…¨ç‰¹æ€§

### 1. å®¢æˆ·ç«¯å…¬é’¥èº«ä»½éªŒè¯

* æ¯ä¸ªæ–‡ä»¶å…³è”ä¸€ä¸ªå®¢æˆ·ç«¯å…¬é’¥ï¼ˆPKï¼‰
* æœç´¢å’Œåˆ é™¤æ“ä½œéœ€è¦PKéªŒè¯
* åªæœ‰æ–‡ä»¶æ‰€æœ‰è€…æ‰èƒ½æ‰§è¡Œæ•æ„Ÿæ“ä½œ

### 2. å¯†ç å­¦åŸºç¡€

* **é…å¯¹å‡½æ•°**: ä½¿ç”¨ PBC åº“å®ç°çš„åŒçº¿æ€§é…å¯¹ï¼ˆtype aï¼‰
* **å“ˆå¸Œå‡½æ•°**:
  * H1: SHA256 â†’ ZN
  * H2: SHA256 â†’ G1
  * H3: SHA256 â†’ {0,1}^256
* **ä¼ªéšæœºå‡½æ•° (PRF)**: Ï€(seed, input) = H1(seed||input) mod N
* **å…¬å…±å‚æ•°**: å®Œæ•´çš„åŒçº¿æ€§ç¾¤å‚æ•°æŒä¹…åŒ–

### 3. æ•°æ®å®Œæ•´æ€§

* æ–‡ä»¶è®¤è¯æ ‡ç­¾ (TS\_F)
* å®Œæ•´æ€§è¯æ˜ç”Ÿæˆ
* çŠ¶æ€ç®¡ç†ï¼ˆvalid/invalidï¼‰

### 4. è®¿é—®æ§åˆ¶

* åŸºäºPKçš„æ‰€æœ‰æƒéªŒè¯
* çŠ¶æ€æ£€æŸ¥ï¼ˆåªè¿”å›validçŠ¶æ€çš„æ–‡ä»¶ï¼‰
* åˆ é™¤æƒé™éªŒè¯

---

## ğŸ› ï¸ å¼€å‘è¯´æ˜

### ä¸»è¦ç±»å’Œå‡½æ•°

#### StorageNode ç±»

**æ ¸å¿ƒå‡½æ•°**:

```cpp
// å¯†ç å­¦åˆå§‹åŒ–ï¼ˆv3.2æ›´æ–°ï¼‰
bool setup_cryptography(int security_param, 
                       const std::string& public_params_path = "");

// å…¬å…±å‚æ•°ç®¡ç†ï¼ˆv3.2æ–°å¢ï¼‰
bool save_public_params(const std::string& filepath);
bool load_public_params(const std::string& filepath);

// æ–‡ä»¶æ“ä½œ
bool insert_file(const std::string& param_json_path, 
                const std::string& enc_file_path);
bool delete_file(const std::string& PK, 
                const std::string& file_id, 
                const std::string& del_proof);
SearchResult search_keyword(const std::string& PK,
                           const std::string& search_token, 
                           const std::string& latest_state,
                           const std::string& seed);

// æ£€ç´¢å‡½æ•°
Json::Value retrieve_file(const std::string& file_id);
std::string generate_integrity_proof(const std::string& file_id, 
                                     const std::string& seed);
```

### æ•°æ®ç»“æ„

```cpp
struct IndexEntry {
    std::string PK;              // å®¢æˆ·ç«¯å…¬é’¥
    std::string Ts;              // çŠ¶æ€ä»¤ç‰Œ
    std::string keyword;         // å…³é”®è¯
    std::string pointer;         // åŠ å¯†æŒ‡é’ˆ
    std::string file_identifier; // æ–‡ä»¶æ ‡è¯†ç¬¦
    std::string state;           // çŠ¶æ€: "valid" æˆ– "invalid"
};

struct FileData {
    std::string PK;              // å®¢æˆ·ç«¯å…¬é’¥
    std::string file_id;         // æ–‡ä»¶ID
    std::string ciphertext;      // åŠ å¯†æ–‡æœ¬
    std::string pointer;         // æ–‡ä»¶æŒ‡é’ˆ
    std::string file_auth_tag;   // æ–‡ä»¶è®¤è¯æ ‡ç­¾
    std::string state;           // çŠ¶æ€: "valid" æˆ– "invalid"
};

struct SearchResult {
    std::vector<std::string> file_identifiers;
    std::vector<std::string> keyword_proofs;
    std::string aggregated_proof;
};
```

---

## ğŸ“Š APIä¿®æ”¹å¯¹æ¯”

### v3.1 â†’ v3.2 ä¸»è¦å˜åŒ–

#### 1. setup\_cryptography() å‡½æ•°ç­¾åå˜æ›´

**v3.1**:

```cpp
bool setup_cryptography();
```

**v3.2**:

```cpp
bool setup_cryptography(int security_param, 
                       const std::string& public_params_path = "");
```

#### 2. æ–°å¢å‡½æ•°

```cpp
// ä¿å­˜å…¬å…±å‚æ•°
bool save_public_params(const std::string& filepath);

// åŠ è½½å…¬å…±å‚æ•°
bool load_public_params(const std::string& filepath);
```

#### 3. ä¸»ç¨‹åºåˆå§‹åŒ–æµç¨‹å˜æ›´

**v3.1**: 5ä¸ªæ­¥éª¤

```
[1/5] åˆ›å»ºæ•°æ®ç›®å½•
[2/5] åŠ è½½é…ç½®
[3/5] åˆå§‹åŒ–å¯†ç å­¦
[4/5] åŠ è½½ç´¢å¼•æ•°æ®åº“
[5/5] åŠ è½½èŠ‚ç‚¹ä¿¡æ¯
```

**v3.2**: 6ä¸ªæ­¥éª¤

```
[1/6] åˆ›å»ºæ•°æ®ç›®å½•
[2/6] åŠ è½½é…ç½®
[3/6] è®¾ç½®å®‰å…¨å‚æ•°        â† æ–°å¢
[4/6] åˆå§‹åŒ–å¯†ç å­¦ç³»ç»Ÿ
[5/6] åŠ è½½ç´¢å¼•æ•°æ®åº“
[6/6] åŠ è½½èŠ‚ç‚¹ä¿¡æ¯
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ä¿®æ”¹å®‰å…¨å‚æ•°ï¼Ÿ

**A**: åœ¨ç¨‹åºå¯åŠ¨æ—¶çš„ç¬¬3æ­¥ä¼šæç¤ºè¾“å…¥å®‰å…¨å‚æ•°Kï¼Œç›´æ¥è¾“å…¥æ‰€éœ€çš„æ¯”ç‰¹æ•°ï¼ˆå»ºè®®512æˆ–1024ï¼‰ã€‚

### Q2: å…¬å…±å‚æ•°ä¿å­˜åœ¨å“ªé‡Œï¼Ÿ

**A**: å…¬å…±å‚æ•°è‡ªåŠ¨ä¿å­˜åœ¨ `./data/public_params.json` æ–‡ä»¶ä¸­ã€‚

### Q3: å¦‚ä½•éªŒè¯å…¬å…±å‚æ•°æ˜¯å¦æ­£ç¡®ï¼Ÿ

**A**:

1. åœ¨ä¸»èœå•é€‰æ‹©é€‰é¡¹10æŸ¥çœ‹å…¬å…±å‚æ•°
2. æˆ–ç›´æ¥æ‰“å¼€ `./data/public_params.json` æ–‡ä»¶æŸ¥çœ‹

### Q4: åˆ é™¤æ–‡ä»¶åè¿˜èƒ½æ¢å¤å—ï¼Ÿ

**A**: åˆ é™¤æ“ä½œåªæ˜¯å°†æ–‡ä»¶æ ‡è®°ä¸º"invalid"ï¼Œæ–‡ä»¶æ•°æ®ä»ç„¶ä¿ç•™åœ¨ç³»ç»Ÿä¸­ã€‚å¦‚éœ€æ¢å¤ï¼Œå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹æ•°æ®åº“ä¸­çš„çŠ¶æ€å­—æ®µã€‚

### Q5: ä¸ºä»€ä¹ˆæœç´¢ä¸åˆ°æˆ‘çš„æ–‡ä»¶ï¼Ÿ

**A**: è¯·æ£€æŸ¥ï¼š

1. PKæ˜¯å¦æ­£ç¡®
2. æœç´¢ä»¤ç‰Œ(T\_i)æ˜¯å¦æ­£ç¡®
3. æ–‡ä»¶çŠ¶æ€æ˜¯å¦ä¸º"valid"
4. æ–‡ä»¶æ˜¯å¦å±äºè¯¥PK

### Q6: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ

**A**: ç›´æ¥å¤‡ä»½æ•´ä¸ª `./data/` ç›®å½•å³å¯ï¼ŒåŒ…å«ï¼š

* é…ç½®æ–‡ä»¶
* ç´¢å¼•æ•°æ®åº“
* å…¬å…±å‚æ•°
* æ‰€æœ‰åŠ å¯†æ–‡ä»¶
* æ‰€æœ‰å…ƒæ•°æ®

---

## ğŸ”„ å‡çº§è¯´æ˜

### ä» v3.1 å‡çº§åˆ° v3.2

1. **å¤‡ä»½æ•°æ®**
   ```bash
   cp -r ./data ./data_backup
   ```
2. **æ›¿æ¢ç¨‹åºæ–‡ä»¶**
   * æ›¿æ¢ `storage_node.h`
   * æ›¿æ¢ `storage_node.cpp`
   * æ›¿æ¢ `main.cpp`
3. **é‡æ–°ç¼–è¯‘**
   ```bash
   g++ -std=c++11 main.cpp storage_node.cpp -o storage_node \
       -lssl -lcrypto -lpbc -lgmp -ljsoncpp -lpthread
   ```
4. **é¦–æ¬¡è¿è¡Œ**
   * ç¨‹åºä¼šæç¤ºè¾“å…¥å®‰å…¨å‚æ•°K
   * è‡ªåŠ¨ç”Ÿæˆå…¬å…±å‚æ•°æ–‡ä»¶
   * ç°æœ‰æ•°æ®ä¿æŒä¸å˜
5. **éªŒè¯å‡çº§**
   * æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼Œç¡®è®¤ç‰ˆæœ¬ä¸º v3.2
   * é€‰æ‹©èœå•é€‰é¡¹10æŸ¥çœ‹å…¬å…±å‚æ•°

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v3.2 (2024-11-09)

* âœ¨ æ–°å¢å…¬å…±å‚æ•°æŒä¹…åŒ–åŠŸèƒ½
* âœ¨ æ”¯æŒä»æ§åˆ¶å°è¾“å…¥å®‰å…¨å‚æ•°K
* âœ¨ æ–°å¢save\_public\_params()å‡½æ•°
* âœ¨ æ–°å¢load\_public\_params()å‡½æ•°
* ğŸ”§ ä¿®æ”¹setup\_cryptography()å‡½æ•°ç­¾å
* ğŸ“‹ ä¸»èœå•æ–°å¢"æŸ¥çœ‹å…¬å…±å‚æ•°"é€‰é¡¹
* ğŸ“š æ›´æ–°é…ç½®æ–‡ä»¶ç‰ˆæœ¬åˆ°3.2

### v3.1 (2024-11-08)

* âœ¨ æ–°å¢å®¢æˆ·ç«¯å…¬é’¥(PK)èº«ä»½éªŒè¯
* âœ¨ æ–°å¢æ–‡ä»¶çŠ¶æ€ç®¡ç†
* ğŸ”’ å¢å¼ºè®¿é—®æ§åˆ¶
* ğŸ› ä¿®å¤ç´¢å¼•æ•°æ®åº“ä¿å­˜é—®é¢˜

### v3.0 (2024-11-07)

* ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
* âœ… å®Œå…¨æœ¬åœ°åŒ–å­˜å‚¨
* âœ… JSONæ–‡ä»¶æŒä¹…åŒ–
* âœ… äº¤äº’å¼æ§åˆ¶å°

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æäº¤Issueã€‚

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

* [PBC Library](https://crypto.stanford.edu/pbc/) - é…å¯¹å¯†ç å­¦åº“
* [OpenSSL](https://www.openssl.org/) - åŠ å¯†åº“
* [JsonCpp](https://github.com/open-source-parsers/jsoncpp) - JSONè§£æåº“
* [GMP](https://gmplib.org/) - å¤§æ•´æ•°è¿ç®—åº“

---

**ç‰ˆæœ¬**: v3.2
**æœ€åæ›´æ–°**: 2024-11-09
**ä½œè€…**: å­˜å‚¨èŠ‚ç‚¹å¼€å‘å›¢é˜Ÿ

# å»ä¸­å¿ƒåŒ–å­˜å‚¨èŠ‚ç‚¹ v3.1 ä½¿ç”¨è¯´æ˜

## ğŸ“‹ ç›®å½•

1. [ç®€ä»‹](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#%E7%AE%80%E4%BB%8B)
2. [ç‰ˆæœ¬æ›´æ–°](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0)
3. [ç¼–è¯‘ä¸è¿è¡Œ](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C)
4. [åŠŸèƒ½æ¦‚è¿°](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#%E5%8A%9F%E8%83%BD%E6%A6%82%E8%BF%B0)
5. [è¯¦ç»†ä½¿ç”¨æŒ‡å—](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97)
   * [1. æ’å…¥æ–‡ä»¶](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#1-%E6%8F%92%E5%85%A5%E6%96%87%E4%BB%B6)
   * [2. æœç´¢å…³é”®è¯](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#2-%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E8%AF%8D)
   * [3. æ£€ç´¢æ–‡ä»¶](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#3-%E6%A3%80%E7%B4%A2%E6%96%87%E4%BB%B6)
   * [4. åˆ é™¤æ–‡ä»¶](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#4-%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6)
   * [5. ç”Ÿæˆå®Œæ•´æ€§è¯æ˜](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#5-%E7%94%9F%E6%88%90%E5%AE%8C%E6%95%B4%E6%80%A7%E8%AF%81%E6%98%8E)
   * [6. æŸ¥çœ‹çŠ¶æ€](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#6-%E6%9F%A5%E7%9C%8B%E7%8A%B6%E6%80%81)
6. [JSONæ ¼å¼è¯´æ˜](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#json%E6%A0%BC%E5%BC%8F%E8%AF%B4%E6%98%8E)
7. [æ–‡ä»¶ç»“æ„](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84)
8. [å¸¸è§é—®é¢˜](https://15659118.4omini.xyz/chat/5b39992c-53a8-46d9-953d-7380290ca4ae#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98)

---

## ç®€ä»‹

**å»ä¸­å¿ƒåŒ–å­˜å‚¨èŠ‚ç‚¹ v3.1** æ˜¯ä¸€ä¸ªæ”¯æŒåŠ å¯†æ–‡ä»¶å­˜å‚¨ã€å…³é”®è¯æœç´¢å’Œèº«ä»½éªŒè¯çš„æœ¬åœ°å­˜å‚¨ç³»ç»Ÿã€‚

### æ ¸å¿ƒç‰¹æ€§

* âœ… **å®Œå…¨æœ¬åœ°åŒ–å­˜å‚¨** - æ— éœ€åŒºå—é“¾æˆ–ç½‘ç»œè¿æ¥
* âœ… **JSONæŒä¹…åŒ–** - æ•°æ®ä»¥JSONæ ¼å¼å­˜å‚¨ï¼Œæ˜“äºç®¡ç†
* âœ… **äº¤äº’å¼æ§åˆ¶å°** - å‹å¥½çš„å‘½ä»¤è¡Œç•Œé¢
* âœ… **PKèº«ä»½éªŒè¯** - åŸºäºå®¢æˆ·ç«¯å…¬é’¥çš„æƒé™æ§åˆ¶ **(v3.1æ–°å¢)**
* âœ… **æ–‡ä»¶çŠ¶æ€ç®¡ç†** - æ”¯æŒ valid/invalid çŠ¶æ€ **(v3.1æ–°å¢)**
* âœ… **å¯†ç å­¦å®‰å…¨** - ä½¿ç”¨PBCåº“å’ŒOpenSSLè¿›è¡ŒåŠ å¯†æ“ä½œ

---

## ç‰ˆæœ¬æ›´æ–°

### v3.1 ä¸»è¦æ›´æ–° (å½“å‰ç‰ˆæœ¬)

1. **PKèº«ä»½éªŒè¯ç³»ç»Ÿ**
   * æ‰€æœ‰æ–‡ä»¶å’Œç´¢å¼•éƒ½å…³è”å®¢æˆ·ç«¯å…¬é’¥ (PK)
   * åˆ é™¤å’Œæœç´¢æ“ä½œéœ€è¦PKéªŒè¯
   * åªæœ‰æ–‡ä»¶æ‰€æœ‰è€…æ‰èƒ½åˆ é™¤æ–‡ä»¶
2. **æ–‡ä»¶çŠ¶æ€ç®¡ç†**
   * çŠ¶æ€å­—æ®µä» bool æ”¹ä¸º string ("valid"/"invalid")
   * åˆ é™¤æ“ä½œæ ‡è®°æ–‡ä»¶ä¸º "invalid" è€Œéç‰©ç†åˆ é™¤
   * æœç´¢åªè¿”å› "valid" çŠ¶æ€çš„æ–‡ä»¶
3. **JSONæ ¼å¼æ›´æ–°**
   * æ–°çš„å‚æ•°æ ¼å¼: `PK`, `ID_F`, `ptr`, `TS_F`, `state`
   * å…³é”®è¯æ ¼å¼: `T_i`, `kt_i`
   * æ›´æ¸…æ™°çš„å‚æ•°å‘½å

---

## ç¼–è¯‘ä¸è¿è¡Œ

### ä¾èµ–åº“

```bash
# Ubuntu/Debian
sudo apt-get install libpbc-dev libgmp-dev libssl-dev libjsoncpp-dev

# æˆ–æ‰‹åŠ¨ç¼–è¯‘ PBC å’Œ GMP
```

### ç¼–è¯‘

```bash
# åŸºæœ¬ç¼–è¯‘
g++ -o storage_node main.cpp storage_node.cpp \
    -lpbc -lgmp -lcrypto -ljsoncpp -std=c++11

# å¯ç”¨è°ƒè¯•ä¿¡æ¯
g++ -g -o storage_node main.cpp storage_node.cpp \
    -lpbc -lgmp -lcrypto -ljsoncpp -std=c++11
```

### è¿è¡Œ

```bash
# ä½¿ç”¨é»˜è®¤å‚æ•° (æ•°æ®ç›®å½•: ./data, ç«¯å£: 9000)
./storage_node

# æŒ‡å®šæ•°æ®ç›®å½•
./storage_node /path/to/data

# æŒ‡å®šæ•°æ®ç›®å½•å’Œç«¯å£
./storage_node /path/to/data 9001
```

---

## åŠŸèƒ½æ¦‚è¿°


| åŠŸèƒ½       | èœå•é€‰é¡¹ | éœ€è¦PK        | è¯´æ˜                   |
| ---------- | -------- | ------------- | ---------------------- |
| æ’å…¥æ–‡ä»¶   | 1        | âœ… (åœ¨JSONä¸­) | ä¸Šä¼ åŠ å¯†æ–‡ä»¶åˆ°å­˜å‚¨èŠ‚ç‚¹ |
| æœç´¢å…³é”®è¯ | 2        | âœ…            | æ ¹æ®å…³é”®è¯æœç´¢æ–‡ä»¶     |
| æ£€ç´¢æ–‡ä»¶   | 3        | âŒ            | è·å–æ–‡ä»¶å†…å®¹           |
| åˆ é™¤æ–‡ä»¶   | 4        | âœ…            | æ ‡è®°æ–‡ä»¶ä¸ºæ— æ•ˆ         |
| å®Œæ•´æ€§è¯æ˜ | 5        | âŒ            | ç”Ÿæˆæ–‡ä»¶å®Œæ•´æ€§è¯æ˜     |
| æŸ¥çœ‹çŠ¶æ€   | 6        | âŒ            | æ˜¾ç¤ºèŠ‚ç‚¹åŸºæœ¬çŠ¶æ€       |
| åˆ—å‡ºæ–‡ä»¶   | 7        | âŒ            | æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶åˆ—è¡¨       |
| å¯¼å‡ºå…ƒæ•°æ® | 8        | âŒ            | å¯¼å‡ºæ–‡ä»¶å…ƒæ•°æ®         |
| è¯¦ç»†çŠ¶æ€   | 9        | âŒ            | æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡ä¿¡æ¯       |

---

## è¯¦ç»†ä½¿ç”¨æŒ‡å—

### 1. æ’å…¥æ–‡ä»¶

**åŠŸèƒ½**: å°†åŠ å¯†æ–‡ä»¶å’Œç´¢å¼•ä¿¡æ¯æ’å…¥å­˜å‚¨èŠ‚ç‚¹

#### è¾“å…¥å‚æ•°

**1.1 å‚æ•°JSONæ–‡ä»¶** (å¿…éœ€)

æ–‡ä»¶æ ¼å¼: `insert.json`

```json
{
    "PK": "å®¢æˆ·ç«¯å…¬é’¥(hexå­—ç¬¦ä¸²)",
    "ID_F": "æ–‡ä»¶å”¯ä¸€æ ‡è¯†ç¬¦",
    "ptr": "æ–‡ä»¶æŒ‡é’ˆ",
    "TS_F": "æ–‡ä»¶è®¤è¯æ ‡ç­¾",
    "state": "valid",
    "keywords": [
        {
            "T_i": "å…³é”®è¯çŠ¶æ€ä»¤ç‰Œ_1",
            "kt_i": "å…³é”®è¯_1"
        },
        {
            "T_i": "å…³é”®è¯çŠ¶æ€ä»¤ç‰Œ_2",
            "kt_i": "å…³é”®è¯_2"
        }
    ],
    "metadata": {
        "description": "å¯é€‰çš„å…ƒæ•°æ®",
        "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"]
    }
}
```

**å‚æ•°è¯´æ˜**:


| å‚æ•°               | ç±»å‹   | å¿…éœ€ | è¯´æ˜                               |
| ------------------ | ------ | ---- | ---------------------------------- |
| `PK`               | string | âœ…   | å®¢æˆ·ç«¯å…¬é’¥ï¼Œç”¨äºèº«ä»½éªŒè¯ (hexæ ¼å¼) |
| `ID_F`             | string | âœ…   | æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦                   |
| `ptr`              | string | âœ…   | åŠ å¯†çš„æ–‡ä»¶æŒ‡é’ˆ                     |
| `TS_F`             | string | âœ…   | æ–‡ä»¶è®¤è¯æ ‡ç­¾/æ—¶é—´æˆ³                |
| `state`            | string | âœ…   | æ–‡ä»¶çŠ¶æ€: "valid" æˆ– "invalid"     |
| `keywords`         | array  | âœ…   | å…³é”®è¯æ•°ç»„                         |
| `keywords[i].T_i`  | string | âœ…   | ç¬¬iä¸ªå…³é”®è¯çš„çŠ¶æ€ä»¤ç‰Œ (ç”¨äºæœç´¢)   |
| `keywords[i].kt_i` | string | âœ…   | ç¬¬iä¸ªå…³é”®è¯                        |
| `metadata`         | object | âŒ   | å¯é€‰çš„å…ƒæ•°æ®ä¿¡æ¯                   |

**1.2 åŠ å¯†æ–‡ä»¶** (å¿…éœ€)

* æ–‡ä»¶æ ¼å¼: ä»»æ„äºŒè¿›åˆ¶æ–‡ä»¶
* æ–‡ä»¶è·¯å¾„: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
* ç¤ºä¾‹: `./encrypted_file.enc`

#### æ“ä½œæ­¥éª¤

1. å‡†å¤‡å‚æ•°JSONæ–‡ä»¶ (`insert.json`)
2. å‡†å¤‡åŠ å¯†æ–‡ä»¶ (`encrypted_file.enc`)
3. åœ¨ä¸»èœå•é€‰æ‹© `1`
4. è¾“å…¥å‚æ•°JSONæ–‡ä»¶è·¯å¾„
5. è¾“å…¥åŠ å¯†æ–‡ä»¶è·¯å¾„
6. ç­‰å¾…æ’å…¥å®Œæˆ

#### è¾“å‡ºç»“æœ

**æˆåŠŸè¾“å‡º**:

```
âœ… æ–‡ä»¶æ’å…¥æˆåŠŸ!
   ç´¢å¼•æ¡ç›®: 3
   æ€»æ–‡ä»¶æ•°: 1
   æ€»ç´¢å¼•æ•°: 3
```

**å­˜å‚¨ä½ç½®**:

* åŠ å¯†æ–‡ä»¶: `./data/files/file_001.enc`
* å…ƒæ•°æ®: `./data/metadata/file_001.json`
* ç´¢å¼•: `./data/index_db.json`

#### å®Œæ•´ç¤ºä¾‹

```bash
# 1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶
echo "This is encrypted content" > test.enc

# 2. åˆ›å»º insert.json
cat > insert.json << 'EOF'
{
    "PK": "1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef",
    "ID_F": "test_file_001",
    "ptr": "encrypted_ptr_xyz",
    "TS_F": "auth_tag_abc",
    "state": "valid",
    "keywords": [
        {
            "T_i": "token_search_medical",
            "kt_i": "medical"
        },
        {
            "T_i": "token_search_report",
            "kt_i": "report"
        }
    ],
    "metadata": {
        "description": "åŒ»ç–—æŠ¥å‘Š",
        "tags": ["åŒ»ç–—", "2024"]
    }
}
EOF

# 3. è¿è¡Œç¨‹åºå¹¶æ’å…¥
./storage_node
# é€‰æ‹© 1 (æ’å…¥æ–‡ä»¶)
# è¾“å…¥: insert.json
# è¾“å…¥: test.enc
```

---

### 2. æœç´¢å…³é”®è¯

**åŠŸèƒ½**: æ ¹æ®å…³é”®è¯æœç´¢å±äºç‰¹å®šå®¢æˆ·ç«¯çš„æ–‡ä»¶

#### è¾“å…¥å‚æ•°


| å‚æ•°           | ç±»å‹   | å¿…éœ€ | è¯´æ˜                                  |
| -------------- | ------ | ---- | ------------------------------------- |
| `PK`           | string | âœ…   | å®¢æˆ·ç«¯å…¬é’¥ (å¿…é¡»ä¸æ–‡ä»¶æ’å…¥æ—¶çš„PKåŒ¹é…) |
| `T_i`          | string | âœ…   | æœç´¢ä»¤ç‰Œ (å¯¹åº”å…³é”®è¯çš„ T\_i å€¼)       |
| `latest_state` | string | âŒ   | æœ€æ–°çŠ¶æ€ (å¯é€‰å‚æ•°)                   |
| `seed`         | string | âŒ   | éšæœºç§å­ (å¯é€‰å‚æ•°)                   |

#### æ“ä½œæ­¥éª¤

1. åœ¨ä¸»èœå•é€‰æ‹© `2`
2. è¾“å…¥å®¢æˆ·ç«¯å…¬é’¥ (PK)
3. è¾“å…¥æœç´¢ä»¤ç‰Œ (T\_i)
4. å¯é€‰: è¾“å…¥æœ€æ–°çŠ¶æ€å’Œç§å­

#### è¾“å‡ºç»“æœ

**æ‰¾åˆ°æ–‡ä»¶**:

```
ğŸ“Š æœç´¢ç»“æœ:
   æ‰¾åˆ° 2 ä¸ªåŒ¹é…æ–‡ä»¶

ğŸ“„ æ–‡ä»¶åˆ—è¡¨:
   [1] test_file_001 (å…³é”®è¯: medical)
   [2] test_file_002 (å…³é”®è¯: medical)
```

**æœªæ‰¾åˆ°æ–‡ä»¶**:

```
ğŸ“Š æœç´¢ç»“æœ:
   æ‰¾åˆ° 0 ä¸ªåŒ¹é…æ–‡ä»¶

âš ï¸  æœªæ‰¾åˆ°åŒ¹é…çš„æ–‡ä»¶
   è¯·æ£€æŸ¥:
   1. PKæ˜¯å¦æ­£ç¡®
   2. æœç´¢ä»¤ç‰Œæ˜¯å¦æ­£ç¡®
   3. æ–‡ä»¶çŠ¶æ€æ˜¯å¦ä¸º 'valid'
```

#### æœç´¢é€»è¾‘

æœç´¢æ—¶ä¼šè¿›è¡Œä»¥ä¸‹è¿‡æ»¤:

1. **PKåŒ¹é…**: åªè¿”å›è¯¥PKæ‰€å±çš„æ–‡ä»¶
2. **T\_iåŒ¹é…**: æœç´¢ä»¤ç‰Œå¿…é¡»åŒ¹é…
3. **çŠ¶æ€è¿‡æ»¤**: åªè¿”å› state="valid" çš„æ–‡ä»¶

#### å®Œæ•´ç¤ºä¾‹

```bash
# åœ¨æ§åˆ¶å°ä¸­
é€‰æ‹©æ“ä½œ: 2

è¯·è¾“å…¥å®¢æˆ·ç«¯å…¬é’¥ (PK): 1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
è¯·è¾“å…¥æœç´¢ä»¤ç‰Œ (T_i): token_search_medical
è¯·è¾“å…¥æœ€æ–°çŠ¶æ€ (å¯é€‰): [å›è½¦è·³è¿‡]
è¯·è¾“å…¥ç§å­ (å¯é€‰): [å›è½¦è·³è¿‡]

# è¾“å‡º: æ‰¾åˆ°æ‰€æœ‰åŒ…å«è¯¥å…³é”®è¯çš„æ–‡ä»¶
```

---

### 3. æ£€ç´¢æ–‡ä»¶

**åŠŸèƒ½**: æ ¹æ®æ–‡ä»¶IDæ£€ç´¢å®Œæ•´çš„æ–‡ä»¶ä¿¡æ¯

#### è¾“å…¥å‚æ•°


| å‚æ•°      | ç±»å‹   | å¿…éœ€ | è¯´æ˜                     |
| --------- | ------ | ---- | ------------------------ |
| `file_id` | string | âœ…   | æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ (ID\_F) |

#### æ“ä½œæ­¥éª¤

1. åœ¨ä¸»èœå•é€‰æ‹© `3`
2. è¾“å…¥æ–‡ä»¶ID
3. æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯
4. å¯é€‰: ä¿å­˜å¯†æ–‡åˆ°æ–‡ä»¶

#### è¾“å‡ºç»“æœ

```
âœ… æ–‡ä»¶æ£€ç´¢æˆåŠŸ!
   æ–‡ä»¶ID:       test_file_001
   å®¢æˆ·ç«¯PK:     1234567890abcdef...
   å¯†æ–‡å¤§å°:     1024 å­—èŠ‚
   æŒ‡é’ˆ:         encrypted_ptr_xyz...
   è®¤è¯æ ‡ç­¾:     auth_tag_abc...
   çŠ¶æ€:         valid

æ˜¯å¦ä¿å­˜å¯†æ–‡åˆ°æ–‡ä»¶? (y/n): 
```

#### JSONå“åº”æ ¼å¼

```json
{
    "success": true,
    "PK": "1234567890abcdef...",
    "file_id": "test_file_001",
    "ciphertext": "åŠ å¯†å†…å®¹...",
    "pointer": "encrypted_ptr_xyz",
    "file_auth_tag": "auth_tag_abc",
    "state": "valid"
}
```

---

### 4. åˆ é™¤æ–‡ä»¶

**åŠŸèƒ½**: æ ‡è®°æ–‡ä»¶ä¸ºæ— æ•ˆçŠ¶æ€ (éœ€è¦PKèº«ä»½éªŒè¯)

#### è¾“å…¥å‚æ•°


| å‚æ•°        | ç±»å‹   | å¿…éœ€ | è¯´æ˜                              |
| ----------- | ------ | ---- | --------------------------------- |
| `PK`        | string | âœ…   | å®¢æˆ·ç«¯å…¬é’¥ (å¿…é¡»ä¸æ–‡ä»¶æ‰€æœ‰è€…åŒ¹é…) |
| `file_id`   | string | âœ…   | è¦åˆ é™¤çš„æ–‡ä»¶ID                    |
| `del_proof` | string | âŒ   | åˆ é™¤è¯æ˜ (å¯é€‰)                   |

#### æ“ä½œæ­¥éª¤

1. åœ¨ä¸»èœå•é€‰æ‹© `4`
2. è¾“å…¥å®¢æˆ·ç«¯å…¬é’¥ (PK)
3. è¾“å…¥æ–‡ä»¶ID
4. å¯é€‰: è¾“å…¥åˆ é™¤è¯æ˜
5. ç¡®è®¤åˆ é™¤æ“ä½œ

#### æƒé™éªŒè¯

åˆ é™¤æ“ä½œä¼šéªŒè¯:

1. **PKæ ¼å¼**: å¿…é¡»æ˜¯æœ‰æ•ˆçš„hexå­—ç¬¦ä¸²
2. **æ–‡ä»¶å­˜åœ¨**: æ–‡ä»¶å¿…é¡»å­˜åœ¨
3. **æ‰€æœ‰æƒ**: PKå¿…é¡»ä¸æ–‡ä»¶æ‰€æœ‰è€…åŒ¹é…

#### è¾“å‡ºç»“æœ

**æˆåŠŸåˆ é™¤**:

```
ğŸ—‘ï¸  åˆ é™¤æ–‡ä»¶: test_file_001
   è¯·æ±‚è€…PK: 1234567890abcdef...
   âœ… èº«ä»½éªŒè¯é€šè¿‡
   æ ‡è®° 3 æ¡ç´¢å¼•ä¸ºæ— æ•ˆ
âœ… æ–‡ä»¶åˆ é™¤æˆåŠŸ (å·²æ ‡è®°ä¸ºæ— æ•ˆ)
```

**æƒé™ä¸è¶³**:

```
âŒ æƒé™ä¸è¶³: æ‚¨ä¸æ˜¯æ­¤æ–‡ä»¶çš„æ‰€æœ‰è€…
   æ–‡ä»¶æ‰€æœ‰è€…PK: abcdef1234567890...
```

#### åˆ é™¤è¡Œä¸ºè¯´æ˜

* **è½¯åˆ é™¤**: æ–‡ä»¶è¢«æ ‡è®°ä¸º `state="invalid"`ï¼Œä½†ä¸ä¼šç‰©ç†åˆ é™¤
* **ç´¢å¼•æ›´æ–°**: æ‰€æœ‰ç›¸å…³ç´¢å¼•æ¡ç›®çš„ state éƒ½ä¼šè®¾ä¸º "invalid"
* **æœç´¢å½±å“**: è¢«æ ‡è®°ä¸º invalid çš„æ–‡ä»¶ä¸ä¼šå‡ºç°åœ¨æœç´¢ç»“æœä¸­

---

### 5. ç”Ÿæˆå®Œæ•´æ€§è¯æ˜

**åŠŸèƒ½**: ä¸ºæŒ‡å®šæ–‡ä»¶ç”Ÿæˆå®Œæ•´æ€§è¯æ˜

#### è¾“å…¥å‚æ•°


| å‚æ•°      | ç±»å‹   | å¿…éœ€ | è¯´æ˜            |
| --------- | ------ | ---- | --------------- |
| `file_id` | string | âœ…   | æ–‡ä»¶ID          |
| `seed`    | string | âŒ   | éšæœºç§å­ (å¯é€‰) |

#### æ“ä½œæ­¥éª¤

1. åœ¨ä¸»èœå•é€‰æ‹© `5`
2. è¾“å…¥æ–‡ä»¶ID
3. å¯é€‰: è¾“å…¥ç§å­
4. æŸ¥çœ‹ç”Ÿæˆçš„è¯æ˜
5. å¯é€‰: ä¿å­˜è¯æ˜åˆ°æ–‡ä»¶

#### è¾“å‡ºç»“æœ

```
âœ… å®Œæ•´æ€§è¯æ˜ç”ŸæˆæˆåŠŸ!
   è¯æ˜: a1b2c3d4e5f6789012345678901234567890abcdef...

æ˜¯å¦ä¿å­˜è¯æ˜åˆ°æ–‡ä»¶? (y/n):
```

#### è¯æ˜ç®—æ³•

```
proof = H1(file_id || file_auth_tag || seed)
```

å…¶ä¸­ H1 æ˜¯ SHA256 å“ˆå¸Œå‡½æ•°ã€‚

---

### 6. æŸ¥çœ‹çŠ¶æ€

**åŠŸèƒ½**: æ˜¾ç¤ºèŠ‚ç‚¹çš„åŸºæœ¬çŠ¶æ€ä¿¡æ¯

#### è¾“å‡ºå†…å®¹

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š å­˜å‚¨èŠ‚ç‚¹çŠ¶æ€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
èŠ‚ç‚¹ ID:      node_1699123456
æ•°æ®ç›®å½•:     ./data
ç«¯å£:         9000
æ–‡ä»¶æ•°:       5
ç´¢å¼•æ•°:       15
å¯†ç å­¦:       å·²åˆå§‹åŒ–
ç‰ˆæœ¬:         v3.1 (æ”¯æŒPKèº«ä»½éªŒè¯)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## JSONæ ¼å¼è¯´æ˜

### æ’å…¥æ–‡ä»¶å‚æ•°æ ¼å¼ (insert.json)

```json
{
    "PK": "hexæ ¼å¼çš„å®¢æˆ·ç«¯å…¬é’¥",
    "ID_F": "æ–‡ä»¶å”¯ä¸€æ ‡è¯†ç¬¦",
    "ptr": "æ–‡ä»¶æŒ‡é’ˆ",
    "TS_F": "æ–‡ä»¶è®¤è¯æ ‡ç­¾",
    "state": "valid",
    "keywords": [
        {
            "T_i": "æœç´¢ä»¤ç‰Œ",
            "kt_i": "å…³é”®è¯"
        }
    ],
    "metadata": {
        "ä»»æ„é”®": "ä»»æ„å€¼"
    }
}
```

### ç´¢å¼•æ•°æ®åº“æ ¼å¼ (index\_db.json)

```json
{
    "version": "3.1",
    "last_updated": "2024-11-09T10:30:00Z",
    "indices": {
        "search_token_1": [
            {
                "PK": "å®¢æˆ·ç«¯å…¬é’¥",
                "Ts": "çŠ¶æ€ä»¤ç‰Œ",
                "keyword": "å…³é”®è¯",
                "pointer": "æ–‡ä»¶æŒ‡é’ˆ",
                "file_identifier": "æ–‡ä»¶ID",
                "state": "valid"
            }
        ]
    },
    "total_entries": 15
}
```

### æ–‡ä»¶å…ƒæ•°æ®æ ¼å¼ (metadata/ {file\_id}.json)

```json
{
    "PK": "å®¢æˆ·ç«¯å…¬é’¥",
    "file_id": "test_file_001",
    "pointer": "encrypted_ptr_xyz",
    "file_auth_tag": "auth_tag_abc",
    "state": "valid",
    "insert_time": "2024-11-09T10:30:00Z",
    "keyword_count": 3,
    "file_size": 1024,
    "original": {
        "description": "åŸå§‹å…ƒæ•°æ®",
        "tags": ["æ ‡ç­¾"]
    }
}
```

---

## æ–‡ä»¶ç»“æ„

### ç›®å½•ç»“æ„

```
./data/                          # æ•°æ®æ ¹ç›®å½•
â”œâ”€â”€ config.json                  # èŠ‚ç‚¹é…ç½®æ–‡ä»¶
â”œâ”€â”€ index_db.json               # ç´¢å¼•æ•°æ®åº“
â”œâ”€â”€ node_info.json              # èŠ‚ç‚¹ä¿¡æ¯
â”œâ”€â”€ files/                      # åŠ å¯†æ–‡ä»¶å­˜å‚¨
â”‚   â”œâ”€â”€ file_001.enc
â”‚   â”œâ”€â”€ file_002.enc
â”‚   â””â”€â”€ ...
â””â”€â”€ metadata/                   # æ–‡ä»¶å…ƒæ•°æ®
    â”œâ”€â”€ file_001.json
    â”œâ”€â”€ file_002.json
    â””â”€â”€ ...
```

### é…ç½®æ–‡ä»¶ (config.json)

```json
{
    "version": "3.1",
    "node": {
        "node_id": "node_1699123456",
        "created_at": "2024-11-09T10:00:00Z",
        "description": "å»ä¸­å¿ƒåŒ–å­˜å‚¨èŠ‚ç‚¹ (æ”¯æŒPKèº«ä»½éªŒè¯)"
    },
    "paths": {
        "data_dir": "./data",
        "files_dir": "./data/files",
        "metadata_dir": "./data/metadata",
        "index_db": "./data/index_db.json"
    },
    "server": {
        "port": 9000,
        "enable_server": false
    },
    "storage": {
        "max_file_size_mb": 100,
        "max_total_storage_gb": 10
    },
    "logging": {
        "enable_logging": true,
        "log_level": "INFO"
    },
    "security": {
        "enable_pk_verification": true
    }
}
```

---

## å¸¸è§é—®é¢˜

### Q1: PKæ ¼å¼è¦æ±‚æ˜¯ä»€ä¹ˆ?

**A**: PKå¿…é¡»æ˜¯åå…­è¿›åˆ¶(hex)å­—ç¬¦ä¸²ï¼ŒåªåŒ…å«0-9å’Œa-få­—ç¬¦ã€‚å»ºè®®é•¿åº¦è‡³å°‘64å­—ç¬¦ã€‚

ç¤ºä¾‹:

```
âœ… æ­£ç¡®: "1234567890abcdef1234567890abcdef"
âŒ é”™è¯¯: "123xyz" (åŒ…å«éhexå­—ç¬¦)
âŒ é”™è¯¯: "12 34" (åŒ…å«ç©ºæ ¼)
```

### Q2: åˆ é™¤æ–‡ä»¶åè¿˜èƒ½æ¢å¤å—?

**A**: å¯ä»¥ã€‚v3.1é‡‡ç”¨è½¯åˆ é™¤æœºåˆ¶ï¼Œæ–‡ä»¶è¢«æ ‡è®°ä¸º `state="invalid"` ä½†ä¸ä¼šç‰©ç†åˆ é™¤ã€‚å¦‚éœ€æ¢å¤ï¼Œå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ç´¢å¼•æ•°æ®åº“å’Œå…ƒæ•°æ®ä¸­çš„ state å­—æ®µã€‚

### Q3: ä¸ºä»€ä¹ˆæœç´¢ä¸åˆ°æˆ‘çš„æ–‡ä»¶?

**A**: è¯·æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:

1. **PKæ˜¯å¦æ­£ç¡®**: æœç´¢æ—¶è¾“å…¥çš„PKå¿…é¡»ä¸æ’å…¥æ—¶çš„PKå®Œå…¨åŒ¹é…
2. **T\_iæ˜¯å¦æ­£ç¡®**: æœç´¢ä»¤ç‰Œå¿…é¡»æ˜¯æ’å…¥æ—¶ä½¿ç”¨çš„ T\_i å€¼
3. **æ–‡ä»¶çŠ¶æ€**: åªæœ‰ state="valid" çš„æ–‡ä»¶ä¼šå‡ºç°åœ¨æœç´¢ç»“æœä¸­
4. **å…³é”®è¯æ˜¯å¦å­˜åœ¨**: ç¡®è®¤è¯¥æ–‡ä»¶ç¡®å®åŒ…å«è¯¥å…³é”®è¯

### Q4: å¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥æ’å…¥åŒä¸€ä¸ªfile\_idå—?

**A**: æŠ€æœ¯ä¸Šå¯ä»¥ï¼Œä½†ä¸å»ºè®®ã€‚å¦‚æœå¤šä¸ªPKæ’å…¥ç›¸åŒçš„file\_idï¼Œåæ’å…¥çš„ä¼šè¦†ç›–å‰é¢çš„æ–‡ä»¶ï¼Œä½†ç´¢å¼•æ•°æ®åº“ä¼šä¿ç•™æ‰€æœ‰PKçš„ç´¢å¼•æ¡ç›®ã€‚

### Q5: å¦‚ä½•æ‰¹é‡å¯¼å…¥æ–‡ä»¶?

**A**: å¯ä»¥ç¼–å†™è„šæœ¬å¾ªç¯è°ƒç”¨æ’å…¥æ¥å£ã€‚ç¤ºä¾‹:

```bash
#!/bin/bash
for i in {1..10}; do
    # å‡†å¤‡ insert_$i.json å’Œ file_$i.enc
    echo "1" | ./storage_node  # é€‰æ‹©æ’å…¥
    # ... è‡ªåŠ¨åŒ–è¾“å…¥
done
```

### Q6: ç´¢å¼•æ•°æ®åº“æŸåæ€ä¹ˆåŠ?

**A**: å¤‡ä»½ç­–ç•¥:

1. å®šæœŸå¤‡ä»½ `./data` ç›®å½•
2. å¦‚æœ index\_db.json æŸåï¼Œåˆ é™¤å®ƒå¹¶é‡å¯ç¨‹åºï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„ç©ºæ•°æ®åº“
3. ä»å¤‡ä»½æ¢å¤: `cp backup/index_db.json ./data/`

### Q7: stateå­—æ®µå¯ä»¥è‡ªå®šä¹‰å—?

**A**: ç›®å‰åªæ”¯æŒ "valid" å’Œ "invalid" ä¸¤ç§çŠ¶æ€ã€‚å¦‚éœ€æ‰©å±•ï¼Œéœ€è¦ä¿®æ”¹æºä»£ç ä¸­çš„éªŒè¯é€»è¾‘ã€‚

### Q8: å¦‚ä½•è¿ç§»åˆ°æ–°ç‰ˆæœ¬?

**A**: ä»v3.0å‡çº§åˆ°v3.1:

1. å¤‡ä»½æ•°æ®: `cp -r ./data ./data_backup`
2. æ¸…ç©ºæˆ–åˆ é™¤æ—§çš„ index\_db.json (v3.0æ ¼å¼ä¸å…¼å®¹)
3. é‡æ–°æ’å…¥æ‰€æœ‰æ–‡ä»¶ï¼Œä½¿ç”¨æ–°çš„JSONæ ¼å¼

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥:

1. ä¾èµ–åº“æ˜¯å¦æ­£ç¡®å®‰è£…
2. ç¼–è¯‘æ—¶æ˜¯å¦æœ‰è­¦å‘Šæˆ–é”™è¯¯
3. æ•°æ®ç›®å½•æ˜¯å¦æœ‰å†™æƒé™
4. JSONæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®

---

## ç‰ˆæƒä¿¡æ¯

å»ä¸­å¿ƒåŒ–å­˜å‚¨èŠ‚ç‚¹ v3.1
Â© 2024 All Rights Reserved

å®Œå…¨æœ¬åœ°åŒ–çš„å»ä¸­å¿ƒåŒ–å­˜å‚¨èŠ‚ç‚¹å®ç°,ä½¿ç”¨JSONæ–‡ä»¶è¿›è¡Œæ•°æ®æŒä¹…åŒ–,æ— éœ€åŒºå—é“¾ä¾èµ–ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- âœ… **å®Œå…¨æœ¬åœ°åŒ–**: æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
- âœ… **JSONæŒä¹…åŒ–**: ä½¿ç”¨JSONæ–‡ä»¶ç®¡ç†é…ç½®å’Œç´¢å¼•
- âœ… **äº¤äº’å¼æ§åˆ¶å°**: å‹å¥½çš„å‘½ä»¤è¡Œç•Œé¢
- âœ… **å¯†ç å­¦æ”¯æŒ**: åŸºäºPBCåº“çš„é…å¯¹å¯†ç å­¦
- âœ… **æ— åŒºå—é“¾ä¾èµ–**: ç‹¬ç«‹è¿è¡Œ,ä¸éœ€è¦ä»¥å¤ªåŠæˆ–å…¶ä»–åŒºå—é“¾

## ğŸ“‹ åŠŸèƒ½åˆ—è¡¨

1. **æ–‡ä»¶æ’å…¥** - æ’å…¥åŠ å¯†æ–‡ä»¶åŠå…¶ç´¢å¼•
2. **å…³é”®è¯æœç´¢** - åŸºäºç´¢å¼•çš„å…³é”®è¯æœç´¢
3. **æ–‡ä»¶æ£€ç´¢** - æ ¹æ®æ–‡ä»¶IDæ£€ç´¢åŠ å¯†æ–‡ä»¶
4. **æ–‡ä»¶åˆ é™¤** - åˆ é™¤æ–‡ä»¶åŠå…¶ç´¢å¼•
5. **å®Œæ•´æ€§è¯æ˜** - ç”Ÿæˆæ–‡ä»¶å®Œæ•´æ€§è¯æ˜
6. **çŠ¶æ€æŸ¥çœ‹** - æŸ¥çœ‹èŠ‚ç‚¹è¿è¡ŒçŠ¶æ€
7. **æ–‡ä»¶åˆ—è¡¨** - åˆ—å‡ºæ‰€æœ‰å­˜å‚¨çš„æ–‡ä»¶
8. **å…ƒæ•°æ®å¯¼å‡º** - å¯¼å‡ºæ–‡ä»¶å…ƒæ•°æ®åˆ°JSON

## ğŸ› ï¸ ä¾èµ–åº“

```bash
# å¿…éœ€çš„åº“
- OpenSSL (libssl-dev)
- PBC (libpbc-dev)
- GMP (libgmp-dev)
- JsonCpp (libjsoncpp-dev)
```

## ğŸ“¦ å®‰è£…ä¾èµ–

### Ubuntu/Debian

```bash
sudo apt-get update
sudo apt-get install -y \
    build-essential \
    libssl-dev \
    libgmp-dev \
    libpbc-dev \
    libjsoncpp-dev
```

### macOS

```bash
brew install openssl gmp pbc jsoncpp
```

## ğŸ”¨ ç¼–è¯‘

```bash
# ç¼–è¯‘æ‰€æœ‰æ–‡ä»¶
g++ -o storage_node main.cpp storage_node.cpp \
    -lpbc -lgmp -lssl -lcrypto -ljsoncpp -std=c++11

# æˆ–ä½¿ç”¨ä¼˜åŒ–ç¼–è¯‘
g++ -O2 -o storage_node main.cpp storage_node.cpp \
    -lpbc -lgmp -lssl -lcrypto -ljsoncpp -std=c++11
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨ç¨‹åº

```bash
# ä½¿ç”¨é»˜è®¤é…ç½® (æ•°æ®ç›®å½•: ./data, ç«¯å£: 9000)
./storage_node

# æŒ‡å®šæ•°æ®ç›®å½•
./storage_node /path/to/data

# æŒ‡å®šæ•°æ®ç›®å½•å’Œç«¯å£
./storage_node /path/to/data 8080
```

### é¦–æ¬¡è¿è¡Œ

ç¨‹åºé¦–æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºå¿…è¦çš„ç›®å½•å’Œé…ç½®æ–‡ä»¶:

```
data/
â”œâ”€â”€ config.json          # èŠ‚ç‚¹é…ç½®
â”œâ”€â”€ node_info.json       # èŠ‚ç‚¹ä¿¡æ¯
â”œâ”€â”€ index_db.json        # ç´¢å¼•æ•°æ®åº“
â”œâ”€â”€ files/               # åŠ å¯†æ–‡ä»¶å­˜å‚¨
â””â”€â”€ metadata/            # æ–‡ä»¶å…ƒæ•°æ®
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. æ’å…¥æ–‡ä»¶

å‡†å¤‡ä¸¤ä¸ªæ–‡ä»¶:

- `insert_params.json` - å‚æ•°æ–‡ä»¶
- `encrypted_file.enc` - åŠ å¯†æ–‡ä»¶

**insert_params.json æ ¼å¼:**

```json
{
    "file_id": "file_12345",
    "Ts": ["state_token_1", "state_token_2", "state_token_3"],
    "keywords": ["keyword_1", "keyword_2", "keyword_3"],
    "pointer": "encrypted_pointer_abc123",
    "file_auth_tag": "file_authentication_tag",
    "metadata": {
        "filename": "document.pdf",
        "size": 102400,
        "upload_time": "2025-11-09T10:30:00Z"
    }
}
```

åœ¨æ§åˆ¶å°ä¸­:

```
è¯·é€‰æ‹©æ“ä½œ [0-9]: 1
è¯·è¾“å…¥å‚æ•°JSONæ–‡ä»¶è·¯å¾„: ./insert_params.json
è¯·è¾“å…¥åŠ å¯†æ–‡ä»¶è·¯å¾„: ./encrypted_file.enc
```

### 2. æœç´¢å…³é”®è¯

```
è¯·é€‰æ‹©æ“ä½œ [0-9]: 2
è¯·è¾“å…¥æœç´¢ä»¤ç‰Œ (Ts): state_token_1
è¯·è¾“å…¥æœ€æ–°çŠ¶æ€ (å¯é€‰): 
è¯·è¾“å…¥ç§å­ (å¯é€‰): 
```

### 3. æ£€ç´¢æ–‡ä»¶

```
è¯·é€‰æ‹©æ“ä½œ [0-9]: 3
è¯·è¾“å…¥æ–‡ä»¶ID: file_12345
æ˜¯å¦ä¿å­˜å¯†æ–‡åˆ°æ–‡ä»¶? (y/n): y
è¾“å‡ºæ–‡ä»¶è·¯å¾„: ./retrieved_file.enc
```

### 4. åˆ é™¤æ–‡ä»¶

```
è¯·é€‰æ‹©æ“ä½œ [0-9]: 4
è¯·è¾“å…¥æ–‡ä»¶ID: file_12345
è¯·è¾“å…¥åˆ é™¤è¯æ˜ (å¯é€‰): 
ç¡®è®¤åˆ é™¤? (y/n): y
```

## ğŸ“Š JSONæ–‡ä»¶æ ¼å¼

### config.json

```json
{
    "version": "3.0",
    "node": {
        "node_id": "storage_node_001",
        "created_at": "2025-11-09T10:00:00Z"
    },
    "paths": {
        "data_dir": "./data",
        "files_dir": "./data/files",
        "metadata_dir": "./data/metadata",
        "index_db": "./data/index_db.json"
    },
    "server": {
        "port": 9000
    },
    "storage": {
        "max_file_size_mb": 100,
        "max_total_storage_gb": 10
    }
}
```

### node_info.json

```json
{
    "node_id": "storage_node_001",
    "status": "active",
    "last_updated": "2025-11-09T15:30:00Z",
    "statistics": {
        "total_files": 5,
        "total_index_entries": 15
    }
}
```

### index_db.json

```json
{
    "version": "1.0",
    "last_updated": "2025-11-09T15:30:00Z",
    "total_entries": 3,
    "indices": {
        "state_token_1": [
            {
                "Ts": "state_token_1",
                "keyword": "keyword_1",
                "pointer": "encrypted_pointer",
                "file_identifier": "file_12345",
                "valid": true
            }
        ]
    }
}
```

## ğŸ”’ å®‰å…¨è¯´æ˜

1. **å¯†é’¥ç®¡ç†**: ç¡®ä¿åŠ å¯†å¯†é’¥å®‰å…¨å­˜å‚¨
2. **è®¿é—®æ§åˆ¶**: é™åˆ¶æ•°æ®ç›®å½•çš„è®¿é—®æƒé™
3. **å¤‡ä»½**: å®šæœŸå¤‡ä»½ `data/` ç›®å½•
4. **ä¼ è¾“å®‰å…¨**: åŠ å¯†æ–‡ä»¶åœ¨ä¼ è¾“æ—¶ä½¿ç”¨å®‰å…¨é€šé“

## ğŸ› æ•…éšœæ’æŸ¥

### ç¼–è¯‘é”™è¯¯

**é—®é¢˜**: æ‰¾ä¸åˆ°PBCåº“

```
solution: ç¡®ä¿å·²å®‰è£… libpbc-dev
sudo apt-get install libpbc-dev
```

**é—®é¢˜**: æ‰¾ä¸åˆ°jsoncpp

```
solution: ç¡®ä¿å·²å®‰è£… libjsoncpp-dev
sudo apt-get install libjsoncpp-dev
```

### è¿è¡Œæ—¶é”™è¯¯

**é—®é¢˜**: æ— æ³•åˆ›å»ºç›®å½•

```
solution: æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæƒé™
chmod 755 data/
```

**é—®é¢˜**: JSONè§£æå¤±è´¥

```
solution: æ£€æŸ¥JSONæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
ä½¿ç”¨åœ¨çº¿JSONéªŒè¯å™¨: https://jsonlint.com/
```

## ğŸ“– APIå‚è€ƒ

### StorageNode ç±»

#### æ„é€ å‡½æ•°

```cpp
StorageNode(const std::string& data_directory = "./data", int port = 9000);
```

#### ä¸»è¦æ–¹æ³•

```cpp
// åˆå§‹åŒ–
bool setup_cryptography();
bool initialize_directories();
bool load_config();

// æ–‡ä»¶æ“ä½œ
bool insert_file(const std::string& param_json_path, const std::string& enc_file_path);
bool delete_file(const std::string& file_id, const std::string& del_proof);
SearchResult search_keyword(const std::string& search_token, ...);
Json::Value retrieve_file(const std::string& file_id);

// å·¥å…·æ–¹æ³•
std::vector<std::string> list_all_files();
Json::Value get_file_metadata(const std::string& file_id);
bool export_file_metadata(const std::string& file_id, const std::string& output_path);
```

## ğŸ”„ ç‰ˆæœ¬å†å²

### v3.0 (å½“å‰ç‰ˆæœ¬)

- âœ… å®Œå…¨æœ¬åœ°åŒ–,ç§»é™¤æ‰€æœ‰åŒºå—é“¾ä¾èµ–
- âœ… JSONæ–‡ä»¶æŒä¹…åŒ–
- âœ… äº¤äº’å¼æ§åˆ¶å°ç•Œé¢
- âœ… ç®€åŒ–çš„æ–‡ä»¶æ’å…¥æµç¨‹

### v2.0

- å¢å¼ºçš„ç³»ç»Ÿå¥åº·æ£€æŸ¥
- äº¤æ˜“å‰å¼ºåˆ¶éªŒè¯
- è¯¦ç»†çš„é”™è¯¯è¯Šæ–­

### v1.0

- åŸºç¡€å­˜å‚¨åŠŸèƒ½
- åŒºå—é“¾é›†æˆ
- å¯†ç å­¦æ”¯æŒ

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿æäº¤é—®é¢˜å’Œæ‹‰å–è¯·æ±‚!

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜,è¯·é€šè¿‡GitHub Issuesè”ç³»ã€‚

---

**æ³¨æ„**: æ­¤ç‰ˆæœ¬ä¸ºæœ¬åœ°å­˜å‚¨ç‰ˆæœ¬,ä¸åŒ…å«åŒºå—é“¾åŠŸèƒ½ã€‚å¦‚éœ€åŒºå—é“¾é›†æˆ,è¯·å‚è€ƒv2.0ç‰ˆæœ¬ã€‚
