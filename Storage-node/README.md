# å»ä¸­å¿ƒåŒ–å­˜å‚¨èŠ‚ç‚¹ç³»ç»Ÿ v3.2 - æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](https://45659418.sdppt.com/chat/fb64931c-726a-432d-8316-20fe3e1bdd76#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0)
2. [ç³»ç»Ÿæ¶æ„](https://45659418.sdppt.com/chat/fb64931c-726a-432d-8316-20fe3e1bdd76#%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84)
3. [æ•°æ®ç»“æ„è¯¦è§£](https://45659418.sdppt.com/chat/fb64931c-726a-432d-8316-20fe3e1bdd76#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AF%A6%E8%A7%A3)
4. [å‡½æ•°è¯¦ç»†è¯´æ˜](https://45659418.sdppt.com/chat/fb64931c-726a-432d-8316-20fe3e1bdd76#%E5%87%BD%E6%95%B0%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E)
5. [æ“ä½œæµç¨‹å›¾](https://45659418.sdppt.com/chat/fb64931c-726a-432d-8316-20fe3e1bdd76#%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%9B%BE)
6. [æ–‡ä»¶ä¸æ•°æ®åº“æ›´æ–°æœºåˆ¶](https://45659418.sdppt.com/chat/fb64931c-726a-432d-8316-20fe3e1bdd76#%E6%96%87%E4%BB%B6%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9B%B4%E6%96%B0%E6%9C%BA%E5%88%B6)
7. [ä½¿ç”¨ç¤ºä¾‹](https://45659418.sdppt.com/chat/fb64931c-726a-432d-8316-20fe3e1bdd76#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B)

---

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºå¯†ç å­¦çš„å»ä¸­å¿ƒåŒ–å­˜å‚¨èŠ‚ç‚¹ç³»ç»Ÿï¼Œæ”¯æŒå®‰å…¨çš„æ–‡ä»¶å­˜å‚¨ã€å¯æœç´¢åŠ å¯†ã€èº«ä»½éªŒè¯å’Œå®Œæ•´æ€§è¯æ˜ã€‚

### æ ¸å¿ƒç‰¹æ€§

* âœ… **å®Œå…¨æœ¬åœ°åŒ–å­˜å‚¨** - æ— åŒºå—é“¾ä¾èµ–
* âœ… **å¯æœç´¢åŠ å¯†** - æ”¯æŒåŠ å¯†æ•°æ®ä¸Šçš„å…³é”®è¯æœç´¢
* âœ… **èº«ä»½éªŒè¯** - åŸºäºå®¢æˆ·ç«¯å…¬é’¥çš„è®¿é—®æ§åˆ¶
* âœ… **å®Œæ•´æ€§è¯æ˜** - å¯éªŒè¯æ•°æ®å®Œæ•´æ€§
* âœ… **å…¬å…±å‚æ•°æŒä¹…åŒ–** - å¯†ç å­¦å‚æ•°å¯ä¿å­˜å’ŒåŠ è½½
* âœ… **æ–‡ä»¶çŠ¶æ€ç®¡ç†** - æ”¯æŒæ–‡ä»¶æ ‡è®°ä¸ºæœ‰æ•ˆ/æ— æ•ˆ

### æŠ€æœ¯æ ˆ

* **è¯­è¨€**: C++
* **å¯†ç å­¦åº“**: PBC (Pairing-Based Cryptography), OpenSSL
* **æ•°æ®æ ¼å¼**: JSON
* **å¤§æ•°è¿ç®—**: GMP

---

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   äº¤äº’å¼æ§åˆ¶å° (main.cpp)                 â”‚
â”‚  - èœå•ç³»ç»Ÿ                                              â”‚
â”‚  - ç”¨æˆ·è¾“å…¥å¤„ç†                                          â”‚
â”‚  - æ“ä½œè°ƒåº¦                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å­˜å‚¨èŠ‚ç‚¹æ ¸å¿ƒ (StorageNode)                   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ æ–‡ä»¶ç®¡ç†    â”‚  â”‚ ç´¢å¼•ç®¡ç†    â”‚  â”‚ å¯†ç å­¦æ¨¡å—  â”‚    â”‚
â”‚  â”‚ - æ’å…¥      â”‚  â”‚ - æœç´¢      â”‚  â”‚ - Setup     â”‚    â”‚
â”‚  â”‚ - åˆ é™¤      â”‚  â”‚ - æ›´æ–°      â”‚  â”‚ - Hash      â”‚    â”‚
â”‚  â”‚ - æ£€ç´¢      â”‚  â”‚ - æŒä¹…åŒ–    â”‚  â”‚ - é…å¯¹      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æŒä¹…åŒ–å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ–‡ä»¶ç³»ç»Ÿ     â”‚  â”‚ ç´¢å¼•æ•°æ®åº“   â”‚  â”‚ å…ƒæ•°æ®       â”‚ â”‚
â”‚  â”‚ (.encæ–‡ä»¶)   â”‚  â”‚ (JSON)       â”‚  â”‚ (JSON)       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„

```
./data/
â”œâ”€â”€ config.json              # èŠ‚ç‚¹é…ç½®
â”œâ”€â”€ public_params.json       # å…¬å…±å¯†ç å­¦å‚æ•°
â”œâ”€â”€ index_db.json            # ç´¢å¼•æ•°æ®åº“
â”œâ”€â”€ node_info.json           # èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯
â”œâ”€â”€ files/                   # åŠ å¯†æ–‡ä»¶å­˜å‚¨
â”‚   â””â”€â”€ file_id.enc
â””â”€â”€ metadata/                # æ–‡ä»¶å…ƒæ•°æ®
    â””â”€â”€ file_id.json
```

---

## æ•°æ®ç»“æ„è¯¦è§£

### 1. IndexEntry (ç´¢å¼•æ¡ç›®)

```cpp
struct IndexEntry {
    std::string PK;              // å®¢æˆ·ç«¯å…¬é’¥ (ç”¨äºèº«ä»½éªŒè¯)
    std::string Ts;              // çŠ¶æ€ä»¤ç‰Œ (æœç´¢ä»¤ç‰Œ T_i)
    std::string keyword;         // å…³é”®è¯åŠ å¯†å€¼ (kt_i)
    std::string pointer;         // åŠ å¯†æ–‡ä»¶æŒ‡é’ˆ
    std::string file_identifier; // æ–‡ä»¶å”¯ä¸€æ ‡è¯† (ID_F)
    std::string state;           // çŠ¶æ€: "valid" æˆ– "invalid"
};
```

**ç”¨é€”**: æ”¯æŒå¯æœç´¢åŠ å¯†ï¼Œå°†åŠ å¯†å…³é”®è¯æ˜ å°„åˆ°æ–‡ä»¶ID

### 2. FileData (æ–‡ä»¶æ•°æ®)

```cpp
struct FileData {
    std::string PK;              // å®¢æˆ·ç«¯å…¬é’¥ (æ‰€æœ‰è€…æ ‡è¯†)
    std::string file_id;         // æ–‡ä»¶å”¯ä¸€æ ‡è¯† (ID_F)
    std::string ciphertext;      // åŠ å¯†æ–‡ä»¶å†…å®¹
    std::string pointer;         // æ–‡ä»¶æŒ‡é’ˆ (ptr)
    std::string file_auth_tag;   // æ–‡ä»¶è®¤è¯æ ‡ç­¾ (TS_F)
    std::string state;           // çŠ¶æ€: "valid" æˆ– "invalid"
};
```

**ç”¨é€”**: å­˜å‚¨åŠ å¯†æ–‡ä»¶åŠå…¶å…ƒæ•°æ®

### 3. SearchResult (æœç´¢ç»“æœ)

```cpp
struct SearchResult {
    std::vector<std::string> file_identifiers;  // åŒ¹é…çš„æ–‡ä»¶IDåˆ—è¡¨
    std::vector<std::string> keyword_proofs;    // å…³é”®è¯è¯æ˜åˆ—è¡¨
    std::string aggregated_proof;               // èšåˆè¯æ˜
};
```

**ç”¨é€”**: è¿”å›å…³é”®è¯æœç´¢ç»“æœ

---

## å‡½æ•°è¯¦ç»†è¯´æ˜

### ğŸ”§ åˆå§‹åŒ–å‡½æ•°

#### 1. `StorageNode::StorageNode()`

**è¾“å…¥**:

* `data_directory`: æ•°æ®ç›®å½•è·¯å¾„ (é»˜è®¤: `./data`)
* `port`: æœåŠ¡å™¨ç«¯å£ (é»˜è®¤: 9000)

**è¾“å‡º**: StorageNodeå¯¹è±¡å®ä¾‹

**æµç¨‹**:

```
1. è®¾ç½®æ•°æ®ç›®å½•è·¯å¾„
   â”œâ”€ data_dir = data_directory
   â”œâ”€ files_dir = data_dir + "/files"
   â””â”€ metadata_dir = data_dir + "/metadata"

2. ç”ŸæˆèŠ‚ç‚¹ID
   â””â”€ node_id = "node_" + å½“å‰æ—¶é—´æˆ³

3. åˆå§‹åŒ–æ ‡å¿—
   â””â”€ crypto_initialized = false
```

#### 2. `setup_cryptography()`

**è¾“å…¥**:

* `security_param`: å®‰å…¨å‚æ•°K (æ¯”ç‰¹ä½æ•°ï¼Œå¦‚512)
* `public_params_path`: å…¬å…±å‚æ•°ä¿å­˜è·¯å¾„ (å¯é€‰)

**è¾“å‡º**: `bool` - æˆåŠŸè¿”å›true

**æµç¨‹**:

```
1. åˆå§‹åŒ–é…å¯¹å‚æ•° (Type A pairing)
   â”œâ”€ ä½¿ç”¨é¢„å®šä¹‰çš„æ¤­åœ†æ›²çº¿å‚æ•°
   â”œâ”€ q = å¤§ç´ æ•° (ç¾¤çš„é˜¶)
   â””â”€ åˆå§‹åŒ– pairing_t ç»“æ„

2. åˆå§‹åŒ–ç¾¤å…ƒç´ 
   â”œâ”€ element_init_G1(g, pairing)  // ç”Ÿæˆå…ƒ g âˆˆ Gâ‚
   â”œâ”€ element_init_G1(mu, pairing) // å…ƒç´  Î¼ âˆˆ Gâ‚
   â””â”€ mpz_init(N)                  // å¤§æ•´æ•° N

3. éšæœºç”Ÿæˆå¯†ç å­¦å‚æ•°
   â”œâ”€ element_random(g)   // éšæœºç”Ÿæˆ g
   â”œâ”€ element_random(mu)  // éšæœºç”Ÿæˆ Î¼
   â””â”€ N = 1000000007      // è®¾ç½®å¤§ç´ æ•°

4. è®¾ç½®åˆå§‹åŒ–æ ‡å¿—
   â””â”€ crypto_initialized = true

5. (å¯é€‰) ä¿å­˜å…¬å…±å‚æ•°
   â””â”€ å¦‚æœæä¾›è·¯å¾„ï¼Œè°ƒç”¨ save_public_params()
```

**å…¬å…±å‚æ•° PP = {p, q, Gâ‚, Gâ‚‚, e}**:

* `p, q`: ç¾¤çš„é˜¶ (ç´ æ•°)
* `Gâ‚`: æ¤­åœ†æ›²çº¿åŠ æ³•ç¾¤
* `Gâ‚‚`: ç›®æ ‡ä¹˜æ³•ç¾¤
* `e`: åŒçº¿æ€§é…å¯¹ e: Gâ‚ Ã— Gâ‚ â†’ Gâ‚‚

#### 3. `initialize_directories()`

**è¾“å…¥**: æ— 

**è¾“å‡º**: `bool` - æˆåŠŸè¿”å›true

**æµç¨‹**:

```
1. åˆ›å»ºä¸»æ•°æ®ç›®å½•
   â””â”€ mkdir(data_dir)

2. åˆ›å»ºæ–‡ä»¶å­˜å‚¨ç›®å½•
   â””â”€ mkdir(files_dir)

3. åˆ›å»ºå…ƒæ•°æ®ç›®å½•
   â””â”€ mkdir(metadata_dir)

4. è¿”å›åˆ›å»ºç»“æœ
```

---

### ğŸ” å¯†ç å­¦å‡½æ•°

#### 4. `compute_hash_H1()`

**è¾“å…¥**: `input` - å¾…å“ˆå¸Œå­—ç¬¦ä¸²

**è¾“å‡º**: `string` - åå…­è¿›åˆ¶å“ˆå¸Œå€¼

**æµç¨‹**:

```
Hâ‚: {0,1}* â†’ {0,1}Â²âµâ¶

1. SHA256(input) â†’ hash[32 bytes]
2. bytes_to_hex(hash) â†’ åå…­è¿›åˆ¶å­—ç¬¦ä¸²
3. è¿”å›ç»“æœ
```

**ç”¨é€”**: ç”Ÿæˆæ–‡ä»¶IDã€è®¡ç®—å®Œæ•´æ€§è¯æ˜

#### 5. `compute_hash_H2()`

**è¾“å…¥**:

* `result`: è¾“å‡ºå…ƒç´  (element\_t)
* `input`: å¾…å“ˆå¸Œå­—ç¬¦ä¸²

**è¾“å‡º**: æ—  (é€šè¿‡resultå‚æ•°è¿”å›)

**æµç¨‹**:

```
Hâ‚‚: {0,1}* â†’ Gâ‚

1. SHA256(input) â†’ hash[32 bytes]
2. element_from_hash(result, hash) â†’ å°†å“ˆå¸Œæ˜ å°„åˆ°Gâ‚ç¾¤å…ƒç´ 
```

**ç”¨é€”**: å°†å­—ç¬¦ä¸²æ˜ å°„åˆ°æ¤­åœ†æ›²çº¿ç‚¹

#### 6. `compute_hash_H3()`

**è¾“å…¥**: `input` - å¾…å“ˆå¸Œå­—ç¬¦ä¸²

**è¾“å‡º**: `string` - å‰16å­—èŠ‚çš„åå…­è¿›åˆ¶

**æµç¨‹**:

```
Hâ‚ƒ: {0,1}* â†’ {0,1}Â¹Â²â¸

1. SHA256(input) â†’ hash[32 bytes]
2. å–å‰16å­—èŠ‚
3. bytes_to_hex(hash[0:16]) â†’ åå…­è¿›åˆ¶å­—ç¬¦ä¸²
```

**ç”¨é€”**: ç”ŸæˆçŸ­å“ˆå¸Œå€¼

#### 7. `compute_prf()`

**è¾“å…¥**:

* `result`: è¾“å‡ºæ•´æ•° (mpz\_t)
* `seed`: ç§å­
* `input`: è¾“å…¥å€¼

**è¾“å‡º**: æ—  (é€šè¿‡resultå‚æ•°è¿”å›)

**æµç¨‹**:

```
PRF: {0,1}áµ Ã— {0,1}* â†’ â„¤N

1. combined = seed || input
2. hash_hex = Hâ‚(combined)
3. mpz_set_str(result, hash_hex, 16)  // åå…­è¿›åˆ¶è½¬å¤§æ•´æ•°
4. result = result mod N
```

**ç”¨é€”**: ä¼ªéšæœºå‡½æ•°ï¼Œç”¨äºå¯†é’¥æ´¾ç”Ÿ

---

### ğŸ“ æ–‡ä»¶æ“ä½œå‡½æ•°

#### 8. `insert_file()`

**è¾“å…¥**:

* `param_json_path`: å‚æ•°JSONæ–‡ä»¶è·¯å¾„
* `enc_file_path`: åŠ å¯†æ–‡ä»¶è·¯å¾„

**JSONæ ¼å¼**:

```json
{
  "PK": "å®¢æˆ·ç«¯å…¬é’¥(hex)",
  "ID_F": "æ–‡ä»¶å”¯ä¸€æ ‡è¯†",
  "ptr": "æ–‡ä»¶æŒ‡é’ˆ(åŠ å¯†)",
  "TS_F": "æ–‡ä»¶è®¤è¯æ ‡ç­¾",
  "state": "valid",
  "keywords": [
    {"T_i": "æœç´¢ä»¤ç‰Œ1", "kt_i": "å…³é”®è¯åŠ å¯†å€¼1"},
    {"T_i": "æœç´¢ä»¤ç‰Œ2", "kt_i": "å…³é”®è¯åŠ å¯†å€¼2"}
  ]
}
```

**è¾“å‡º**: `bool` - æˆåŠŸè¿”å›true

**è¯¦ç»†æµç¨‹**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å‚æ•°éªŒè¯é˜¶æ®µ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ£€æŸ¥å‚æ•°æ–‡ä»¶æ˜¯å¦å­˜åœ¨                   â”‚
â”‚ â€¢ è§£æJSONï¼ŒéªŒè¯å¿…éœ€å­—æ®µ                 â”‚
â”‚ â€¢ éªŒè¯PKæ ¼å¼ (hexå­—ç¬¦ä¸²)                â”‚
â”‚ â€¢ æ£€æŸ¥æ–‡ä»¶IDæ˜¯å¦å·²å­˜åœ¨                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è¯»å–åŠ å¯†æ–‡ä»¶                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ è¯»å–enc_file_pathçš„äºŒè¿›åˆ¶å†…å®¹         â”‚
â”‚ â€¢ å­˜å‚¨åˆ°ciphertextå˜é‡                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åˆ›å»ºæ–‡ä»¶æ•°æ®å¯¹è±¡                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FileData {                              â”‚
â”‚   PK: params["PK"]                      â”‚
â”‚   file_id: params["ID_F"]               â”‚
â”‚   ciphertext: è¯»å–çš„æ–‡ä»¶å†…å®¹             â”‚
â”‚   pointer: params["ptr"]                â”‚
â”‚   file_auth_tag: params["TS_F"]         â”‚
â”‚   state: params["state"] (é»˜è®¤"valid")  â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å­˜å‚¨åˆ°å†…å­˜æ˜ å°„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ file_storage[file_id] = file_data       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ä¿å­˜åŠ å¯†æ–‡ä»¶åˆ°æ–‡ä»¶ç³»ç»Ÿ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç›®æ ‡è·¯å¾„: files_dir/file_id.enc         â”‚
â”‚ å¤åˆ¶æ–‡ä»¶å†…å®¹                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. å¤„ç†å…³é”®è¯ç´¢å¼•                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FOR EACH keyword in params["keywords"]: â”‚
â”‚   â”œâ”€ éªŒè¯T_iå’Œkt_iå­—æ®µå­˜åœ¨              â”‚
â”‚   â”œâ”€ åˆ›å»ºIndexEntryå¯¹è±¡                 â”‚
â”‚   â”‚   â”œâ”€ PK = params["PK"]              â”‚
â”‚   â”‚   â”œâ”€ Ts = keyword["T_i"]            â”‚
â”‚   â”‚   â”œâ”€ keyword = keyword["kt_i"]      â”‚
â”‚   â”‚   â”œâ”€ pointer = params["ptr"]        â”‚
â”‚   â”‚   â”œâ”€ file_identifier = file_id     â”‚
â”‚   â”‚   â””â”€ state = "valid"                â”‚
â”‚   â””â”€ index_database[Ts].push(entry)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ä¿å­˜å…ƒæ•°æ®                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ›å»ºmetadata JSON:                      â”‚
â”‚ {                                       â”‚
â”‚   "PK": PK,                             â”‚
â”‚   "file_id": file_id,                   â”‚
â”‚   "file_size": ciphertext.length(),     â”‚
â”‚   "keyword_count": å…³é”®è¯æ•°é‡,           â”‚
â”‚   "state": "valid",                     â”‚
â”‚   "insert_time": å½“å‰æ—¶é—´æˆ³,            â”‚
â”‚   "success": true                       â”‚
â”‚ }                                       â”‚
â”‚ ä¿å­˜åˆ°: metadata_dir/file_id.json       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. æŒä¹…åŒ–æ›´æ–°                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ save_index_database()                 â”‚
â”‚ â€¢ update_statistics("insert")           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ–‡ä»¶ç³»ç»Ÿæ›´æ–°**:

* `files/file_id.enc` - æ–°å¢åŠ å¯†æ–‡ä»¶
* `metadata/file_id.json` - æ–°å¢å…ƒæ•°æ®æ–‡ä»¶
* `index_db.json` - æ›´æ–°ç´¢å¼•æ•°æ®åº“
* `node_info.json` - æ›´æ–°ç»Ÿè®¡ä¿¡æ¯

#### 9. `delete_file()`

**è¾“å…¥**:

* `PK`: å®¢æˆ·ç«¯å…¬é’¥ (èº«ä»½éªŒè¯)
* `file_id`: æ–‡ä»¶ID
* `del_proof`: åˆ é™¤è¯æ˜ (å¯é€‰)

**è¾“å‡º**: `bool` - æˆåŠŸè¿”å›true

**è¯¦ç»†æµç¨‹**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. èº«ä»½éªŒè¯é˜¶æ®µ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ éªŒè¯PKæ ¼å¼                            â”‚
â”‚ â€¢ æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨                       â”‚
â”‚ â€¢ è·å–æ–‡ä»¶æ‰€æœ‰è€…PK                      â”‚
â”‚ â€¢ æ¯”è¾ƒè¯·æ±‚è€…PKä¸æ–‡ä»¶æ‰€æœ‰è€…PK            â”‚
â”‚   â””â”€ å¦‚æœä¸åŒ¹é… â†’ è¿”å›é”™è¯¯              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ ‡è®°ç´¢å¼•ä¸ºæ— æ•ˆ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FOR EACH (token, entries) in index_db:  â”‚
â”‚   FOR EACH entry in entries:            â”‚
â”‚     IF entry.file_identifier == file_id â”‚
â”‚        AND entry.PK == PK:              â”‚
â”‚       â””â”€ entry.state = "invalid"        â”‚
â”‚                                         â”‚
â”‚ ç»Ÿè®¡æ ‡è®°æ•°é‡ â†’ marked_count             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ›´æ–°æ–‡ä»¶çŠ¶æ€                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ file_storage[file_id].state = "invalid" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æŒä¹…åŒ–æ›´æ–°                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ save_index_database()                 â”‚
â”‚ â€¢ update_statistics("delete")           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ³¨æ„**: æ–‡ä»¶ä¸ä¼šè¢«ç‰©ç†åˆ é™¤ï¼Œåªæ˜¯æ ‡è®°ä¸º"invalid"

#### 10. `search_keyword()`

**è¾“å…¥**:

* `PK`: å®¢æˆ·ç«¯å…¬é’¥ (èº«ä»½è¿‡æ»¤)
* `search_token`: æœç´¢ä»¤ç‰Œ (T\_i)
* `latest_state`: æœ€æ–°çŠ¶æ€ (å¯é€‰)
* `seed`: ç§å­ (å¯é€‰)

**è¾“å‡º**: `SearchResult` å¯¹è±¡

**è¯¦ç»†æµç¨‹**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å‚æ•°éªŒè¯                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ éªŒè¯PKæ ¼å¼                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æŸ¥æ‰¾ç´¢å¼•                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åœ¨index_databaseä¸­æŸ¥æ‰¾search_token      â”‚
â”‚   â””â”€ auto it = index_db.find(token)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è¿‡æ»¤ç»“æœ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IF æ‰¾åˆ°ç´¢å¼•æ¡ç›®:                        â”‚
â”‚   FOR EACH entry in entries:            â”‚
â”‚     IF entry.PK == PK                   â”‚
â”‚        AND entry.state == "valid":      â”‚
â”‚       â”œâ”€ result.file_identifiers.add(   â”‚
â”‚       â”‚     entry.file_identifier)      â”‚
â”‚       â””â”€ result.keyword_proofs.add(     â”‚
â”‚             entry.keyword)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è¿”å›ç»“æœ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SearchResult {                          â”‚
â”‚   file_identifiers: [IDâ‚, IDâ‚‚, ...],   â”‚
â”‚   keyword_proofs: [ktâ‚, ktâ‚‚, ...]      â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æœç´¢é€»è¾‘**:

* åªè¿”å›åŒ¹é…PKçš„æ–‡ä»¶ (éšç§ä¿æŠ¤)
* åªè¿”å›state="valid"çš„æ–‡ä»¶ (æ’é™¤å·²åˆ é™¤æ–‡ä»¶)

#### 11. `retrieve_file()`

**è¾“å…¥**: `file_id` - æ–‡ä»¶ID

**è¾“å‡º**: `Json::Value` - æ–‡ä»¶æ•°æ®JSON

**æµç¨‹**:

```
1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   â””â”€ IF NOT has_file(file_id) â†’ è¿”å›é”™è¯¯

2. è·å–æ–‡ä»¶æ•°æ®
   â””â”€ const FileData& data = file_storage[file_id]

3. æ„é€ è¿”å›JSON
   {
     "success": true,
     "PK": data.PK,
     "file_id": file_id,
     "ciphertext": data.ciphertext,
     "pointer": data.pointer,
     "file_auth_tag": data.file_auth_tag,
     "state": data.state
   }

4. è¿”å›JSONå¯¹è±¡
```

#### 12. `generate_integrity_proof()`

**è¾“å…¥**:

* `file_id`: æ–‡ä»¶ID
* `seed`: ç§å­å€¼ (å¯é€‰)

**è¾“å‡º**: `string` - å®Œæ•´æ€§è¯æ˜ (åå…­è¿›åˆ¶)

**æµç¨‹**:

```
1. æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§
   â””â”€ IF NOT has_file(file_id) â†’ è¿”å›ç©ºå­—ç¬¦ä¸²

2. è·å–æ–‡ä»¶æ•°æ®
   â””â”€ const FileData& data = file_storage[file_id]

3. è®¡ç®—å®Œæ•´æ€§è¯æ˜
   combined = file_id || data.file_auth_tag || seed
   proof = Hâ‚(combined)

4. è¿”å›è¯æ˜
```

**ç”¨é€”**: éªŒè¯æ–‡ä»¶æœªè¢«ç¯¡æ”¹

---

### ğŸ’¾ æŒä¹…åŒ–å‡½æ•°

#### 13. `save_index_database()`

**è¾“å…¥**: æ— 

**è¾“å‡º**: `bool` - æˆåŠŸè¿”å›true

**JSONç»“æ„**:

```json
{
  "version": "3.2",
  "last_update": "2024-01-01T12:00:00Z",
  "indices": {
    "search_token_1": [
      {
        "PK": "å…¬é’¥1",
        "Ts": "çŠ¶æ€ä»¤ç‰Œ",
        "keyword": "å…³é”®è¯åŠ å¯†å€¼",
        "pointer": "æ–‡ä»¶æŒ‡é’ˆ",
        "file_identifier": "æ–‡ä»¶ID",
        "state": "valid"
      }
    ],
    "search_token_2": [...]
  }
}
```

**æµç¨‹**:

```
1. åˆ›å»ºæ ¹JSONå¯¹è±¡
   â”œâ”€ version: "3.2"
   â””â”€ last_update: å½“å‰æ—¶é—´æˆ³

2. éå†index_databaseæ˜ å°„
   FOR EACH (token, entries) in index_database:
     FOR EACH entry in entries:
       â”œâ”€ åˆ›å»ºentry_jsonå¯¹è±¡
       â””â”€ indices[token].append(entry_json)

3. ä¿å­˜åˆ°æ–‡ä»¶
   â””â”€ save_json_to_file(root, "index_db.json")
```

#### 14. `load_index_database()`

**è¾“å…¥**: æ— 

**è¾“å‡º**: `bool` - æˆåŠŸè¿”å›true

**æµç¨‹**:

```
1. æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§
   â””â”€ IF NOT exists("index_db.json") â†’ åˆ›å»ºæ–°æ•°æ®åº“

2. åŠ è½½JSONæ–‡ä»¶
   â””â”€ Json::Value root = load_json_from_file(...)

3. æ¸…ç©ºå†…å­˜æ•°æ®åº“
   â””â”€ index_database.clear()

4. è§£æJSONå¹¶å¡«å……æ˜ å°„
   FOR EACH token in root["indices"]:
     FOR EACH entry_json in root["indices"][token]:
       â”œâ”€ åˆ›å»ºIndexEntryå¯¹è±¡
       â”œâ”€ å¡«å……å­—æ®µ
       â””â”€ index_database[token].push(entry)

5. è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
```

#### 15. `save_public_params()`

**è¾“å…¥**: `filepath` - ä¿å­˜è·¯å¾„

**è¾“å‡º**: `bool` - æˆåŠŸè¿”å›true

**JSONç»“æ„**:

```json
{
  "version": "1.0",
  "created_at": "2024-01-01T12:00:00Z",
  "description": "Public Parameters for Decentralized Storage System",
  "public_params": {
    "p": "å¤§ç´ æ•°(ç¾¤Gâ‚çš„é˜¶)",
    "q": "å¤§ç´ æ•°(ç¾¤Gâ‚‚çš„é˜¶)",
    "G_1": {
      "type": "G1 (Elliptic Curve Group)",
      "order": "ç¾¤çš„é˜¶",
      "description": "Additive group on elliptic curve",
      "generator_g_hex": "ç”Ÿæˆå…ƒgçš„åå…­è¿›åˆ¶è¡¨ç¤º"
    },
    "G_2": {
      "type": "G_T (Target Group)",
      "order": "ç¾¤çš„é˜¶",
      "description": "Multiplicative target group for pairing"
    },
    "e": {
      "type": "Bilinear Pairing",
      "mapping": "e: G_1 Ã— G_1 â†’ G_2",
      "properties": ["bilinearity", "non-degeneracy", "computability"],
      "pairing_type": "type_a (symmetric)"
    }
  }
}
```

**æµç¨‹**:

```
1. éªŒè¯å¯†ç å­¦ç³»ç»Ÿå·²åˆå§‹åŒ–

2. æ„é€ å…¬å…±å‚æ•°JSON
   â”œâ”€ è®¾ç½®ç‰ˆæœ¬å’Œæ—¶é—´æˆ³
   â”œâ”€ æ·»åŠ p, q (ç¾¤çš„é˜¶)
   â”œâ”€ åºåˆ—åŒ–ç”Ÿæˆå…ƒg
   â”‚   â””â”€ element_to_bytes() â†’ hex
   â”œâ”€ æè¿°Gâ‚ç¾¤ä¿¡æ¯
   â”œâ”€ æè¿°Gâ‚‚ç¾¤ä¿¡æ¯
   â””â”€ æè¿°é…å¯¹eçš„æ€§è´¨

3. ä¿å­˜åˆ°JSONæ–‡ä»¶
```

---

## æ“ä½œæµç¨‹å›¾

### æµç¨‹1: æ–‡ä»¶æ’å…¥å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¾“å…¥   â”‚
â”‚ â€¢ å‚æ•°JSON   â”‚
â”‚ â€¢ åŠ å¯†æ–‡ä»¶   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           1. å‚æ•°éªŒè¯ä¸è§£æ                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ è¯»å–å‚æ•°JSONæ–‡ä»¶                       â”‚  â”‚
â”‚  â”‚ â€¢ éªŒè¯å¿…éœ€å­—æ®µ: PK, ID_F, ptr, TS_F     â”‚  â”‚
â”‚  â”‚ â€¢ éªŒè¯PKæ ¼å¼(hexå­—ç¬¦ä¸²)                  â”‚  â”‚
â”‚  â”‚ â€¢ æ£€æŸ¥æ–‡ä»¶IDé‡å¤æ€§                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           2. è¯»å–åŠ å¯†æ–‡ä»¶                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ read_file_content(enc_file_path)         â”‚  â”‚
â”‚  â”‚   â†’ ciphertext (äºŒè¿›åˆ¶æ•°æ®)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           3. å†…å­˜æ•°æ®ç»“æ„æ›´æ–°                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FileDataå¯¹è±¡åˆ›å»º:                        â”‚  â”‚
â”‚  â”‚   file_storage[file_id] = {              â”‚  â”‚
â”‚  â”‚     PK, file_id, ciphertext,             â”‚  â”‚
â”‚  â”‚     pointer, file_auth_tag, state        â”‚  â”‚
â”‚  â”‚   }                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           4. æ–‡ä»¶ç³»ç»ŸæŒä¹…åŒ–                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å¤åˆ¶åŠ å¯†æ–‡ä»¶åˆ°:                          â”‚  â”‚
â”‚  â”‚   files_dir/file_id.enc                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           5. ç´¢å¼•æ•°æ®åº“æ›´æ–°                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FOR EACH keyword in params["keywords"]:  â”‚  â”‚
â”‚  â”‚   åˆ›å»ºIndexEntry {                       â”‚  â”‚
â”‚  â”‚     PK, Ts=T_i, keyword=kt_i,           â”‚  â”‚
â”‚  â”‚     pointer, file_identifier, state     â”‚  â”‚
â”‚  â”‚   }                                      â”‚  â”‚
â”‚  â”‚   index_database[Ts].push(entry)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           6. å…ƒæ•°æ®æŒä¹…åŒ–                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åˆ›å»ºmetadata JSON:                       â”‚  â”‚
â”‚  â”‚   { PK, file_id, file_size,             â”‚  â”‚
â”‚  â”‚     keyword_count, state,               â”‚  â”‚
â”‚  â”‚     insert_time }                       â”‚  â”‚
â”‚  â”‚ ä¿å­˜åˆ°: metadata_dir/file_id.json       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           7. æ•°æ®åº“æŒä¹…åŒ–                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ save_index_database()                  â”‚  â”‚
â”‚  â”‚   â†’ æ›´æ–° index_db.json                   â”‚  â”‚
â”‚  â”‚                                          â”‚  â”‚
â”‚  â”‚ â€¢ update_statistics("insert")            â”‚  â”‚
â”‚  â”‚   â†’ æ›´æ–° node_info.json                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  æ“ä½œå®Œæˆ     â”‚
              â”‚  è¿”å›æˆåŠŸ     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¶‰åŠçš„æ–‡ä»¶æ›´æ–°**:

1. `files/file_id.enc` - æ–°å¢
2. `metadata/file_id.json` - æ–°å¢
3. `index_db.json` - æ›´æ–°(æ·»åŠ ç´¢å¼•æ¡ç›®)
4. `node_info.json` - æ›´æ–°(ç»Ÿè®¡ä¿¡æ¯)

---

### æµç¨‹2: å…³é”®è¯æœç´¢æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¾“å…¥   â”‚
â”‚ â€¢ PK         â”‚
â”‚ â€¢ search_tokenâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           1. èº«ä»½éªŒè¯                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ verify_pk_format(PK)                     â”‚  â”‚
â”‚  â”‚   â”œâ”€ æ£€æŸ¥æ˜¯å¦ä¸ºhexå­—ç¬¦ä¸²                 â”‚  â”‚
â”‚  â”‚   â””â”€ éªŒè¯é•¿åº¦åˆç†æ€§                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           2. ç´¢å¼•æŸ¥æ‰¾                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ auto it = index_database.find(           â”‚  â”‚
â”‚  â”‚             search_token)                â”‚  â”‚
â”‚  â”‚                                          â”‚  â”‚
â”‚  â”‚ æŸ¥æ‰¾ç»“æœ:                                â”‚  â”‚
â”‚  â”‚   â€¢ æœªæ‰¾åˆ° â†’ è¿”å›ç©ºç»“æœ                  â”‚  â”‚
â”‚  â”‚   â€¢ æ‰¾åˆ° â†’ ç»§ç»­å¤„ç†                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           3. ç»“æœè¿‡æ»¤                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FOR EACH entry in it->second:            â”‚  â”‚
â”‚  â”‚   IF entry.PK == PK                      â”‚  â”‚
â”‚  â”‚      AND entry.state == "valid":         â”‚  â”‚
â”‚  â”‚     â”œâ”€ æ·»åŠ åˆ°file_identifiersåˆ—è¡¨        â”‚  â”‚
â”‚  â”‚     â””â”€ æ·»åŠ åˆ°keyword_proofsåˆ—è¡¨          â”‚  â”‚
â”‚  â”‚                                          â”‚  â”‚
â”‚  â”‚ è¿‡æ»¤æ¡ä»¶:                                â”‚  â”‚
â”‚  â”‚   âœ“ PKåŒ¹é…(éšç§ä¿æŠ¤)                     â”‚  â”‚
â”‚  â”‚   âœ“ çŠ¶æ€ä¸ºvalid(æ’é™¤å·²åˆ é™¤)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           4. æ„é€ æœç´¢ç»“æœ                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SearchResult {                           â”‚  â”‚
â”‚  â”‚   file_identifiers: [IDâ‚, IDâ‚‚, ...],    â”‚  â”‚
â”‚  â”‚   keyword_proofs: [ktâ‚, ktâ‚‚, ...]       â”‚  â”‚
â”‚  â”‚ }                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  è¿”å›ç»“æœ     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ— æ–‡ä»¶ç³»ç»Ÿæ›´æ–°** (åªè¯»æ“ä½œ)

---

### æµç¨‹3: æ–‡ä»¶åˆ é™¤æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¾“å…¥   â”‚
â”‚ â€¢ PK         â”‚
â”‚ â€¢ file_id    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           1. èº«ä»½éªŒè¯                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ éªŒè¯PKæ ¼å¼                             â”‚  â”‚
â”‚  â”‚ â€¢ æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§                         â”‚  â”‚
â”‚  â”‚ â€¢ è·å–æ–‡ä»¶æ‰€æœ‰è€…PK                       â”‚  â”‚
â”‚  â”‚ â€¢ æ¯”è¾ƒè¯·æ±‚è€…PKä¸æ‰€æœ‰è€…PK                 â”‚  â”‚
â”‚  â”‚   â””â”€ ä¸åŒ¹é… â†’ æ‹’ç»è®¿é—®                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           2. æ ‡è®°ç´¢å¼•ä¸ºæ— æ•ˆ                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FOR EACH (token, entries) in index_db:   â”‚  â”‚
â”‚  â”‚   FOR EACH entry in entries:             â”‚  â”‚
â”‚  â”‚     IF entry.file_identifier == file_id  â”‚  â”‚
â”‚  â”‚        AND entry.PK == PK:               â”‚  â”‚
â”‚  â”‚       entry.state = "invalid"            â”‚  â”‚
â”‚  â”‚       marked_count++                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           3. æ›´æ–°æ–‡ä»¶çŠ¶æ€                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ file_storage[file_id].state = "invalid"  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           4. æŒä¹…åŒ–æ›´æ–°                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ save_index_database()                  â”‚  â”‚
â”‚  â”‚   â†’ æ›´æ–° index_db.json                   â”‚  â”‚
â”‚  â”‚     (æ‰€æœ‰ç›¸å…³ç´¢å¼•æ¡ç›®stateæ”¹ä¸ºinvalid)   â”‚  â”‚
â”‚  â”‚                                          â”‚  â”‚
â”‚  â”‚ â€¢ update_statistics("delete")            â”‚  â”‚
â”‚  â”‚   â†’ æ›´æ–° node_info.json                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  æ“ä½œå®Œæˆ     â”‚
              â”‚  è¿”å›æˆåŠŸ     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ³¨æ„: æ–‡ä»¶ä¸ä¼šè¢«ç‰©ç†åˆ é™¤
      â”œâ”€ files/file_id.enc ä¿ç•™
      â””â”€ metadata/file_id.json ä¿ç•™
```

**æ¶‰åŠçš„æ–‡ä»¶æ›´æ–°**:

1. `index_db.json` - æ›´æ–°(ç›¸å…³ç´¢å¼•stateæ”¹ä¸ºinvalid)
2. `node_info.json` - æ›´æ–°(ç»Ÿè®¡ä¿¡æ¯)

---

### æµç¨‹4: ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¨‹åºå¯åŠ¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      [1/6] åˆ›å»ºæ•°æ®ç›®å½•                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ initialize_directories()                 â”‚  â”‚
â”‚  â”‚   â”œâ”€ mkdir(data_dir)                     â”‚  â”‚
â”‚  â”‚   â”œâ”€ mkdir(files_dir)                    â”‚  â”‚
â”‚  â”‚   â””â”€ mkdir(metadata_dir)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      [2/6] åŠ è½½é…ç½®                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ load_config()                            â”‚  â”‚
â”‚  â”‚   â”œâ”€ å¦‚æœconfig.jsonå­˜åœ¨ â†’ åŠ è½½          â”‚  â”‚
â”‚  â”‚   â””â”€ å¦åˆ™ â†’ create_default_config()      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      [3/6] è®¾ç½®å®‰å…¨å‚æ•°                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä»æ§åˆ¶å°è¯»å–å®‰å…¨å‚æ•°K                    â”‚  â”‚
â”‚  â”‚   é»˜è®¤: 512 bits                         â”‚  â”‚
â”‚  â”‚   èŒƒå›´: 128-2048 bits                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      [4/6] åˆå§‹åŒ–å¯†ç å­¦ç³»ç»Ÿ                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ setup_cryptography(K, pp_path)           â”‚  â”‚
â”‚  â”‚   â”œâ”€ åˆå§‹åŒ–é…å¯¹pairing (Type A)          â”‚  â”‚
â”‚  â”‚   â”œâ”€ åˆå§‹åŒ–ç¾¤å…ƒç´  g, Î¼ âˆˆ Gâ‚             â”‚  â”‚
â”‚  â”‚   â”œâ”€ éšæœºç”Ÿæˆå‚æ•°                        â”‚  â”‚
â”‚  â”‚   â””â”€ save_public_params()                â”‚  â”‚
â”‚  â”‚       â†’ ä¿å­˜åˆ° public_params.json        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      [5/6] åŠ è½½ç´¢å¼•æ•°æ®åº“                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ load_index_database()                    â”‚  â”‚
â”‚  â”‚   â”œâ”€ å¦‚æœindex_db.jsonå­˜åœ¨ â†’ è§£æåŠ è½½    â”‚  â”‚
â”‚  â”‚   â””â”€ å¦åˆ™ â†’ åˆ›å»ºç©ºæ•°æ®åº“                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      [6/6] åŠ è½½èŠ‚ç‚¹ä¿¡æ¯                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ load_node_info()                         â”‚  â”‚
â”‚  â”‚   â”œâ”€ å¦‚æœnode_info.jsonå­˜åœ¨ â†’ åŠ è½½       â”‚  â”‚
â”‚  â”‚   â””â”€ å¦åˆ™ â†’ åˆ›å»ºæ–°èŠ‚ç‚¹ä¿¡æ¯               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ‰“å°èŠ‚ç‚¹çŠ¶æ€                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ print_status()                           â”‚  â”‚
â”‚  â”‚   æ˜¾ç¤º:                                  â”‚  â”‚
â”‚  â”‚   â€¢ èŠ‚ç‚¹ID                               â”‚  â”‚
â”‚  â”‚   â€¢ æ•°æ®ç›®å½•                             â”‚  â”‚
â”‚  â”‚   â€¢ æ–‡ä»¶æ•°é‡                             â”‚  â”‚
â”‚  â”‚   â€¢ ç´¢å¼•æ•°é‡                             â”‚  â”‚
â”‚  â”‚   â€¢ å¯†ç å­¦çŠ¶æ€                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  è¿›å…¥ä¸»å¾ªç¯   â”‚
              â”‚  (èœå•ç³»ç»Ÿ)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ–‡ä»¶ä¸æ•°æ®åº“æ›´æ–°æœºåˆ¶

### æ•°æ®æŒä¹…åŒ–æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å†…å­˜æ•°æ®ç»“æ„                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ file_storage:                            â”‚  â”‚
â”‚  â”‚   map<file_id, FileData>                 â”‚  â”‚
â”‚  â”‚                                          â”‚  â”‚
â”‚  â”‚ index_database:                          â”‚  â”‚
â”‚  â”‚   map<search_token, vector<IndexEntry>>  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ æŒä¹…åŒ–
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ–‡ä»¶ç³»ç»Ÿ                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ data/                                    â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ config.json          (é…ç½®)         â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ public_params.json   (å…¬å…±å‚æ•°)     â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ index_db.json        (ç´¢å¼•æ•°æ®åº“)   â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ node_info.json       (èŠ‚ç‚¹ä¿¡æ¯)     â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ files/               (åŠ å¯†æ–‡ä»¶)     â”‚  â”‚
â”‚  â”‚ â”‚   â””â”€â”€ *.enc                           â”‚  â”‚
â”‚  â”‚ â””â”€â”€ metadata/            (å…ƒæ•°æ®)       â”‚  â”‚
â”‚  â”‚     â””â”€â”€ *.json                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å„æ“ä½œçš„æ–‡ä»¶æ›´æ–°è¯¦æƒ…

#### 1. insert\_file() æ“ä½œ

**æ›´æ–°çš„æ–‡ä»¶**:


| æ–‡ä»¶è·¯å¾„                  | æ›´æ–°ç±»å‹ | æ›´æ–°å†…å®¹                               |
| ------------------------- | -------- | -------------------------------------- |
| `files/{file_id}.enc`     | æ–°å¢     | åŠ å¯†æ–‡ä»¶äºŒè¿›åˆ¶å†…å®¹                     |
| `metadata/{file_id}.json` | æ–°å¢     | æ–‡ä»¶å…ƒæ•°æ®(PK, size, keyword\_countç­‰) |
| `index_db.json`           | ä¿®æ”¹     | åœ¨indiceså­—æ®µä¸­æ·»åŠ æ–°çš„ç´¢å¼•æ¡ç›®        |
| `node_info.json`          | ä¿®æ”¹     | æ›´æ–°total\_fileså’Œtotal\_indicesç»Ÿè®¡   |

**index\_db.json æ›´æ–°ç¤ºä¾‹**:

```json
{
  "indices": {
    "existing_token": [...],
    "new_token_1": [        // æ–°å¢
      {
        "PK": "...",
        "Ts": "new_token_1",
        "keyword": "...",
        "pointer": "...",
        "file_identifier": "new_file_id",
        "state": "valid"
      }
    ]
  }
}
```

#### 2. delete\_file() æ“ä½œ

**æ›´æ–°çš„æ–‡ä»¶**:


| æ–‡ä»¶è·¯å¾„         | æ›´æ–°ç±»å‹ | æ›´æ–°å†…å®¹                               |
| ---------------- | -------- | -------------------------------------- |
| `index_db.json`  | ä¿®æ”¹     | å°†ç›¸å…³ç´¢å¼•æ¡ç›®çš„stateå­—æ®µæ”¹ä¸º"invalid" |
| `node_info.json` | ä¿®æ”¹     | æ›´æ–°ç»Ÿè®¡ä¿¡æ¯                           |

**index\_db.json æ›´æ–°ç¤ºä¾‹**:

```json
{
  "indices": {
    "token_1": [
      {
        "file_identifier": "deleted_file_id",
        "state": "invalid"    // ä»"valid"æ”¹ä¸º"invalid"
      }
    ]
  }
}
```

**æ³¨æ„**: `files/` å’Œ `metadata/` ä¸­çš„æ–‡ä»¶ä¸ä¼šè¢«ç‰©ç†åˆ é™¤

#### 3. search\_keyword() æ“ä½œ

**æ— æ–‡ä»¶æ›´æ–°** (çº¯æŸ¥è¯¢æ“ä½œ)

#### 4. retrieve\_file() æ“ä½œ

**æ— æ–‡ä»¶æ›´æ–°** (çº¯æŸ¥è¯¢æ“ä½œ)

#### 5. setup\_cryptography() æ“ä½œ

**æ›´æ–°çš„æ–‡ä»¶**:


| æ–‡ä»¶è·¯å¾„             | æ›´æ–°ç±»å‹  | æ›´æ–°å†…å®¹                          |
| -------------------- | --------- | --------------------------------- |
| `public_params.json` | æ–°å¢/è¦†ç›– | å…¬å…±å¯†ç å­¦å‚æ•°(p, q, Gâ‚, Gâ‚‚, e) |

---

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: å®Œæ•´çš„æ–‡ä»¶æ’å…¥æµç¨‹

**æ­¥éª¤1**: å‡†å¤‡å‚æ•°JSONæ–‡ä»¶ `params.json`

```json
{
  "PK": "0a1b2c3d4e5f6789",
  "ID_F": "file_001",
  "ptr": "encrypted_pointer_xyz",
  "TS_F": "auth_tag_123456",
  "state": "valid",
  "keywords": [
    {
      "T_i": "token_confidential",
      "kt_i": "keyword_encrypted_value_1"
    },
    {
      "T_i": "token_document",
      "kt_i": "keyword_encrypted_value_2"
    }
  ]
}
```

**æ­¥éª¤2**: å‡†å¤‡åŠ å¯†æ–‡ä»¶ `document.enc`

**æ­¥éª¤3**: æ‰§è¡Œæ’å…¥æ“ä½œ

```bash
é€‰æ‹©æ“ä½œ: 1
è¯·è¾“å…¥å‚æ•°JSONæ–‡ä»¶è·¯å¾„: params.json
è¯·è¾“å…¥åŠ å¯†æ–‡ä»¶è·¯å¾„: document.enc
```

**æ­¥éª¤4**: ç³»ç»Ÿå¤„ç†æµç¨‹

```
ğŸ“¤ æ’å…¥æ–‡ä»¶...
   æ–‡ä»¶ID:   file_001
   å®¢æˆ·ç«¯PK: 0a1b2c3d4e5f...
   çŠ¶æ€:     valid
   å…³é”®è¯æ•°: 2
âœ… æ–‡ä»¶æ’å…¥æˆåŠŸ!
```

**ç»“æœ**:

* æ–‡ä»¶å­˜å‚¨åœ¨ `data/files/file_001.enc`
* å…ƒæ•°æ®å­˜å‚¨åœ¨ `data/metadata/file_001.json`
* ç´¢å¼•æ•°æ®åº“æ›´æ–°

### ç¤ºä¾‹2: å…³é”®è¯æœç´¢

```bash
é€‰æ‹©æ“ä½œ: 2
è¯·è¾“å…¥å®¢æˆ·ç«¯å…¬é’¥ (PK): 0a1b2c3d4e5f6789
è¯·è¾“å…¥æœç´¢ä»¤ç‰Œ (T_i): token_confidential
è¯·è¾“å…¥æœ€æ–°çŠ¶æ€ (å¯é€‰): [ç›´æ¥å›è½¦]
è¯·è¾“å…¥ç§å­ (å¯é€‰): [ç›´æ¥å›è½¦]

ğŸ“Š æœç´¢ç»“æœ:
   æ‰¾åˆ° 1 ä¸ªåŒ¹é…æ–‡ä»¶
   
ğŸ“„ æ–‡ä»¶åˆ—è¡¨:
   [1] file_001 (å…³é”®è¯: keyword_encrypted_value_1)
```

### ç¤ºä¾‹3: æ–‡ä»¶åˆ é™¤

```bash
é€‰æ‹©æ“ä½œ: 4
è¯·è¾“å…¥å®¢æˆ·ç«¯å…¬é’¥ (PK): 0a1b2c3d4e5f6789
è¯·è¾“å…¥æ–‡ä»¶ID: file_001
è¯·è¾“å…¥åˆ é™¤è¯æ˜ (å¯é€‰): [ç›´æ¥å›è½¦]

âš ï¸  è­¦å‘Š: æ­¤æ“ä½œå°†æ ‡è®°æ–‡ä»¶ä¸ºæ— æ•ˆ!
ç¡®è®¤åˆ é™¤? (y/n): y

   âœ… èº«ä»½éªŒè¯é€šè¿‡
   æ ‡è®° 2 æ¡ç´¢å¼•ä¸ºæ— æ•ˆ
âœ… æ–‡ä»¶åˆ é™¤æˆåŠŸ (å·²æ ‡è®°ä¸ºæ— æ•ˆ)
```

---

## å®‰å…¨ç‰¹æ€§

### 1. èº«ä»½éªŒè¯æœºåˆ¶

* æ¯ä¸ªæ–‡ä»¶éƒ½ä¸å®¢æˆ·ç«¯å…¬é’¥(PK)å…³è”
* åªæœ‰æ–‡ä»¶æ‰€æœ‰è€…(PKåŒ¹é…)æ‰èƒ½åˆ é™¤æ–‡ä»¶
* æœç´¢æ“ä½œåªè¿”å›è¯·æ±‚è€…PKçš„æ–‡ä»¶

### 2. å¯æœç´¢åŠ å¯†

* å…³é”®è¯è¢«åŠ å¯†ä¸ºæœç´¢ä»¤ç‰Œ(T\_i)
* æœåŠ¡å™¨æ— æ³•çŸ¥é“å®é™…å…³é”®è¯å†…å®¹
* æ”¯æŒæ¨¡ç³Šæœç´¢å’Œå…³é”®è¯åŒ¹é…

### 3. å®Œæ•´æ€§éªŒè¯

* æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è®¤è¯æ ‡ç­¾(TS\_F)
* æ”¯æŒç”Ÿæˆå®Œæ•´æ€§è¯æ˜
* å¯éªŒè¯æ–‡ä»¶æœªè¢«ç¯¡æ”¹

### 4. çŠ¶æ€ç®¡ç†

* æ–‡ä»¶çŠ¶æ€: valid / invalid
* åˆ é™¤æ“ä½œä¸ç‰©ç†åˆ é™¤æ–‡ä»¶,åªæ ‡è®°ä¸ºinvalid
* æœç´¢å’Œæ£€ç´¢è‡ªåŠ¨è¿‡æ»¤invalidæ–‡ä»¶

---

## ç¼–è¯‘ä¸è¿è¡Œ

### ä¾èµ–é¡¹

```bash
# Ubuntu/Debian
sudo apt-get install libpbc-dev libgmp-dev libssl-dev libjsoncpp-dev

# macOS
brew install pbc gmp openssl jsoncpp
```

### ç¼–è¯‘

```bash
g++ -o storage_node main.cpp storage_node.cpp \
    -lpbc -lgmp -lcrypto -ljsoncpp -std=c++11
```

### è¿è¡Œ

```bash
./storage_node [data_dir] [port]

# ç¤ºä¾‹
./storage_node ./my_data 9000
```

---

## ç‰ˆæœ¬å†å²

* **v3.2** (å½“å‰ç‰ˆæœ¬)
  * âœ… å…¬å…±å‚æ•°æŒä¹…åŒ–æ”¯æŒ
  * âœ… å¯†ç å­¦å‚æ•°å¯ä¿å­˜å’ŒåŠ è½½
* **v3.1**
  * âœ… å®¢æˆ·ç«¯å…¬é’¥èº«ä»½éªŒè¯
  * âœ… æ–‡ä»¶çŠ¶æ€ç®¡ç†(valid/invalid)
* **v3.0**
  * âœ… å®Œå…¨æœ¬åœ°åŒ–å­˜å‚¨
  * âœ… JSONæ–‡ä»¶æŒä¹…åŒ–
  * âœ… äº¤äº’å¼æ§åˆ¶å°

---

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜,è¯·é€šè¿‡é¡¹ç›®ä»“åº“æäº¤Issueã€‚
