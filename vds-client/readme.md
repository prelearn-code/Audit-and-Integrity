# æœ¬åœ°åŠ å¯†å­˜å‚¨å·¥å…· v4.0 - README

# æœ¬åœ°åŠ å¯†å­˜å‚¨å®¢æˆ·ç«¯ v4.0 æŠ€æœ¯æ–‡æ¡£

## ğŸ“‘ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](https://45659418.sdppt.com/chat/f11b8fc0-ce47-448f-bf6f-dcf415263e1d#%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0)
2. [ç³»ç»Ÿæ¶æ„](https://45659418.sdppt.com/chat/f11b8fc0-ce47-448f-bf6f-dcf415263e1d#%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84)
3. [æ–‡ä»¶ç»“æ„](https://45659418.sdppt.com/chat/f11b8fc0-ce47-448f-bf6f-dcf415263e1d#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84)
4. [æ ¸å¿ƒç±»ä¸æ•°æ®ç»“æ„](https://45659418.sdppt.com/chat/f11b8fc0-ce47-448f-bf6f-dcf415263e1d#%E6%A0%B8%E5%BF%83%E7%B1%BB%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84)
5. [å‡½æ•°è¯¦ç»†åˆ†æ](https://45659418.sdppt.com/chat/f11b8fc0-ce47-448f-bf6f-dcf415263e1d#%E5%87%BD%E6%95%B0%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90)
6. [æ“ä½œæµç¨‹å›¾](https://45659418.sdppt.com/chat/f11b8fc0-ce47-448f-bf6f-dcf415263e1d#%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%9B%BE)
7. [æ–‡ä»¶æ ¼å¼è¯´æ˜](https://45659418.sdppt.com/chat/f11b8fc0-ce47-448f-bf6f-dcf415263e1d#%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%AF%B4%E6%98%8E)
8. [ä½¿ç”¨æŒ‡å—](https://45659418.sdppt.com/chat/f11b8fc0-ce47-448f-bf6f-dcf415263e1d#%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97)
9. [å®‰å…¨æ€§è¯´æ˜](https://45659418.sdppt.com/chat/f11b8fc0-ce47-448f-bf6f-dcf415263e1d#%E5%AE%89%E5%85%A8%E6%80%A7%E8%AF%B4%E6%98%8E)

---

## ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿç®€ä»‹

æœ¬ç³»ç»Ÿæ˜¯ä¸€ä¸ª\*\*å¯éªŒè¯çš„å¯æœç´¢åŠ å¯†ï¼ˆVerifiable Searchable Encryptionï¼‰\*\*æœ¬åœ°å­˜å‚¨å®¢æˆ·ç«¯ï¼Œå®ç°äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

* **æ–‡ä»¶åŠ å¯†ä¸è§£å¯†**ï¼šåŸºäº AES-256-CBC çš„å¯¹ç§°åŠ å¯†
* **å¯æœç´¢åŠ å¯†**ï¼šåœ¨ä¸è§£å¯†çš„æƒ…å†µä¸‹æœç´¢åŠ å¯†æ–‡ä»¶
* **å®Œæ•´æ€§éªŒè¯**ï¼šä½¿ç”¨åŒçº¿æ€§é…å¯¹ç”Ÿæˆè®¤è¯æ ‡ç­¾
* **å‰å‘å®‰å…¨æ€§**ï¼šé€šè¿‡çŠ¶æ€é“¾é˜²æ­¢å†å²æŸ¥è¯¢æ³„éœ²

### 1.2 æ ¸å¿ƒæŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å¯†ç å­¦åº“ä¾èµ–å…³ç³»                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  OpenSSL      - AESåŠ å¯†ã€SHA256å“ˆå¸Œ     â”‚
â”‚  GMP          - å¤§æ•´æ•°è¿ç®—               â”‚
â”‚  PBC Library  - åŒçº¿æ€§é…å¯¹è¿ç®—           â”‚
â”‚  JsonCpp      - JSONæ•°æ®å¤„ç†            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 v4.0 ç‰ˆæœ¬ç‰¹æ€§

* âœ… ç»Ÿä¸€ä½¿ç”¨ `public_params.json` åŠ è½½æ‰€æœ‰å…¬å…±å‚æ•°
* âœ… é…å¯¹å‚æ•°ç¡¬ç¼–ç ï¼ˆType A æ›²çº¿ï¼Œ1024ä½å®‰å…¨çº§åˆ«ï¼‰
* âœ… ä¿®å¤å‚æ•°ä¸ä¸€è‡´å¯¼è‡´çš„è®¤è¯æ ‡ç­¾é”™è¯¯
* âœ… ç®€åŒ–åˆå§‹åŒ–æµç¨‹
* âœ… å¢å¼ºå¯†é’¥åŠ è½½éªŒè¯

---

## ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Storage Client v4.0                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  åˆå§‹åŒ–æ¨¡å—     â”‚  â”‚   å¯†é’¥ç®¡ç†     â”‚  â”‚  çŠ¶æ€ç®¡ç†    â”‚ â”‚
â”‚  â”‚  initialize()  â”‚  â”‚  generateKeys()â”‚  â”‚  updateState â”‚ â”‚
â”‚  â”‚                â”‚  â”‚  loadKeys()    â”‚  â”‚  queryState  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           æ–‡ä»¶åŠ å¯†/è§£å¯†æ ¸å¿ƒå¼•æ“                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ encryptFile()â”‚  â”‚ decryptFile()â”‚  â”‚ Auth Tags â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              å¯†ç å­¦åŸè¯­å±‚                            â”‚   â”‚
â”‚  â”‚  â€¢ H1: SHA256 â†’ Z_N                                 â”‚   â”‚
â”‚  â”‚  â€¢ H2: SHA256 â†’ Gâ‚                                  â”‚   â”‚
â”‚  â”‚  â€¢ H3: SHA256 â†’ {0,1}^Î»                            â”‚   â”‚
â”‚  â”‚  â€¢ AES-256-CBC/ECB                                  â”‚   â”‚
â”‚  â”‚  â€¢ Bilinear Pairing (Type A)                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æ“ä½œ   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‘½ä»¤è¡Œäº¤äº’ç•Œé¢ (main.cpp)           â”‚
â”‚  init | keygen | encrypt | decrypt | ...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      StorageClient ç±» (client.cpp/h)      â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å…¬å…±å‚æ•°    â”‚â—„â”€â”€â”€â”€â”€â”¤ Storage Node  â”‚ â”‚
â”‚  â”‚  (N, g, Î¼)  â”‚      â”‚ (å¤–éƒ¨æœåŠ¡)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚  å®¢æˆ·ç«¯å¯†é’¥  â”‚                         â”‚
â”‚  â”‚  (mk,sk,ek,pk)â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            æ–‡ä»¶ç³»ç»Ÿè¾“å‡º                     â”‚
â”‚                                            â”‚
â”‚  â€¢ *.enc              - åŠ å¯†æ–‡ä»¶           â”‚
â”‚  â€¢ insert.json        - æœåŠ¡å™¨æ’å…¥æ•°æ®     â”‚
â”‚  â€¢ *_metadata.json    - æœ¬åœ°å…ƒæ•°æ®         â”‚
â”‚  â€¢ private_key.dat    - ç§é’¥               â”‚
â”‚  â€¢ public_key.json    - å…¬é’¥               â”‚
â”‚  â€¢ keyword_states.json- å…³é”®è¯çŠ¶æ€         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ–‡ä»¶ç»“æ„

### 3.1 æºä»£ç æ–‡ä»¶

```
project/
â”œâ”€â”€ client.h          # ç±»å®šä¹‰ã€æ¥å£å£°æ˜ã€è¯¦ç»†æ³¨é‡Š
â”œâ”€â”€ client.cpp        # å®ç°æ–‡ä»¶ï¼ˆ1175è¡Œï¼‰
â”œâ”€â”€ main.cpp          # å‘½ä»¤è¡Œäº¤äº’ç•Œé¢
â””â”€â”€ README.md         # æœ¬æ–‡æ¡£
```

### 3.2 è¿è¡Œæ—¶æ–‡ä»¶

```
runtime/
â”œâ”€â”€ è¾“å…¥æ–‡ä»¶:
â”‚   â””â”€â”€ public_params.json       # ä»Storage Nodeè·å–çš„å…¬å…±å‚æ•°
â”‚
â”œâ”€â”€ ç”Ÿæˆçš„å¯†é’¥æ–‡ä»¶:
â”‚   â”œâ”€â”€ private_key.dat          # å®¢æˆ·ç«¯ç§é’¥ï¼ˆäºŒè¿›åˆ¶ï¼‰
â”‚   â””â”€â”€ public_key.json          # å®¢æˆ·ç«¯å…¬é’¥ï¼ˆJSONï¼‰
â”‚
â”œâ”€â”€ åŠ å¯†è¾“å‡ºæ–‡ä»¶:
â”‚   â”œâ”€â”€ [filename].enc           # åŠ å¯†åçš„æ–‡ä»¶
â”‚   â”œâ”€â”€ insert.json              # ä¾›Storage Nodeä½¿ç”¨
â”‚   â””â”€â”€ [filename]_metadata.json # æœ¬åœ°å…ƒæ•°æ®
â”‚
â””â”€â”€ çŠ¶æ€ç®¡ç†æ–‡ä»¶:
    â””â”€â”€ keyword_states.json      # å…³é”®è¯çŠ¶æ€å†å²
```

---

## æ ¸å¿ƒç±»ä¸æ•°æ®ç»“æ„

### 4.1 StorageClient ç±»

```cpp
class StorageClient {
public:
    // ç”Ÿå‘½å‘¨æœŸç®¡ç†
    StorageClient();
    ~StorageClient();
  
    // æ ¸å¿ƒåŠŸèƒ½æ¥å£
    bool initialize(const std::string& public_params_file);
    bool generateKeys();
    bool encryptFile(...);
    bool decryptFile(...);
  
    // å¯†é’¥ç®¡ç†
    bool saveKeys(const std::string& key_file);
    bool loadKeys(const std::string& key_file);
    std::string getPublicKey();
  
    // çŠ¶æ€ç®¡ç†
    bool loadKeywordStates(const std::string& file_path);
    bool saveKeywordStates(const std::string& file_path);
    bool updateKeywordState(...);
    std::string queryKeywordState(const std::string& keyword);

private:
    // å¯†ç å­¦æ“ä½œ
    bool encryptFileData(...);
    bool decryptFileData(...);
    bool generateAuthTags(...);
    bool generateStateAssociatedToken(...);
  
    // å“ˆå¸Œå‡½æ•°
    void computeHashH1(const std::string& input, mpz_t result);
    void computeHashH2(const std::string& input, element_t result);
    std::string computeHashH3(const std::string& input);
  
    // è¾…åŠ©å‡½æ•°
    std::string encryptKeyword(const std::string& keyword);
    std::string generateRandomState();
    std::string encryptPointer(...);
  
    // æˆå‘˜å˜é‡
    pairing_t pairing_;           // é…å¯¹ç»“æ„
    element_t g_, mu_, pk_;       // ç¾¤å…ƒç´ 
    mpz_t N_, sk_;                // å¤§æ•´æ•°
    unsigned char mk_[32];        // ä¸»å¯†é’¥
    unsigned char ek_[32];        // åŠ å¯†å¯†é’¥
    bool initialized_;            // åˆå§‹åŒ–æ ‡å¿—
    // ... çŠ¶æ€ç®¡ç†å˜é‡
};
```

### 4.2 å…³é”®æ•°æ®ç»“æ„

#### 4.2.1 å…¬å…±å‚æ•° (public\_params.json)

```json
{
  "version": "v4.0",
  "created_at": "2025-11-10 12:00:00",
  "public_params": {
    "N": "å¤§æ•´æ•°å­—ç¬¦ä¸²ï¼ˆRSAæ¨¡æ•°ï¼Œ2048+ä½ï¼‰",
    "g": "åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆGâ‚ç¾¤ç”Ÿæˆå…ƒï¼‰",
    "mu": "åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆè®¤è¯å‚æ•°ï¼ŒGâ‚ç¾¤ï¼‰"
  }
}
```

#### 4.2.2 å®¢æˆ·ç«¯å¯†é’¥ç»“æ„

**private\_key.datï¼ˆäºŒè¿›åˆ¶æ ¼å¼ï¼‰:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  mk[32]        - ä¸»å¯†é’¥ï¼ˆ256ä½ï¼‰    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ek[32]        - åŠ å¯†å¯†é’¥ï¼ˆ256ä½ï¼‰  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  sk_size[4]    - ské•¿åº¦æ ‡è®°         â”‚
â”‚  sk[variable]  - ç§é’¥ï¼ˆå¤§æ•´æ•°ï¼‰     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  pk_size[4]    - pké•¿åº¦æ ‡è®°         â”‚
â”‚  pk[variable]  - å…¬é’¥åºåˆ—åŒ–         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**public\_key.json:**

```json
{
  "pk": "åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå…¬é’¥åºåˆ—åŒ–ï¼‰",
  "timestamp": "2025-11-10 12:00:00",
  "version": "v4.0",
  "note": "Public key generated by StorageClient v4.0"
}
```

#### 4.2.3 åŠ å¯†æ–‡ä»¶è¾“å‡º

**insert.jsonï¼ˆä¾›Storage Nodeä½¿ç”¨ï¼‰:**

```json
{
  "file_id": "æ–‡ä»¶å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆSHA256ï¼‰",
  "keywords": [
    {
      "Ti": "æœç´¢ä»¤ç‰Œï¼ˆåŠ å¯†å…³é”®è¯ï¼‰",
      "kt": "çŠ¶æ€å…³è”ä»¤ç‰Œï¼ˆç¾¤å…ƒç´ åºåˆ—åŒ–ï¼‰",
      "ptr": "åŠ å¯†æŒ‡é’ˆï¼ˆæŒ‡å‘å‰ä¸€çŠ¶æ€ï¼‰"
    }
  ],
  "auth_tags": [
    "è®¤è¯æ ‡ç­¾1ï¼ˆç¾¤å…ƒç´ åºåˆ—åŒ–ï¼‰",
    "è®¤è¯æ ‡ç­¾2",
    "..."
  ],
  "timestamp": "2025-11-10 12:00:00"
}
```

**[filename]\_metadata.jsonï¼ˆæœ¬åœ°å…ƒæ•°æ®ï¼‰:**

```json
{
  "file_id": "æ–‡ä»¶å”¯ä¸€æ ‡è¯†ç¬¦",
  "original_file": "åŸå§‹æ–‡ä»¶è·¯å¾„",
  "encrypted_file": "åŠ å¯†æ–‡ä»¶è·¯å¾„",
  "keywords": ["å…³é”®è¯1", "å…³é”®è¯2", "..."],
  "timestamp": "2025-11-10 12:00:00"
}
```

#### 4.2.4 å…³é”®è¯çŠ¶æ€æ–‡ä»¶

**keyword\_states.json:**

```json
{
  "version": "v4.0",
  "keywords": {
    "å…³é”®è¯1": {
      "current_state": "å½“å‰çŠ¶æ€å€¼ï¼ˆ256ä½éšæœºæ•°ï¼‰",
      "last_update": "2025-11-10 12:00:00",
      "history": [
        {
          "state": "å†å²çŠ¶æ€å€¼",
          "file_id": "å…³è”æ–‡ä»¶ID",
          "timestamp": "2025-11-10 11:00:00"
        }
      ]
    }
  }
}
```

---

## å‡½æ•°è¯¦ç»†åˆ†æ

### 5.1 åˆå§‹åŒ–ä¸å¯†é’¥ç®¡ç†å‡½æ•°

#### 5.1.1 initialize()

**å‡½æ•°ç­¾å:**

```cpp
bool initialize(const std::string& public_params_file = "public_params.json")
```

**åŠŸèƒ½æè¿°:** åˆå§‹åŒ–å®¢æˆ·ç«¯ç³»ç»Ÿï¼ŒåŠ è½½é…å¯¹å‚æ•°å’Œå…¬å…±å‚æ•°ã€‚

**è¾“å…¥å‚æ•°:**

* `public_params_file`: å…¬å…±å‚æ•°æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ä¸º "public\_params.json"ï¼‰

**è¾“å‡º:**

* è¿”å› `bool`: æˆåŠŸè¿”å› `true`ï¼Œå¤±è´¥è¿”å› `false`

**æ‰§è¡Œæµç¨‹:**

```
1. åˆå§‹åŒ–é…å¯¹å‚æ•°ï¼ˆType Aæ›²çº¿ï¼Œç¡¬ç¼–ç ï¼‰
   â”œâ”€ ä½¿ç”¨å›ºå®šçš„1024ä½å®‰å…¨çº§åˆ«å‚æ•°
   â””â”€ åˆå§‹åŒ– pairing_ ç»“æ„

2. ä» public_params.json è¯»å–å‚æ•°
   â”œâ”€ è§£æJSONæ–‡ä»¶
   â””â”€ æ”¯æŒåµŒå¥—æ ¼å¼å’Œæ ¹çº§æ ¼å¼

3. åŠ è½½å¹¶éªŒè¯ Nï¼ˆRSAæ¨¡æ•°ï¼‰
   â”œâ”€ ä»åè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸º mpz_t
   â”œâ”€ éªŒè¯ä½æ•°ï¼ˆè‡³å°‘2048ä½ï¼‰
   â””â”€ å­˜å‚¨åˆ° N_

4. åŠ è½½å¹¶éªŒè¯ gï¼ˆç”Ÿæˆå…ƒï¼‰
   â”œâ”€ ä»åå…­è¿›åˆ¶å­—ç¬¦ä¸²ååºåˆ—åŒ–
   â”œâ”€ éªŒè¯ä¸æ˜¯å•ä½å…ƒ
   â””â”€ åˆå§‹åŒ–ä¸º Gâ‚ ç¾¤å…ƒç´ 

5. åŠ è½½å¹¶éªŒè¯ Î¼ï¼ˆè®¤è¯å‚æ•°ï¼‰
   â”œâ”€ ä»åå…­è¿›åˆ¶å­—ç¬¦ä¸²ååºåˆ—åŒ–
   â”œâ”€ éªŒè¯ä¸æ˜¯å•ä½å…ƒ
   â””â”€ åˆå§‹åŒ–ä¸º Gâ‚ ç¾¤å…ƒç´ 

6. åˆå§‹åŒ–å…¬é’¥å…ƒç´  pk_
   â””â”€ ä»…åˆ†é…ç©ºé—´ï¼Œä¸è®¡ç®—å€¼

7. è®¾ç½® initialized_ = true
```

**å‰¯ä½œç”¨:**

* ä¿®æ”¹æˆå‘˜å˜é‡: `pairing_`, `g_`, `mu_`, `N_`, `pk_`, `initialized_`
* è¾“å‡ºè°ƒè¯•ä¿¡æ¯åˆ°æ ‡å‡†è¾“å‡º

**é”™è¯¯å¤„ç†:**

* æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æ³•æ‰“å¼€
* JSONè§£æå¤±è´¥
* å‚æ•°æ ¼å¼é”™è¯¯
* å‚æ•°éªŒè¯å¤±è´¥

---

#### 5.1.2 generateKeys()

**å‡½æ•°ç­¾å:**

```cpp
bool generateKeys()
```

**åŠŸèƒ½æè¿°:** ç”Ÿæˆå®¢æˆ·ç«¯çš„æ‰€æœ‰å¯†é’¥ï¼ˆmk, sk, ek, pkï¼‰å¹¶ä¿å­˜åˆ°æ–‡ä»¶ã€‚

**è¾“å…¥å‚æ•°:**

* æ— ï¼ˆä½†è¦æ±‚å·²è°ƒç”¨ `initialize()`ï¼‰

**è¾“å‡º:**

* è¿”å› `bool`: æˆåŠŸè¿”å› `true`
* ç”Ÿæˆæ–‡ä»¶: `private_key.dat`, `public_key.json`

**æ‰§è¡Œæµç¨‹:**

```
1. æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€
   â””â”€ å¦‚æœæœªåˆå§‹åŒ–ï¼Œè¿”å›é”™è¯¯

2. ç”Ÿæˆä¸»å¯†é’¥ mk
   â”œâ”€ ä½¿ç”¨ RAND_bytes() ç”Ÿæˆ256ä½éšæœºæ•°
   â””â”€ å­˜å‚¨åˆ° mk_[32]

3. ç”ŸæˆåŠ å¯†å¯†é’¥ ek
   â”œâ”€ ä½¿ç”¨ RAND_bytes() ç”Ÿæˆ256ä½éšæœºæ•°
   â””â”€ å­˜å‚¨åˆ° ek_[32]

4. ç”Ÿæˆç§é’¥ sk
   â”œâ”€ åœ¨ Zr ä¸­éšæœºç”Ÿæˆå…ƒç´ 
   â”œâ”€ è½¬æ¢ä¸ºå¤§æ•´æ•°
   â””â”€ å­˜å‚¨åˆ° sk_

5. è®¡ç®—å…¬é’¥ pk = g^sk
   â”œâ”€ ä½¿ç”¨åŒçº¿æ€§é…å¯¹çš„æŒ‡æ•°è¿ç®—
   â”œâ”€ éªŒè¯ pk ä¸æ˜¯å•ä½å…ƒ
   â””â”€ å­˜å‚¨åˆ° pk_

6. ä¿å­˜ç§é’¥åˆ° private_key.dat
   â”œâ”€ äºŒè¿›åˆ¶æ ¼å¼
   â”œâ”€ é¡ºåº: mk | ek | sk_size | sk | pk_size | pk
   â””â”€ æ–‡ä»¶æƒé™åº”è®¾ä¸ºåªè¯»ï¼ˆç”¨æˆ·æ‰‹åŠ¨è®¾ç½®ï¼‰

7. ä¿å­˜å…¬é’¥åˆ° public_key.json
   â”œâ”€ JSONæ ¼å¼
   â””â”€ åŒ…å«æ—¶é—´æˆ³å’Œç‰ˆæœ¬ä¿¡æ¯
```

**ç”Ÿæˆçš„å¯†é’¥:**

```
mk: ä¸»å¯†é’¥ï¼ˆç”¨äºå…³é”®è¯åŠ å¯†ï¼‰
    - é•¿åº¦: 256ä½
    - ç”¨é€”: ç”Ÿæˆæœç´¢ä»¤ç‰Œ Ti = H3(H1(mk || keyword))

sk: ç§é’¥ï¼ˆå¤§æ•´æ•°ï¼‰
    - é•¿åº¦: å¯å˜ï¼ˆé…å¯¹å‚æ•°å†³å®šï¼‰
    - ç”¨é€”: ç”Ÿæˆè®¤è¯æ ‡ç­¾ã€çŠ¶æ€ä»¤ç‰Œ

ek: åŠ å¯†å¯†é’¥
    - é•¿åº¦: 256ä½
    - ç”¨é€”: AES-256-CBC æ–‡ä»¶åŠ å¯†

pk: å…¬é’¥ï¼ˆç¾¤å…ƒç´  Gâ‚ï¼‰
    - å…³ç³»: pk = g^sk
    - ç”¨é€”: éªŒè¯æ“ä½œï¼ˆç”±Storage Nodeä½¿ç”¨ï¼‰
```

**å‰¯ä½œç”¨:**

* åˆ›å»º `private_key.dat`ï¼ˆé‡è¦ï¼šéœ€å¦¥å–„ä¿ç®¡ï¼‰
* åˆ›å»º `public_key.json`
* è¾“å‡ºç”Ÿæˆè¿‡ç¨‹åˆ°æ ‡å‡†è¾“å‡º

---

#### 5.1.3 saveKeys() / loadKeys()

**saveKeys() å‡½æ•°ç­¾å:**

```cpp
bool saveKeys(const std::string& key_file)
```

**åŠŸèƒ½:** å°†æ‰€æœ‰å¯†é’¥ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶æ ¼å¼ï¼‰

**è¾“å…¥:**

* `key_file`: ç›®æ ‡æ–‡ä»¶è·¯å¾„

**è¾“å‡º:**

* è¿”å› `bool`: æˆåŠŸ/å¤±è´¥
* åˆ›å»ºå¯†é’¥æ–‡ä»¶

---

**loadKeys() å‡½æ•°ç­¾å:**

```cpp
bool loadKeys(const std::string& key_file)
```

**åŠŸèƒ½:** ä»æ–‡ä»¶åŠ è½½å¯†é’¥

**è¾“å…¥:**

* `key_file`: å¯†é’¥æ–‡ä»¶è·¯å¾„

**è¾“å‡º:**

* è¿”å› `bool`: æˆåŠŸ/å¤±è´¥
* æ¢å¤æˆå‘˜å˜é‡: `mk_`, `ek_`, `sk_`, `pk_`

**å‰ç½®æ¡ä»¶:**

* **å¿…é¡»å…ˆè°ƒç”¨ `initialize()`** ï¼ˆv4.0æ–°å¢æ£€æŸ¥ï¼‰
* åŸå› : åŠ è½½å¯†é’¥éœ€è¦é…å¯¹å‚æ•°æ¥ååºåˆ—åŒ–ç¾¤å…ƒç´ 

**æ‰§è¡Œæµç¨‹:**

```
1. æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€
   â””â”€ å¦‚æœæœªåˆå§‹åŒ–ï¼Œæç¤ºå…ˆè°ƒç”¨ initialize()

2. æ‰“å¼€å¯†é’¥æ–‡ä»¶

3. æŒ‰é¡ºåºè¯»å–:
   â”œâ”€ mk[32]
   â”œâ”€ ek[32]
   â”œâ”€ sk_size, sk
   â””â”€ pk_size, pk

4. ååºåˆ—åŒ– pkï¼ˆéœ€è¦é…å¯¹å‚æ•°ï¼‰
```

---

### 5.2 æ–‡ä»¶åŠ å¯†å‡½æ•°

#### 5.2.1 encryptFile()

**å‡½æ•°ç­¾å:**

```cpp
bool encryptFile(
    const std::string& file_path,           // è¾“å…¥æ–‡ä»¶è·¯å¾„
    const std::vector<std::string>& keywords, // å…³é”®è¯åˆ—è¡¨
    const std::string& output_prefix,        // è¾“å‡ºæ–‡ä»¶å‰ç¼€
    const std::string& insert_json_path = "insert.json" // insert.jsonè·¯å¾„
)
```

**åŠŸèƒ½æè¿°:** åŠ å¯†æ–‡ä»¶å¹¶ç”Ÿæˆæ‰€æœ‰å¿…è¦çš„å…ƒæ•°æ®ï¼ˆè®¤è¯æ ‡ç­¾ã€æœç´¢ä»¤ç‰Œç­‰ï¼‰ã€‚

**è¾“å…¥å‚æ•°:**

1. `file_path`: è¦åŠ å¯†çš„åŸå§‹æ–‡ä»¶è·¯å¾„
2. `keywords`: å…³é”®è¯åˆ—è¡¨ï¼ˆç”¨äºå¯æœç´¢åŠ å¯†ï¼‰
3. `output_prefix`: åŠ å¯†æ–‡ä»¶çš„å‰ç¼€ï¼ˆå¦‚ "myfile"ï¼Œå°†ç”Ÿæˆ "myfile.enc"ï¼‰
4. `insert_json_path`: insert.json çš„è¾“å‡ºè·¯å¾„ï¼ˆé»˜è®¤ "insert.json"ï¼‰

**è¾“å‡º:**

* è¿”å› `bool`: æˆåŠŸ/å¤±è´¥
* ç”Ÿæˆæ–‡ä»¶:
  1. `[output_prefix].enc` - åŠ å¯†æ–‡ä»¶
  2. `insert.json` - ä¾› Storage Node ä½¿ç”¨
  3. `[file_path]_metadata.json` - æœ¬åœ°å…ƒæ•°æ®

**è¯¦ç»†æ‰§è¡Œæµç¨‹:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   encryptFile() æµç¨‹                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬1æ­¥: è¯»å–åŸå§‹æ–‡ä»¶
    â”œâ”€ ä½¿ç”¨ readFile() è¯»å–æ–‡ä»¶å†…å®¹åˆ° vector<unsigned char>
    â””â”€ è®°å½•æ–‡ä»¶å¤§å°

ç¬¬2æ­¥: ç”Ÿæˆæ–‡ä»¶ID
    â”œâ”€ è¾“å…¥: file_path + å½“å‰æ—¶é—´æˆ³
    â”œâ”€ ä½¿ç”¨ H3 å“ˆå¸Œ
    â””â”€ å¾—åˆ°å”¯ä¸€çš„ file_id

ç¬¬3æ­¥: åŠ å¯†æ–‡ä»¶æ•°æ®
    â”œâ”€ è°ƒç”¨ encryptFileData(plaintext, ciphertext)
    â”œâ”€ ä½¿ç”¨ AES-256-CBC
    â”œâ”€ éšæœºç”Ÿæˆ IVï¼ˆ16å­—èŠ‚ï¼‰
    â””â”€ è¾“å‡ºæ ¼å¼: [IV(16) | å¯†æ–‡ | padding]

ç¬¬4æ­¥: ä¿å­˜åŠ å¯†æ–‡ä»¶
    â””â”€ å†™å…¥ [output_prefix].enc

ç¬¬5æ­¥: ç”Ÿæˆè®¤è¯æ ‡ç­¾
    â”œâ”€ è°ƒç”¨ generateAuthTags(file_id, ciphertext, auth_tags)
    â”œâ”€ å°†å¯†æ–‡åˆ†ä¸º n ä¸ªå—ï¼ˆBLOCK_SIZE = 4096å­—èŠ‚ï¼‰
    â”œâ”€ æ¯å—åˆ†ä¸º s ä¸ªæ‰‡åŒºï¼ˆSECTOR_SIZE = 256å­—èŠ‚ï¼‰
    â”‚
    â””â”€ å¯¹äºç¬¬ i ä¸ªå—:
        â”œâ”€ è®¡ç®— H_2(file_id || i)
        â”œâ”€ å¯¹äºç¬¬ j ä¸ªæ‰‡åŒº:
        â”‚   â”œâ”€ å°†æ‰‡åŒºæ•°æ®è½¬ä¸ºæ•´æ•° c_{i,j}
        â”‚   â””â”€ ç´¯ä¹˜ Î¼^{c_{i,j}}
        â””â”€ Ïƒ_i = [H_2(file_id||i) * âˆ_{j=1}^s Î¼^{c_{i,j}}]^sk

ç¬¬6æ­¥: å¤„ç†æ¯ä¸ªå…³é”®è¯
    â””â”€ å¯¹äºæ¯ä¸ª keyword:
        â”‚
        â”œâ”€ 6.1: ç”Ÿæˆæœç´¢ä»¤ç‰Œ
        â”‚   â”œâ”€ è°ƒç”¨ encryptKeyword(keyword)
        â”‚   â”œâ”€ Ti = H3(H1(mk || keyword))
        â”‚   â””â”€ å­˜å‚¨ Ti
        â”‚
        â”œâ”€ 6.2: è·å–æˆ–ç”ŸæˆçŠ¶æ€
        â”‚   â”œâ”€ æ£€æŸ¥ keyword_states_ æ˜ å°„
        â”‚   â”œâ”€ previous_state = states_[keyword] (å¦‚æœå­˜åœ¨)
        â”‚   â”œâ”€ current_state = generateRandomState() (256ä½éšæœºæ•°)
        â”‚   â””â”€ è®°å½•çŠ¶æ€è½¬æ¢
        â”‚
        â”œâ”€ 6.3: ç”ŸæˆçŠ¶æ€å…³è”ä»¤ç‰Œ
        â”‚   â”œâ”€ è°ƒç”¨ generateStateAssociatedToken()
        â”‚   â”‚
        â”‚   â”œâ”€ å¦‚æœ previous_state å­˜åœ¨:
        â”‚   â”‚   â””â”€ kt = [H_2(file_id) * H_2(st_d||Ti) / H_2(st_{d-1}||Ti)]^sk
        â”‚   â”‚
        â”‚   â””â”€ å¦‚æœ previous_state ä¸å­˜åœ¨ï¼ˆé¦–æ¬¡ï¼‰:
        â”‚       â””â”€ kt = [H_2(file_id) * H_2(st_d||Ti)]^sk
        â”‚
        â”œâ”€ 6.4: åŠ å¯†æŒ‡é’ˆ
        â”‚   â”œâ”€ è°ƒç”¨ encryptPointer(previous_state, H3(current_state))
        â”‚   â”œâ”€ ä½¿ç”¨å½“å‰çŠ¶æ€å“ˆå¸Œä½œä¸ºå¯†é’¥
        â”‚   â””â”€ AES-256-ECB åŠ å¯†å‰ä¸€çŠ¶æ€
        â”‚
        â””â”€ 6.5: æ›´æ–°å…³é”®è¯çŠ¶æ€
            â”œâ”€ è°ƒç”¨ updateKeywordState(keyword, current_state, file_id)
            â”œâ”€ æ›´æ–°å†…å­˜æ˜ å°„
            â””â”€ æ·»åŠ å†å²è®°å½•

ç¬¬7æ­¥: ç”Ÿæˆ insert.json
    â”œâ”€ ç»„è£… JSON å¯¹è±¡:
    â”‚   â”œâ”€ file_id
    â”‚   â”œâ”€ keywords[] (åŒ…å« Ti, kt, ptr)
    â”‚   â”œâ”€ auth_tags[]
    â”‚   â””â”€ timestamp
    â””â”€ å†™å…¥æ–‡ä»¶

ç¬¬8æ­¥: ç”Ÿæˆæœ¬åœ°å…ƒæ•°æ®
    â”œâ”€ åˆ›å»º [file_path]_metadata.json
    â”œâ”€ è®°å½•:
    â”‚   â”œâ”€ file_id
    â”‚   â”œâ”€ original_file
    â”‚   â”œâ”€ encrypted_file
    â”‚   â”œâ”€ keywords (æ˜æ–‡)
    â”‚   â””â”€ timestamp
    â””â”€ ç”¨äºæœ¬åœ°æŸ¥è¯¢å’Œç®¡ç†

å®Œæˆ: è¿”å› true
```

**æ•°å­¦ç¬¦å·è¯´æ˜:**

```
ç¬¦å·          å«ä¹‰                              å®ç°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Ti           æœç´¢ä»¤ç‰Œ                          H3(H1(mk||keyword))
kt^w         çŠ¶æ€å…³è”ä»¤ç‰Œ                      [...]^sk (è§ä¸Šè¿°å…¬å¼)
ptr          åŠ å¯†æŒ‡é’ˆ                          AES(previous_state)
Ïƒ_i          ç¬¬iå—è®¤è¯æ ‡ç­¾                     [H_2(ID||i)*âˆÎ¼^{c_{i,j}}]^sk
c_{i,j}      ç¬¬iå—ç¬¬jæ‰‡åŒºæ•°æ®ï¼ˆæ•´æ•°ï¼‰          mpz_import(sector_data)
st_d         ç¬¬dä¸ªçŠ¶æ€å€¼                       256ä½éšæœºæ•°
```

**çŠ¶æ€è½¬æ¢ç¤ºä¾‹:**

```
å…³é”®è¯ "confidential" çš„çŠ¶æ€å†å²:

æ–‡ä»¶1åŠ å¯†:
    previous_state: (æ— )
    current_state: 0x1a2b3c... (éšæœºç”Ÿæˆ)
    kt^w_1 = [H_2(ID_F1) * H_2(st_1||Ti)]^sk

æ–‡ä»¶2åŠ å¯† (åŒä¸€å…³é”®è¯):
    previous_state: 0x1a2b3c...
    current_state: 0x7f8e9d... (æ–°éšæœºå€¼)
    kt^w_2 = [H_2(ID_F2) * H_2(st_2||Ti) / H_2(st_1||Ti)]^sk

æ–‡ä»¶3åŠ å¯†:
    previous_state: 0x7f8e9d...
    current_state: 0x4d5e6f... (æ–°éšæœºå€¼)
    kt^w_3 = [H_2(ID_F3) * H_2(st_3||Ti) / H_2(st_2||Ti)]^sk
```

**å…³é”®ç‰¹æ€§:**

1. **å‰å‘å®‰å…¨æ€§**: å³ä½¿ sk è¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•æœç´¢å†å²æ–‡ä»¶
2. **å¯éªŒè¯æ€§**: Storage Node å¯ä»¥éªŒè¯è®¤è¯æ ‡ç­¾çš„æ­£ç¡®æ€§
3. **å¯æœç´¢æ€§**: é€šè¿‡ Ti ä»¤ç‰Œå¯ä»¥æœç´¢è€Œä¸æ³„éœ²å…³é”®è¯

---

### 5.3 æ–‡ä»¶è§£å¯†å‡½æ•°

#### 5.3.1 decryptFile()

**å‡½æ•°ç­¾å:**

```cpp
bool decryptFile(
    const std::string& encrypted_file,  // åŠ å¯†æ–‡ä»¶è·¯å¾„
    const std::string& output_path      // è¾“å‡ºæ–‡ä»¶è·¯å¾„
)
```

**åŠŸèƒ½æè¿°:** è§£å¯†ä¹‹å‰åŠ å¯†çš„æ–‡ä»¶ã€‚

**è¾“å…¥å‚æ•°:**

1. `encrypted_file`: åŠ å¯†æ–‡ä»¶è·¯å¾„ï¼ˆ.enc æ–‡ä»¶ï¼‰
2. `output_path`: è§£å¯†åçš„è¾“å‡ºæ–‡ä»¶è·¯å¾„

**è¾“å‡º:**

* è¿”å› `bool`: æˆåŠŸ/å¤±è´¥
* åˆ›å»ºè§£å¯†æ–‡ä»¶

**æ‰§è¡Œæµç¨‹:**

```
1. æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€
   â””â”€ å¦‚æœæœªåˆå§‹åŒ–ï¼Œè¿”å›é”™è¯¯

2. è¯»å–åŠ å¯†æ–‡ä»¶
   â”œâ”€ ä½¿ç”¨ readFile()
   â””â”€ è·å–å¯†æ–‡æ•°æ®

3. è°ƒç”¨ decryptFileData()
   â”œâ”€ æå– IVï¼ˆå‰16å­—èŠ‚ï¼‰
   â”œâ”€ ä½¿ç”¨ AES-256-CBC è§£å¯†
   â”œâ”€ ä½¿ç”¨ ek_ ä½œä¸ºå¯†é’¥
   â””â”€ è¾“å‡ºæ˜æ–‡

4. å†™å…¥è§£å¯†æ–‡ä»¶
   â””â”€ ä½¿ç”¨ writeFile()

5. è¿”å›æˆåŠŸ
```

**æ³¨æ„äº‹é¡¹:**

* éœ€è¦ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼ˆek\_ï¼‰
* IV å­˜å‚¨åœ¨å¯†æ–‡çš„å‰16å­—èŠ‚
* è‡ªåŠ¨å¤„ç† PKCS#7 å¡«å……

---

### 5.4 å¯†ç å­¦åŸè¯­å‡½æ•°

#### 5.4.1 computeHashH1()

**å‡½æ•°ç­¾å:**

```cpp
void computeHashH1(const std::string& input, mpz_t result)
```

**åŠŸèƒ½:** H1: {0,1}\* â†’ Z\_N ï¼ˆå“ˆå¸Œåˆ°å¤§æ•´æ•°æ¨¡Nï¼‰

**è¾“å…¥:**

* `input`: ä»»æ„å­—ç¬¦ä¸²
* `result`: è¾“å‡ºå‚æ•°ï¼ˆmpz\_tç±»å‹ï¼‰

**ç®—æ³•:**

```
1. è®¡ç®— SHA256(input)
2. å°†å“ˆå¸Œç»“æœè½¬ä¸ºå¤§æ•´æ•°
3. result = å¤§æ•´æ•° mod N
```

**ç”¨é€”:** ç”Ÿæˆæœç´¢ä»¤ç‰Œçš„ä¸­é—´æ­¥éª¤

---

#### 5.4.2 computeHashH2()

**å‡½æ•°ç­¾å:**

```cpp
void computeHashH2(const std::string& input, element_t result)
```

**åŠŸèƒ½:** H2: {0,1}\* â†’ Gâ‚ ï¼ˆå“ˆå¸Œåˆ°ç¾¤å…ƒç´ ï¼‰

**è¾“å…¥:**

* `input`: ä»»æ„å­—ç¬¦ä¸²
* `result`: è¾“å‡ºå‚æ•°ï¼ˆelement\_tç±»å‹ï¼ŒGâ‚ç¾¤ï¼‰

**ç®—æ³•:**

```
1. è®¡ç®— SHA256(input)
2. ä½¿ç”¨ element_from_hash() å°†å“ˆå¸Œæ˜ å°„åˆ° Gâ‚
```

**ç”¨é€”:**

* ç”Ÿæˆè®¤è¯æ ‡ç­¾ä¸­çš„ H\_2(ID\_F||i)
* ç”ŸæˆçŠ¶æ€å…³è”ä»¤ç‰Œä¸­çš„ H\_2(st\_d||Ti)

---

#### 5.4.3 computeHashH3()

**å‡½æ•°ç­¾å:**

```cpp
std::string computeHashH3(const std::string& input)
```

**åŠŸèƒ½:** H3: {0,1}\* â†’ {0,1}^Î» ï¼ˆå“ˆå¸Œåˆ°å›ºå®šé•¿åº¦å­—ç¬¦ä¸²ï¼‰

**è¾“å…¥:**

* `input`: ä»»æ„å­—ç¬¦ä¸²

**è¾“å‡º:**

* è¿”å› 256ä½å“ˆå¸Œçš„åå…­è¿›åˆ¶è¡¨ç¤ºï¼ˆ64å­—ç¬¦ï¼‰

**ç®—æ³•:**

```
1. è®¡ç®— SHA256(input)
2. è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
```

**ç”¨é€”:**

* ç”Ÿæˆæ–‡ä»¶ID
* ç”Ÿæˆæœç´¢ä»¤ç‰Œ
* ä½œä¸ºåŠ å¯†å¯†é’¥

---

#### 5.4.4 encryptKeyword()

**å‡½æ•°ç­¾å:**

```cpp
std::string encryptKeyword(const std::string& keyword)
```

**åŠŸèƒ½:** ç”Ÿæˆæœç´¢ä»¤ç‰Œ Ti

**è¾“å…¥:**

* `keyword`: æ˜æ–‡å…³é”®è¯

**è¾“å‡º:**

* è¿”å› Tiï¼ˆæœç´¢ä»¤ç‰Œï¼Œ256ä½åå…­è¿›åˆ¶ï¼‰

**ç®—æ³•:**

```
Ti = H3(H1(mk || keyword))

æ­¥éª¤:
1. è¿æ¥ mk å’Œ keyword
2. è®¡ç®— H1 å¾—åˆ°å¤§æ•´æ•°
3. å°†å¤§æ•´æ•°è½¬ä¸ºå­—èŠ‚ä¸²
4. è®¡ç®— H3 å¾—åˆ°æœ€ç»ˆä»¤ç‰Œ
```

**ç‰¹æ€§:**

* å•å‘å‡½æ•°ï¼Œæ— æ³•ä» Ti æ¢å¤ keyword
* éœ€è¦ mk æ‰èƒ½ç”Ÿæˆï¼Œä¿è¯å®¢æˆ·ç«¯æ§åˆ¶

---

#### 5.4.5 generateAuthTags()

**å‡½æ•°ç­¾å:**

```cpp
bool generateAuthTags(
    const std::string& file_id,
    const std::vector<unsigned char>& ciphertext,
    std::vector<std::string>& auth_tags
)
```

**åŠŸèƒ½:** ç”Ÿæˆæ–‡ä»¶çš„å®Œæ•´æ€§è®¤è¯æ ‡ç­¾

**è¾“å…¥:**

* `file_id`: æ–‡ä»¶å”¯ä¸€æ ‡è¯†ç¬¦
* `ciphertext`: åŠ å¯†åçš„æ–‡ä»¶æ•°æ®

**è¾“å‡º:**

* `auth_tags`: è®¤è¯æ ‡ç­¾åˆ—è¡¨ï¼ˆæ¯ä¸ªå—ä¸€ä¸ªï¼‰
* è¿”å› `bool`: æˆåŠŸ/å¤±è´¥

**ç®—æ³•è¯¦è§£:**

```
å¯¹äºæ¯ä¸ªå— i (å…± n ä¸ªå—):

1. åˆ†å—
   â””â”€ ciphertext â†’ blocks (æ¯å—4096å­—èŠ‚)

2. å¯¹äºå— i:
   â”œâ”€ è®¡ç®—åŸºç¡€å…ƒç´ : h = H_2(file_id || i)
   â”‚
   â”œâ”€ åˆ†æ‰‡åŒº: block_i â†’ sectors (æ¯æ‰‡åŒº256å­—èŠ‚, å…±16æ‰‡åŒº)
   â”‚
   â”œâ”€ å¯¹äºæ¯ä¸ªæ‰‡åŒº j:
   â”‚   â”œâ”€ å°†æ‰‡åŒºæ•°æ®è§†ä¸ºå¤§æ•´æ•°: c_{i,j} = bytes_to_integer(sector_j)
   â”‚   â”œâ”€ è®¡ç®—: Î¼^{c_{i,j}} (æ¨¡æŒ‡æ•°è¿ç®—)
   â”‚   â””â”€ ç´¯ä¹˜åˆ° product
   â”‚
   â”œâ”€ è®¡ç®—: temp = h * product
   â”‚
   â””â”€ è®¡ç®—æœ€ç»ˆæ ‡ç­¾: Ïƒ_i = temp^sk (ç§é’¥æŒ‡æ•°)

3. åºåˆ—åŒ– Ïƒ_i ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
4. æ·»åŠ åˆ° auth_tags åˆ—è¡¨
```

**æ•°å­¦è¡¨ç¤º:**

```
Ïƒ_i = [H_2(ID_F || i) Â· âˆ_{j=1}^{s} Î¼^{c_{i,j}}]^{sk}

å…¶ä¸­:
- ID_F: æ–‡ä»¶æ ‡è¯†ç¬¦
- i: å—ç´¢å¼• (0 åˆ° n-1)
- j: æ‰‡åŒºç´¢å¼• (0 åˆ° s-1, s=16)
- c_{i,j}: ç¬¬iå—ç¬¬jæ‰‡åŒºçš„æ•°æ®ï¼ˆä½œä¸ºæ•´æ•°ï¼‰
- Î¼: å…¬å…±è®¤è¯å‚æ•°ï¼ˆGâ‚ç¾¤å…ƒç´ ï¼‰
- sk: å®¢æˆ·ç«¯ç§é’¥
```

**å—å’Œæ‰‡åŒºç»“æ„:**

```
æ–‡ä»¶å¯†æ–‡ï¼ˆä¾‹å¦‚: 100KBï¼‰
â”‚
â”œâ”€ å—0 (4096å­—èŠ‚)
â”‚  â”œâ”€ æ‰‡åŒº0 (256å­—èŠ‚) â†’ c_{0,0}
â”‚  â”œâ”€ æ‰‡åŒº1 (256å­—èŠ‚) â†’ c_{0,1}
â”‚  â”œâ”€ ...
â”‚  â””â”€ æ‰‡åŒº15 (256å­—èŠ‚) â†’ c_{0,15}
â”‚  â””â”€ Ïƒ_0 = [H_2(ID||0) * Î¼^{c_{0,0}} * Î¼^{c_{0,1}} * ... * Î¼^{c_{0,15}}]^sk
â”‚
â”œâ”€ å—1 (4096å­—èŠ‚)
â”‚  â”œâ”€ æ‰‡åŒº0-15
â”‚  â””â”€ Ïƒ_1 = [H_2(ID||1) * âˆÎ¼^{c_{1,j}}]^sk
â”‚
â”œâ”€ ...
â”‚
â””â”€ å—n-1 (å¯èƒ½ä¸è¶³4096å­—èŠ‚ï¼Œå¡«å……0)
   â””â”€ Ïƒ_{n-1}
```

**éªŒè¯è¿‡ç¨‹ï¼ˆç”±Storage Nodeæ‰§è¡Œï¼‰:**

```
éªŒè¯ Ïƒ_i æ˜¯å¦æ­£ç¡®:

1. é‡æ–°è®¡ç®—: temp = H_2(ID_F || i) Â· âˆ_{j=1}^{s} Î¼^{c_{i,j}}

2. ä½¿ç”¨åŒçº¿æ€§é…å¯¹éªŒè¯:
   e(Ïƒ_i, g) ?= e(temp, pk)
   
   å…¶ä¸­:
   - e: åŒçº¿æ€§é…å¯¹å‡½æ•°
   - g: å…¬å…±ç”Ÿæˆå…ƒ
   - pk: å®¢æˆ·ç«¯å…¬é’¥ (= g^sk)

3. éªŒè¯æˆç«‹å› ä¸º:
   e(temp^sk, g) = e(temp, g)^sk = e(temp, g^sk) = e(temp, pk)
```

---

#### 5.4.6 generateStateAssociatedToken()

**å‡½æ•°ç­¾å:**

```cpp
bool generateStateAssociatedToken(
    const std::string& file_id,
    const std::string& Ti,
    const std::string& current_state,
    const std::string& previous_state,
    std::string& kt_output
)
```

**åŠŸèƒ½:** ç”ŸæˆçŠ¶æ€å…³è”ä»¤ç‰Œï¼ˆå®ç°å‰å‘å®‰å…¨æ€§ï¼‰

**è¾“å…¥:**

* `file_id`: æ–‡ä»¶æ ‡è¯†ç¬¦
* `Ti`: æœç´¢ä»¤ç‰Œ
* `current_state`: å½“å‰çŠ¶æ€å€¼
* `previous_state`: å‰ä¸€çŠ¶æ€å€¼ï¼ˆç©ºå­—ç¬¦ä¸²è¡¨ç¤ºé¦–æ¬¡ï¼‰

**è¾“å‡º:**

* `kt_output`: çŠ¶æ€å…³è”ä»¤ç‰Œï¼ˆåºåˆ—åŒ–çš„ç¾¤å…ƒç´ ï¼‰
* è¿”å› `bool`: æˆåŠŸ/å¤±è´¥

**ç®—æ³•è¯¦è§£:**

```
åœºæ™¯1: é¦–æ¬¡ä¸ºè¯¥å…³é”®è¯åŠ å¯†æ–‡ä»¶ (previous_state ä¸ºç©º)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
kt^w = [H_2(ID_F) Â· H_2(st_d || Ti)]^sk

æ­¥éª¤:
1. è®¡ç®— h1 = H_2(file_id)
2. è®¡ç®— h2 = H_2(current_state || Ti)
3. temp = h1 * h2 (ç¾¤ä¹˜æ³•)
4. kt = temp^sk (æŒ‡æ•°è¿ç®—)


åœºæ™¯2: éé¦–æ¬¡åŠ å¯† (previous_state å­˜åœ¨)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
kt^w = [H_2(ID_F) Â· H_2(st_d || Ti) / H_2(st_{d-1} || Ti)]^sk

æ­¥éª¤:
1. è®¡ç®— h1 = H_2(file_id)
2. è®¡ç®— h2_current = H_2(current_state || Ti)
3. è®¡ç®— h2_previous = H_2(previous_state || Ti)
4. è®¡ç®— h2_prev_inv = h2_previous^{-1} (ç¾¤é€†å…ƒ)
5. temp = h1 * h2_current * h2_prev_inv
6. kt = temp^sk
```

**å‰å‘å®‰å…¨æ€§åŸç†:**

```
çŠ¶æ€é“¾ç¤ºä¾‹:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ—¶é—´ t1: åŠ å¯†æ–‡ä»¶1
    st_1 = 0xaabbcc...
    kt^w_1 = [H_2(ID_1) Â· H_2(st_1 || Ti)]^sk

æ—¶é—´ t2: åŠ å¯†æ–‡ä»¶2 (åŒä¸€å…³é”®è¯)
    st_2 = 0xddeeff...
    kt^w_2 = [H_2(ID_2) Â· H_2(st_2 || Ti) / H_2(st_1 || Ti)]^sk

æ—¶é—´ t3: åŠ å¯†æ–‡ä»¶3 (åŒä¸€å…³é”®è¯)
    st_3 = 0x112233...
    kt^w_3 = [H_2(ID_3) Â· H_2(st_3 || Ti) / H_2(st_2 || Ti)]^sk

æœç´¢æ—¶ (åœ¨æ—¶é—´ t3):
    æœåŠ¡å™¨æ‹¥æœ‰: kt^w_1, kt^w_2, kt^w_3, st_3
  
    ä» st_3 å¼€å§‹å‘å‰æœç´¢:
    1. ä½¿ç”¨ kt^w_3 å’Œ st_3 æ‰¾åˆ°æ–‡ä»¶3
    2. ä»åŠ å¯†æŒ‡é’ˆè§£å¯†å¾—åˆ° st_2
    3. ä½¿ç”¨ kt^w_2 å’Œ st_2 æ‰¾åˆ°æ–‡ä»¶2
    4. ä»åŠ å¯†æŒ‡é’ˆè§£å¯†å¾—åˆ° st_1
    5. ä½¿ç”¨ kt^w_1 å’Œ st_1 æ‰¾åˆ°æ–‡ä»¶1

å…³é”®: æ²¡æœ‰æœ€æ–°çŠ¶æ€ st_3ï¼Œæ— æ³•å¼€å§‹æœç´¢é“¾ï¼
```

**ä¸ºä»€ä¹ˆæ˜¯å‰å‘å®‰å…¨çš„:**

```
æ”»å‡»åœºæ™¯: æ”»å‡»è€…åœ¨ t2 æ—¶åˆ»è·å¾—äº†æ‰€æœ‰æ•°æ®

æ”»å‡»è€…æ‹¥æœ‰:
âœ“ kt^w_1 (æ–‡ä»¶1çš„ä»¤ç‰Œ)
âœ“ kt^w_2 (æ–‡ä»¶2çš„ä»¤ç‰Œ)
âœ“ st_2 (æ—¶é—´t2çš„æœ€æ–°çŠ¶æ€)

æ”»å‡»è€…æƒ³è¦: æœç´¢ t3 æ—¶åˆ»åŠ å¯†çš„æ–‡ä»¶3

æ”»å‡»å¤±è´¥åŸå› :
âœ— æ²¡æœ‰ st_3 (æ–‡ä»¶3çš„çŠ¶æ€)
âœ— kt^w_3 è¿˜æœªç”Ÿæˆ
âœ— å³ä½¿ä¹‹åè·å¾— kt^w_3ï¼Œä¹Ÿä¸çŸ¥é“ st_3

ç»“è®º: æ— æ³•æœç´¢æœªæ¥åŠ å¯†çš„æ–‡ä»¶ï¼
```

---

#### 5.4.7 encryptPointer()

**å‡½æ•°ç­¾å:**

```cpp
std::string encryptPointer(
    const std::string& previous_state,
    const std::string& current_state_hash
)
```

**åŠŸèƒ½:** åŠ å¯†æŒ‡å‘å‰ä¸€çŠ¶æ€çš„æŒ‡é’ˆ

**è¾“å…¥:**

* `previous_state`: å‰ä¸€ä¸ªçŠ¶æ€å€¼ï¼ˆç©ºè¡¨ç¤ºé¦–æ¬¡ï¼‰
* `current_state_hash`: å½“å‰çŠ¶æ€çš„å“ˆå¸Œå€¼ï¼ˆä½œä¸ºå¯†é’¥ï¼‰

**è¾“å‡º:**

* è¿”å›åŠ å¯†åçš„æŒ‡é’ˆï¼ˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰

**ç®—æ³•:**

```
1. ç¡®å®šè¦åŠ å¯†çš„æ•°æ®:
   â””â”€ data = previous_state ä¸ºç©º ? current_state_hash : previous_state

2. æå–å¯†é’¥:
   â””â”€ key = current_state_hash çš„å‰32å­—èŠ‚

3. ä½¿ç”¨ AES-256-ECB åŠ å¯†:
   â””â”€ ptr = AES_ECB_encrypt(data, key)

4. è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
```

**ç”¨é€”:**

* åœ¨çŠ¶æ€é“¾ä¸­å‘å‰å¯¼èˆª
* è§£å¯†éœ€è¦çŸ¥é“å½“å‰çŠ¶æ€çš„å“ˆå¸Œå€¼

---

### 5.5 çŠ¶æ€ç®¡ç†å‡½æ•°

#### 5.5.1 updateKeywordState()

**å‡½æ•°ç­¾å:**

```cpp
bool updateKeywordState(
    const std::string& keyword,
    const std::string& new_state,
    const std::string& file_id
)
```

**åŠŸèƒ½:** æ›´æ–°å…³é”®è¯çš„çŠ¶æ€å¹¶è®°å½•å†å²

**è¾“å…¥:**

* `keyword`: å…³é”®è¯ï¼ˆæ˜æ–‡ï¼‰
* `new_state`: æ–°çš„çŠ¶æ€å€¼
* `file_id`: å…³è”çš„æ–‡ä»¶ID

**è¾“å‡º:**

* è¿”å› `bool`: æˆåŠŸ/å¤±è´¥

**æ‰§è¡Œæµç¨‹:**

```
1. å¦‚æœ keyword_states_data_ ä¸ºç©ºï¼Œåˆå§‹åŒ–

2. å¦‚æœå…³é”®è¯é¦–æ¬¡å‡ºç°ï¼Œåˆ›å»ºæ¡ç›®

3. æ›´æ–°å½“å‰çŠ¶æ€:
   â””â”€ keywords[keyword]["current_state"] = new_state

4. æ›´æ–°æ—¶é—´æˆ³:
   â””â”€ keywords[keyword]["last_update"] = getCurrentTimestamp()

5. æ·»åŠ å†å²è®°å½•:
   â””â”€ keywords[keyword]["history"].append({
       "state": new_state,
       "file_id": file_id,
       "timestamp": getCurrentTimestamp()
   })

6. æ›´æ–°å†…å­˜æ˜ å°„:
   â””â”€ keyword_states_[keyword] = new_state

7. å¦‚æœçŠ¶æ€æ–‡ä»¶å·²åŠ è½½ï¼Œè‡ªåŠ¨ä¿å­˜
```

---

#### 5.5.2 queryKeywordState()

**å‡½æ•°ç­¾å:**

```cpp
std::string queryKeywordState(const std::string& keyword)
```

**åŠŸèƒ½:** æŸ¥è¯¢å…³é”®è¯çš„å½“å‰çŠ¶æ€å’Œå†å²

**è¾“å…¥:**

* `keyword`: è¦æŸ¥è¯¢çš„å…³é”®è¯

**è¾“å‡º:**

* è¿”å›æ ¼å¼åŒ–çš„çŠ¶æ€ä¿¡æ¯å­—ç¬¦ä¸²

**è¾“å‡ºæ ¼å¼ç¤ºä¾‹:**

```
[æŸ¥è¯¢ç»“æœ] å…³é”®è¯: confidential
============================================
å½“å‰çŠ¶æ€: 0x7f8e9d...
æœ€åæ›´æ–°: 2025-11-10 14:30:00

å†å²è®°å½• (3 æ¡):
  [1] çŠ¶æ€: 0x1a2b3c4d5e6f... | æ–‡ä»¶ID: 0xabcdef12... | æ—¶é—´: 2025-11-10 12:00:00
  [2] çŠ¶æ€: 0x7f8e9d0c1b2a... | æ–‡ä»¶ID: 0x12345678... | æ—¶é—´: 2025-11-10 13:15:00
  [3] çŠ¶æ€: 0x9a8b7c6d5e4f... | æ–‡ä»¶ID: 0x87654321... | æ—¶é—´: 2025-11-10 14:30:00
============================================
```

---

### 5.6 è¾…åŠ©å‡½æ•°

#### 5.6.1 readFile() / writeFile()

**åŠŸèƒ½:** æ–‡ä»¶I/Oæ“ä½œ

**readFile:**

```cpp
bool readFile(const std::string& file_path, 
             std::vector<unsigned char>& data)
```

* è¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜
* ä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼

**writeFile:**

```cpp
bool writeFile(const std::string& file_path,
              const std::vector<unsigned char>& data)
```

* å°†æ•°æ®å†™å…¥æ–‡ä»¶
* ä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼

---

#### 5.6.2 splitIntoBlocks()

**å‡½æ•°ç­¾å:**

```cpp
std::vector<std::vector<unsigned char>> splitIntoBlocks(
    const std::vector<unsigned char>& data,
    size_t block_size
)
```

**åŠŸèƒ½:** å°†æ•°æ®åˆ†å‰²æˆå›ºå®šå¤§å°çš„å—

**è¾“å…¥:**

* `data`: åŸå§‹æ•°æ®
* `block_size`: å—å¤§å°ï¼ˆé€šå¸¸ä¸º4096æˆ–256ï¼‰

**è¾“å‡º:**

* è¿”å›å—çš„å‘é‡

**ç‰¹æ€§:**

* æœ€åä¸€å—å¦‚æœä¸è¶³ï¼Œå¡«å……é›¶

---

#### 5.6.3 serializeElement() / deserializeElement()

**åŠŸèƒ½:** ç¾¤å…ƒç´ çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–

**serializeElement:**

```cpp
std::string serializeElement(element_t elem)
```

* å°† Gâ‚ ç¾¤å…ƒç´ è½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
* ç”¨äºå­˜å‚¨å’Œä¼ è¾“

**deserializeElement:**

```cpp
bool deserializeElement(const std::string& hex_str, element_t elem)
```

* ä»åå…­è¿›åˆ¶å­—ç¬¦ä¸²æ¢å¤ç¾¤å…ƒç´ 
* éœ€è¦å·²åˆå§‹åŒ–çš„é…å¯¹å‚æ•°

---

## æ“ä½œæµç¨‹å›¾

### 6.1 ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç³»ç»Ÿåˆå§‹åŒ–å®Œæ•´æµç¨‹                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·æ“ä½œ               å®¢æˆ·ç«¯çŠ¶æ€                    æ–‡ä»¶ç³»ç»Ÿ
â•â•â•â•â•â•â•â•â•            â•â•â•â•â•â•â•â•â•â•â•â•                  â•â•â•â•â•â•â•â•â•â•â•

[å¯åŠ¨ç¨‹åº]
    â”‚
    â”œâ”€> æ£€æµ‹æ–‡ä»¶
    â”‚        â””â”€> public_params.json å­˜åœ¨? â”€â”€> [æ˜¾ç¤ºæç¤º]
    â”‚
    v
[è¾“å…¥å‘½ä»¤: init]
    â”‚
    â”œâ”€> initialize()
    â”‚     â”‚
    â”‚     â”œâ”€> 1. ç¡¬ç¼–ç é…å¯¹å‚æ•°
    â”‚     â”‚      â”œâ”€ Type A æ›²çº¿
    â”‚     â”‚      â”œâ”€ q, h, r å‚æ•°
    â”‚     â”‚      â””â”€> pairing_init() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [å†…å­˜: pairing_]
    â”‚     â”‚
    â”‚     â”œâ”€> 2. è¯»å– public_params.json â”€â”€â”€â”€â”€> [è¯»å–æ–‡ä»¶]
    â”‚     â”‚      â”œâ”€ è§£æ JSON                     â”‚
    â”‚     â”‚      â””â”€ æå– public_params            â”‚
    â”‚     â”‚                                       â”‚
    â”‚     â”œâ”€> 3. åŠ è½½ N (RSAæ¨¡æ•°)                â”‚
    â”‚     â”‚      â”œâ”€ å­—ç¬¦ä¸² â†’ mpz_t               â”‚
    â”‚     â”‚      â”œâ”€ éªŒè¯ä½æ•° (â‰¥2048ä½)           â”‚
    â”‚     â”‚      â””â”€> å­˜å‚¨åˆ° N_ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [å†…å­˜: N_]
    â”‚     â”‚
    â”‚     â”œâ”€> 4. åŠ è½½ g (ç”Ÿæˆå…ƒ)
    â”‚     â”‚      â”œâ”€ åå…­è¿›åˆ¶ â†’ element_t
    â”‚     â”‚      â”œâ”€ ååºåˆ—åŒ– (deserializeElement)
    â”‚     â”‚      â”œâ”€ éªŒè¯: element_is1(g) == false
    â”‚     â”‚      â””â”€> å­˜å‚¨åˆ° g_ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [å†…å­˜: g_]
    â”‚     â”‚
    â”‚     â”œâ”€> 5. åŠ è½½ Î¼ (è®¤è¯å‚æ•°)
    â”‚     â”‚      â”œâ”€ åå…­è¿›åˆ¶ â†’ element_t
    â”‚     â”‚      â”œâ”€ ååºåˆ—åŒ–
    â”‚     â”‚      â”œâ”€ éªŒè¯: element_is1(Î¼) == false
    â”‚     â”‚      â””â”€> å­˜å‚¨åˆ° mu_ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [å†…å­˜: mu_]
    â”‚     â”‚
    â”‚     â”œâ”€> 6. åˆå§‹åŒ– pk_ (é¢„åˆ†é…ç©ºé—´)
    â”‚     â”‚      â””â”€> element_init_G1(pk_) â”€â”€â”€â”€â”€â”€> [å†…å­˜: pk_]
    â”‚     â”‚
    â”‚     â””â”€> 7. è®¾ç½®æ ‡å¿—
    â”‚            â””â”€> initialized_ = true â”€â”€â”€â”€â”€â”€â”€â”€> [çŠ¶æ€: å·²åˆå§‹åŒ–]
    â”‚
    v
[æ˜¾ç¤º: åˆå§‹åŒ–æˆåŠŸ]


[è¾“å…¥å‘½ä»¤: keygen]
    â”‚
    â”œâ”€> generateKeys()
    â”‚     â”‚
    â”‚     â”œâ”€> æ£€æŸ¥: initialized_ == true?
    â”‚     â”‚      â””â”€ å¦ â†’ [é”™è¯¯: æœªåˆå§‹åŒ–]
    â”‚     â”‚
    â”‚     â”œâ”€> 1. ç”Ÿæˆ mk (ä¸»å¯†é’¥)
    â”‚     â”‚      â”œâ”€ RAND_bytes(mk_, 32)
    â”‚     â”‚      â””â”€> å­˜å‚¨åˆ° mk_[32] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [å†…å­˜: mk_]
    â”‚     â”‚
    â”‚     â”œâ”€> 2. ç”Ÿæˆ ek (åŠ å¯†å¯†é’¥)
    â”‚     â”‚      â”œâ”€ RAND_bytes(ek_, 32)
    â”‚     â”‚      â””â”€> å­˜å‚¨åˆ° ek_[32] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [å†…å­˜: ek_]
    â”‚     â”‚
    â”‚     â”œâ”€> 3. ç”Ÿæˆ sk (ç§é’¥)
    â”‚     â”‚      â”œâ”€ element_random(temp) âˆˆ Zr
    â”‚     â”‚      â”œâ”€ element_to_mpz(sk_, temp)
    â”‚     â”‚      â””â”€> å­˜å‚¨åˆ° sk_ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [å†…å­˜: sk_]
    â”‚     â”‚
    â”‚     â”œâ”€> 4. è®¡ç®— pk (å…¬é’¥)
    â”‚     â”‚      â”œâ”€ pk = g^sk
    â”‚     â”‚      â”œâ”€ element_pow_mpz(pk_, g_, sk_)
    â”‚     â”‚      â”œâ”€ éªŒè¯: element_is1(pk_) == false
    â”‚     â”‚      â””â”€> æ›´æ–° pk_ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [å†…å­˜: pk_]
    â”‚     â”‚
    â”‚     â”œâ”€> 5. ä¿å­˜ç§é’¥
    â”‚     â”‚      â”œâ”€ æ‰“å¼€ private_key.dat (äºŒè¿›åˆ¶)
    â”‚     â”‚      â”œâ”€ å†™å…¥ mk_[32]
    â”‚     â”‚      â”œâ”€ å†™å…¥ ek_[32]
    â”‚     â”‚      â”œâ”€ å†™å…¥ sk_size, sk_
    â”‚     â”‚      â”œâ”€ å†™å…¥ pk_size, pk_åºåˆ—åŒ–
    â”‚     â”‚      â””â”€> å…³é—­æ–‡ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [åˆ›å»º: private_key.dat]
    â”‚     â”‚
    â”‚     â””â”€> 6. ä¿å­˜å…¬é’¥
    â”‚            â”œâ”€ åˆ›å»º JSON å¯¹è±¡
    â”‚            â”œâ”€ json["pk"] = serializeElement(pk_)
    â”‚            â”œâ”€ json["timestamp"] = å½“å‰æ—¶é—´
    â”‚            â”œâ”€ json["version"] = "v4.0"
    â”‚            â””â”€> å†™å…¥ public_key.json â”€â”€â”€â”€â”€â”€â”€â”€> [åˆ›å»º: public_key.json]
    â”‚
    v
[æ˜¾ç¤º: å¯†é’¥ç”ŸæˆæˆåŠŸ]
[æç¤º: å¦¥å–„ä¿ç®¡ private_key.dat]


æœ€ç»ˆçŠ¶æ€:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
å†…å­˜çŠ¶æ€:
  âœ“ pairing_      - Type A æ›²çº¿é…å¯¹å‚æ•°
  âœ“ N_            - RSAæ¨¡æ•° (â‰¥2048ä½)
  âœ“ g_            - Gâ‚ ç”Ÿæˆå…ƒ
  âœ“ mu_           - è®¤è¯å‚æ•° (Gâ‚)
  âœ“ mk_[32]       - ä¸»å¯†é’¥ (256ä½)
  âœ“ ek_[32]       - åŠ å¯†å¯†é’¥ (256ä½)
  âœ“ sk_           - ç§é’¥ (å¤§æ•´æ•°)
  âœ“ pk_           - å…¬é’¥ (g^sk âˆˆ Gâ‚)
  âœ“ initialized_  - true

æ–‡ä»¶ç³»ç»Ÿ:
  âœ“ public_params.json   - å·²è¯»å–
  âœ“ private_key.dat      - å·²åˆ›å»º (ä¿å¯†!)
  âœ“ public_key.json      - å·²åˆ›å»º

ç³»ç»Ÿå°±ç»ª: å¯ä»¥å¼€å§‹åŠ å¯†æ–‡ä»¶
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

### 6.2 æ–‡ä»¶åŠ å¯†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ–‡ä»¶åŠ å¯†è¯¦ç»†æµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·æ“ä½œ               å®¢æˆ·ç«¯å¤„ç†                           æ–‡ä»¶æ›´æ–°
â•â•â•â•â•â•â•â•â•â•â•          â•â•â•â•â•â•â•â•â•â•â•â•â•                        â•â•â•â•â•â•â•â•â•â•â•â•â•

[è¾“å…¥å‘½ä»¤: encrypt]
    â”‚
    â”œâ”€> è¾“å…¥æ–‡ä»¶è·¯å¾„: "document.pdf"
    â”œâ”€> è¾“å…¥å…³é”®è¯: "confidential, finance, Q4"
    â”œâ”€> è¾“å…¥è¾“å‡ºå‰ç¼€: "document_enc"
    â”‚
    v
encryptFile()
    â”‚
    â”œâ”€â”€> [é˜¶æ®µ1: æ–‡ä»¶è¯»å–ä¸IDç”Ÿæˆ]
    â”‚      â”‚
    â”‚      â”œâ”€> readFile("document.pdf") â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [è¯»å–: document.pdf]
    â”‚      â”‚      â””â”€> plaintext (100KB)
    â”‚      â”‚
    â”‚      â””â”€> ç”Ÿæˆ file_id
    â”‚             â”œâ”€ è¾“å…¥: "document.pdf" + æ—¶é—´æˆ³
    â”‚             â”œâ”€ è®¡ç®—: H3(è¾“å…¥)
    â”‚             â””â”€> file_id = "0xabcd1234..."
    â”‚
    â”œâ”€â”€> [é˜¶æ®µ2: æ–‡ä»¶æ•°æ®åŠ å¯†]
    â”‚      â”‚
    â”‚      â””â”€> encryptFileData(plaintext, ciphertext)
    â”‚             â”‚
    â”‚             â”œâ”€> ç”Ÿæˆéšæœº IV (16å­—èŠ‚)
    â”‚             â”œâ”€> AES-256-CBC åŠ å¯†
    â”‚             â”‚      â”œâ”€ å¯†é’¥: ek_
    â”‚             â”‚      â”œâ”€ æ¨¡å¼: CBC
    â”‚             â”‚      â””â”€ å¡«å……: PKCS#7
    â”‚             â”‚
    â”‚             â””â”€> ciphertext = [IV | å¯†æ–‡æ•°æ®]
    â”‚                    (16 + 100KB + padding)
    â”‚
    â”œâ”€â”€> ä¿å­˜åŠ å¯†æ–‡ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [åˆ›å»º: document_enc.enc]
    â”‚
    â”œâ”€â”€> [é˜¶æ®µ3: ç”Ÿæˆè®¤è¯æ ‡ç­¾]
    â”‚      â”‚
    â”‚      â””â”€> generateAuthTags(file_id, ciphertext, auth_tags)
    â”‚             â”‚
    â”‚             â”œâ”€> åˆ†å—: ciphertext â†’ blocks[] (æ¯å—4096B)
    â”‚             â”‚      â””â”€> å‡è®¾25ä¸ªå—
    â”‚             â”‚
    â”‚             â””â”€> å¯¹äºæ¯ä¸ªå— i (i=0 to 24):
    â”‚                    â”‚
    â”‚                    â”œâ”€> è®¡ç®— h = H_2(file_id || i)
    â”‚                    â”‚
    â”‚                    â”œâ”€> åˆ†æ‰‡åŒº: block[i] â†’ sectors[] (æ¯æ‰‡åŒº256B)
    â”‚                    â”‚      â””â”€> 16ä¸ªæ‰‡åŒº
    â”‚                    â”‚
    â”‚                    â”œâ”€> product = 1 (Gâ‚å•ä½å…ƒ)
    â”‚                    â”œâ”€> å¯¹äºæ¯ä¸ªæ‰‡åŒº j (j=0 to 15):
    â”‚                    â”‚      â”œâ”€ c_{i,j} = sector_to_integer(sectors[j])
    â”‚                    â”‚      â”œâ”€ temp = Î¼^{c_{i,j}}
    â”‚                    â”‚      â””â”€ product *= temp
    â”‚                    â”‚
    â”‚                    â”œâ”€> temp = h * product
    â”‚                    â””â”€> Ïƒ_i = temp^sk
    â”‚                           â””â”€> auth_tags[i] = serialize(Ïƒ_i)
    â”‚
    â”œâ”€â”€> [é˜¶æ®µ4: å¤„ç†å…³é”®è¯]
    â”‚      â”‚
    â”‚      â””â”€> å¯¹äºæ¯ä¸ªå…³é”®è¯ (3ä¸ªå…³é”®è¯):
    â”‚             â”‚
    â”‚             â”œâ”€> ã€å…³é”®è¯1: "confidential"ã€‘
    â”‚             â”‚      â”‚
    â”‚             â”‚      â”œâ”€> 4.1 ç”Ÿæˆæœç´¢ä»¤ç‰Œ
    â”‚             â”‚      â”‚      â”œâ”€ Ti = encryptKeyword("confidential")
    â”‚             â”‚      â”‚      â”‚     â””â”€> H3(H1(mk || "confidential"))
    â”‚             â”‚      â”‚      â””â”€> Ti = "0x7f8e..."
    â”‚             â”‚      â”‚
    â”‚             â”‚      â”œâ”€> 4.2 çŠ¶æ€ç®¡ç†
    â”‚             â”‚      â”‚      â”œâ”€ æŸ¥è¯¢: keyword_states_["confidential"]
    â”‚             â”‚      â”‚      â”œâ”€ previous_state = (æœªæ‰¾åˆ°)
    â”‚             â”‚      â”‚      â””â”€ current_state = generateRandomState()
    â”‚             â”‚      â”‚             â””â”€> "0x1a2b3c..."
    â”‚             â”‚      â”‚
    â”‚             â”‚      â”œâ”€> 4.3 ç”ŸæˆçŠ¶æ€å…³è”ä»¤ç‰Œ
    â”‚             â”‚      â”‚      â”œâ”€ è°ƒç”¨ generateStateAssociatedToken(
    â”‚             â”‚      â”‚      â”‚    file_id, Ti, current_state, previous_state)
    â”‚             â”‚      â”‚      â”‚
    â”‚             â”‚      â”‚      â”œâ”€ é¦–æ¬¡åŠ å¯† (previous_state ä¸ºç©º):
    â”‚             â”‚      â”‚      â”‚    â”œâ”€ h1 = H_2(file_id)
    â”‚             â”‚      â”‚      â”‚    â”œâ”€ h2 = H_2(current_state || Ti)
    â”‚             â”‚      â”‚      â”‚    â”œâ”€ temp = h1 * h2
    â”‚             â”‚      â”‚      â”‚    â””â”€ kt = temp^sk
    â”‚             â”‚      â”‚      â”‚
    â”‚             â”‚      â”‚      â””â”€> kt = "0x4d5e6f..."
    â”‚             â”‚      â”‚
    â”‚             â”‚      â”œâ”€> 4.4 åŠ å¯†æŒ‡é’ˆ
    â”‚             â”‚      â”‚      â”œâ”€ é¦–æ¬¡: åŠ å¯†å½“å‰çŠ¶æ€å“ˆå¸Œ
    â”‚             â”‚      â”‚      â”œâ”€ key = H3(current_state)[0:32]
    â”‚             â”‚      â”‚      â””â”€ ptr = AES-ECB(H3(current_state), key)
    â”‚             â”‚      â”‚             â””â”€> "0x9a8b..."
    â”‚             â”‚      â”‚
    â”‚             â”‚      â””â”€> 4.5 æ›´æ–°çŠ¶æ€
    â”‚             â”‚             â””â”€> updateKeywordState(
    â”‚             â”‚                    "confidential", 
    â”‚             â”‚                    current_state,
    â”‚             â”‚                    file_id
    â”‚             â”‚                 )
    â”‚             â”‚                 â””â”€> æ›´æ–°å†…å­˜å’Œ JSON
    â”‚             â”‚
    â”‚             â”œâ”€> ã€å…³é”®è¯2: "finance"ã€‘
    â”‚             â”‚      â””â”€> (é‡å¤ä¸Šè¿°4.1-4.5æ­¥éª¤)
    â”‚             â”‚
    â”‚             â””â”€> ã€å…³é”®è¯3: "Q4"ã€‘
    â”‚                    â””â”€> (é‡å¤ä¸Šè¿°4.1-4.5æ­¥éª¤)
    â”‚
    â”œâ”€â”€> [é˜¶æ®µ5: ç”Ÿæˆ insert.json]
    â”‚      â”‚
    â”‚      â””â”€> ç»„è£… JSON:
    â”‚             {
    â”‚               "file_id": "0xabcd1234...",
    â”‚               "keywords": [
    â”‚                 {
    â”‚                   "Ti": "0x7f8e...",    // confidential
    â”‚                   "kt": "0x4d5e6f...",
    â”‚                   "ptr": "0x9a8b..."
    â”‚                 },
    â”‚                 { ... },  // finance
    â”‚                 { ... }   // Q4
    â”‚               ],
    â”‚               "auth_tags": [
    â”‚                 "0x...", "0x...", ... // 25ä¸ªæ ‡ç­¾
    â”‚               ],
    â”‚               "timestamp": "2025-11-10 14:30:00"
    â”‚             }
    â”‚             â”‚
    â”‚             â””â”€> å†™å…¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [åˆ›å»º: insert.json]
    â”‚
    â”œâ”€â”€> [é˜¶æ®µ6: ç”Ÿæˆæœ¬åœ°å…ƒæ•°æ®]
    â”‚      â”‚
    â”‚      â””â”€> åˆ›å»º metadata:
    â”‚             {
    â”‚               "file_id": "0xabcd1234...",
    â”‚               "original_file": "document.pdf",
    â”‚               "encrypted_file": "document_enc.enc",
    â”‚               "keywords": [
    â”‚                 "confidential",
    â”‚                 "finance",
    â”‚                 "Q4"
    â”‚               ],
    â”‚               "timestamp": "2025-11-10 14:30:00"
    â”‚             }
    â”‚             â”‚
    â”‚             â””â”€> å†™å…¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [åˆ›å»º: document.pdf_metadata.json]
    â”‚
    â””â”€â”€> [é˜¶æ®µ7: è‡ªåŠ¨ä¿å­˜çŠ¶æ€]
           â”‚
           â””â”€> saveKeywordStates() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [æ›´æ–°: keyword_states.json]
                  {
                    "version": "v4.0",
                    "keywords": {
                      "confidential": {
                        "current_state": "0x1a2b3c...",
                        "last_update": "2025-11-10 14:30:00",
                        "history": [
                          {
                            "state": "0x1a2b3c...",
                            "file_id": "0xabcd1234...",
                            "timestamp": "2025-11-10 14:30:00"
                          }
                        ]
                      },
                      "finance": { ... },
                      "Q4": { ... }
                    }
                  }

æœ€ç»ˆè¾“å‡ºæ–‡ä»¶:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ“ document_enc.enc           - åŠ å¯†æ–‡ä»¶ (100KB + 16B IV + padding)
âœ“ insert.json                - ä¾› Storage Node ä½¿ç”¨
                               åŒ…å«: file_id, å…³é”®è¯ä»¤ç‰Œ, è®¤è¯æ ‡ç­¾
âœ“ document.pdf_metadata.json - æœ¬åœ°å…ƒæ•°æ® (æ˜æ–‡å…³é”®è¯ç­‰)
âœ“ keyword_states.json        - æ›´æ–°å…³é”®è¯çŠ¶æ€

å†…å­˜çŠ¶æ€æ›´æ–°:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
keyword_states_ æ˜ å°„:
  "confidential" â†’ "0x1a2b3c..."
  "finance"      â†’ "0x5f6a7b..."
  "Q4"           â†’ "0x8c9d0e..."
```

---

### 6.3 æ–‡ä»¶è§£å¯†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ–‡ä»¶è§£å¯†æµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·æ“ä½œ               å®¢æˆ·ç«¯å¤„ç†                    æ–‡ä»¶æ“ä½œ
â•â•â•â•â•â•â•â•â•â•â•          â•â•â•â•â•â•â•â•â•â•â•â•â•               â•â•â•â•â•â•â•â•â•â•â•

[è¾“å…¥å‘½ä»¤: decrypt]
    â”‚
    â”œâ”€> è¾“å…¥åŠ å¯†æ–‡ä»¶: "document_enc.enc"
    â”œâ”€> è¾“å…¥è¾“å‡ºè·¯å¾„: "document_decrypted.pdf"
    â”‚
    v
decryptFile()
    â”‚
    â”œâ”€â”€> [æ­¥éª¤1: æ£€æŸ¥åˆå§‹åŒ–]
    â”‚      â””â”€> initialized_ == true?
    â”‚             â””â”€ å¦ â†’ [é”™è¯¯: æœªåˆå§‹åŒ–]
    â”‚
    â”œâ”€â”€> [æ­¥éª¤2: è¯»å–åŠ å¯†æ–‡ä»¶]
    â”‚      â”‚
    â”‚      â””â”€> readFile("document_enc.enc") â”€â”€â”€> [è¯»å–æ–‡ä»¶]
    â”‚             â”‚
    â”‚             â””â”€> ciphertext
    â”‚                    â”œâ”€ å‰16å­—èŠ‚: IV
    â”‚                    â””â”€ å…¶ä½™: å¯†æ–‡æ•°æ®
    â”‚
    â”œâ”€â”€> [æ­¥éª¤3: è§£å¯†æ•°æ®]
    â”‚      â”‚
    â”‚      â””â”€> decryptFileData(ciphertext, plaintext)
    â”‚             â”‚
    â”‚             â”œâ”€> æå– IV = ciphertext[0:16]
    â”‚             â”‚
    â”‚             â”œâ”€> AES-256-CBC è§£å¯†
    â”‚             â”‚      â”œâ”€ å¯†é’¥: ek_
    â”‚             â”‚      â”œâ”€ åˆå§‹åŒ–å‘é‡: IV
    â”‚             â”‚      â””â”€ æ¨¡å¼: CBC
    â”‚             â”‚
    â”‚             â”œâ”€> è‡ªåŠ¨å»é™¤ PKCS#7 å¡«å……
    â”‚             â”‚
    â”‚             â””â”€> plaintext (æ¢å¤åŸå§‹å¤§å°)
    â”‚
    â””â”€â”€> [æ­¥éª¤4: ä¿å­˜è§£å¯†æ–‡ä»¶]
           â”‚
           â””â”€> writeFile("document_decrypted.pdf", plaintext)
                  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [åˆ›å»º: document_decrypted.pdf]

å®Œæˆ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ“ è§£å¯†æˆåŠŸ
âœ“ åŸå§‹æ–‡ä»¶å·²æ¢å¤
âœ“ æ–‡ä»¶å¤§å°: ä¸åŸå§‹æ–‡ä»¶ä¸€è‡´
```

---

### 6.4 æœç´¢æµç¨‹ï¼ˆStorage Nodeç«¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æœç´¢æµç¨‹ï¼ˆç”±Storage Nodeæ‰§è¡Œï¼‰                      â”‚
â”‚          æ³¨ï¼šå®¢æˆ·ç«¯ä¸ç›´æ¥æ‰§è¡Œæœç´¢                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®¢æˆ·ç«¯                         Storage Node                æ•°æ®åº“/å­˜å‚¨
â•â•â•â•â•â•â•â•â•â•â•                   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•             â•â•â•â•â•â•â•â•â•â•â•

[ç”¨æˆ·æƒ³æœç´¢ "confidential"]
    â”‚
    â”œâ”€> 1. ç”Ÿæˆæœç´¢ä»¤ç‰Œ
    â”‚      â”œâ”€ è¯»å– mk (ä¸»å¯†é’¥)
    â”‚      â””â”€ Ti = H3(H1(mk || "confidential"))
    â”‚             â””â”€> "0x7f8e..."
    â”‚
    â”œâ”€> 2. è·å–å½“å‰çŠ¶æ€
    â”‚      â””â”€> ä» keyword_states.json è¯»å–
    â”‚             â””â”€> current_state = "0x9a8b..."
    â”‚                    (å…³é”®è¯çš„æœ€æ–°çŠ¶æ€)
    â”‚
    â””â”€> 3. å‘é€æœç´¢è¯·æ±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
           Request: {
             "Ti": "0x7f8e...",
             "current_state": "0x9a8b..."
           }
                                                   â”‚
                                                   â”œâ”€> åœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾
                                                   â”‚   åŒ¹é… Ti çš„æ‰€æœ‰è®°å½•
                                                   â”‚
                                                   v
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  ç´¢å¼•æ•°æ®åº“ç»“æ„:    â”‚
                                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                          â”‚ file_id | Ti | kt â”‚
                                          â”‚         |    | ptrâ”‚
                                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                          â”‚  F1  | 0x7f | kt1â”‚
                                          â”‚      |      | ptr1â”‚
                                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                          â”‚  F2  | 0x7f | kt2â”‚
                                          â”‚      |      | ptr2â”‚
                                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                          â”‚  F3  | 0x7f | kt3â”‚
                                          â”‚      |      | ptr3â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â”œâ”€> 4. çŠ¶æ€é“¾éªŒè¯
                                                   â”‚   (ä»æœ€æ–°åˆ°æœ€æ—§)
                                                   â”‚
                                                   â”œâ”€> æ–‡ä»¶3 (æœ€æ–°):
                                                   â”‚      â”œâ”€ ä½¿ç”¨ current_state
                                                   â”‚      â”œâ”€ éªŒè¯ kt3
                                                   â”‚      â”‚  â””â”€ e(kt3, g) ?= 
                                                   â”‚      â”‚     e(H_2(F3)*H_2(st_3||Ti)/H_2(st_2||Ti), pk)
                                                   â”‚      â”œâ”€ âœ“ éªŒè¯é€šè¿‡
                                                   â”‚      â””â”€ è§£å¯† ptr3 å¾— st_2
                                                   â”‚
                                                   â”œâ”€> æ–‡ä»¶2:
                                                   â”‚      â”œâ”€ ä½¿ç”¨ st_2
                                                   â”‚      â”œâ”€ éªŒè¯ kt2
                                                   â”‚      â”œâ”€ âœ“ éªŒè¯é€šè¿‡
                                                   â”‚      â””â”€ è§£å¯† ptr2 å¾— st_1
                                                   â”‚
                                                   â””â”€> æ–‡ä»¶1 (æœ€æ—§):
                                                          â”œâ”€ ä½¿ç”¨ st_1
                                                          â”œâ”€ éªŒè¯ kt1
                                                          â””â”€ âœ“ éªŒè¯é€šè¿‡ (é¦–ä¸ªæ–‡ä»¶)
                                                 
                                                   v
                              Response: {
                                "matched_files": [
                                  {
                                    "file_id": "F1",
                                    "encrypted_file": "path/to/F1.enc"
                                  },
                                  {
                                    "file_id": "F2",
                                    "encrypted_file": "path/to/F2.enc"
                                  },
                                  {
                                    "file_id": "F3",
                                    "encrypted_file": "path/to/F3.enc"
                                  }
                                ],
                                "total": 3
                              }
                                       â”‚
          <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          â”‚
          v
[å®¢æˆ·ç«¯æ¥æ”¶ç»“æœ]
    â”‚
    â”œâ”€> 5. ä¸‹è½½åŠ å¯†æ–‡ä»¶
    â”‚      â””â”€> å¯¹äºæ¯ä¸ªåŒ¹é…çš„æ–‡ä»¶:
    â”‚             â””â”€> ä¸‹è½½ *.enc
    â”‚
    â””â”€> 6. æœ¬åœ°è§£å¯†
           â””â”€> decryptFile() (ä½¿ç”¨ ek_)


å‰å‘å®‰å…¨æ€§éªŒè¯:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
å‡è®¾æ”»å‡»è€…åœ¨ t2 æ—¶åˆ»å…¥ä¾µï¼Œè·å¾—:
  âœ“ Ti = "0x7f8e..."
  âœ“ st_2 (t2æ—¶åˆ»çš„çŠ¶æ€)
  âœ“ kt1, kt2 (å†å²ä»¤ç‰Œ)
  âœ— st_3 (æœªæ¥çŠ¶æ€ï¼ŒæœªçŸ¥)

æ”»å‡»è€…å°è¯•:
  1. ä½¿ç”¨ Ti åœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾
     â””â”€> æ‰¾åˆ° F1, F2, F3
  
  2. å°è¯•éªŒè¯ kt3 (æ–‡ä»¶3)
     â””â”€> éœ€è¦ st_3ï¼Œä½†æ”»å‡»è€…ä¸çŸ¥é“
     â””â”€> âœ— éªŒè¯å¤±è´¥
  
  3. ä½¿ç”¨ st_2 éªŒè¯ kt2 (æ–‡ä»¶2)
     â””â”€> âœ“ å¯ä»¥è®¿é—® (å†å²æ–‡ä»¶)
  
  4. ä½¿ç”¨ st_1 éªŒè¯ kt1 (æ–‡ä»¶1)
     â””â”€> âœ“ å¯ä»¥è®¿é—® (å†å²æ–‡ä»¶)

ç»“è®º: æ”»å‡»è€…åªèƒ½è®¿é—®å…¥ä¾µæ—¶åˆ»ä¹‹å‰çš„æ–‡ä»¶!
```

---

### 6.5 çŠ¶æ€ç®¡ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å…³é”®è¯çŠ¶æ€ç®¡ç†æµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ“ä½œåºåˆ—                     çŠ¶æ€å˜åŒ–                    æ–‡ä»¶ç³»ç»Ÿ
â•â•â•â•â•â•â•â•â•â•â•                â•â•â•â•â•â•â•â•â•â•â•â•â•              â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
åˆå§‹çŠ¶æ€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
keyword_states_ = {}         [ç©ºæ˜ å°„]
keyword_states.json          [ä¸å­˜åœ¨]


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ“ä½œ1: åŠ å¯†æ–‡ä»¶1 (åŒ…å« "confidential")
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
encryptFile("file1.txt", ["confidential"], ...)
    â”‚
    â”œâ”€> updateKeywordState("confidential", st_1, "ID_F1")
    â”‚      â”‚
    â”‚      â”œâ”€> å†…å­˜æ›´æ–°:
    â”‚      â”‚      keyword_states_["confidential"] = st_1
    â”‚      â”‚         â””â”€> st_1 = "0x1a2b3c..."
    â”‚      â”‚
    â”‚      â””â”€> JSONæ›´æ–°:                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             {                              â”‚ keyword_states.  â”‚
    â”‚               "keywords": {                â”‚ json             â”‚
    â”‚                 "confidential": {          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                   "current_state": st_1,   â”‚ confidential:    â”‚
    â”‚                   "last_update": t1,       â”‚   st â†’ st_1      â”‚
    â”‚                   "history": [             â”‚   history: [1]   â”‚
    â”‚                     {                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                       "state": st_1,
    â”‚                       "file_id": "ID_F1",
    â”‚                       "timestamp": t1
    â”‚                     }
    â”‚                   ]
    â”‚                 }
    â”‚               }
    â”‚             }
    â”‚
    â””â”€> è‡ªåŠ¨ä¿å­˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [æ›´æ–°: keyword_states.json]


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ“ä½œ2: åŠ å¯†æ–‡ä»¶2 (åŒ…å« "confidential")
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
encryptFile("file2.txt", ["confidential"], ...)
    â”‚
    â”œâ”€> è¯»å–å½“å‰çŠ¶æ€:
    â”‚      keyword_states_["confidential"]
    â”‚         â””â”€> previous_state = st_1
    â”‚
    â”œâ”€> ç”Ÿæˆæ–°çŠ¶æ€:
    â”‚      current_state = st_2 = "0x7f8e9d..."
    â”‚
    â”œâ”€> ç”ŸæˆçŠ¶æ€å…³è”ä»¤ç‰Œ:
    â”‚      kt^w_2 = [H_2(ID_F2) * H_2(st_2||Ti) / H_2(st_1||Ti)]^sk
    â”‚                 â””â”€> ä½¿ç”¨ st_1 å’Œ st_2
    â”‚
    â”œâ”€> åŠ å¯†æŒ‡é’ˆ:
    â”‚      ptr_2 = AES(st_1, key=H3(st_2))
    â”‚             â””â”€> æŒ‡å‘å‰ä¸€çŠ¶æ€
    â”‚
    â””â”€> updateKeywordState("confidential", st_2, "ID_F2")
           â”‚
           â””â”€> JSONæ›´æ–°:                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  {                              â”‚ keyword_states.  â”‚
                    "keywords": {                â”‚ json             â”‚
                      "confidential": {          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                        "current_state": st_2,   â”‚ confidential:    â”‚
                        "last_update": t2,       â”‚   st â†’ st_2      â”‚
                        "history": [             â”‚   history: [1,2] â”‚
                          { ...st_1, t1 },       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          {
                            "state": st_2,
                            "file_id": "ID_F2",
                            "timestamp": t2
                          }
                        ]
                      }
                    }
                  }


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ“ä½œ3: åŠ å¯†æ–‡ä»¶3 (åŒ…å« "confidential" å’Œ "finance")
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
encryptFile("file3.txt", ["confidential", "finance"], ...)
    â”‚
    â”œâ”€> å¯¹äº "confidential":
    â”‚      â”œâ”€ previous_state = st_2
    â”‚      â”œâ”€ current_state = st_3
    â”‚      â”œâ”€ kt^w_3 ä½¿ç”¨ st_2 å’Œ st_3
    â”‚      â””â”€ ptr_3 = AES(st_2, key=H3(st_3))
    â”‚
    â”œâ”€> å¯¹äº "finance" (é¦–æ¬¡):
    â”‚      â”œâ”€ previous_state = (æ— )
    â”‚      â”œâ”€ current_state = st_finance_1
    â”‚      â”œâ”€ kt^finance_1 ä»…ä½¿ç”¨ st_finance_1
    â”‚      â””â”€ ptr_finance_1 = AES(H3(st_finance_1), key=H3(st_finance_1))
    â”‚
    â””â”€> æ›´æ–°çŠ¶æ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [æ›´æ–°: keyword_states.json]
           {
             "keywords": {
               "confidential": {
                 "current_state": st_3,           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 "history": [st_1, st_2, st_3]    â”‚ keyword_states.  â”‚
               },                                 â”‚ json             â”‚
               "finance": {                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                 "current_state": st_finance_1,   â”‚ confidential:    â”‚
                 "history": [st_finance_1]        â”‚   st â†’ st_3      â”‚
               }                                  â”‚   history: [3]   â”‚
             }                                    â”‚ finance:         â”‚
           }                                      â”‚   st â†’ st_f1     â”‚
                                                  â”‚   history: [1]   â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ“ä½œ4: æŸ¥è¯¢çŠ¶æ€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
queryKeywordState("confidential")
    â”‚
    â””â”€> è¾“å‡º:
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ [æŸ¥è¯¢ç»“æœ] å…³é”®è¯: confidential     â”‚
           â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
           â”‚ å½“å‰çŠ¶æ€: 0x4d5e6f...              â”‚
           â”‚ æœ€åæ›´æ–°: 2025-11-10 16:00:00      â”‚
           â”‚                                    â”‚
           â”‚ å†å²è®°å½• (3 æ¡):                   â”‚
           â”‚   [1] çŠ¶æ€: 0x1a2b3c... |         â”‚
           â”‚       æ–‡ä»¶ID: ID_F1 |              â”‚
           â”‚       æ—¶é—´: 2025-11-10 14:00:00    â”‚
           â”‚   [2] çŠ¶æ€: 0x7f8e9d... |         â”‚
           â”‚       æ–‡ä»¶ID: ID_F2 |              â”‚
           â”‚       æ—¶é—´: 2025-11-10 15:00:00    â”‚
           â”‚   [3] çŠ¶æ€: 0x4d5e6f... |         â”‚
           â”‚       æ–‡ä»¶ID: ID_F3 |              â”‚
           â”‚       æ—¶é—´: 2025-11-10 16:00:00    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


çŠ¶æ€é“¾å¯è§†åŒ–:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
å…³é”®è¯ "confidential" çš„çŠ¶æ€æ¼”åŒ–:

st_1 (t1) â”€â”€[ptr_2]â”€â”€> st_2 (t2) â”€â”€[ptr_3]â”€â”€> st_3 (t3)
  â”‚                      â”‚                      â”‚
  â”œâ”€ kt^w_1             â”œâ”€ kt^w_2              â”œâ”€ kt^w_3
  â”‚  (é¦–æ¬¡)             â”‚  (é™¤æ³•å½¢å¼)          â”‚  (é™¤æ³•å½¢å¼)
  â”‚                      â”‚                      â”‚
  â””â”€ F1                  â””â”€ F2                  â””â”€ F3

æœç´¢æ—¶éœ€è¦: Ti + st_3 (æœ€æ–°çŠ¶æ€)
éªŒè¯é“¾: st_3 â†’ st_2 â†’ st_1
ç»“æœ: æ‰¾åˆ° F3, F2, F1
```

---

## æ–‡ä»¶æ ¼å¼è¯´æ˜

### 7.1 public\_params.json

**æ¥æº:** Storage Node ç”Ÿæˆ **ç”¨é€”:** å®¢æˆ·ç«¯åˆå§‹åŒ–æ‰€éœ€çš„å…¬å…±å‚æ•°

```json
{
  "version": "v4.0",
  "created_at": "2025-11-10 12:00:00",
  "description": "Public parameters for verifiable searchable encryption",
  "public_params": {
    "N": "å¤§æ•´æ•°å­—ç¬¦ä¸²ï¼ˆåè¿›åˆ¶ï¼Œ2048+ä½ï¼‰",
    "g": "åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆGâ‚ç¾¤ç”Ÿæˆå…ƒåºåˆ—åŒ–ï¼‰",
    "mu": "åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆè®¤è¯å‚æ•°Î¼åºåˆ—åŒ–ï¼‰"
  },
  "security": {
    "pairing_type": "Type A (1024-bit)",
    "rsa_modulus_bits": 2048,
    "symmetric_key_bits": 256
  }
}
```

**å­—æ®µè¯´æ˜:**

* `N`: RSAæ¨¡æ•°ï¼Œç”¨äºH1å“ˆå¸Œ
* `g`: é…å¯¹ç¾¤Gâ‚çš„ç”Ÿæˆå…ƒ
* `mu`: è®¤è¯å‚æ•°ï¼Œç”¨äºç”Ÿæˆè®¤è¯æ ‡ç­¾

---

### 7.2 private\_key.dat

**æ ¼å¼:** äºŒè¿›åˆ¶ **æƒé™:** åº”è®¾ç½®ä¸º 0600 (ä»…æ‰€æœ‰è€…è¯»å†™)

```
åç§»é‡    é•¿åº¦    å†…å®¹
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0         32     mk (ä¸»å¯†é’¥)
32        32     ek (åŠ å¯†å¯†é’¥)
64        4      sk_size (skçš„å­—èŠ‚é•¿åº¦)
68        var    sk (ç§é’¥ï¼Œå¤§æ•´æ•°)
68+sk     4      pk_size (pkçš„å­—èŠ‚é•¿åº¦)
72+sk     var    pk (å…¬é’¥åºåˆ—åŒ–)
```

---

### 7.3 insert.json

**ç”¨é€”:** æäº¤ç»™ Storage Node æ’å…¥æ•°æ®åº“ **æ³¨æ„:** ä¸åŒ…å«æ˜æ–‡å…³é”®è¯ï¼Œä»…åŒ…å«åŠ å¯†ä»¤ç‰Œ

```json
{
  "file_id": "æ–‡ä»¶å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆSHA256ï¼Œ64å­—ç¬¦åå…­è¿›åˆ¶ï¼‰",
  "keywords": [
    {
      "Ti": "æœç´¢ä»¤ç‰Œï¼ˆSHA256ï¼Œ64å­—ç¬¦åå…­è¿›åˆ¶ï¼‰",
      "kt": "çŠ¶æ€å…³è”ä»¤ç‰Œï¼ˆç¾¤å…ƒç´ åºåˆ—åŒ–ï¼Œåå…­è¿›åˆ¶ï¼‰",
      "ptr": "åŠ å¯†æŒ‡é’ˆï¼ˆAESåŠ å¯†ï¼Œåå…­è¿›åˆ¶ï¼‰"
    }
  ],
  "auth_tags": [
    "è®¤è¯æ ‡ç­¾1ï¼ˆç¾¤å…ƒç´ åºåˆ—åŒ–ï¼‰",
    "è®¤è¯æ ‡ç­¾2",
    "..."
  ],
  "timestamp": "2025-11-10 14:30:00",
  "metadata": {
    "total_blocks": 25,
    "sectors_per_block": 16,
    "ciphertext_size": 102416
  }
}
```

---

### 7.4 keyword\_states.json

**ç”¨é€”:** æœ¬åœ°ç®¡ç†å…³é”®è¯çŠ¶æ€å†å² **å®‰å…¨æ€§:** åº”åŠ å¯†å­˜å‚¨æˆ–è®¾ç½®é€‚å½“æƒé™

```json
{
  "version": "v4.0",
  "last_updated": "2025-11-10 16:00:00",
  "keywords": {
    "å…³é”®è¯1": {
      "current_state": "å½“å‰çŠ¶æ€å€¼ï¼ˆ256ä½ï¼Œ64å­—ç¬¦åå…­è¿›åˆ¶ï¼‰",
      "last_update": "2025-11-10 16:00:00",
      "total_files": 3,
      "history": [
        {
          "state": "å†å²çŠ¶æ€å€¼1",
          "file_id": "å…³è”æ–‡ä»¶ID1",
          "timestamp": "2025-11-10 14:00:00",
          "operation": "encrypt"
        },
        {
          "state": "å†å²çŠ¶æ€å€¼2",
          "file_id": "å…³è”æ–‡ä»¶ID2",
          "timestamp": "2025-11-10 15:00:00",
          "operation": "encrypt"
        }
      ]
    }
  }
}
```

---

## ä½¿ç”¨æŒ‡å—

### 8.1 é¦–æ¬¡ä½¿ç”¨æµç¨‹

```bash
# 1. ç¡®ä¿ä¾èµ–åº“å·²å®‰è£…
sudo apt-get install libssl-dev libgmp-dev libjsoncpp-dev
# éœ€è¦æ‰‹åŠ¨å®‰è£… PBC library

# 2. ç¼–è¯‘ç¨‹åº
g++ -std=c++11 main.cpp client.cpp -o client \
    -lssl -lcrypto -lgmp -lpbc -ljsoncpp

# 3. ä» Storage Node è·å– public_params.json
# ï¼ˆå‡è®¾å·²æœ‰æ­¤æ–‡ä»¶ï¼‰

# 4. è¿è¡Œç¨‹åº
./client

# 5. åˆå§‹åŒ–ç³»ç»Ÿ
> init

# 6. ç”Ÿæˆå¯†é’¥
> keygen

# 7. åŠ å¯†æ–‡ä»¶
> encrypt
è¾“å…¥æ–‡ä»¶è·¯å¾„: document.pdf
è¾“å…¥å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰: confidential, finance
è¾“å‡ºæ–‡ä»¶å‰ç¼€: document_enc

# 8. è§£å¯†æ–‡ä»¶
> decrypt
è¾“å…¥åŠ å¯†æ–‡ä»¶è·¯å¾„: document_enc.enc
è¾“å‡ºæ–‡ä»¶è·¯å¾„: document_recovered.pdf
```

### 8.2 å‘½ä»¤å‚è€ƒ


| å‘½ä»¤          | åŠŸèƒ½           | å‰ç½®æ¡ä»¶                 |
| ------------- | -------------- | ------------------------ |
| `init`        | åˆå§‹åŒ–ç³»ç»Ÿ     | éœ€è¦ public\_params.json |
| `keygen`      | ç”Ÿæˆå¯†é’¥       | å·²åˆå§‹åŒ–                 |
| `encrypt`     | åŠ å¯†æ–‡ä»¶       | å·²ç”Ÿæˆå¯†é’¥               |
| `decrypt`     | è§£å¯†æ–‡ä»¶       | å·²åŠ è½½å¯†é’¥               |
| `save-keys`   | ä¿å­˜å¯†é’¥       | å·²ç”Ÿæˆå¯†é’¥               |
| `load-keys`   | åŠ è½½å¯†é’¥       | å·²åˆå§‹åŒ–                 |
| `load-states` | åŠ è½½çŠ¶æ€æ–‡ä»¶   | æ—                        |
| `save-states` | ä¿å­˜çŠ¶æ€æ–‡ä»¶   | å·²æœ‰çŠ¶æ€æ•°æ®             |
| `query-state` | æŸ¥è¯¢å…³é”®è¯çŠ¶æ€ | å·²åŠ è½½çŠ¶æ€               |

### 8.3 å…¸å‹ä½¿ç”¨åœºæ™¯

#### åœºæ™¯1: å¤‡ä»½é‡è¦æ–‡æ¡£

```bash
# åŠ å¯†å¤šä¸ªæ–‡ä»¶
> encrypt
æ–‡ä»¶: contract_2024.pdf
å…³é”®è¯: contract, 2024, confidential
å‰ç¼€: contract_2024_enc

> encrypt
æ–‡ä»¶: financial_report.xlsx
å…³é”®è¯: finance, Q4, 2024
å‰ç¼€: finance_Q4_enc

# å°† *.enc å’Œ insert.json ä¸Šä¼ åˆ° Storage Node
# æœ¬åœ°ä¿ç•™ *_metadata.json å’Œ keyword_states.json
```

#### åœºæ™¯2: æœç´¢å¹¶æ¢å¤æ–‡æ¡£

```bash
# ï¼ˆåœ¨ Storage Node ç«¯æ‰§è¡Œæœç´¢ï¼Œè·å¾—åŠ å¯†æ–‡ä»¶åˆ—è¡¨ï¼‰

# ä¸‹è½½éœ€è¦çš„åŠ å¯†æ–‡ä»¶
# ä¾‹å¦‚: contract_2024_enc.enc

# æœ¬åœ°è§£å¯†
> decrypt
è¾“å…¥åŠ å¯†æ–‡ä»¶: contract_2024_enc.enc
è¾“å‡ºæ–‡ä»¶: contract_2024_recovered.pdf

# éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
sha256sum contract_2024.pdf contract_2024_recovered.pdf
```

---

## å®‰å…¨æ€§è¯´æ˜

### 9.1 å®‰å…¨ç‰¹æ€§

#### 9.1.1 æœºå¯†æ€§

* **æ–‡ä»¶å†…å®¹**: AES-256-CBC åŠ å¯†ï¼Œå¯†é’¥ ek ä»…å®¢æˆ·ç«¯æŒæœ‰
* **å…³é”®è¯**: ä½¿ç”¨ mk åŠ å¯†ä¸ºæœç´¢ä»¤ç‰Œ Tiï¼Œä¸å¯é€†
* **çŠ¶æ€å€¼**: 256ä½éšæœºæ•°ï¼Œé«˜ç†µä¸å¯é¢„æµ‹

#### 9.1.2 å®Œæ•´æ€§

* **è®¤è¯æ ‡ç­¾**: ä½¿ç”¨åŒçº¿æ€§é…å¯¹éªŒè¯æ–‡ä»¶å—å®Œæ•´æ€§
* **ä¸å¯ä¼ªé€ **: éœ€è¦ç§é’¥ sk æ‰èƒ½ç”Ÿæˆæœ‰æ•ˆæ ‡ç­¾
* **å¯éªŒè¯**: Storage Node å¯ä½¿ç”¨å…¬é’¥ pk éªŒè¯

#### 9.1.3 å‰å‘å®‰å…¨æ€§

* **çŠ¶æ€é“¾**: æ¯æ¬¡åŠ å¯†æ›´æ–°å…³é”®è¯çŠ¶æ€
* **é™¤æ³•ç»“æ„**: kt ä»¤ç‰Œä½¿ç”¨å‰åçŠ¶æ€æ¯”å€¼
* **éš”ç¦»æ€§**: æ—§çŠ¶æ€æ— æ³•æ¨å¯¼æ–°çŠ¶æ€

### 9.2 å¯†é’¥ç®¡ç†å»ºè®®

#### 9.2.1 ç§é’¥ä¿æŠ¤

```bash
# è®¾ç½®æ–‡ä»¶æƒé™
chmod 600 private_key.dat

# å®šæœŸå¤‡ä»½åˆ°å®‰å…¨ä½ç½®
cp private_key.dat /secure/backup/

# è€ƒè™‘ä½¿ç”¨ç¡¬ä»¶å®‰å…¨æ¨¡å— (HSM)
```

#### 9.2.2 çŠ¶æ€æ–‡ä»¶ä¿æŠ¤

```bash
# åŠ å¯†å­˜å‚¨çŠ¶æ€æ–‡ä»¶
openssl enc -aes-256-cbc -salt \
  -in keyword_states.json \
  -out keyword_states.json.enc

# è®¾ç½®æƒé™
chmod 600 keyword_states.json.enc
```

### 9.3 å¨èƒæ¨¡å‹


| å¨èƒç±»å‹     | é˜²æŠ¤æªæ–½       | æ•ˆæœ                    |
| ------------ | -------------- | ----------------------- |
| çªƒå–åŠ å¯†æ–‡ä»¶ | AES-256åŠ å¯†    | âœ“ æ— å¯†é’¥æ— æ³•è§£å¯†       |
| ç¯¡æ”¹æ–‡ä»¶     | è®¤è¯æ ‡ç­¾       | âœ“ éªŒè¯å¤±è´¥             |
| æœç´¢æ¨¡å¼æ³„éœ² | æœç´¢ä»¤ç‰ŒåŠ å¯†   | âœ“ ä¸æ³„éœ²å…³é”®è¯         |
| å†å²æŸ¥è¯¢æ³„éœ² | å‰å‘å®‰å…¨çŠ¶æ€é“¾ | âœ“ æ—§çŠ¶æ€æ— æ³•æœç´¢æ–°æ–‡ä»¶ |
| ä¼ªé€ æœç´¢ä»¤ç‰Œ | éœ€è¦ mk        | âœ“ ä»…å®¢æˆ·ç«¯å¯ç”Ÿæˆ       |
| ä¼ªé€ è®¤è¯æ ‡ç­¾ | éœ€è¦ sk        | âœ“ ä»…å®¢æˆ·ç«¯å¯ç”Ÿæˆ       |

### 9.4 å·²çŸ¥é™åˆ¶

1. **å‘åå®‰å…¨æ€§**: ç³»ç»Ÿä¸æä¾›å‘åå®‰å…¨ï¼ˆæ–°å¯†é’¥æ— æ³•è§£å¯†æ—§æ–‡ä»¶ï¼‰
2. **å…³é”®è¯æ•°é‡**: æ¯ä¸ªæ–‡ä»¶çš„å…³é”®è¯æ•°é‡ä¼šå½±å“ insert.json å¤§å°
3. **å—å¤§å°å›ºå®š**: BLOCK\_SIZE=4096 ä¸å¯åŠ¨æ€è°ƒæ•´
4. **çŠ¶æ€æ–‡ä»¶æ³„éœ²**: å¦‚æœ keyword\_states.json è¢«ç›—ï¼Œæ”»å‡»è€…å¯æœç´¢æ‰€æœ‰å†å²å’Œæœªæ¥æ–‡ä»¶

---

## é™„å½•

### A.1 é…å¯¹å‚æ•°è¯´æ˜

**Type A æ›²çº¿å‚æ•°:**

```
ç±»å‹: å¯¹ç§°é…å¯¹ (Gâ‚ = Gâ‚‚)
å®‰å…¨çº§åˆ«: 1024ä½
ç´ æ•° q: 8780710799663312522437781984754049815806883...
ä½™å› å­ h: 12016012264891146079388821366740534204802...
é˜¶ r: 730750818665451621361119245571504901405976...
```

### A.2 æ€§èƒ½å‚æ•°


| æ“ä½œ         | æ—¶é—´å¤æ‚åº¦ | è¯´æ˜        |
| ------------ | ---------- | ----------- |
| åˆå§‹åŒ–       | O(1)       | å›ºå®šæ—¶é—´    |
| å¯†é’¥ç”Ÿæˆ     | O(1)       | å›ºå®šæ—¶é—´    |
| æ–‡ä»¶åŠ å¯†     | O(n)       | n=æ–‡ä»¶å¤§å°  |
| è®¤è¯æ ‡ç­¾ç”Ÿæˆ | O(nÂ·s)    | s=æ‰‡åŒºæ•°/å— |
| çŠ¶æ€ä»¤ç‰Œç”Ÿæˆ | O(k)       | k=å…³é”®è¯æ•°  |
| æ–‡ä»¶è§£å¯†     | O(n)       | n=æ–‡ä»¶å¤§å°  |

### A.3 å¸¸è§é—®é¢˜

**Q: public\_params.json ä»å“ªé‡Œè·å–ï¼Ÿ** A: ç”± Storage Node ç”Ÿæˆå¹¶åˆ†å‘ç»™æ‰€æœ‰å®¢æˆ·ç«¯ã€‚

**Q: å¿˜è®°å¯†é’¥æ€ä¹ˆåŠï¼Ÿ** A: æ— æ³•æ¢å¤ï¼Œæ‰€æœ‰åŠ å¯†æ–‡ä»¶å°†æ°¸ä¹…ä¸¢å¤±ã€‚åŠ¡å¿…å¤‡ä»½ private\_key.datã€‚

**Q: å¯ä»¥æ›´æ”¹å…³é”®è¯å—ï¼Ÿ** A: éœ€è¦é‡æ–°åŠ å¯†æ–‡ä»¶å¹¶ç”Ÿæˆæ–°çš„ insert.jsonã€‚

**Q: Storage Node å¯ä»¥çœ‹åˆ°ä»€ä¹ˆï¼Ÿ** A: åªèƒ½çœ‹åˆ°åŠ å¯†çš„æ–‡ä»¶ã€ä»¤ç‰Œå’Œæ ‡ç­¾ï¼Œæ— æ³•çœ‹åˆ°æ˜æ–‡å†…å®¹å’Œå…³é”®è¯ã€‚

**Q: å¦‚ä½•æ’¤é”€å¯¹æŸæ–‡ä»¶çš„è®¿é—®ï¼Ÿ** A: ä» Storage Node åˆ é™¤å¯¹åº”çš„ insert.json æ¡ç›®å’ŒåŠ å¯†æ–‡ä»¶ã€‚

---

## æ›´æ–°æ—¥å¿—

### v4.0 (2025-11-10)

* âœ… ç»Ÿä¸€ä½¿ç”¨ public\_params.json
* âœ… é…å¯¹å‚æ•°ç¡¬ç¼–ç 
* âœ… ä¿®å¤ Î¼ å‚æ•°åŠ è½½é—®é¢˜
* âœ… ç®€åŒ–åˆå§‹åŒ–æµç¨‹
* âœ… å¢å¼ºé”™è¯¯æ£€æŸ¥

### v3.x (å†å²ç‰ˆæœ¬)

* ä½¿ç”¨åˆ†ç¦»çš„å‚æ•°æ–‡ä»¶
* é…å¯¹å‚æ•°ä»æ–‡ä»¶åŠ è½½

---

## è®¸å¯è¯

æœ¬é¡¹ç›®ä¾›å­¦æœ¯ç ”ç©¶ä½¿ç”¨ã€‚

---

## è”ç³»æ–¹å¼

å¦‚æœ‰æŠ€æœ¯é—®é¢˜ï¼Œè¯·å‚è€ƒæºä»£ç æ³¨é‡Šæˆ–æŸ¥é˜…ç›¸å…³è®ºæ–‡ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v4.0 **æœ€åæ›´æ–°**: 2025-11-10 **ä½œè€…**: Storage Client Development Team

## ğŸ“Œ ç‰ˆæœ¬è¯´æ˜

**v4.0 (æ–¹æ¡ˆAé‡æ„ç‰ˆ)** - 2024

æœ¬ç‰ˆæœ¬å¯¹å®¢æˆ·ç«¯æ¶æ„è¿›è¡Œäº†é‡å¤§é‡æ„ï¼Œè§£å†³äº†å‚æ•°ä¸ä¸€è‡´çš„æ ¸å¿ƒé—®é¢˜ï¼Œç¡®ä¿ä¸ Storage Node çš„å®Œå…¨å…¼å®¹ã€‚

---

## ğŸš€ v4.0 æ ¸å¿ƒå˜æ›´

### âœ… ä¸»è¦æ”¹è¿›

1. **ç»Ÿä¸€å‚æ•°æº**
   * åˆ é™¤ `system_params.json` ä¾èµ–
   * `public_params.json` æˆä¸º**å”¯ä¸€**å‚æ•°æ–‡ä»¶
   * æ‰€æœ‰å…¬å…±å‚æ•°ï¼ˆN, g, Î¼ï¼‰ç”± Storage Node æä¾›
2. **é…å¯¹å‚æ•°ç¡¬ç¼–ç **
   * Type A æ›²çº¿å‚æ•°å†…åµŒåˆ°ä»£ç ä¸­
   * 1024ä½å®‰å…¨çº§åˆ«ï¼ˆæ ‡å‡†é…ç½®ï¼‰
   * æ¶ˆé™¤é…å¯¹å‚æ•°é…ç½®é”™è¯¯çš„å¯èƒ½æ€§
3. **ä¿®å¤å…³é”® Bug**
   * **ä¿®å¤**: Î¼ å‚æ•°æœªæ­£ç¡®åŠ è½½å¯¼è‡´è®¤è¯æ ‡ç­¾é”™è¯¯
   * **ä¿®å¤**: N å€¼åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ä¸ä¸€è‡´
   * **ä¿®å¤**: g è¢«é‡å¤åŠ è½½è¦†ç›–
4. **ç®€åŒ–åˆå§‹åŒ–æµç¨‹**
   ```
   v3.3: initialize() â†’ loadSystemParams() â†’ generateKeys() â†’ é‡æ–°åŠ è½½g
                â†“                                    â†“
            ä½¿ç”¨æœ¬åœ°å‚æ•°                         è¦†ç›–ä¹‹å‰çš„gï¼Œå¿½ç•¥Î¼ âŒ

   v4.0: initialize(public_params.json) â†’ ä¸€æ¬¡æ€§åŠ è½½ N, g, Î¼
                â†“                                    â†“
            ç»Ÿä¸€å‚æ•°æº                         generateKeys() ä»…ç”Ÿæˆå¯†é’¥ âœ…
   ```

### ğŸ“Š æ¥å£å˜æ›´å¯¹æ¯”


| åŠŸèƒ½         | v3.3                                      | v4.0                             |
| ------------ | ----------------------------------------- | -------------------------------- |
| **åˆå§‹åŒ–**   | `initialize()`                            | `initialize(public_params_file)` |
| **å‚æ•°æ–‡ä»¶** | system\_params.json + public\_params.json | **ä»…**public\_params.json        |
| **å¯†é’¥ç”Ÿæˆ** | `generateKeys(public_params_file)`        | `generateKeys()`                 |
| **å‚æ•°åŠ è½½** | g åŠ è½½ä¸¤æ¬¡ï¼ŒÎ¼ ç¼ºå¤±                       | N, g, Î¼ ä¸€æ¬¡æ€§æ­£ç¡®åŠ è½½          |
| **loadKeys** | æ— åˆå§‹åŒ–æ£€æŸ¥                              | å¼ºåˆ¶è¦æ±‚å…ˆåˆå§‹åŒ–                 |

---

## ğŸ“¦ ä¾èµ–åº“

```bash
# Ubuntu/Debian
sudo apt-get install libpbc-dev libgmp-dev libssl-dev libjsoncpp-dev

# åº“è¯´æ˜
- PBC Library: é…å¯¹å¯†ç å­¦è¿ç®—
- GMP: å¤§æ•´æ•°è¿ç®—
- OpenSSL: AESåŠ å¯†å’Œå“ˆå¸Œå‡½æ•°
- JsonCpp: JSONæ–‡ä»¶è§£æ
```

---

## ğŸ› ï¸ ç¼–è¯‘æ–¹æ³•

```bash
# æ–¹æ³•1: ä½¿ç”¨g++ç›´æ¥ç¼–è¯‘
g++ -std=c++11 main.cpp client.cpp -lpbc -lgmp -lcrypto -ljsoncpp -o storage_client

# æ–¹æ³•2: ä½¿ç”¨CMakeï¼ˆæ¨èï¼‰
mkdir build && cd build
cmake ..
make
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ è·å–å…¬å…±å‚æ•°

ä» Storage Node è·å– `public_params.json`ï¼ˆåŒ…å« N, g, Î¼ï¼‰:

```json
{
  "N": "2875631...",
  "g": "0a1b2c3d...",
  "mu": "4e5f6a7b...",
  "timestamp": "2024-11-10 10:30:00",
  "version": "v1.0"
}
```

### 2ï¸âƒ£ åˆå§‹åŒ–ç³»ç»Ÿ

```bash
./storage_client

# åœ¨äº¤äº’ç•Œé¢ä¸­:
> init
# ç³»ç»Ÿä¼šä» public_params.json åŠ è½½æ‰€æœ‰å‚æ•°
# é…å¯¹å‚æ•°ï¼ˆType Aæ›²çº¿ï¼‰å·²ç¡¬ç¼–ç åˆ°ç¨‹åºä¸­
```

### 3ï¸âƒ£ ç”Ÿæˆå¯†é’¥

```bash
> keygen
# ç”Ÿæˆæ–‡ä»¶:
# - private_key.dat (ç§é’¥ï¼Œå¦¥å–„ä¿ç®¡)
# - public_key.json (å…¬é’¥)
```

### 4ï¸âƒ£ åŠ å¯†æ–‡ä»¶

```bash
> encrypt
ğŸ“„ è¾“å…¥æ–‡ä»¶è·¯å¾„: test.txt
ğŸ·ï¸  è¾“å…¥å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰: æœºå¯†, è´¢åŠ¡æŠ¥å‘Š
ğŸ’¾ è¾“å‡ºæ–‡ä»¶å‰ç¼€: test_encrypted
ğŸ’¾ insert.json è¾“å‡ºè·¯å¾„: insert.json

# ç”Ÿæˆæ–‡ä»¶:
# - test_encrypted.enc (åŠ å¯†æ–‡ä»¶)
# - insert.json (ä¾› Storage Node ä½¿ç”¨)
# - test.txt_metadata.json (æœ¬åœ°å…ƒæ•°æ®)
```

### 5ï¸âƒ£ è§£å¯†æ–‡ä»¶

```bash
> decrypt
ğŸ“¥ è¾“å…¥åŠ å¯†æ–‡ä»¶è·¯å¾„: test_encrypted.enc
ğŸ’¾ è¾“å‡ºæ–‡ä»¶è·¯å¾„: test_decrypted.txt
```

---

## ğŸ“– å®Œæ•´å‘½ä»¤åˆ—è¡¨

### ç³»ç»Ÿè®¾ç½®

* `init` - åˆå§‹åŒ–ç³»ç»Ÿï¼ˆä» public\_params.json åŠ è½½å‚æ•°ï¼‰
* `keygen` - ç”Ÿæˆå¯†é’¥ï¼ˆéœ€å…ˆåˆå§‹åŒ–ï¼‰
* `save-keys` - ä¿å­˜å¯†é’¥åˆ°æ–‡ä»¶
* `load-keys` - ä»æ–‡ä»¶åŠ è½½å¯†é’¥

### æ–‡ä»¶æ“ä½œ

* `encrypt` - åŠ å¯†æ–‡ä»¶
* `decrypt` - è§£å¯†æ–‡ä»¶

### çŠ¶æ€ç®¡ç†ï¼ˆå‰å‘å®‰å…¨ï¼‰

* `load-states` - åŠ è½½å…³é”®è¯çŠ¶æ€
* `save-states` - ä¿å­˜å…³é”®è¯çŠ¶æ€
* `query-state` - æŸ¥è¯¢å…³é”®è¯å†å²

### å…¶ä»–

* `help` - æ˜¾ç¤ºå¸®åŠ©
* `quit` - é€€å‡º

---

## ğŸ”„ ä» v3.3 è¿ç§»

### éœ€è¦çš„æ–‡ä»¶å˜æ›´

1. **åˆ é™¤æ–‡ä»¶**
   ```bash
   rm system_params.json  # ä¸å†éœ€è¦
   ```
2. **ä¿ç•™æ–‡ä»¶**
   ```bash
   public_params.json     # å”¯ä¸€å‚æ•°æ–‡ä»¶ï¼ˆä» Storage Node è·å–ï¼‰
   private_key.dat        # å¯†é’¥æ–‡ä»¶ï¼ˆå…¼å®¹ï¼‰
   public_key.json        # å…¬é’¥æ–‡ä»¶ï¼ˆå…¼å®¹ï¼‰
   keyword_states.json    # çŠ¶æ€æ–‡ä»¶ï¼ˆå…¼å®¹ï¼‰
   ```

### ä»£ç è°ƒç”¨å˜æ›´

```cpp
// v3.3 ä»£ç 
client.initialize();  // ä» system_params.json åŠ è½½
client.generateKeys("public_params.json");  // åˆä» public_params.json åŠ è½½

// v4.0 ä»£ç 
client.initialize("public_params.json");  // ç»Ÿä¸€ä»ä¸€ä¸ªæ–‡ä»¶åŠ è½½
client.generateKeys();  // ä»…ç”Ÿæˆå¯†é’¥
```

### é‡æ–°åˆå§‹åŒ–æ­¥éª¤

å¦‚æœæ‚¨å·²ç»ä½¿ç”¨ v3.3 åŠ å¯†äº†æ–‡ä»¶ï¼š

```bash
# 1. å¤‡ä»½ç°æœ‰å¯†é’¥å’ŒçŠ¶æ€
cp private_key.dat private_key_backup.dat
cp keyword_states.json keyword_states_backup.json

# 2. ç¡®ä¿æœ‰ public_params.jsonï¼ˆä» Storage Node è·å–ï¼‰

# 3. ä½¿ç”¨ v4.0 é‡æ–°åˆå§‹åŒ–
./storage_client
> init
> load-keys private_key.dat  # åŠ è½½æ—§å¯†é’¥
> load-states keyword_states.json  # åŠ è½½æ—§çŠ¶æ€

# 4. éªŒè¯ï¼ˆæŸ¥è¯¢å…³é”®è¯çŠ¶æ€åº”è¯¥æ­£å¸¸ï¼‰
> query-state æœºå¯†
```

**âš ï¸ é‡è¦**: v3.3 ç”Ÿæˆçš„å¯†é’¥æ–‡ä»¶ä¸ v4.0 å…¼å®¹ï¼Œæ— éœ€é‡æ–°ç”Ÿæˆå¯†é’¥ã€‚

---

## ğŸ” å®‰å…¨æ€§è¯´æ˜

### ç¡¬ç¼–ç é…å¯¹å‚æ•°çš„å®‰å…¨æ€§

**Q: é…å¯¹å‚æ•°ç¡¬ç¼–ç å®‰å…¨å—ï¼Ÿ**

**A: å®Œå…¨å®‰å…¨ã€‚** åŸå› å¦‚ä¸‹ï¼š

1. **é…å¯¹å‚æ•°ä¸æ˜¯å¯†é’¥**
   * é…å¯¹å‚æ•°æ˜¯å…¬å¼€çš„æ•°å­¦ç»“æ„å®šä¹‰
   * ç±»ä¼¼äº RSA å›ºå®šä½¿ç”¨ e=65537
   * ä¸åŒ…å«ä»»ä½•ç§˜å¯†ä¿¡æ¯
2. **Type A æ›²çº¿æ˜¯æ ‡å‡†é…ç½®**
   * ä½¿ç”¨ä¸šç•Œè®¤å¯çš„ 1024ä½å®‰å…¨çº§åˆ«
   * å‚æ•°ç”± PBC åº“å®˜æ–¹æä¾›
   * å·²è¢«å¹¿æ³›éªŒè¯å’Œä½¿ç”¨
3. **çœŸæ­£çš„å¯†é’¥ä»ç„¶æ˜¯éšæœºç”Ÿæˆçš„**
   * sk (ç§é’¥) - éšæœºç”Ÿæˆ
   * mk (ä¸»å¯†é’¥) - éšæœºç”Ÿæˆ
   * ek (åŠ å¯†å¯†é’¥) - éšæœºç”Ÿæˆ

### å¯†é’¥ç®¡ç†

```bash
# ç§é’¥æ–‡ä»¶æƒé™ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰
chmod 600 private_key.dat

# ç›®å½•ç»“æ„å»ºè®®
project/
â”œâ”€â”€ storage_client          # å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ public_params.json      # å…¬å…±å‚æ•°ï¼ˆå¯å…¬å¼€ï¼‰
â”œâ”€â”€ public_key.json         # å…¬é’¥ï¼ˆå¯å…¬å¼€ï¼‰
â”œâ”€â”€ private_key.dat         # ç§é’¥ï¼ˆä¸¥æ ¼ä¿å¯†ï¼‰
â””â”€â”€ keyword_states.json     # çŠ¶æ€æ–‡ä»¶ï¼ˆå»ºè®®åŠ å¯†å­˜å‚¨ï¼‰
```

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: "ç³»ç»Ÿå°šæœªåˆå§‹åŒ–"

**åŸå› **: è°ƒç”¨ `generateKeys()` æˆ– `loadKeys()` å‰æœªåˆå§‹åŒ–

**è§£å†³**:

```bash
> init
# ç„¶åå†è¿è¡Œå…¶ä»–å‘½ä»¤
```

### é—®é¢˜2: "æ— æ³•æ‰“å¼€ public\_params.json"

**åŸå› **: æ–‡ä»¶ä¸å­˜åœ¨æˆ–è·¯å¾„é”™è¯¯

**è§£å†³**:

```bash
# ä» Storage Node è·å–æ–‡ä»¶
# ç¡®ä¿æ–‡ä»¶åœ¨ç¨‹åºåŒç›®å½•æˆ–æä¾›æ­£ç¡®è·¯å¾„
> init
ğŸ’¡ è¾“å…¥ public_params.json è·¯å¾„: /path/to/public_params.json
```

### é—®é¢˜3: "è®¤è¯æ ‡ç­¾éªŒè¯å¤±è´¥"

**åŸå› **: v3.3 çš„ Î¼ å‚æ•°æœªæ­£ç¡®åŠ è½½

**è§£å†³**: å‡çº§åˆ° v4.0 å¹¶ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„ `public_params.json`

### é—®é¢˜4: "åŠ è½½å¯†é’¥å‰å¿…é¡»å…ˆåˆå§‹åŒ–ç³»ç»Ÿ"

**åŸå› **: v4.0 æ–°å¢çš„å®‰å…¨æ£€æŸ¥

**è§£å†³**:

```bash
> init         # å…ˆåˆå§‹åŒ–
> load-keys    # å†åŠ è½½å¯†é’¥
```

---

## ğŸ“Š æ–‡ä»¶æ ¼å¼è¯´æ˜

### public\_params.jsonï¼ˆStorage Node æä¾›ï¼‰

```json
{
  "N": "å¤§æ•´æ•°ï¼ˆåè¿›åˆ¶å­—ç¬¦ä¸²ï¼‰",
  "g": "Gâ‚ç¾¤ç”Ÿæˆå…ƒï¼ˆåå…­è¿›åˆ¶ï¼‰",
  "mu": "è®¤è¯å‚æ•°ï¼ˆåå…­è¿›åˆ¶ï¼‰",
  "timestamp": "ç”Ÿæˆæ—¶é—´",
  "version": "ç‰ˆæœ¬å·"
}
```

### public\_key.jsonï¼ˆå®¢æˆ·ç«¯ç”Ÿæˆï¼‰

```json
{
  "pk": "å…¬é’¥ pk = g^skï¼ˆåå…­è¿›åˆ¶ï¼‰",
  "timestamp": "ç”Ÿæˆæ—¶é—´",
  "version": "v4.0",
  "note": "è¯´æ˜æ–‡å­—"
}
```

### insert.jsonï¼ˆä¾› Storage Nodeï¼‰

```json
{
  "file_id": "æ–‡ä»¶å”¯ä¸€æ ‡è¯†",
  "keywords": [
    {
      "Ti": "æœç´¢ä»¤ç‰Œ",
      "kt": "çŠ¶æ€å…³è”ä»¤ç‰Œ",
      "ptr": "åŠ å¯†æŒ‡é’ˆ"
    }
  ],
  "auth_tags": ["è®¤è¯æ ‡ç­¾æ•°ç»„"],
  "timestamp": "æ—¶é—´æˆ³"
}
```

---

## ğŸ”¬ æŠ€æœ¯ç»†èŠ‚

### åˆå§‹åŒ–æµç¨‹ï¼ˆv4.0ï¼‰

```
1. åˆå§‹åŒ–é…å¯¹å‚æ•°
   â”œâ”€ åŠ è½½ç¡¬ç¼–ç çš„ Type A æ›²çº¿å‚æ•°
   â””â”€ pairing_init_set_str(pairing_, HARDCODED_PARAMS)

2. åŠ è½½å…¬å…±å‚æ•°ï¼ˆä» public_params.jsonï¼‰
   â”œâ”€ N: RSA æ¨¡æ•°ï¼ˆè‡³å°‘ 2048 ä½ï¼‰
   â”œâ”€ g: Gâ‚ ç¾¤ç”Ÿæˆå…ƒ
   â””â”€ Î¼: è®¤è¯å‚æ•°ï¼ˆç”¨äºæ ‡ç­¾ç”Ÿæˆï¼‰

3. éªŒè¯å‚æ•°
   â”œâ”€ æ£€æŸ¥ N çš„ä½æ•°ï¼ˆâ‰¥2048ï¼‰
   â”œâ”€ éªŒè¯ g â‰  1
   â””â”€ éªŒè¯ Î¼ â‰  1

4. åˆå§‹åŒ–å…¬é’¥å…ƒç´ 
   â””â”€ element_init_G1(pk_, pairing_)
```

### å¯†é’¥ç”Ÿæˆæµç¨‹ï¼ˆv4.0ï¼‰

```
1. æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€
   â””â”€ if (!initialized_) â†’ æŠ¥é”™

2. ç”Ÿæˆéšæœºå¯†é’¥
   â”œâ”€ mk: 256ä½ä¸»å¯†é’¥ï¼ˆRAND_bytesï¼‰
   â”œâ”€ ek: 256ä½åŠ å¯†å¯†é’¥ï¼ˆRAND_bytesï¼‰
   â””â”€ sk: éšæœºå¤§æ•´æ•°ï¼ˆelement_random â†’ mpzï¼‰

3. è®¡ç®—å…¬é’¥
   â””â”€ pk = g^sk

4. ä¿å­˜å¯†é’¥
   â”œâ”€ private_key.dat: mk || ek || sk
   â””â”€ public_key.json: {"pk": serialize(pk)}
```

### è®¤è¯æ ‡ç­¾ç®—æ³•

```
å¯¹äºæ¯ä¸ªæ•°æ®å— i:
  Ïƒ_i = [Hâ‚‚(ID_F||i) Ã— âˆ_{j=1}^s Î¼^{c_{i,j}}]^sk

å…¶ä¸­:
- ID_F: æ–‡ä»¶æ ‡è¯†ç¬¦
- c_{i,j}: ç¬¬ i å—ç¬¬ j æ‰‡åŒºçš„æ•°æ®
- Î¼: ä» public_params.json åŠ è½½ï¼ˆv4.0 ä¿®å¤ï¼‰
- sk: å®¢æˆ·ç«¯ç§é’¥
```

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

### å¸¸è§é—®é¢˜

1. **Q: ä¸ºä»€ä¹ˆåˆ é™¤ system\_params.jsonï¼Ÿ**
   * A: é¿å…å‚æ•°é‡å¤å’Œä¸ä¸€è‡´ï¼Œç®€åŒ–é…ç½®
2. **Q: å¦‚æœ Storage Node æ›´æ–°äº† public\_params.jsonï¼Ÿ**
   * A: éœ€è¦é‡æ–°åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶é‡æ–°ç”Ÿæˆå¯†é’¥
3. **Q: v3.3 çš„åŠ å¯†æ–‡ä»¶èƒ½ç”¨ v4.0 è§£å¯†å—ï¼Ÿ**
   * A: å¯ä»¥ï¼Œä½†éœ€è¦ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’Œå‚æ•°

### ç‰ˆæœ¬å†å²

* **v4.0** (2024-11) - æ–¹æ¡ˆAé‡æ„ï¼šç»Ÿä¸€å‚æ•°æºï¼Œç¡¬ç¼–ç é…å¯¹å‚æ•°
* **v3.3** (2024-10) - æ”¯æŒ Storage Node æ¥å£
* **v3.0** (2024-09) - å¯æœç´¢åŠ å¯†å®ç°
* **v2.0** (2024-08) - è®¤è¯æ ‡ç­¾æ”¯æŒ
* **v1.0** (2024-07) - åŸºç¡€åŠ å¯†åŠŸèƒ½

---

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®ç”¨äºå­¦æœ¯ç ”ç©¶å’Œæ•™è‚²ç›®çš„ã€‚

---

## ğŸ¯ æ€»ç»“

**v4.0 çš„æ ¸å¿ƒä»·å€¼**:

* âœ… ä¿®å¤äº† Î¼ å‚æ•°ç¼ºå¤±çš„ä¸¥é‡ bug
* âœ… ç»Ÿä¸€å‚æ•°æºï¼Œæ¶ˆé™¤ä¸ä¸€è‡´æ€§
* âœ… ç®€åŒ–é…ç½®ï¼Œé™ä½å‡ºé”™æ¦‚ç‡
* âœ… ä¿æŒå‘åå…¼å®¹ï¼ˆå¯†é’¥æ–‡ä»¶æ ¼å¼ä¸å˜ï¼‰

**å‡çº§å»ºè®®**:

* å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ v3.3ï¼Œ**å¼ºçƒˆå»ºè®®**å‡çº§åˆ° v4.0
* å‡çº§è¿‡ç¨‹ç®€å•ï¼Œæ— éœ€é‡æ–°ç”Ÿæˆå¯†é’¥
* åªéœ€æ›¿æ¢å¯æ‰§è¡Œæ–‡ä»¶å¹¶åˆ é™¤ system\_params.json

**æŠ€æœ¯æ”¯æŒ**:

* é‡åˆ°é—®é¢˜è¯·æ£€æŸ¥æœ¬ README çš„"æ•…éšœæ’é™¤"ç« èŠ‚
* ç¡®ä¿ public\_params.json ä¸ Storage Node ä¸€è‡´

---

*æœ€åæ›´æ–°: 2024-11-10**ç‰ˆæœ¬: v4.0 (æ–¹æ¡ˆAå®ç°)*

# æœ¬åœ°åŠ å¯†å­˜å‚¨å·¥å…· v3.3

> åŸºäºå¯æœç´¢åŠ å¯†çš„æœ¬åœ°æ–‡ä»¶åŠ å¯†å·¥å…·ï¼Œæ”¯æŒå‰å‘å®‰å…¨æ€§å’Œå¯éªŒè¯æ€§
> **v3.3 æ–°ç‰¹æ€§ï¼šå®Œå…¨ç¬¦åˆ Storage Node æ¥å£è§„èŒƒ**

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)[![C++](https://img.shields.io/badge/C++-14-blue.svg)](https://isocpp.org/)[![Version](https://img.shields.io/badge/version-3.3-green.svg)](https://github.com/your-repo)

---

## ğŸ“– ç®€ä»‹

æœ¬å·¥å…·æ˜¯ä¸€ä¸ª**çº¯æœ¬åœ°è¿è¡Œ**çš„æ–‡ä»¶åŠ å¯†å·¥å…·ï¼Œä½¿ç”¨å†›äº‹çº§åŠ å¯†ç®—æ³•ï¼ˆAES-256-CBCï¼‰å’Œå¯æœç´¢åŠ å¯†æŠ€æœ¯ï¼Œå®Œå…¨ç¬¦åˆåˆ†å¸ƒå¼å­˜å‚¨èŠ‚ç‚¹ï¼ˆStorage Nodeï¼‰çš„æ¥å£è§„èŒƒã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**

* âœ… å®Œå…¨æœ¬åœ°è¿è¡Œï¼Œæ— éœ€ç½‘ç»œ
* âœ… ä¸ä¾èµ–åŒºå—é“¾æˆ–å¤–éƒ¨æœåŠ¡
* âœ… å†›äº‹çº§åŠ å¯†ï¼ˆAES-256ï¼‰
* âœ… å¯æœç´¢åŠ å¯†ï¼ˆæ— éœ€è§£å¯†å³å¯æœç´¢ï¼‰
* âœ… å‰å‘å®‰å…¨æ€§ï¼ˆæ–°æ–‡ä»¶ä¸æ³„éœ²æ—§æœç´¢æ¨¡å¼ï¼‰
* âœ… ç¬¦åˆ Storage Node æ¥å£è§„èŒƒ
* âœ… ç”Ÿæˆæ ‡å‡†åŒ–çš„ insert.json æ–‡ä»¶
* âœ… ç®—æ³•å®Œå…¨æŒ‰ç…§è®ºæ–‡å®ç°

---

## ğŸ†• v3.3 ç‰ˆæœ¬é‡å¤§æ›´æ–°

### ä¸»è¦å˜æ›´

#### 1. **å¯†é’¥ç”Ÿæˆï¼ˆgenerateKeysï¼‰**

* âœ¨ ä» Storage Node æä¾›çš„ `public_params.json` è¯»å–å…¬å…±å‚æ•°
* âœ¨ ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š
  * `private_key.dat`ï¼ˆäºŒè¿›åˆ¶æ ¼å¼ï¼ŒåŒ…å« mk, ek, skï¼‰
  * `public_key.json`ï¼ˆJSONæ ¼å¼ï¼ŒåŒ…å« PK å’Œå®¢æˆ·ç«¯ä¿¡æ¯ï¼‰

#### 2. **æ–‡ä»¶åŠ å¯†ï¼ˆencryptFileï¼‰**

* âœ¨ ç”Ÿæˆä¸‰ä¸ªæ–‡ä»¶ï¼š
  * `[prefix].enc` - åŠ å¯†æ–‡ä»¶
  * `insert.json` - ä¾› Storage Node ä½¿ç”¨çš„æ ‡å‡†åŒ–æ’å…¥æ•°æ®
  * `[filename]_metadata.json` - æœ¬åœ°å…ƒæ•°æ®
* âœ¨ `insert.json` å®Œå…¨ç¬¦åˆ Storage Node æ¥å£è§„èŒƒ

#### 3. **è®¤è¯æ ‡ç­¾ç”Ÿæˆï¼ˆgenerateAuthTagsï¼‰**

* ğŸ”§ ç®—æ³•å®Œå…¨é‡å†™ï¼Œä¸¥æ ¼æŒ‰ç…§è®ºæ–‡å®ç°
* ğŸ“ å…¬å¼ï¼š`Ïƒ_i = [H_2(ID_F||i) * âˆ_{j=1}^s Î¼^{c_{i,j}}]^sk`
* âœ… æ”¯æŒåˆ†å—éªŒè¯

#### 4. **çŠ¶æ€å…³è”ä»¤ç‰Œï¼ˆgenerateStateAssociatedTokenï¼‰**

* ğŸ”§ ä» `generateKeywordTag` æ”¹å
* ğŸ”§ ç®—æ³•ä¿®æ­£ï¼š
  * æœ‰å‰ä¸€çŠ¶æ€ï¼š`kt^{w_i} = [H_2(ID_F) * H_2(st_d||Ti) / H_2(st_{d-1}||Ti)]^{sk}`
  * æ— å‰ä¸€çŠ¶æ€ï¼š`kt^{w_i} = [H_2(ID_F) * H_2(st_d||Ti)]^{sk}`

#### 5. **æœç´¢ä»¤ç‰Œç”Ÿæˆ**

* âŒ åˆ é™¤äº† `generateSearchToken` å‘½ä»¤ï¼ˆåŠŸèƒ½å·²æ•´åˆï¼‰
* âœ… ç°åœ¨è‡ªåŠ¨åœ¨åŠ å¯†æ—¶ç”Ÿæˆæœç´¢ä»¤ç‰Œ

#### 6. **æŒ‡é’ˆåŠ å¯†ï¼ˆencryptPointerï¼‰**

* ğŸ”§ è°ƒæ•´é€»è¾‘ï¼šä½¿ç”¨å½“å‰çŠ¶æ€å“ˆå¸Œä½œä¸ºå¯†é’¥åŠ å¯†å‰ä¸€çŠ¶æ€

---

## ğŸ“‹ v3.3 ä¸ v3.2 çš„åŒºåˆ«


| ç‰¹æ€§         | v3.2                   | v3.3                                       |
| ------------ | ---------------------- | ------------------------------------------ |
| å¯†é’¥ç”Ÿæˆ     | ä» system\_params.json | ä» public\_params.jsonï¼ˆStorage Nodeæä¾›ï¼‰ |
| å…¬é’¥å­˜å‚¨     | ä¸ä¿å­˜å•ç‹¬æ–‡ä»¶         | ç”Ÿæˆ public\_key.json                      |
| åŠ å¯†è¾“å‡º     | .enc + .json           | .enc + insert.json + metadata.json         |
| insert.json  | ä¸ç”Ÿæˆ                 | âœ… ç”Ÿæˆï¼ˆç¬¦åˆStorage Nodeè§„èŒƒï¼‰            |
| è®¤è¯æ ‡ç­¾ç®—æ³• | ç®€åŒ–ç‰ˆæœ¬               | âœ… å®Œå…¨æŒ‰è®ºæ–‡å®ç°                          |
| çŠ¶æ€å…³è”ä»¤ç‰Œ | generateKeywordTag     | generateStateAssociatedTokenï¼ˆç®—æ³•ä¿®æ­£ï¼‰   |
| æœç´¢ä»¤ç‰Œå‘½ä»¤ | ç‹¬ç«‹å‘½ä»¤               | å·²åˆ é™¤ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰                         |
| æ¥å£å…¼å®¹æ€§   | éƒ¨åˆ†å…¼å®¹               | âœ… å®Œå…¨å…¼å®¹ Storage Node                   |

---

## ğŸ”§ å®‰è£…ä¾èµ–

### Ubuntu/Debian

```bash
sudo apt-get update
sudo apt-get install -y build-essential cmake
sudo apt-get install -y libssl-dev libgmp-dev libjsoncpp-dev libpbc-dev
```

### CentOS/RHEL

```bash
sudo yum install -y gcc-c++ cmake
sudo yum install -y openssl-devel gmp-devel jsoncpp-devel pbc-devel
```

---

## ğŸ—ï¸ ç¼–è¯‘

```bash
# åˆ›å»ºæ„å»ºç›®å½•
mkdir build && cd build

# é…ç½®
cmake ..

# ç¼–è¯‘
make -j4

# æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶
ls -lh storage_client
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‡†å¤‡å·¥ä½œ

**é‡è¦ï¼šv3.3 éœ€è¦ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼**

1. **system\_params.json** - ç³»ç»Ÿå‚æ•°ï¼ˆæœ¬åœ°é…ç½®ï¼‰
2. **public\_params.json** - å…¬å…±å‚æ•°ï¼ˆç”± Storage Node ç”Ÿæˆï¼‰

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
ls -l system_params.json public_params.json

# å¦‚æœä¸å­˜åœ¨ï¼Œè¯·ä»ç›¸åº”æ¥æºè·å–
```

### ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–ç³»ç»Ÿ

```bash
./storage_client
```

ç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹é…ç½®æ–‡ä»¶å¹¶æ˜¾ç¤ºçŠ¶æ€ï¼š

```
==================================================
  ğŸ” æœ¬åœ°åŠ å¯†å­˜å‚¨å·¥å…· - v3.3
  å¯éªŒè¯çš„å¯æœç´¢åŠ å¯†ç³»ç»Ÿ
  â­ v3.3 æ–°ç‰¹æ€§: ç¬¦åˆ Storage Node æ¥å£è§„èŒƒ
==================================================

âœ… æ£€æµ‹åˆ°ç³»ç»Ÿå‚æ•°é…ç½®æ–‡ä»¶
âœ… æ£€æµ‹åˆ°å…¬å…±å‚æ•°æ–‡ä»¶ï¼ˆå¯ä»¥ç”Ÿæˆå¯†é’¥ï¼‰

...
```

è¿è¡Œåˆå§‹åŒ–å‘½ä»¤ï¼š

```
ğŸ’» > init

âš™ï¸  åˆå§‹åŒ–åŠ å¯†ç³»ç»Ÿ...
ğŸ“„ ä½¿ç”¨é…ç½®æ–‡ä»¶: system_params.json
ğŸ’¡ æç¤º: è¯·ç¡®ä¿é…ç½®æ–‡ä»¶åœ¨ç¨‹åºåŒç›®å½•ä¸‹

åˆå§‹åŒ–å®¢æˆ·ç«¯...
ä»é…ç½®æ–‡ä»¶åŠ è½½ç³»ç»Ÿå‚æ•°...
âœ… ç³»ç»Ÿå‚æ•°åŠ è½½æˆåŠŸ
   é…å¯¹ç±»å‹: a
   å®‰å…¨çº§åˆ«: 512-bit
âœ… å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ
```

### ç¬¬äºŒæ­¥ï¼šç”Ÿæˆå¯†é’¥

```
ğŸ’» > keygen

ğŸ”‘ ç”Ÿæˆå¯†é’¥...
ğŸ“„ ä» public_params.json è¯»å–å…¬å…±å‚æ•°...
ğŸ’¡ è¾“å…¥å…¬å…±å‚æ•°æ–‡ä»¶è·¯å¾„ï¼ˆæŒ‰å›è½¦ä½¿ç”¨é»˜è®¤: public_params.jsonï¼‰: [å›è½¦]

ç”Ÿæˆå®¢æˆ·ç«¯å¯†é’¥...
ä» public_params.json è¯»å–å…¬å…±å‚æ•°...
âœ… ä»å…¬å…±å‚æ•°åŠ è½½ç”Ÿæˆå…ƒ g
âœ… å¯†é’¥ç”ŸæˆæˆåŠŸ
âœ… ç§é’¥å·²ä¿å­˜åˆ°: private_key.dat
âœ… å…¬é’¥å·²ä¿å­˜åˆ°: public_key.json
ğŸ“Œ å®¢æˆ·ç«¯ID: a1b2c3d4e5f6g7h8
âš ï¸  è¯·å¦¥å–„ä¿ç®¡ç§é’¥æ–‡ä»¶ï¼
```

**ç”Ÿæˆçš„æ–‡ä»¶ï¼š**

* `private_key.dat` - ç§é’¥ï¼ˆäºŒè¿›åˆ¶ï¼ŒåŒ…å« mk, ek, skï¼‰
* `public_key.json` - å…¬é’¥å’Œå®¢æˆ·ç«¯ä¿¡æ¯ï¼ˆJSONæ ¼å¼ï¼‰

---

## ğŸ“š å®Œæ•´ä½¿ç”¨æ•™ç¨‹

### 1. åŠ å¯†æ–‡ä»¶ï¼ˆv3.3 æ–°æµç¨‹ï¼‰

```
ğŸ’» > encrypt

ğŸ“„ è¾“å…¥æ–‡ä»¶è·¯å¾„: documents/report.pdf
ğŸ·ï¸  è¾“å…¥å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰: confidential, finance, Q4-2024
ğŸ’¾ è¾“å‡ºæ–‡ä»¶å‰ç¼€ï¼ˆå°†ç”Ÿæˆ .enc å’Œç›¸å…³ JSONï¼‰: encrypted_report
ğŸ’¾ insert.json è¾“å‡ºè·¯å¾„ï¼ˆæŒ‰å›è½¦ä½¿ç”¨é»˜è®¤: insert.jsonï¼‰: [å›è½¦]

ğŸ” åŠ å¯†ä¸­...
åŠ å¯†æ–‡ä»¶: documents/report.pdf
æ–‡ä»¶å¤§å°: 524288 å­—èŠ‚
æ–‡ä»¶ID: a3f5e8d2b1c7a4f9e2d8c3b6a1f5e9d2...
ç”Ÿæˆäº† 128 ä¸ªè®¤è¯æ ‡ç­¾
ç”Ÿæˆäº† 3 ä¸ªå…³é”®è¯æ ‡ç­¾
âœ… insert.json å·²ç”Ÿæˆ: insert.json
âœ… æœ¬åœ°å…ƒæ•°æ®å·²ç”Ÿæˆ: report.pdf_metadata.json

ğŸ‰ æ–‡ä»¶åŠ å¯†å®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¦ åŠ å¯†æ–‡ä»¶: encrypted_report.enc
ğŸ“‹ æ’å…¥æ•°æ®: insert.json
ğŸ“„ æœ¬åœ°å…ƒæ•°æ®: report.pdf_metadata.json
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¡ å¯ä»¥å°† insert.json å‘é€ç»™ Storage Node
```

**ç”Ÿæˆçš„æ–‡ä»¶è¯´æ˜ï¼š**

1. **encrypted\_report.enc** - åŠ å¯†åçš„æ–‡ä»¶
   * æ ¼å¼ï¼š`[16å­—èŠ‚ IV][AES-256-CBC åŠ å¯†æ•°æ®]`
2. **insert.json** - ä¾› Storage Node ä½¿ç”¨ï¼ˆæ ‡å‡†æ ¼å¼ï¼‰
   ```json
   {
     "PK": "å®¢æˆ·ç«¯å…¬é’¥",
     "ID_F": "æ–‡ä»¶IDï¼ˆSHA256å“ˆå¸Œï¼‰",
     "ptr": "æŒ‡é’ˆæ•°æ®",
     "TS_F": ["è®¤è¯æ ‡ç­¾æ•°ç»„"],
     "state": "valid",
     "keywords": [
       {
         "T_i": "æœç´¢ä»¤ç‰Œ Ti",
         "kt_i": "å…³é”®è¯æ ‡ç­¾ kt^wi"
       }
     ]
   }
   ```
3. **report.pdf\_metadata.json** - æœ¬åœ°å…ƒæ•°æ®
   ```json
   {
     "original_filename": "report.pdf",
     "encrypted_filename": "encrypted_report.enc",
     "file_id": "a3f5e8...",
     "file_size": 524288,
     "encryption_time": "2025-11-09T10:30:00Z",
     "keywords": ["confidential", "finance", "Q4-2024"],
     "states": {
       "confidential": {
         "current_state": "å½“å‰çŠ¶æ€å€¼",
         "previous_state": "å‰ä¸€çŠ¶æ€å€¼"
       }
     }
   }
   ```

### 2. è§£å¯†æ–‡ä»¶

```
ğŸ’» > decrypt

ğŸ“¥ è¾“å…¥åŠ å¯†æ–‡ä»¶è·¯å¾„: encrypted_report.enc
ğŸ’¾ è¾“å‡ºæ–‡ä»¶è·¯å¾„: decrypted_report.pdf

ğŸ”“ è§£å¯†ä¸­...
è§£å¯†æ–‡ä»¶: encrypted_report.enc
âœ… æ–‡ä»¶è§£å¯†æˆåŠŸ
ä¿å­˜åˆ°: decrypted_report.pdf
```

### 3. å…³é”®è¯çŠ¶æ€ç®¡ç†

#### åŠ è½½çŠ¶æ€æ–‡ä»¶

```
ğŸ’» > load-states

ğŸ“‚ è¾“å…¥çŠ¶æ€æ–‡ä»¶è·¯å¾„: keyword_states.json

ğŸ“¥ åŠ è½½å…³é”®è¯çŠ¶æ€...
âœ… å·²åŠ è½½ 5 ä¸ªå…³é”®è¯çŠ¶æ€
ğŸ’¡ æç¤º: åŠ å¯†æ–‡ä»¶æ—¶ä¼šè‡ªåŠ¨æ›´æ–°æ­¤çŠ¶æ€æ–‡ä»¶
```

#### æŸ¥è¯¢å…³é”®è¯çŠ¶æ€

```
ğŸ’» > query-state

ğŸ” è¾“å…¥è¦æŸ¥è¯¢çš„å…³é”®è¯: confidential

ğŸ” å…³é”®è¯çŠ¶æ€æŸ¥è¯¢ç»“æœ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å…³é”®è¯: confidential
å½“å‰çŠ¶æ€: 8a7f3e2d...

ğŸ“œ å†å²è®°å½• (3 æ¡):
  1. [å½“å‰] æ–‡ä»¶ID: a3f5e8d2b1c7a4f9...
     æ—¶é—´: 2025-11-09T10:30:00Z
  2. æ–‡ä»¶ID: b4f6e9d3c2b8a5f0...
     æ—¶é—´: 2025-11-08T15:20:00Z
  3. æ–‡ä»¶ID: c5f7e0d4c3b9a6f1...
     æ—¶é—´: 2025-11-07T12:10:00Z
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## ğŸ“‹ å‘½ä»¤å‚è€ƒ


| å‘½ä»¤                   | å¿«æ·é”®    | åŠŸèƒ½                 | v3.3 å˜æ›´                   |
| ---------------------- | --------- | -------------------- | --------------------------- |
| `init`                 | 1         | åˆå§‹åŒ–åŠ å¯†ç³»ç»Ÿ       | ä¸å˜                        |
| `keygen`               | 2         | ç”Ÿæˆæ–°çš„åŠ å¯†å¯†é’¥     | âœ¨ éœ€è¦ public\_params.json |
| `save-keys`            | 3         | ä¿å­˜å¯†é’¥åˆ°æ–‡ä»¶       | ä¸å˜                        |
| `load-keys`            | 4         | ä»æ–‡ä»¶åŠ è½½å¯†é’¥       | ä¸å˜                        |
| `encrypt`              | 5         | åŠ å¯†æ–‡ä»¶å¹¶ç”Ÿæˆå…ƒæ•°æ® | âœ¨ ç”Ÿæˆ insert.json         |
| `decrypt`              | 6         | è§£å¯†æ–‡ä»¶             | ä¸å˜                        |
| \~\~`search-token`\~\~ | \~\~7\~\~ | \~\~ç”Ÿæˆæœç´¢ä»¤ç‰Œ\~\~ | âŒ å·²åˆ é™¤                   |
| `load-states`          | 10        | åŠ è½½å…³é”®è¯çŠ¶æ€æ–‡ä»¶   | ä¸å˜                        |
| `save-states`          | 11        | ä¿å­˜å…³é”®è¯çŠ¶æ€æ–‡ä»¶   | ä¸å˜                        |
| `query-state`          | 12        | æŸ¥è¯¢å…³é”®è¯å½“å‰çŠ¶æ€   | ä¸å˜                        |
| `help`                 | 13        | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯         | ä¸å˜                        |
| `quit`                 | 14        | é€€å‡ºç¨‹åº             | ä¸å˜                        |

---

## ğŸ“„ æ–‡ä»¶æ ¼å¼è¯´æ˜

### 1. public\_params.jsonï¼ˆç”± Storage Node ç”Ÿæˆï¼‰

```json
{
  "version": "1.0",
  "created_at": "2025-11-09T10:00:00Z",
  "G_1": {
    "generator_g_hex": "ç”Ÿæˆå…ƒgçš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²",
    "description": "G1 group generator"
  },
  "node_info": {
    "node_id": "storage_node_001",
    "location": "datacenter-1"
  }
}
```

### 2. public\_key.jsonï¼ˆç”±å®¢æˆ·ç«¯ç”Ÿæˆï¼‰

```json
{
  "version": "1.0",
  "created_at": "2025-11-09T10:30:00Z",
  "PK": "å…¬é’¥çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²",
  "node_info": {
    "client_id": "a1b2c3d4e5f6g7h8",
    "key_generated_at": "2025-11-09T10:30:00Z"
  }
}
```

### 3. insert.jsonï¼ˆä¾› Storage Node ä½¿ç”¨ï¼‰

```json
{
  "PK": "å®¢æˆ·ç«¯å…¬é’¥ï¼ˆä» public_key.json è¯»å–ï¼‰",
  "ID_F": "æ–‡ä»¶IDï¼ˆSHA256å“ˆå¸Œï¼Œ64å­—ç¬¦åå…­è¿›åˆ¶ï¼‰",
  "ptr": "æŒ‡é’ˆæ•°æ®ï¼ˆå¦‚éœ€è¦ï¼‰",
  "TS_F": [
    "è®¤è¯æ ‡ç­¾1ï¼ˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰",
    "è®¤è¯æ ‡ç­¾2",
    "..."
  ],
  "state": "valid",
  "keywords": [
    {
      "T_i": "æœç´¢ä»¤ç‰Œ Tiï¼ˆ64å­—ç¬¦åå…­è¿›åˆ¶ï¼‰",
      "kt_i": "å…³é”®è¯æ ‡ç­¾ kt^wiï¼ˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰"
    }
  ]
}
```

### 4. [filename]\_metadata.jsonï¼ˆæœ¬åœ°å…ƒæ•°æ®ï¼‰

```json
{
  "original_filename": "report.pdf",
  "encrypted_filename": "encrypted_report.enc",
  "file_id": "a3f5e8d2...",
  "file_size": 524288,
  "encryption_time": "2025-11-09T10:30:00Z",
  "keywords": ["confidential", "finance"],
  "states": {
    "confidential": {
      "current_state": "8a7f3e2d...",
      "previous_state": "7a6f2e1c..."
    }
  }
}
```

### 5. keyword\_states.jsonï¼ˆå…³é”®è¯çŠ¶æ€æ–‡ä»¶ï¼‰

```json
{
  "version": "1.0",
  "last_updated": "2025-11-09T14:30:00Z",
  "keywords": {
    "confidential": {
      "current_state": "8a7f3e2d...",
      "history": [
        {
          "state": "8a7f3e2d...",
          "file_id": "a3f5e8d2...",
          "timestamp": "2025-11-09T10:30:00Z",
          "is_current": true
        }
      ]
    }
  }
}
```

---

## ğŸ” å®‰å…¨æ€§è¯´æ˜

### åŠ å¯†ç®—æ³•


| ç»„ä»¶       | ç®—æ³•              | å®‰å…¨çº§åˆ« |
| ---------- | ----------------- | -------- |
| æ–‡ä»¶åŠ å¯†   | AES-256-CBC       | 256ä½    |
| å…³é”®è¯åŠ å¯† | AES-256-CBC       | 256ä½    |
| è®¤è¯æ ‡ç­¾   | é…å¯¹å¯†ç å­¦ï¼ˆPBCï¼‰ | 512ä½    |
| å“ˆå¸Œå‡½æ•°   | SHA-256           | 256ä½    |

### v3.3 ç®—æ³•æ­£ç¡®æ€§

* âœ… è®¤è¯æ ‡ç­¾ç”Ÿæˆå®Œå…¨æŒ‰ç…§è®ºæ–‡å…¬å¼å®ç°
* âœ… çŠ¶æ€å…³è”ä»¤ç‰Œç®—æ³•ä¿®æ­£
* âœ… æ”¯æŒå‰å‘å®‰å…¨çš„å¯æœç´¢åŠ å¯†
* âœ… æ‰€æœ‰è¾“å‡ºç¬¦åˆ Storage Node æ¥å£è§„èŒƒ

### å¯†é’¥ç®¡ç†å»ºè®®

**DOï¼ˆæ¨èï¼‰ï¼š**

* âœ… ç«‹å³å¤‡ä»½ `private_key.dat` åˆ°å¤šä¸ªå®‰å…¨ä½ç½®
* âœ… å¦¥å–„ä¿ç®¡ `public_key.json`ï¼ˆéœ€è¦å‘é€ç»™ Storage Nodeï¼‰
* âœ… ä½¿ç”¨å¼ºå¯†ç åŠ å¯†å­˜å‚¨å¯†é’¥æ–‡ä»¶
* âœ… å®šæœŸæµ‹è¯•å¯†é’¥å¤‡ä»½æ˜¯å¦å¯ç”¨
* âœ… å°†å¯†é’¥å­˜å‚¨åœ¨ç¦»çº¿è®¾å¤‡ï¼ˆUç›˜ã€ç¡¬ç›˜ï¼‰
* âœ… å¤‡ä»½ `system_params.json` å’Œ `public_params.json`

**DON'Tï¼ˆç¦æ­¢ï¼‰ï¼š**

* âŒ ä¸è¦å°†ç§é’¥æ–‡ä»¶å­˜å‚¨åœ¨äº‘ç«¯ï¼ˆé™¤éåŠ å¯†ï¼‰
* âŒ ä¸è¦é€šè¿‡é‚®ä»¶/èŠå¤©è½¯ä»¶å‘é€ç§é’¥
* âŒ ä¸è¦åœ¨å…¬å…±ç”µè„‘ä¸Šç”Ÿæˆæˆ–ä½¿ç”¨å¯†é’¥
* âŒ ä¸è¦å¿˜è®°å¤‡ä»½å¯†é’¥
* âŒ ä¸è¦éšæ„ä¿®æ”¹é…ç½®æ–‡ä»¶å‚æ•°

---

## ğŸ”¬ æŠ€æœ¯ç»†èŠ‚

### v3.3 ç®—æ³•å®ç°

#### 1. è®¤è¯æ ‡ç­¾ç”Ÿæˆ

```
å¯¹äºæ¯ä¸ª block i (å…± n ä¸ª blocks):
    1. è®¡ç®— H_2(ID_F||i)
    2. å°† block åˆ†ä¸º s ä¸ª sectors
    3. å¯¹äºæ¯ä¸ª sector j:
        - è·å–å¯†æ–‡å— c_{i,j}
        - è®¡ç®— Î¼^{c_{i,j}}
    4. ç´¯ä¹˜æ‰€æœ‰ sectors çš„ç»“æœ: âˆ_{j=1}^s Î¼^{c_{i,j}}
    5. ä¸ H_2(ID_F||i) ç›¸ä¹˜
    6. ç”¨ sk ç­¾å: Ïƒ_i = [ç»“æœ]^sk
```

#### 2. çŠ¶æ€å…³è”ä»¤ç‰Œç”Ÿæˆ

**æœ‰å‰ä¸€çŠ¶æ€çš„æƒ…å†µï¼š**

```
kt^{w_i} = [H_2(ID_F) * H_2(st_d||Ti) / H_2(st_{d-1}||Ti)]^{sk}
```

**ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆæ— å‰ä¸€çŠ¶æ€ï¼‰ï¼š**

```
kt^{w_i} = [H_2(ID_F) * H_2(st_d||Ti)]^{sk}
```

#### 3. æœç´¢ä»¤ç‰Œç”Ÿæˆ

```
Ti = H_3(H_1(mk || keyword))
```

### æ ¸å¿ƒç»„ä»¶

1. **é…å¯¹å¯†ç ç³»ç»Ÿ**
   * ä½¿ç”¨ PBC åº“
   * Type A æ›²çº¿
   * å¯é…ç½®å‚æ•°
   * 512ä½å®‰å…¨æ€§ï¼ˆé»˜è®¤ï¼‰
2. **å“ˆå¸Œå‡½æ•°**
   * H1: å­—ç¬¦ä¸² â†’ Zp
   * H2: å­—ç¬¦ä¸² â†’ G1
   * H3: å­—ç¬¦ä¸² â†’ å­—ç¬¦ä¸²ï¼ˆSHA-256ï¼‰
3. **å…³é”®è¯çŠ¶æ€é“¾**
   * æ¯ä¸ªå…³é”®è¯ç»´æŠ¤ä¸€ä¸ªçŠ¶æ€
   * çŠ¶æ€é€šè¿‡æŒ‡é’ˆè¿æ¥ï¼ˆå‰å‘å®‰å…¨ï¼‰
   * æ”¯æŒé«˜æ•ˆçš„å…³é”®è¯æœç´¢

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1ï¼šä¸¢å¤±ç§é’¥æ–‡ä»¶æ€ä¹ˆåŠï¼Ÿ

**Aï¼šæ— æ³•æ¢å¤ï¼** å¯†é’¥ä¸¢å¤±åï¼Œæ‰€æœ‰åŠ å¯†æ–‡ä»¶å°†æ°¸ä¹…æ— æ³•è§£å¯†ã€‚è¯·åŠ¡å¿…åšå¥½å¤‡ä»½ã€‚

### Q2ï¼šå¦‚ä½•è·å– public\_params.jsonï¼Ÿ

**Aï¼š** æ­¤æ–‡ä»¶ç”± Storage Node ç”Ÿæˆå¹¶æä¾›ã€‚è¯·è”ç³»æ‚¨çš„ Storage Node ç®¡ç†å‘˜è·å–ã€‚

### Q3ï¼šinsert.json æ˜¯åšä»€ä¹ˆç”¨çš„ï¼Ÿ

**Aï¼š** è¿™æ˜¯å‘é€ç»™ Storage Node çš„æ ‡å‡†åŒ–æ•°æ®æ–‡ä»¶ï¼ŒåŒ…å«æ–‡ä»¶IDã€è®¤è¯æ ‡ç­¾ã€å…³é”®è¯æ ‡ç­¾ç­‰ä¿¡æ¯ï¼ŒStorage Node ä¼šä½¿ç”¨è¿™äº›ä¿¡æ¯è¿›è¡Œå­˜å‚¨å’ŒéªŒè¯ã€‚

### Q4ï¼šä¸ºä»€ä¹ˆåˆ é™¤äº† search-token å‘½ä»¤ï¼Ÿ

**Aï¼š** æœç´¢ä»¤ç‰Œç°åœ¨åœ¨åŠ å¯†æ–‡ä»¶æ—¶è‡ªåŠ¨ç”Ÿæˆå¹¶åŒ…å«åœ¨ insert.json ä¸­ï¼Œä¸éœ€è¦å•ç‹¬ç”Ÿæˆã€‚

### Q5ï¼šv3.3 çš„ç®—æ³•ä¸ä¹‹å‰ç‰ˆæœ¬æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

**Aï¼š** v3.3 å®Œå…¨æŒ‰ç…§è®ºæ–‡å®ç°äº†è®¤è¯æ ‡ç­¾å’ŒçŠ¶æ€å…³è”ä»¤ç‰Œçš„ç®—æ³•ï¼Œä¿®æ­£äº†ä¹‹å‰ç‰ˆæœ¬çš„ç®€åŒ–å®ç°ï¼Œç¡®ä¿äº†ç®—æ³•çš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§ã€‚

### Q6ï¼šå¯ä»¥ç”¨æ—§ç‰ˆæœ¬çš„å¯†é’¥å—ï¼Ÿ

**Aï¼š** ä¸å»ºè®®ã€‚v3.3 çš„å¯†é’¥ç”Ÿæˆæ–¹å¼æœ‰æ‰€å˜åŒ–ï¼Œå»ºè®®é‡æ–°ç”Ÿæˆå¯†é’¥ã€‚

### Q7ï¼šå…ƒæ•°æ®æ–‡ä»¶ï¼ˆ.jsonï¼‰å¯ä»¥å…¬å¼€å—ï¼Ÿ

**Aï¼šä¸å»ºè®®ã€‚** è™½ç„¶å…ƒæ•°æ®ä¸åŒ…å«æ–‡ä»¶å†…å®¹ï¼Œä½†åŒ…å«å…³é”®è¯æ ‡ç­¾ä¿¡æ¯ï¼Œå¯èƒ½æ³„éœ²éšç§ã€‚

---

## ğŸ“Š æ€§èƒ½å‚æ•°


| é¡¹ç›®         | å‚æ•°                         |
| ------------ | ---------------------------- |
| å—å¤§å°       | 4096 å­—èŠ‚                    |
| æ‰‡åŒºå¤§å°     | 256 å­—èŠ‚                     |
| æ¯å—æ‰‡åŒºæ•°   | 16 ä¸ª                        |
| æœ€å¤§æ–‡ä»¶å¤§å° | ç†è®ºæ— é™åˆ¶ï¼ˆå—å­˜å‚¨ç©ºé—´é™åˆ¶ï¼‰ |
| åŠ å¯†é€Ÿåº¦     | \~50 MB/sï¼ˆå–å†³äºCPUæ€§èƒ½ï¼‰   |
| è§£å¯†é€Ÿåº¦     | \~50 MB/sï¼ˆå–å†³äºCPUæ€§èƒ½ï¼‰   |
| é…ç½®åŠ è½½æ—¶é—´ | <100ms                       |

---

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
project/
â”œâ”€â”€ client.h                 # å®¢æˆ·ç«¯å¤´æ–‡ä»¶ï¼ˆv3.3ä¿®æ”¹ï¼‰
â”œâ”€â”€ client.cpp               # å®¢æˆ·ç«¯å®ç°ï¼ˆv3.3å¤§å¹…ä¿®æ”¹ï¼‰
â”œâ”€â”€ main.cpp                 # ä¸»ç¨‹åºï¼ˆv3.3ä¿®æ”¹ï¼‰
â”œâ”€â”€ system_params.json       # ç³»ç»Ÿå‚æ•°é…ç½®
â”œâ”€â”€ public_params.json       # å…¬å…±å‚æ•°ï¼ˆStorage Nodeæä¾›ï¼‰â­ æ–°å¢
â”œâ”€â”€ CMakeLists.txt           # CMakeé…ç½®
â””â”€â”€ README.md                # æœ¬æ–‡ä»¶ï¼ˆv3.3æ›´æ–°ï¼‰
```

**è¿è¡Œæ—¶ç”Ÿæˆçš„æ–‡ä»¶ï¼š**

```
â”œâ”€â”€ private_key.dat          # ç§é’¥æ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶ï¼‰â­ æ–°å¢
â”œâ”€â”€ public_key.json          # å…¬é’¥æ–‡ä»¶ï¼ˆJSONï¼‰â­ æ–°å¢
â”œâ”€â”€ keyword_states.json      # å…³é”®è¯çŠ¶æ€æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ [prefix].enc             # åŠ å¯†æ–‡ä»¶
â”œâ”€â”€ insert.json              # Storage Nodeæ’å…¥æ•°æ® â­ æ–°å¢
â””â”€â”€ [filename]_metadata.json # æœ¬åœ°å…ƒæ•°æ® â­ æ–°å¢
```

---

## ğŸ”„ ä» v3.2 å‡çº§åˆ° v3.3

### è¿ç§»æ­¥éª¤

1. **å¤‡ä»½æ—§ç‰ˆæœ¬æ•°æ®**
   ```bash
   cp my_keys.dat my_keys_v32.dat.backup
   cp keyword_states.json keyword_states_v32.json.backup
   ```
2. **è·å– public\_params.json**
   * ä» Storage Node è·å–æ­¤æ–‡ä»¶
   * æ”¾åœ¨ç¨‹åºåŒç›®å½•ä¸‹
3. **é‡æ–°ç”Ÿæˆå¯†é’¥**
   ```bash
   ./storage_client
   > init
   > keygen
   ```
4. **é‡æ–°åŠ å¯†æ–‡ä»¶**
   * æ—§ç‰ˆæœ¬åŠ å¯†çš„æ–‡ä»¶å¯ä»¥ç”¨æ—§å¯†é’¥è§£å¯†
   * æ–°æ–‡ä»¶è¯·ä½¿ç”¨æ–°å¯†é’¥åŠ å¯†

### ä¸å…¼å®¹æ€§è¯´æ˜

* âŒ å¯†é’¥æ–‡ä»¶æ ¼å¼ä¸å…¼å®¹ï¼ˆéœ€è¦é‡æ–°ç”Ÿæˆï¼‰
* âœ… å…³é”®è¯çŠ¶æ€æ–‡ä»¶æ ¼å¼å…¼å®¹
* âœ… system\_params.json æ ¼å¼å…¼å®¹

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

---

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](https://78991718.4omini.xyz/chat/LICENSE) æ–‡ä»¶

---

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®åŸºäºä»¥ä¸‹ç ”ç©¶è®ºæ–‡ï¼š

**"Enabling Verifiable Search and Integrity Auditing in Encrypted Decentralized Storage Using One Proof"**
ä½œè€…ï¼šMingyang Song, Zhongyun Hua, et al.

ä½¿ç”¨çš„å¼€æºåº“ï¼š

* [PBC Library](https://crypto.stanford.edu/pbc/) - é…å¯¹å¯†ç å­¦
* [OpenSSL](https://www.openssl.org/) - åŠ å¯†ç®—æ³•
* [GMP](https://gmplib.org/) - å¤§æ•°è¿ç®—
* [JsonCpp](https://github.com/open-source-parsers/jsoncpp) - JSONè§£æ

---

## ğŸ“ æ”¯æŒ

* ğŸ“§ Email: support@example.com
* ğŸ› Issues: [GitHub Issues](https://github.com/your-repo/issues)
* ğŸ“– æ–‡æ¡£: [å®Œæ•´æ–‡æ¡£](https://docs.example.com/)

---

## ğŸ“‹ æ›´æ–°æ—¥å¿—

### v3.3.0 (2025-11-09)

* âœ¨ é‡å¤§æ›´æ–°ï¼šå®Œå…¨ç¬¦åˆ Storage Node æ¥å£è§„èŒƒ
* âœ¨ æ–°å¢ï¼šä» public\_params.json ç”Ÿæˆå¯†é’¥
* âœ¨ æ–°å¢ï¼šç”Ÿæˆ public\_key.json å’Œ private\_key.dat
* âœ¨ æ–°å¢ï¼šç”Ÿæˆæ ‡å‡†åŒ–çš„ insert.json
* âœ¨ æ–°å¢ï¼šç”Ÿæˆæœ¬åœ°å…ƒæ•°æ® JSON
* ğŸ”§ é‡å†™ï¼šgenerateAuthTags() ç®—æ³•ï¼ˆä¸¥æ ¼æŒ‰è®ºæ–‡å®ç°ï¼‰
* ğŸ”§ ä¿®æ­£ï¼šgenerateStateAssociatedToken() ç®—æ³•
* ğŸ”§ ç®€åŒ–ï¼šencryptKeyword() å‡½æ•°
* ğŸ”§ è°ƒæ•´ï¼šencryptPointer() é€»è¾‘
* âŒ åˆ é™¤ï¼šgenerateSearchToken() å‘½ä»¤ï¼ˆåŠŸèƒ½å·²æ•´åˆï¼‰
* ğŸ“– æ›´æ–°ï¼šå®Œæ•´çš„æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜

### v3.2.0 (2025-11-09)

* âœ¨ æ–°å¢ï¼šå…³é”®è¯çŠ¶æ€ç®¡ç†åŠŸèƒ½
* âœ¨ æ–°å¢ï¼šload-states, save-states, query-state å‘½ä»¤
* ğŸ”§ æ”¹è¿›ï¼šçŠ¶æ€æ–‡ä»¶ç‹¬ç«‹ç®¡ç†

### v3.1.0 (2025-11-08)

* âœ¨ æ–°å¢ï¼šJSONé…ç½®æ–‡ä»¶æ”¯æŒ
* ğŸ”§ æ”¹è¿›ï¼šç³»ç»Ÿå‚æ•°å¯é…ç½®åŒ–

### v3.0.0 (2025-11-01)

* ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ

---

## âš ï¸ å…è´£å£°æ˜

æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚ä½œè€…ä¸å¯¹ä½¿ç”¨æœ¬å·¥å…·é€ æˆçš„ä»»ä½•æ•°æ®ä¸¢å¤±æˆ–å®‰å…¨é—®é¢˜è´Ÿè´£ã€‚è¯·åŠ¡å¿…ï¼š

1. åœ¨é‡è¦æ–‡ä»¶åŠ å¯†å‰å…ˆå¤‡ä»½
2. å¦¥å–„ä¿ç®¡å¯†é’¥æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶
3. åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰å……åˆ†æµ‹è¯•
4. éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„
5. ç¡®ä¿ä»å¯ä¿¡æ¥æºè·å– public\_params.json

---

**ç‰ˆæœ¬**: 3.3.0
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ09æ—¥
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª âœ…
**Storage Node å…¼å®¹**: å®Œå…¨å…¼å®¹ âœ…

---

**Stay Secure! ğŸ”**

> åŸºäºå¯æœç´¢åŠ å¯†çš„æœ¬åœ°æ–‡ä»¶åŠ å¯†å·¥å…·ï¼Œæ”¯æŒå‰å‘å®‰å…¨æ€§å’Œå¯éªŒè¯æ€§
> **æ–°ç‰ˆæœ¬ç‰¹æ€§ï¼šæ”¯æŒJSONé…ç½®æ–‡ä»¶å¯¼å…¥ç³»ç»Ÿå‚æ•°**

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![C++](https://img.shields.io/badge/C++-14-blue.svg)](https://isocpp.org/)
[![Version](https://img.shields.io/badge/version-3.1-green.svg)](https://github.com/your-repo)

---

## ğŸ“– ç®€ä»‹

æœ¬å·¥å…·æ˜¯ä¸€ä¸ª**çº¯æœ¬åœ°è¿è¡Œ**çš„æ–‡ä»¶åŠ å¯†å·¥å…·ï¼Œä½¿ç”¨å†›äº‹çº§åŠ å¯†ç®—æ³•ï¼ˆAES-256-CBCï¼‰å’Œå¯æœç´¢åŠ å¯†æŠ€æœ¯ï¼Œè®©æ‚¨å¯ä»¥ï¼š

- ğŸ” åŠ å¯†æ–‡ä»¶å¹¶ç”Ÿæˆå…ƒæ•°æ®
- ğŸ” ä¸ºå…³é”®è¯ç”Ÿæˆæœç´¢ä»¤ç‰Œï¼ˆå‰å‘å®‰å…¨ï¼‰
- ğŸ”“ è§£å¯†æ–‡ä»¶
- ğŸ“‹ ç”Ÿæˆè®¤è¯æ ‡ç­¾ç”¨äºå®Œæ•´æ€§éªŒè¯

**æ ¸å¿ƒç‰¹æ€§ï¼š**

- âœ… å®Œå…¨æœ¬åœ°è¿è¡Œï¼Œæ— éœ€ç½‘ç»œ
- âœ… ä¸ä¾èµ–åŒºå—é“¾æˆ–å¤–éƒ¨æœåŠ¡
- âœ… å†›äº‹çº§åŠ å¯†ï¼ˆAES-256ï¼‰
- âœ… å¯æœç´¢åŠ å¯†ï¼ˆæ— éœ€è§£å¯†å³å¯æœç´¢ï¼‰
- âœ… å‰å‘å®‰å…¨æ€§ï¼ˆæ–°æ–‡ä»¶ä¸æ³„éœ²æ—§æœç´¢æ¨¡å¼ï¼‰
- âœ¨ **æ–°åŠŸèƒ½ï¼šJSONé…ç½®æ–‡ä»¶ç®¡ç†ç³»ç»Ÿå‚æ•°**

---

## ğŸ†• v3.1 ç‰ˆæœ¬æ›´æ–°

### ä¸»è¦å˜æ›´

- âœ¨ **é…ç½®æ–‡ä»¶å¯¼å…¥**ï¼šç³»ç»Ÿå‚æ•°ä¸å†ç¡¬ç¼–ç ï¼Œæ”¹ç”¨ `system_params.json` é…ç½®æ–‡ä»¶
- ğŸ”§ **çµæ´»é…ç½®**ï¼šæ”¯æŒä¸åŒå®‰å…¨çº§åˆ«å‚æ•°åˆ‡æ¢ï¼Œæ— éœ€é‡æ–°ç¼–è¯‘
- ğŸ“ **å‚æ•°ç®¡ç†**ï¼šç³»ç»Ÿå‚æ•°å¯è¿½è¸ªã€ç‰ˆæœ¬æ§åˆ¶
- ğŸ›¡ï¸ **å®‰å…¨æ€§æå‡**ï¼šæ–¹ä¾¿æ›´æ¢é…å¯¹å‚æ•°æå‡å®‰å…¨ç­‰çº§

### é…ç½®æ–‡ä»¶ç»“æ„

```json
{
  "pairing_type": "a",
  "parameters": {
    "q": "å¤§ç´ æ•°",
    "h": "å­ç¾¤é˜¶",
    "r": "é˜¶å‚æ•°",
    "exp2": "æŒ‡æ•°å‚æ•°2",
    "exp1": "æŒ‡æ•°å‚æ•°1",
    "sign1": "ç¬¦å·1",
    "sign0": "ç¬¦å·0"
  },
  "system_values": {
    "N": "ç³»ç»Ÿæ¨¡æ•°"
  },
  "security_level": "512-bit"
}
```

---

## ğŸ”§ å®‰è£…ä¾èµ–

### Ubuntu/Debian

```bash
sudo apt-get update
sudo apt-get install -y build-essential cmake
sudo apt-get install -y libssl-dev libgmp-dev libjsoncpp-dev libpbc-dev
```

### CentOS/RHEL

```bash
sudo yum install -y gcc-c++ cmake
sudo yum install -y openssl-devel gmp-devel jsoncpp-devel pbc-devel
```

---

## ğŸ—ï¸ ç¼–è¯‘

```bash
# åˆ›å»ºæ„å»ºç›®å½•
mkdir build && cd build

# é…ç½®
cmake ..

# ç¼–è¯‘
make -j4

# æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶
ls -lh storage_client
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‡†å¤‡å·¥ä½œ

**é‡è¦ï¼šåœ¨è¿è¡Œå‰ï¼Œè¯·ç¡®ä¿ `system_params.json` æ–‡ä»¶åœ¨å¯æ‰§è¡Œæ–‡ä»¶åŒç›®å½•ä¸‹ï¼**

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
ls -l system_params.json

# å¦‚æœä¸å­˜åœ¨ï¼Œè¯·ä»é¡¹ç›®ç›®å½•å¤åˆ¶
cp system_params.json /path/to/build/
```

### ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–ç³»ç»Ÿ

```bash
./storage_client
```

ç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹é…ç½®æ–‡ä»¶ï¼š

```
==================================================
  ğŸ” æœ¬åœ°åŠ å¯†å­˜å‚¨å·¥å…· - v3.1
  å¯éªŒè¯çš„å¯æœç´¢åŠ å¯†ç³»ç»Ÿï¼ˆæ”¯æŒJSONé…ç½®ï¼‰
==================================================

âœ… æ£€æµ‹åˆ°ç³»ç»Ÿå‚æ•°é…ç½®æ–‡ä»¶

=========================================
  æœ¬åœ°åŠ å¯†å­˜å‚¨å·¥å…· v3.1
=========================================
...
```

è¿è¡Œåˆå§‹åŒ–å‘½ä»¤ï¼š

```
ğŸ’» > init

âš™ï¸  åˆå§‹åŒ–åŠ å¯†ç³»ç»Ÿ...
ğŸ“„ ä½¿ç”¨é…ç½®æ–‡ä»¶: system_params.json
ğŸ’¡ æç¤º: è¯·ç¡®ä¿é…ç½®æ–‡ä»¶åœ¨ç¨‹åºåŒç›®å½•ä¸‹

åˆå§‹åŒ–å®¢æˆ·ç«¯...
ä»é…ç½®æ–‡ä»¶åŠ è½½ç³»ç»Ÿå‚æ•°...
âœ… ç³»ç»Ÿå‚æ•°åŠ è½½æˆåŠŸ
   é…å¯¹ç±»å‹: a
   å®‰å…¨çº§åˆ«: 512-bit
âœ… å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ
```

### ç¬¬äºŒæ­¥ï¼šç”Ÿæˆå¯†é’¥

```
ğŸ’» > keygen

ğŸ”‘ ç”Ÿæˆå¯†é’¥...
ç”Ÿæˆå®¢æˆ·ç«¯å¯†é’¥...
âœ… å¯†é’¥ç”ŸæˆæˆåŠŸ
ğŸ“Œ å…¬é’¥: 04a1b2c3d4e5f6789abcdef0123...
```

### ç¬¬ä¸‰æ­¥ï¼šä¿å­˜å¯†é’¥

```
ğŸ’» > save-keys

ğŸ’¾ è¾“å…¥å¯†é’¥æ–‡ä»¶è·¯å¾„: my_keys.dat
âœ… å¯†é’¥å·²ä¿å­˜åˆ°: my_keys.dat
```

**âš ï¸ é‡è¦ï¼šè¯·å¦¥å–„ä¿ç®¡å¯†é’¥æ–‡ä»¶ï¼ä¸¢å¤±å¯†é’¥å°†æ— æ³•è§£å¯†æ–‡ä»¶ï¼**

---

## ğŸ“š å®Œæ•´ä½¿ç”¨æ•™ç¨‹

### 1. åŠ å¯†æ–‡ä»¶

```
ğŸ’» > encrypt

ğŸ“„ è¾“å…¥æ–‡ä»¶è·¯å¾„: documents/report.pdf
ğŸ·ï¸  è¾“å…¥å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰: confidential, finance, Q4-2024
ğŸ’¾ è¾“å‡ºæ–‡ä»¶å‰ç¼€ï¼ˆå°†ç”Ÿæˆ .enc å’Œ .jsonï¼‰: encrypted_report

ğŸ” åŠ å¯†ä¸­...
åŠ å¯†æ–‡ä»¶: documents/report.pdf
æ–‡ä»¶å¤§å°: 524288 å­—èŠ‚
æ–‡ä»¶ID: a3f5e8d2b1c7a4f9e2d8c3b6a1f5e9d2...
ç”Ÿæˆäº† 128 ä¸ªè®¤è¯æ ‡ç­¾
ç”Ÿæˆäº† 3 ä¸ªå…³é”®è¯æ ‡ç­¾

âœ… æ–‡ä»¶åŠ å¯†æˆåŠŸï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¦ åŠ å¯†æ–‡ä»¶: encrypted_report.enc
ğŸ“‹ å…ƒæ•°æ®:   encrypted_report.json
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**è¾“å‡ºæ–‡ä»¶è¯´æ˜ï¼š**

- `encrypted_report.enc` - åŠ å¯†åçš„æ–‡ä»¶ï¼ˆåŒ…å«IVå’Œå¯†æ–‡ï¼‰
- `encrypted_report.json` - å…ƒæ•°æ®æ–‡ä»¶ï¼ˆæ–‡ä»¶IDã€è®¤è¯æ ‡ç­¾ã€å…³é”®è¯æ ‡ç­¾ï¼‰

### 2. è§£å¯†æ–‡ä»¶

```
ğŸ’» > decrypt

ğŸ“¥ è¾“å…¥åŠ å¯†æ–‡ä»¶è·¯å¾„: encrypted_report.enc
ğŸ’¾ è¾“å‡ºæ–‡ä»¶è·¯å¾„: decrypted_report.pdf

ğŸ”“ è§£å¯†ä¸­...
è§£å¯†æ–‡ä»¶: encrypted_report.enc
âœ… æ–‡ä»¶è§£å¯†æˆåŠŸ
ä¿å­˜åˆ°: decrypted_report.pdf
```

### 3. ç”Ÿæˆæœç´¢ä»¤ç‰Œ

```
ğŸ’» > search-token

ğŸ” è¾“å…¥å…³é”®è¯: confidential
ğŸ’¾ è¾“å‡ºJSONæ–‡ä»¶è·¯å¾„: search_confidential.json

ç”Ÿæˆæœç´¢ä»¤ç‰Œ: confidential
âœ… æœç´¢ä»¤ç‰Œå·²ç”Ÿæˆ
ä¿å­˜åˆ°: search_confidential.json
```

**æœç´¢ä»¤ç‰Œç”¨é€”ï¼š** å¯ç”¨äºåœ¨ä¸è§£å¯†æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œåœ¨å­˜å‚¨ç³»ç»Ÿä¸­æœç´¢åŒ…å«ç‰¹å®šå…³é”®è¯çš„æ–‡ä»¶ã€‚

### 4. åŠ è½½å·²æœ‰å¯†é’¥

```
ğŸ’» > load-keys

ğŸ“‚ è¾“å…¥å¯†é’¥æ–‡ä»¶è·¯å¾„: my_keys.dat
âœ… å¯†é’¥å·²ä» my_keys.dat åŠ è½½
```

---

## ğŸ“‹ å‘½ä»¤å‚è€ƒ


| å‘½ä»¤           | å¿«æ·é”® | åŠŸèƒ½                                 |
| -------------- | ------ | ------------------------------------ |
| `init`         | 1      | åˆå§‹åŒ–åŠ å¯†ç³»ç»Ÿï¼ˆä»JSONåŠ è½½é…å¯¹å‚æ•°ï¼‰ |
| `keygen`       | 2      | ç”Ÿæˆæ–°çš„åŠ å¯†å¯†é’¥                     |
| `save-keys`    | 3      | ä¿å­˜å¯†é’¥åˆ°æ–‡ä»¶                       |
| `load-keys`    | 4      | ä»æ–‡ä»¶åŠ è½½å¯†é’¥                       |
| `encrypt`      | 5      | åŠ å¯†æ–‡ä»¶å¹¶ç”Ÿæˆå…ƒæ•°æ®                 |
| `decrypt`      | 6      | è§£å¯†æ–‡ä»¶                             |
| `search-token` | 7      | ç”Ÿæˆæœç´¢ä»¤ç‰Œ                         |
| `help`         | 8      | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯                         |
| `quit`         | 9      | é€€å‡ºç¨‹åº                             |

---

## ğŸ“„ æ–‡ä»¶æ ¼å¼è¯´æ˜

### 1. ç³»ç»Ÿå‚æ•°é…ç½®æ–‡ä»¶ï¼ˆsystem_params.jsonï¼‰â­ æ–°å¢

è¿™æ˜¯v3.1ç‰ˆæœ¬æ–°å¢çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå¿…é¡»ä¸å¯æ‰§è¡Œæ–‡ä»¶åœ¨åŒä¸€ç›®å½•ã€‚

```json
{
  "pairing_type": "a",
  "parameters": {
    "q": "8780710799663312522437781984754049815806883199414208211028653399266475630880222957078625179422662221423155858769582317459277713367317481324925129998224791",
    "h": "12016012264891146079388821366740534204802954401251311822919615131047207289359704531102844802183906537786776",
    "r": "730750818665451621361119245571504901405976559617",
    "exp2": "159",
    "exp1": "107",
    "sign1": "1",
    "sign0": "1"
  },
  "system_values": {
    "N": "730750818665451621361119245571504901405976559617"
  },
  "description": "Type A pairing parameters for 512-bit security level",
  "security_level": "512-bit",
  "version": "1.0"
}
```

**å­—æ®µè¯´æ˜ï¼š**

- `pairing_type`: é…å¯¹ç±»å‹ï¼ˆType Aï¼‰
- `parameters`: é…å¯¹å¯†ç å­¦å‚æ•°ï¼ˆè§ä¸‹æ–‡è¯¦ç»†è§£é‡Šï¼‰
- `system_values`: ç³»ç»Ÿè¿ç®—å‚æ•°
- `security_level`: å®‰å…¨çº§åˆ«æ ‡è¯†

è¯¦ç»†çš„å‚æ•°è§£é‡Šè¯·å‚è§ [PARAMETERS.md](PARAMETERS.md) æ–‡ä»¶ã€‚

### 2. åŠ å¯†æ–‡ä»¶æ ¼å¼ï¼ˆ.encï¼‰

```
[16å­—èŠ‚ IV][AES-256-CBC åŠ å¯†æ•°æ®]
```

### 3. å…ƒæ•°æ®æ ¼å¼ï¼ˆ.jsonï¼‰

```json
{
  "file_id": "a3f5e8d2b1c7a4f9...",
  "original_filename": "report.pdf",
  "encrypted_filename": "encrypted_report.enc",
  "file_size": 524288,
  "timestamp": 1699459200,
  "keywords": ["confidential", "finance", "Q4-2024"],
  "auth_tags": [
    "tag_block_0_hex",
    "tag_block_1_hex",
    ...
  ],
  "keyword_tags": {
    "confidential": {
      "kt": "keyword_tag_hex",
      "state_token": "state_token_hex",
      "pointer": "pointer_hex",
      "current_state": "current_state_hex"
    },
    ...
  }
}
```

### 4. æœç´¢ä»¤ç‰Œæ ¼å¼ï¼ˆ.jsonï¼‰

```json
{
  "keyword": "confidential",
  "search_token": "encrypted_keyword_hex",
  "latest_state": "state_hex",
  "seed": "random_seed_hex",
  "timestamp": 1699459200
}
```

---

## ğŸ” å®‰å…¨æ€§è¯´æ˜

### åŠ å¯†ç®—æ³•


| ç»„ä»¶       | ç®—æ³•              | å®‰å…¨çº§åˆ« |
| ---------- | ----------------- | -------- |
| æ–‡ä»¶åŠ å¯†   | AES-256-CBC       | 256ä½    |
| å…³é”®è¯åŠ å¯† | AES-256-CBC       | 256ä½    |
| è®¤è¯æ ‡ç­¾   | é…å¯¹å¯†ç å­¦ï¼ˆPBCï¼‰ | 512ä½    |
| å“ˆå¸Œå‡½æ•°   | SHA-256           | 256ä½    |

### å‰å‘å®‰å…¨æ€§

æœ¬å·¥å…·å®ç°äº†**å‰å‘å®‰å…¨çš„å¯æœç´¢åŠ å¯†**ï¼š

- æ¯æ¬¡ä¸Šä¼ æ–°æ–‡ä»¶æ—¶ï¼Œå…³é”®è¯çŠ¶æ€ä¼šæ›´æ–°
- å³ä½¿è·å¾—å½“å‰æœç´¢ä»¤ç‰Œï¼Œä¹Ÿæ— æ³•æœç´¢å†å²æ–‡ä»¶
- ä¿æŠ¤ç”¨æˆ·çš„æœç´¢éšç§

### å¯†é’¥ç®¡ç†å»ºè®®

**DOï¼ˆæ¨èï¼‰ï¼š**

- âœ… ç«‹å³å¤‡ä»½å¯†é’¥æ–‡ä»¶åˆ°å¤šä¸ªå®‰å…¨ä½ç½®
- âœ… ä½¿ç”¨å¼ºå¯†ç åŠ å¯†å­˜å‚¨å¯†é’¥æ–‡ä»¶
- âœ… å®šæœŸæµ‹è¯•å¯†é’¥å¤‡ä»½æ˜¯å¦å¯ç”¨
- âœ… å°†å¯†é’¥å­˜å‚¨åœ¨ç¦»çº¿è®¾å¤‡ï¼ˆUç›˜ã€ç¡¬ç›˜ï¼‰
- âœ… å¦¥å–„ä¿ç®¡ `system_params.json` é…ç½®æ–‡ä»¶

**DON'Tï¼ˆç¦æ­¢ï¼‰ï¼š**

- âŒ ä¸è¦å°†å¯†é’¥æ–‡ä»¶å­˜å‚¨åœ¨äº‘ç«¯ï¼ˆé™¤éåŠ å¯†ï¼‰
- âŒ ä¸è¦é€šè¿‡é‚®ä»¶/èŠå¤©è½¯ä»¶å‘é€å¯†é’¥
- âŒ ä¸è¦åœ¨å…¬å…±ç”µè„‘ä¸Šç”Ÿæˆæˆ–ä½¿ç”¨å¯†é’¥
- âŒ ä¸è¦å¿˜è®°å¤‡ä»½å¯†é’¥
- âŒ ä¸è¦éšæ„ä¿®æ”¹é…ç½®æ–‡ä»¶å‚æ•°ï¼ˆé™¤éç†è§£å…¶å«ä¹‰ï¼‰

---

## ğŸ”§ é…ç½®æ–‡ä»¶ç®¡ç†

### æ›´æ¢ç³»ç»Ÿå‚æ•°

å¦‚éœ€æ›´æ¢æ›´é«˜å®‰å…¨çº§åˆ«çš„å‚æ•°ï¼š

1. **å¤‡ä»½å½“å‰é…ç½®**

   ```bash
   cp system_params.json system_params_backup.json
   ```
2. **ç¼–è¾‘é…ç½®æ–‡ä»¶**

   ```bash
   nano system_params.json
   ```
3. **é‡æ–°åˆå§‹åŒ–ç³»ç»Ÿ**

   ```bash
   ./storage_client
   > init
   ```

### å¤šç¯å¢ƒé…ç½®

å¯ä»¥åˆ›å»ºå¤šä¸ªé…ç½®æ–‡ä»¶ç”¨äºä¸åŒç¯å¢ƒï¼š

```bash
# å¼€å‘ç¯å¢ƒï¼ˆè¾ƒä½å®‰å…¨çº§åˆ«ï¼Œå¿«é€Ÿæµ‹è¯•ï¼‰
system_params_dev.json

# ç”Ÿäº§ç¯å¢ƒï¼ˆé«˜å®‰å…¨çº§åˆ«ï¼‰
system_params_prod.json

# ä½¿ç”¨æ—¶é‡å‘½å
cp system_params_prod.json system_params.json
```

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1ï¼šä¸¢å¤±å¯†é’¥æ–‡ä»¶æ€ä¹ˆåŠï¼Ÿ

**Aï¼šæ— æ³•æ¢å¤ï¼** å¯†é’¥ä¸¢å¤±åï¼Œæ‰€æœ‰åŠ å¯†æ–‡ä»¶å°†æ°¸ä¹…æ— æ³•è§£å¯†ã€‚è¯·åŠ¡å¿…åšå¥½å¤‡ä»½ã€‚

### Q2ï¼šä¸¢å¤± system_params.json æ€ä¹ˆåŠï¼Ÿ

**Aï¼š** å¯ä»¥ä»é¡¹ç›®æºç æˆ–å…¶ä»–å·²éƒ¨ç½²çš„å®ä¾‹å¤åˆ¶è¯¥æ–‡ä»¶ã€‚å‚æ•°æ˜¯å…¬å¼€çš„ï¼Œä¸å½±å“å®‰å…¨æ€§ã€‚ä½†å¦‚æœå‚æ•°ä¸ä¸€è‡´ï¼Œå°†æ— æ³•æ­£ç¡®éªŒè¯æ–‡ä»¶ã€‚

### Q3ï¼šå¯ä»¥ä¿®æ”¹å·²åŠ å¯†æ–‡ä»¶çš„å…³é”®è¯å—ï¼Ÿ

**Aï¼šä¸å¯ä»¥ã€‚** å…³é”®è¯åœ¨åŠ å¯†æ—¶å°±å·²å›ºå®šã€‚å¦‚éœ€ä¿®æ”¹ï¼Œè¯·å…ˆè§£å¯†ï¼Œç„¶åç”¨æ–°å…³é”®è¯é‡æ–°åŠ å¯†ã€‚

### Q4ï¼šåˆå§‹åŒ–å¤±è´¥ï¼šæ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶

**Aï¼š** è¯·ç¡®ä¿ `system_params.json` ä¸å¯æ‰§è¡Œæ–‡ä»¶åœ¨åŒä¸€ç›®å½•ã€‚æ£€æŸ¥æ–‡ä»¶åæ‹¼å†™æ˜¯å¦æ­£ç¡®ã€‚

### Q5ï¼šå¯ä»¥è‡ªå®šä¹‰ç³»ç»Ÿå‚æ•°å—ï¼Ÿ

**Aï¼š** å¯ä»¥ï¼Œä½†éœ€è¦æ·±å…¥ç†è§£é…å¯¹å¯†ç å­¦ã€‚å»ºè®®ä½¿ç”¨é»˜è®¤å‚æ•°æˆ–å’¨è¯¢å¯†ç å­¦ä¸“å®¶ã€‚é”™è¯¯çš„å‚æ•°å¯èƒ½å¯¼è‡´å®‰å…¨æ€§é™ä½ã€‚

### Q6ï¼šå…ƒæ•°æ®æ–‡ä»¶ï¼ˆ.jsonï¼‰å¯ä»¥å…¬å¼€å—ï¼Ÿ

**Aï¼šä¸å»ºè®®ã€‚** è™½ç„¶å…ƒæ•°æ®ä¸åŒ…å«æ–‡ä»¶å†…å®¹ï¼Œä½†åŒ…å«å…³é”®è¯æ ‡ç­¾ä¿¡æ¯ï¼Œå¯èƒ½æ³„éœ²éšç§ã€‚

### Q7ï¼šå¦‚ä½•éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ï¼Ÿ

**Aï¼š** å…ƒæ•°æ®ä¸­çš„ `auth_tags` ç”¨äºå®Œæ•´æ€§éªŒè¯ã€‚å¯ä»¥å¼€å‘éªŒè¯å·¥å…·æ¥æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¢«ç¯¡æ”¹ã€‚

### Q8ï¼šæ”¯æŒæ‰¹é‡åŠ å¯†å—ï¼Ÿ

**Aï¼š** å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒã€‚å¯ä»¥ç¼–å†™è„šæœ¬å¾ªç¯è°ƒç”¨ `encrypt` å‘½ä»¤ã€‚

---

## ğŸ“Š æ€§èƒ½å‚æ•°


| é¡¹ç›®         | å‚æ•°                         |
| ------------ | ---------------------------- |
| å—å¤§å°       | 4096 å­—èŠ‚                    |
| æ‰‡åŒºå¤§å°     | 256 å­—èŠ‚                     |
| æœ€å¤§æ–‡ä»¶å¤§å° | ç†è®ºæ— é™åˆ¶ï¼ˆå—å­˜å‚¨ç©ºé—´é™åˆ¶ï¼‰ |
| åŠ å¯†é€Ÿåº¦     | ~50 MB/sï¼ˆå–å†³äºCPUæ€§èƒ½ï¼‰    |
| è§£å¯†é€Ÿåº¦     | ~50 MB/sï¼ˆå–å†³äºCPUæ€§èƒ½ï¼‰    |
| é…ç½®åŠ è½½æ—¶é—´ | <100ms                       |

---

## ğŸ”¬ æŠ€æœ¯ç»†èŠ‚

### ç³»ç»Ÿæ¶æ„

```
ç³»ç»Ÿå¯åŠ¨
   â†“
åŠ è½½ system_params.json
   â†“
åˆå§‹åŒ–é…å¯¹å¯†ç ç³»ç»Ÿ
   â†“
ç”¨æˆ·æ–‡ä»¶
   â†“
AES-256-CBC åŠ å¯†
   â†“
åˆ†å—ï¼ˆ4KB/å—ï¼‰
   â†“
ç”Ÿæˆè®¤è¯æ ‡ç­¾ï¼ˆé…å¯¹å¯†ç å­¦ï¼‰
   â†“
ç”Ÿæˆå…³é”®è¯æ ‡ç­¾ï¼ˆå¯æœç´¢åŠ å¯†ï¼‰
   â†“
è¾“å‡ºï¼š.enc + .json
```

### æ ¸å¿ƒç»„ä»¶

1. **é…ç½®ç®¡ç†ï¼ˆæ–°å¢ï¼‰**

   - JSONè§£æä¸éªŒè¯
   - å‚æ•°åŠ¨æ€åŠ è½½
   - é”™è¯¯å¤„ç†ä¸æç¤º
2. **é…å¯¹å¯†ç ç³»ç»Ÿ**

   - ä½¿ç”¨ PBC åº“
   - Type A æ›²çº¿
   - å¯é…ç½®å‚æ•°
   - 512ä½å®‰å…¨æ€§ï¼ˆé»˜è®¤ï¼‰
3. **å“ˆå¸Œå‡½æ•°**

   - H1: å­—ç¬¦ä¸² â†’ Zp
   - H2: å­—ç¬¦ä¸² â†’ G1
   - H3: å­—ç¬¦ä¸² â†’ å­—ç¬¦ä¸²ï¼ˆSHA-256ï¼‰
4. **å…³é”®è¯çŠ¶æ€é“¾**

   - æ¯ä¸ªå…³é”®è¯ç»´æŠ¤ä¸€ä¸ªçŠ¶æ€
   - çŠ¶æ€é€šè¿‡æŒ‡é’ˆè¿æ¥ï¼ˆå‰å‘å®‰å…¨ï¼‰
   - æ”¯æŒé«˜æ•ˆçš„å…³é”®è¯æœç´¢

---

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
project/
â”œâ”€â”€ client.h              # å®¢æˆ·ç«¯å¤´æ–‡ä»¶
â”œâ”€â”€ client.cpp            # å®¢æˆ·ç«¯å®ç°
â”œâ”€â”€ main.cpp              # ä¸»ç¨‹åº
â”œâ”€â”€ system_params.json    # ç³»ç»Ÿå‚æ•°é…ç½® â­ å¿…éœ€
â”œâ”€â”€ PARAMETERS.md         # å‚æ•°è¯¦ç»†è¯´æ˜ â­ æ–°å¢
â”œâ”€â”€ CMakeLists.txt        # CMakeé…ç½®
â””â”€â”€ README.md             # æœ¬æ–‡ä»¶
```

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

---

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®åŸºäºä»¥ä¸‹ç ”ç©¶è®ºæ–‡ï¼š

**"Enabling Verifiable Search and Integrity Auditing in Encrypted Decentralized Storage Using One Proof"**
ä½œè€…ï¼šMingyang Song, Zhongyun Hua, et al.

ä½¿ç”¨çš„å¼€æºåº“ï¼š

- [PBC Library](https://crypto.stanford.edu/pbc/) - é…å¯¹å¯†ç å­¦
- [OpenSSL](https://www.openssl.org/) - åŠ å¯†ç®—æ³•
- [GMP](https://gmplib.org/) - å¤§æ•°è¿ç®—
- [JsonCpp](https://github.com/open-source-parsers/jsoncpp) - JSONè§£æ

---

## ğŸ“ æ”¯æŒ

- ğŸ“§ Email: support@example.com
- ğŸ› Issues: [GitHub Issues](https://github.com/your-repo/issues)
- ğŸ“– æ–‡æ¡£: [å®Œæ•´æ–‡æ¡£](https://docs.example.com)

---

## ğŸ“‹ æ›´æ–°æ—¥å¿—

### v3.1.0 (2025-11-08)

- âœ¨ æ–°å¢ï¼šJSONé…ç½®æ–‡ä»¶æ”¯æŒ
- ğŸ”§ æ”¹è¿›ï¼šç³»ç»Ÿå‚æ•°å¯é…ç½®åŒ–
- ğŸ“ æ–°å¢ï¼šPARAMETERS.md å‚æ•°è¯´æ˜æ–‡æ¡£
- ğŸ› ä¿®å¤ï¼šé…ç½®æ–‡ä»¶ç¼ºå¤±æ—¶çš„é”™è¯¯æç¤º
- ğŸ“– æ›´æ–°ï¼šREADMEæ–‡æ¡£

### v3.0.0 (2025-11-01)

- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… åŸºæœ¬åŠ å¯†è§£å¯†åŠŸèƒ½
- âœ… å¯æœç´¢åŠ å¯†
- âœ… å‰å‘å®‰å…¨æ€§

---

## âš ï¸ å…è´£å£°æ˜

æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚ä½œè€…ä¸å¯¹ä½¿ç”¨æœ¬å·¥å…·é€ æˆçš„ä»»ä½•æ•°æ®ä¸¢å¤±æˆ–å®‰å…¨é—®é¢˜è´Ÿè´£ã€‚è¯·åŠ¡å¿…ï¼š

1. åœ¨é‡è¦æ–‡ä»¶åŠ å¯†å‰å…ˆå¤‡ä»½
2. å¦¥å–„ä¿ç®¡å¯†é’¥æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶
3. åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰å……åˆ†æµ‹è¯•
4. éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„
5. ä¸è¦éšæ„ä¿®æ”¹é…ç½®å‚æ•°ï¼ˆé™¤éç†è§£å…¶å«ä¹‰ï¼‰

---

**ç‰ˆæœ¬**: 3.1.0
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ08æ—¥
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª âœ…
**é…ç½®æ–¹å¼**: JSONå¯¼å…¥ ğŸ†•

---

**Stay Secure! ğŸ”**

# ç‰ˆæœ¬æ›´æ–°è¯´æ˜ - v3.2

## ğŸ‰ æ›´æ–°æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸º v3.1 ç‰ˆæœ¬å¢åŠ äº†**å…³é”®è¯çŠ¶æ€ç®¡ç†åŠŸèƒ½**ï¼Œå‡çº§è‡³ v3.2ã€‚

---

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. å…³é”®è¯çŠ¶æ€æ–‡ä»¶ç®¡ç†

- æ–°å¢ `keyword_states.json` æ–‡ä»¶ï¼Œç‹¬ç«‹ç®¡ç†æ‰€æœ‰å…³é”®è¯çš„å†å²çŠ¶æ€
- ä¸å¯†é’¥æ–‡ä»¶åˆ†ç¦»ï¼Œä¾¿äºå¤‡ä»½å’Œç‰ˆæœ¬æ§åˆ¶
- æ”¯æŒæ‰‹åŠ¨åŠ è½½ã€ä¿å­˜å’ŒæŸ¥è¯¢

### 2. æ–°å¢å‘½ä»¤


| å‘½ä»¤          | å¿«æ·é”® | åŠŸèƒ½                     |
| ------------- | ------ | ------------------------ |
| `load-states` | 10     | åŠ è½½å…³é”®è¯çŠ¶æ€æ–‡ä»¶       |
| `save-states` | 11     | ä¿å­˜å…³é”®è¯çŠ¶æ€æ–‡ä»¶       |
| `query-state` | 12     | æŸ¥è¯¢å…³é”®è¯å½“å‰çŠ¶æ€å’Œå†å² |

### 3. è‡ªåŠ¨çŠ¶æ€æ›´æ–°

- åŠ å¯†æ–‡ä»¶æ—¶ï¼Œå¦‚æœå·²åŠ è½½çŠ¶æ€æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨æ›´æ–°çŠ¶æ€å¹¶ä¿å­˜
- æ— éœ€æ‰‹åŠ¨æ“ä½œï¼Œæå‡ä½¿ç”¨ä¾¿åˆ©æ€§

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶

1. **client.h**

   - æ–°å¢å‡½æ•°å£°æ˜ï¼š
     - `loadKeywordStates()`
     - `saveKeywordStates()`
     - `updateKeywordState()`
     - `queryKeywordState()`
     - `getCurrentTimestamp()` (è¾…åŠ©å‡½æ•°)
   - æ–°å¢æˆå‘˜å˜é‡ï¼š
     - `keyword_states_file_` - çŠ¶æ€æ–‡ä»¶è·¯å¾„
     - `states_loaded_` - åŠ è½½æ ‡è®°
     - `keyword_states_data_` - JSONæ•°æ®å­˜å‚¨
2. **client.cpp**

   - å®ç°æ‰€æœ‰æ–°å¢å‡½æ•°
   - ä¿®æ”¹ `encryptFile()` å‡½æ•°ï¼Œæ·»åŠ è‡ªåŠ¨çŠ¶æ€æ›´æ–°é€»è¾‘
   - ä¿®æ”¹æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ– `states_loaded_ = false`
3. **main.cpp**

   - æ·»åŠ ä¸‰ä¸ªæ–°å‘½ä»¤çš„å¤„ç†é€»è¾‘
   - æ›´æ–°å¸®åŠ©èœå•æ˜¾ç¤º
   - æ›´æ–°ç‰ˆæœ¬å·ä¸º v3.2
   - æ·»åŠ çŠ¶æ€ç®¡ç†æç¤ºä¿¡æ¯

---

## ğŸ“¦ æ–°å¢æ–‡ä»¶

1. **keyword_states_example.json** - ç¤ºä¾‹çŠ¶æ€æ–‡ä»¶
2. **KEYWORD_STATES_USAGE.md** - è¯¦ç»†ä½¿ç”¨è¯´æ˜æ–‡æ¡£

---

## ğŸ”„ å·¥ä½œæµç¨‹å˜åŒ–

### ä¹‹å‰çš„æµç¨‹ (v3.1)

```
init â†’ keygen â†’ encrypt â†’ encrypt â†’ ...
```

### ç°åœ¨çš„æµç¨‹ (v3.2)

```
init â†’ keygen â†’ load-states â†’ encrypt â†’ encrypt â†’ ...
                  â†‘                â†“
                  â””â”€â”€â”€ è‡ªåŠ¨æ›´æ–° â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### å¿«é€Ÿå¼€å§‹

```bash
# 1. åˆå§‹åŒ–ç³»ç»Ÿ
./storage_client
ğŸ’» > init
ğŸ’» > keygen
ğŸ’» > save-keys
è¾“å…¥å¯†é’¥æ–‡ä»¶è·¯å¾„: my_keys.dat

# 2. é¦–æ¬¡åŠ å¯†ï¼ˆå¦‚æœçŠ¶æ€æ–‡ä»¶ä¸å­˜åœ¨ï¼‰
ğŸ’» > encrypt
# ... è¾“å…¥æ–‡ä»¶å’Œå…³é”®è¯ ...

# 3. ä¿å­˜çŠ¶æ€æ–‡ä»¶
ğŸ’» > save-states
è¾“å…¥ä¿å­˜è·¯å¾„: keyword_states.json

# 4. ä¸‹æ¬¡ä½¿ç”¨æ—¶å…ˆåŠ è½½çŠ¶æ€
ğŸ’» > load-keys
è¾“å…¥å¯†é’¥æ–‡ä»¶è·¯å¾„: my_keys.dat

ğŸ’» > load-states
è¾“å…¥çŠ¶æ€æ–‡ä»¶è·¯å¾„: keyword_states.json

# 5. æŸ¥è¯¢å…³é”®è¯çŠ¶æ€
ğŸ’» > query-state
è¾“å…¥è¦æŸ¥è¯¢çš„å…³é”®è¯: confidential

# 6. ç»§ç»­åŠ å¯†ï¼ˆè‡ªåŠ¨æ›´æ–°çŠ¶æ€ï¼‰
ğŸ’» > encrypt
# çŠ¶æ€ä¼šè‡ªåŠ¨æ›´æ–°åˆ° keyword_states.json
```

---

## ğŸ” çŠ¶æ€æ–‡ä»¶æ ¼å¼

```json
{
  "version": "1.0",
  "last_updated": "2025-11-09T14:30:00",
  "keywords": {
    "å…³é”®è¯å": {
      "current_state": "å½“å‰çŠ¶æ€å€¼ï¼ˆ64å­—ç¬¦åå…­è¿›åˆ¶ï¼‰",
      "history": [
        {
          "state": "å†å²çŠ¶æ€å€¼",
          "file_id": "å…³è”çš„æ–‡ä»¶ID",
          "timestamp": "ISO 8601æ—¶é—´æˆ³",
          "is_current": true/false
        }
      ]
    }
  }
}
```

---

## âš ï¸ é‡è¦æç¤º

### çŠ¶æ€æ–‡ä»¶çš„ä½œç”¨

- **è®°å½•å…³é”®è¯æ¼”åŒ–**ï¼šæ¯ä¸ªå…³é”®è¯çš„æ‰€æœ‰å†å²çŠ¶æ€
- **æ”¯æŒå‰å‘å®‰å…¨**ï¼šä¿è¯æœç´¢ä»¤ç‰Œçš„æœ‰æ•ˆæ€§
- **å®¡è®¡è¿½è¸ª**ï¼šå¯è¿½æº¯æ¯ä¸ªå…³é”®è¯çš„ä½¿ç”¨å†å²

### æ³¨æ„äº‹é¡¹

1. âœ… çŠ¶æ€æ–‡ä»¶å¯ä»¥ä¸å¤šäººå…±äº«ï¼ˆä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
2. âœ… å»ºè®®å®šæœŸå¤‡ä»½çŠ¶æ€æ–‡ä»¶
3. âš ï¸ çŠ¶æ€æ–‡ä»¶ä¸¢å¤±ä¸å½±å“è§£å¯†ï¼Œä½†ä¼šä¸¢å¤±å†å²è®°å½•
4. âš ï¸ å¤šå°æœºå™¨åŒæ—¶ä¿®æ”¹åŒä¸€çŠ¶æ€æ–‡ä»¶å¯èƒ½å¯¼è‡´å†²çª

---

## ğŸ†š ä¸ v3.1 çš„åŒºåˆ«


| ç‰¹æ€§     | v3.1           | v3.2           |
| -------- | -------------- | -------------- |
| çŠ¶æ€å­˜å‚¨ | ä»…åœ¨å¯†é’¥æ–‡ä»¶ä¸­ | ç‹¬ç«‹çš„JSONæ–‡ä»¶ |
| å†å²è®°å½• | æ—              | å®Œæ•´çš„çŠ¶æ€å†å² |
| çŠ¶æ€æŸ¥è¯¢ | ä¸æ”¯æŒ         | æ”¯æŒæŸ¥è¯¢å’Œæ˜¾ç¤º |
| çŠ¶æ€ç®¡ç† | è‡ªåŠ¨ï¼ˆä¸å¯è§ï¼‰ | æ‰‹åŠ¨+è‡ªåŠ¨ç»“åˆ  |
| æ–‡ä»¶æ ¼å¼ | äºŒè¿›åˆ¶         | JSONï¼ˆå¯è¯»ï¼‰   |

---

## ğŸ“– è¯¦ç»†æ–‡æ¡£

å®Œæ•´çš„ä½¿ç”¨è¯´æ˜è¯·æŸ¥çœ‹ï¼š**KEYWORD_STATES_USAGE.md**

---

## ğŸ”§ ç¼–è¯‘è¯´æ˜

ç¼–è¯‘æ–¹å¼ä¸ v3.1 ç›¸åŒï¼Œæ— éœ€é¢å¤–ä¾èµ–ï¼š

```bash
mkdir build && cd build
cmake ..
make -j4
```

---

## ğŸ› å·²çŸ¥é—®é¢˜

æ— 

---

## ğŸš€ åç»­è®¡åˆ’

å¯èƒ½çš„å¢å¼ºåŠŸèƒ½ï¼š

- [ ]  çŠ¶æ€æ–‡ä»¶åŠ å¯†
- [ ]  æ‰¹é‡å¯¼å…¥/å¯¼å‡ºå…³é”®è¯
- [ ]  çŠ¶æ€å†²çªè‡ªåŠ¨åˆå¹¶
- [ ]  Webç•Œé¢å¯è§†åŒ–ç®¡ç†

---

## ğŸ“ åé¦ˆä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘è€…ã€‚

---

**ç‰ˆæœ¬**: 3.2
**å‘å¸ƒæ—¥æœŸ**: 2025-11-09
**å…¼å®¹æ€§**: å‘åå…¼å®¹ v3.1 çš„æ‰€æœ‰åŠŸèƒ½

# å®¢æˆ·ç«¯ä¿®å¤æ–‡ä»¶åŒ… v4.0.1

## ğŸ“¦ æ–‡ä»¶æ¸…å•

æœ¬ä¿®å¤åŒ…åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

1. **client.cpp** (41 KB) - ä¿®å¤åçš„å®¢æˆ·ç«¯å®ç°æ–‡ä»¶
2. **client.h** (9.7 KB) - å®¢æˆ·ç«¯å¤´æ–‡ä»¶ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰
3. **ä¿®å¤æŠ¥å‘Š.md** - è¯¦ç»†çš„ä¿®å¤æŠ€æœ¯æŠ¥å‘Š
4. **ä¿®æ”¹å¯¹æ¯”.md** - ä¿®æ”¹å‰åçš„ä»£ç å¯¹æ¯”
5. **ä¿®æ”¹æ‘˜è¦.txt** - å¿«é€Ÿä¿®æ”¹è¯´æ˜
6. **README.md** - æœ¬æ–‡ä»¶

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å¤‡ä»½åŸæ–‡ä»¶

```bash
# å¤‡ä»½æ‚¨çš„åŸå§‹æ–‡ä»¶
cp client.cpp client.cpp.bak
cp client.h client.h.bak
```

### æ­¥éª¤ 2: æ›¿æ¢æ–‡ä»¶

```bash
# ç”¨ä¿®å¤åçš„æ–‡ä»¶æ›¿æ¢åŸæ–‡ä»¶
cp ä¸‹è½½ç›®å½•/client.cpp ./
cp ä¸‹è½½ç›®å½•/client.h ./
```

### æ­¥éª¤ 3: é‡æ–°ç¼–è¯‘

```bash
g++ -o client client.cpp -lpbc -lgmp -lcrypto -ljsoncpp -std=c++17
```

### æ­¥éª¤ 4: æµ‹è¯•

```bash
./client
# é€‰æ‹©åˆå§‹åŒ–é€‰é¡¹ï¼Œä½¿ç”¨ public_params.json
```

---

## âœ… ä¿®å¤å†…å®¹æ¦‚è¿°

æœ¬æ¬¡ä¿®å¤è§£å†³äº†ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š

### é—®é¢˜ 1: é…å¯¹å‚æ•°ä¸ä¸€è‡´

* **ç—‡çŠ¶**: å®¢æˆ·ç«¯æ— æ³•åŠ è½½ `g` å‚æ•°ï¼ŒæŠ¥é”™ `[é”™è¯¯] g ååºåˆ—åŒ–å¤±è´¥`
* **åŸå› **: å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨äº†ä¸åŒçš„é…å¯¹å‚æ•°
* **ä¿®å¤**: ç»Ÿä¸€é…å¯¹å‚æ•°ï¼Œç‰¹åˆ«æ˜¯ `h` å€¼å’Œ `sign0` å€¼

### é—®é¢˜ 2: element\_from\_bytes è¿”å›å€¼æ£€æŸ¥é”™è¯¯

* **ç—‡çŠ¶**: æ‰€æœ‰å‚æ•°ååºåˆ—åŒ–éƒ½å¤±è´¥
* **åŸå› **: é”™è¯¯ç†è§£å‡½æ•°è¿”å›å€¼ï¼ˆæˆåŠŸè¿”å›æ­£æ•´æ•°ï¼Œå¤±è´¥è¿”å› â‰¤0ï¼‰
* **ä¿®å¤**: æ›´æ­£æ£€æŸ¥é€»è¾‘ä» `!= 0` æ”¹ä¸º `<= 0`

---

## ğŸ“‹ é¢„æœŸæµ‹è¯•ç»“æœ

ä¿®å¤åï¼Œåˆå§‹åŒ–åº”è¯¥æ˜¾ç¤ºï¼š

```
[åˆå§‹åŒ–] æ­¥éª¤1: åŠ è½½é…å¯¹å‚æ•°ï¼ˆType Aæ›²çº¿ï¼Œ1024ä½å®‰å…¨çº§åˆ«ï¼‰
[æˆåŠŸ] é…å¯¹å‚æ•°åŠ è½½å®Œæˆ
[åˆå§‹åŒ–] æ­¥éª¤2: ä» public_params.json åŠ è½½å…¬å…±å‚æ•°
[è§£æ] æ£€æµ‹åˆ°åµŒå¥—çš„ public_params å¯¹è±¡
[ä¿¡æ¯] å‚æ•°æ–‡ä»¶ç‰ˆæœ¬: 2.0
[ä¿¡æ¯] åˆ›å»ºæ—¶é—´: 2025-11-10T11:24:53Z
[è­¦å‘Š] N çš„ä½æ•°è¿‡å°(1023ä½)ï¼Œå»ºè®®è‡³å°‘2048ä½
[æˆåŠŸ] N åŠ è½½å®Œæˆ (1023 ä½)
[æˆåŠŸ] g åŠ è½½å®Œæˆ  âœ… å…³é”®ä¿®å¤ï¼šè¿™é‡Œåº”è¯¥æˆåŠŸï¼
[æˆåŠŸ] Î¼ åŠ è½½å®Œæˆ
[å®Œæˆ] å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ
```

---

## ğŸ” è¯¦ç»†æ–‡æ¡£

æƒ³è¦äº†è§£æ›´å¤šæŠ€æœ¯ç»†èŠ‚ï¼Ÿè¯·æŸ¥çœ‹ï¼š

* **ä¿®å¤æŠ¥å‘Š.md** - å®Œæ•´çš„æŠ€æœ¯åˆ†æå’Œä¿®å¤è¯´æ˜
* **ä¿®æ”¹å¯¹æ¯”.md** - ä¿®æ”¹å‰åçš„ä»£ç å¯¹æ¯”
* **ä¿®æ”¹æ‘˜è¦.txt** - å¿«é€Ÿäº†è§£æ”¹åŠ¨å†…å®¹

---

## âš ï¸ é‡è¦æç¤º

### 1. é…å¯¹å‚æ•°ä¸€è‡´æ€§

å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯**å¿…é¡»**ä½¿ç”¨ç›¸åŒçš„é…å¯¹å‚æ•°ã€‚å¦‚æœæœåŠ¡ç«¯æ›´æ–°äº†å‚æ•°ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¿…é¡»åŒæ­¥æ›´æ–°ã€‚

### 2. å…¬å…±å‚æ•°æ–‡ä»¶

ç¡®ä¿ä½¿ç”¨ä» Storage Node ç”Ÿæˆçš„æœ€æ–° `public_params.json` æ–‡ä»¶ã€‚

### 3. å¯†é’¥æ–‡ä»¶å…¼å®¹æ€§

ä¿®å¤å‰ç”Ÿæˆçš„å¯†é’¥æ–‡ä»¶ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†å»ºè®®é‡æ–°åˆå§‹åŒ–ä»¥ç¡®ä¿å®Œå…¨å…¼å®¹ã€‚

---

## ğŸ› å¦‚æœä»ç„¶å¤±è´¥

å¦‚æœä¿®å¤åä»ç„¶æ— æ³•æ­£å¸¸å·¥ä½œï¼Œè¯·æ£€æŸ¥ï¼š

1. **ä¾èµ–åº“ç‰ˆæœ¬**
   ```bash
   # æ£€æŸ¥ PBC åº“
   pkg-config --modversion pbc

   # æ£€æŸ¥ JsonCpp
   pkg-config --modversion jsoncpp
   ```
2. **public\_params.json æ–‡ä»¶**
   * ç¡®è®¤æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
   * ç¡®è®¤æ–‡ä»¶æ˜¯ä» Storage Node æœ€æ–°ç”Ÿæˆçš„
3. **ç¼–è¯‘é€‰é¡¹**
   * ç¡®è®¤é“¾æ¥äº†æ‰€æœ‰å¿…éœ€çš„åº“
   * ä½¿ç”¨ `-std=c++17` ç¼–è¯‘æ ‡å‡†
4. **æŸ¥çœ‹è°ƒè¯•è¾“å‡º**
   * æ–°å¢çš„è°ƒè¯•è¾“å‡ºä¼šæ˜¾ç¤º `element_from_bytes è¿”å›å€¼`
   * è¿™æœ‰åŠ©äºè¯Šæ–­å…·ä½“é—®é¢˜

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

* æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬
* GCC/G++ ç‰ˆæœ¬
* PBC åº“ç‰ˆæœ¬
* å®Œæ•´çš„é”™è¯¯è¾“å‡º
* è°ƒè¯•è¾“å‡ºä¸­çš„å…·ä½“ä¿¡æ¯

---

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

* **ä¿®å¤ç‰ˆæœ¬**: v4.0.1
* **ä¿®å¤æ—¥æœŸ**: 2025-11-10
* **å…¼å®¹æ€§**: Storage Node v2.0+
* **ä¾èµ–**: PBC, GMP, OpenSSL, JsonCpp

---

## âœ¨ ä¿®å¤ç¡®è®¤æ¸…å•

ä½¿ç”¨æ­¤æ¸…å•ç¡®è®¤ä¿®å¤æˆåŠŸï¼š

* [ ]  æ–‡ä»¶å·²æˆåŠŸæ›¿æ¢
* [ ]  ä»£ç é‡æ–°ç¼–è¯‘æ— é”™è¯¯
* [ ]  å®¢æˆ·ç«¯å¯ä»¥æˆåŠŸåˆå§‹åŒ–
* [ ]  `g` å‚æ•°åŠ è½½æˆåŠŸï¼ˆä¸å†æŠ¥é”™ï¼‰
* [ ]  `Î¼` å‚æ•°åŠ è½½æˆåŠŸ
* [ ]  å¯ä»¥æ­£å¸¸ç”Ÿæˆå¯†é’¥
* [ ]  å¯ä»¥æ­£å¸¸åŠ å¯†æ–‡ä»¶

---

ğŸ‰ ä¿®å¤å®Œæˆï¼ç°åœ¨æ‚¨çš„å®¢æˆ·ç«¯åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒè¯¦ç»†æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚
