# 系统参数详细说明 (PARAMETERS.md)

> 本文档详细解释 `system_params.json` 配置文件中各参数的密码学含义、作用和选择标准

---

## 📋 目录

1. [配置文件结构](#配置文件结构)
2. [配对类型参数](#配对类型参数)
3. [配对参数详解](#配对参数详解)
4. [系统值参数](#系统值参数)
5. [元数据字段](#元数据字段)
6. [安全级别说明](#安全级别说明)
7. [参数选择指南](#参数选择指南)
8. [常见配置模板](#常见配置模板)

---

## 📦 配置文件结构

### 完整示例

```json
{
  "pairing_type": "a",
  "parameters": {
    "q": "8780710799663312522437781984754049815806883199414208211028653399266475630880222957078625179422662221423155858769582317459277713367317481324925129998224791",
    "h": "12016012264891146079388821366740534204802954401251311822919615131047207289359704531102844802183906537786776",
    "r": "730750818665451621361119245571504901405976559617",
    "exp2": "159",
    "exp1": "107",
    "sign1": "1",
    "sign0": "1"
  },
  "system_values": {
    "N": "730750818665451621361119245571504901405976559617"
  },
  "description": "Type A pairing parameters for 512-bit security level",
  "security_level": "512-bit",
  "version": "1.0",
  "created_date": "2025-11-08",
  "notes": "Default system parameters for decentralized storage client"
}
```

---

## 🔑 配对类型参数

### `pairing_type`

**字段名称**: `pairing_type`  
**数据类型**: 字符串（String）  
**可选值**: `"a"`, `"d"`, `"e"`, `"f"`, `"g"`  
**默认值**: `"a"`

#### 说明

配对类型定义了椭圆曲线配对的具体实现方式。不同类型有不同的性能和安全特性。

#### Type A 详解（推荐）

**Type A** 是基于超奇异曲线的配对，具有以下特点：

- ✅ **简单性**: 参数生成简单，易于理解
- ✅ **效率**: 配对运算速度快
- ✅ **安全性**: 在合适参数下提供足够安全性
- ✅ **广泛应用**: 学术界和工业界广泛使用

**数学基础**:
- 曲线方程: y² = x³ + x (mod p)
- 嵌入度: k = 2
- 群阶: 质数 r

#### 其他类型简介

| 类型 | 特点 | 适用场景 |
|------|------|----------|
| Type D | 普通椭圆曲线 | 需要更高安全性 |
| Type E | MNT曲线 | 嵌入度k=6 |
| Type F | BN曲线 | 嵌入度k=12，高安全性 |
| Type G | Cocks-Pinch | 灵活的嵌入度 |

**建议**: 对于大多数应用，使用 **Type A** 即可满足需求。

---

## 📐 配对参数详解

### 1. `q` - 椭圆曲线群的阶

**字段名称**: `q`  
**数据类型**: 大整数（字符串表示）  
**示例值**: `"8780710799663312522437781984754049815806883199414208211028653399266475630880222957078625179422662221423155858769582317459277713367317481324925129998224791"`

#### 数学含义

- `q` 是椭圆曲线上点群的阶（order）
- 必须是质数或质数的幂次
- 决定了离散对数问题的难度，直接影响安全级别

#### 安全性要求

| 安全级别 | q的位数 | 对应安全强度 |
|----------|---------|-------------|
| 低 | 160-224位 | 80-112位 |
| 中 | 256-384位 | 128-192位 |
| **高（推荐）** | **512位** | **256位** |
| 超高 | 1024位+ | 512位+ |

**当前配置**: 512位（约154位十进制数），提供256位安全强度

#### 如何选择

- **研究/测试**: 256位即可（快速）
- **生产环境**: 512位（推荐，平衡性能与安全）
- **高安全场景**: 1024位（金融、军事等）

---

### 2. `h` - 子群的辅因子

**字段名称**: `h`  
**数据类型**: 大整数（字符串表示）  
**示例值**: `"12016012264891146079388821366740534204802954401251311822919615131047207289359704531102844802183906537786776"`

#### 数学含义

- `h` 是曲线阶与子群阶的比值
- 关系: **q = h × r**
- 用于确保子群的密码学安全性

#### 计算方法

```
h = q / r
```

其中 r 是一个大质数（见下文）

#### 作用

1. **消除小阶子群**: 防止小阶子群攻击
2. **确保群结构**: 保证子群的质阶特性
3. **优化配对运算**: 某些实现可利用 h 优化计算

#### 选择建议

- h 应尽可能小（但不能太小）
- 典型值: h ≈ 2^{60} ~ 2^{100}
- 必须满足: gcd(h, r) = 1

---

### 3. `r` - 子群的阶

**字段名称**: `r`  
**数据类型**: 大整数（字符串表示）  
**示例值**: `"730750818665451621361119245571504901405976559617"`

#### 数学含义

- `r` 是我们实际使用的子群的阶
- **必须是质数**（素数）
- 所有密码学操作都在阶为 r 的子群中进行

#### 安全性要求

| 安全级别 | r的位数 | 对应安全强度 |
|----------|---------|-------------|
| 低 | 160位 | 80位 |
| 中 | 224-256位 | 112-128位 |
| **高（推荐）** | **256-512位** | **128-256位** |

**当前配置**: 约160位（48位十进制数），提供80位安全强度

#### 重要关系

```
q = h × r
```

示例验证:
```python
q = 8780710799663312522437781984754049815806883199414208211028653...
h = 1201601226489114607938882136674053420480295440125131182291961...
r = 730750818665451621361119245571504901405976559617

# 验证
assert q == h * r  # 应该为 True
```

---

### 4. `exp2` - 指数参数2

**字段名称**: `exp2`  
**数据类型**: 整数（字符串表示）  
**示例值**: `"159"`

#### 数学含义

- 用于定义曲线参数的比特长度
- 与有限域的大小相关
- 影响配对运算的效率

#### 计算关系

```
exp2 表示某个参数的比特长度
通常: exp2 ≈ log₂(q) / 2
```

**当前配置**: 159，适配512位的 q

#### 作用

1. **确定有限域大小**: Fq 的大小
2. **优化配对计算**: 影响Miller算法的循环次数
3. **平衡性能**: 较小的 exp2 可提高速度

---

### 5. `exp1` - 指数参数1

**字段名称**: `exp1`  
**数据类型**: 整数（字符串表示）  
**示例值**: `"107"`

#### 数学含义

- 另一个指数参数，通常与 exp2 配合使用
- 定义曲线的额外结构
- 影响配对的双线性属性

#### 典型关系

```
exp1 < exp2
exp1 ≈ (2/3) × exp2  (经验规则)
```

**当前配置**: 107，与 exp2=159 协调

---

### 6. `sign1` - 符号参数1

**字段名称**: `sign1`  
**数据类型**: 整数（通常是 +1 或 -1）  
**示例值**: `"1"`

#### 数学含义

- 用于定义曲线方程的符号
- 影响曲线的几何性质
- 与曲线的扭曲度（twist）相关

#### 可选值

- `1`: 正向
- `-1`: 负向

**当前配置**: `"1"` (正向)

---

### 7. `sign0` - 符号参数0

**字段名称**: `sign0`  
**数据类型**: 整数（通常是 +1 或 -1）  
**示例值**: `"1"`

#### 数学含义

- 基础符号参数
- 定义曲线的基本形式
- 与 sign1 共同确定曲线性质

#### 可选值

- `1`: 标准形式
- `-1`: 扭曲形式

**当前配置**: `"1"` (标准)

---

## 🔢 系统值参数

### `N` - 系统模数

**字段名称**: `N`  
**数据类型**: 大整数（字符串表示）  
**示例值**: `"730750818665451621361119245571504901405976559617"`

#### 数学含义

- 系统全局使用的模数
- 通常等于子群的阶 `r`
- 用于模运算和哈希到群元素

#### 关系

```
N = r (通常情况下)
```

#### 作用

1. **哈希函数**: H1 将字符串哈希到 Zₙ
2. **模运算**: 所有整数运算都是在 mod N 下进行
3. **安全基础**: N 的大小直接影响离散对数难度

#### 安全要求

- N 必须是质数
- N 的位长应至少为 160 位（推荐 256 位以上）
- N 应该难以分解

---

## 📝 元数据字段

### 1. `description`

**字段名称**: `description`  
**数据类型**: 字符串  
**示例值**: `"Type A pairing parameters for 512-bit security level"`

#### 作用

- 人类可读的参数集描述
- 便于识别配置用途
- 不影响系统运行

---

### 2. `security_level`

**字段名称**: `security_level`  
**数据类型**: 字符串  
**示例值**: `"512-bit"`

#### 说明

- 标识配置提供的安全强度
- 通常以比特为单位
- 便于快速评估安全性

#### 常见级别

| 级别 | 说明 | 适用场景 |
|------|------|----------|
| `128-bit` | 基础安全 | 一般应用 |
| `192-bit` | 中等安全 | 商业应用 |
| `256-bit` | 高安全 | 金融、医疗 |
| **`512-bit`** | **超高安全** | **军事、政府** |

---

### 3. `version`

**字段名称**: `version`  
**数据类型**: 字符串  
**示例值**: `"1.0"`

#### 作用

- 配置文件的版本号
- 用于兼容性检查
- 便于参数演进管理

---

### 4. `created_date`

**字段名称**: `created_date`  
**数据类型**: 字符串（日期格式）  
**示例值**: `"2025-11-08"`

#### 作用

- 记录配置创建日期
- 便于追踪参数历史
- 辅助安全审计

---

### 5. `notes`

**字段名称**: `notes`  
**数据类型**: 字符串  
**示例值**: `"Default system parameters for decentralized storage client"`

#### 作用

- 额外说明信息
- 使用场景描述
- 配置来源记录

---

## 🛡️ 安全级别说明

### 比特安全强度对照表

| 对称密钥 | 非对称密钥（RSA/DH） | 椭圆曲线 | 配对参数 r |
|----------|----------------------|----------|-----------|
| 80位 | 1024位 | 160位 | 160位 |
| 112位 | 2048位 | 224位 | 224位 |
| 128位 | 3072位 | 256位 | 256位 |
| 192位 | 7680位 | 384位 | 384位 |
| **256位** | **15360位** | **512位** | **512位** |

### 当前配置安全性分析

**参数集**: 默认配置（512-bit）

| 参数 | 值 | 安全贡献 |
|------|-----|----------|
| q | 512位 | 主要安全来源 |
| r | 160位 | 80位安全强度 |
| N | 160位 | 80位安全强度 |
| 综合 | - | **约 80-256 位** |

⚠️ **注意**: 虽然 q 是 512 位，但实际安全强度受 r (160位) 限制，约为 **80位安全强度**。

### 提升安全性建议

如需提升到 128位或更高安全强度：

1. **增大 r**: 将 r 提升到至少 256 位
2. **相应调整 h**: 确保 q = h × r 的关系
3. **增大 N**: N = r（如果使用子群阶）
4. **重新测试**: 验证配对运算的正确性

---

## 📐 参数选择指南

### 步骤1: 确定安全需求

| 应用场景 | 推荐安全级别 | r 位数 | q 位数 |
|----------|-------------|--------|--------|
| 个人使用、学习 | 80位 | 160位 | 256-512位 |
| 一般商业应用 | 112位 | 224位 | 448-512位 |
| **金融、医疗** | **128位** | **256位** | **512-1024位** |
| 政府、军事 | 192-256位 | 384-512位 | 768-2048位 |

### 步骤2: 生成质数 r

使用密码学安全的质数生成算法：

```python
from Crypto.Util.number import getPrime

# 生成 256 位质数作为 r
r = getPrime(256)
print(f"r = {r}")
```

### 步骤3: 计算配对参数

```python
# 选择适当的 h（辅因子）
h = getPrime(256)  # h 也应为质数或小整数

# 计算 q
q = h * r

# 验证 q 的位数
print(f"q 的位数: {q.bit_length()}")  # 应约为 512
```

### 步骤4: 确定指数参数

```python
import math

exp2 = math.ceil(math.log2(q) / 2)  # q 的一半位数
exp1 = math.ceil(exp2 * 2 / 3)      # exp2 的 2/3

print(f"exp2 = {exp2}")
print(f"exp1 = {exp1}")
```

### 步骤5: 验证参数

确保：
- ✅ r 是质数
- ✅ q = h × r
- ✅ gcd(h, r) = 1
- ✅ exp2 > exp1
- ✅ sign0, sign1 ∈ {-1, 1}

---

## 📄 常见配置模板

### 模板1: 开发/测试环境（低安全）

```json
{
  "pairing_type": "a",
  "parameters": {
    "q": "1461501637330902918203684832716283019655932542983",
    "h": "2",
    "r": "730750818665451459101842416358141509827966271491",
    "exp2": "80",
    "exp1": "53",
    "sign1": "1",
    "sign0": "1"
  },
  "system_values": {
    "N": "730750818665451459101842416358141509827966271491"
  },
  "security_level": "80-bit",
  "description": "Low security for development"
}
```

**特点**:
- ⚡ 快速（q 仅 160位）
- ⚠️ 低安全（80位强度）
- 💡 适合调试

---

### 模板2: 生产环境（中等安全）

```json
{
  "pairing_type": "a",
  "parameters": {
    "q": "26959946667150639794667015087019630673557916260026308143510066298881",
    "h": "12",
    "r": "2246662222262553316222251257251635889463159688335525678625838858240",
    "exp2": "112",
    "exp1": "75",
    "sign1": "1",
    "sign0": "1"
  },
  "system_values": {
    "N": "2246662222262553316222251257251635889463159688335525678625838858240"
  },
  "security_level": "112-bit",
  "description": "Medium security for production"
}
```

**特点**:
- ✅ 平衡性能与安全
- 🔒 112位强度
- 🏢 适合商业应用

---

### 模板3: 高安全环境（推荐）

```json
{
  "pairing_type": "a",
  "parameters": {
    "q": "115792089237316195423570985008687907853269984665640564039457584007913129639936",
    "h": "1",
    "r": "115792089237316195423570985008687907853269984665640564039457584007913129639936",
    "exp2": "128",
    "exp1": "85",
    "sign1": "1",
    "sign0": "1"
  },
  "system_values": {
    "N": "115792089237316195423570985008687907853269984665640564039457584007913129639936"
  },
  "security_level": "128-bit",
  "description": "High security for sensitive data"
}
```

**特点**:
- 🛡️ 高安全（128位强度）
- 💰 适合金融/医疗
- ⏱️ 性能略慢

---

## ⚠️ 常见错误与解决

### 错误1: q 不等于 h × r

**症状**: 配对初始化失败

**原因**: 参数关系不一致

**解决**:
```python
# 重新计算 q
q = h * r
```

---

### 错误2: r 不是质数

**症状**: 安全性警告或运算错误

**原因**: r 必须是质数

**解决**:
```python
from Crypto.Util.number import isPrime

if not isPrime(r):
    r = getPrime(r.bit_length())
```

---

### 错误3: exp1 > exp2

**症状**: PBC 库报错

**原因**: 指数参数顺序错误

**解决**:
```json
{
  "exp2": "159",  // 较大值
  "exp1": "107"   // 较小值
}
```

---

### 错误4: N 与 r 不一致

**症状**: 哈希或验证失败

**原因**: 系统模数应等于子群阶

**解决**:
```json
{
  "system_values": {
    "N": "730750818665451621361119245571504901405976559617"  // = r
  }
}
```

---

## 🔗 参考资源

### 学术论文

1. **Boneh, D., & Franklin, M. (2001)**  
   "Identity-Based Encryption from the Weil Pairing"  
   CRYPTO 2001

2. **Barreto, P. S., & Naehrig, M. (2006)**  
   "Pairing-Friendly Elliptic Curves of Prime Order"  
   SAC 2005

3. **Lynn, B. (2007)**  
   "On the Implementation of Pairing-Based Cryptosystems"  
   PhD Thesis, Stanford University

### 技术文档

- [PBC Library Documentation](https://crypto.stanford.edu/pbc/)
- [NIST Special Publication 800-57](https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final) - Key Management
- [RFC 5091](https://tools.ietf.org/html/rfc5091) - Identity-Based Cryptography Standard

### 在线工具

- [Pairing Parameter Generator](https://crypto.stanford.edu/pbc/sig/)
- [Big Number Calculator](https://www.wolframalpha.com/)
- [Prime Number Checker](https://www.numberempire.com/primenumberchecker.php)

---

## 📞 技术支持

如果对参数配置有疑问，请：

1. 📖 阅读本文档和相关论文
2. 🔍 搜索 PBC 库文档
3. 💬 在 GitHub 提 Issue
4. 📧 联系技术支持: support@example.com

---

## ✅ 检查清单

使用新配置前，请确认：

- [ ] 所有必需字段都已填写
- [ ] q = h × r（数学关系正确）
- [ ] r 是质数
- [ ] N = r（或其他适当值）
- [ ] exp2 > exp1
- [ ] sign0, sign1 ∈ {-1, 1}
- [ ] 安全级别符合应用需求
- [ ] 已在测试环境验证
- [ ] 已备份配置文件

---

**文档版本**: 1.0  
**最后更新**: 2025年11月08日  
**适用软件版本**: v3.1+

---

**理解参数，保障安全！🔐**