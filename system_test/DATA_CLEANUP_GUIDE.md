# VDSæ€§èƒ½æµ‹è¯•æ¡†æ¶ - æ•°æ®æ¸…ç†æŒ‡å—

## æµ‹è¯•ç‹¬ç«‹æ€§è¯´æ˜

æœ¬æµ‹è¯•æ¡†æ¶åŒ…å«ä¸‰ä¸ªç‹¬ç«‹ä½†æœ‰ä¾èµ–å…³ç³»çš„æ€§èƒ½æµ‹è¯•ï¼š

1. **æ’å…¥æ€§èƒ½æµ‹è¯•** (`insert_perf_test`)
2. **æœç´¢æ€§èƒ½æµ‹è¯•** (`search_perf_test`)
3. **éªŒè¯æ€§èƒ½æµ‹è¯•** (`verify_perf_test`)

## æµ‹è¯•ä¾èµ–å…³ç³»

```
æ’å…¥æµ‹è¯• â†’ æœç´¢æµ‹è¯• â†’ éªŒè¯æµ‹è¯•
   â†“           â†“           â†“
ç”Ÿæˆæ•°æ®åº“   ä¾èµ–æ•°æ®åº“   ä¾èµ–è¯æ˜æ–‡ä»¶
```

- **æœç´¢æµ‹è¯•** éœ€è¦ **æ’å…¥æµ‹è¯•** äº§ç”Ÿçš„æ•°æ®åº“ï¼ˆindex_db.json, search_db.jsonï¼‰
- **éªŒè¯æµ‹è¯•** éœ€è¦ **æœç´¢æµ‹è¯•** äº§ç”Ÿçš„è¯æ˜æ–‡ä»¶ï¼ˆSearchProof/*.jsonï¼‰

## æ•°æ®æ¸…ç†ç­–ç•¥

### 1. æ’å…¥æ€§èƒ½æµ‹è¯• - cleanupData()

**æ¸…ç†æ—¶æœº**: æ¯æ¬¡è¿è¡Œ `insert_perf_test` ä¹‹å‰

**æ¸…ç†èŒƒå›´**: æ¸…ç†æ‰€æœ‰æ•°æ®åº“å’Œæ’å…¥ç›¸å…³çš„æ–‡ä»¶

#### å®¢æˆ·ç«¯æ¸…ç†
- âœ… `../../vds-client/data/EncFiles/*` - æ‰€æœ‰åŠ å¯†æ–‡ä»¶
- âœ… `../../vds-client/data/MetaFiles/*` - æ‰€æœ‰å…ƒæ•°æ®æ–‡ä»¶
- âœ… `../../vds-client/data/Insert/*` - æ‰€æœ‰æ’å…¥JSONæ–‡ä»¶
- âœ… `../../vds-client/data/keyword_states.json` - å…³é”®è¯çŠ¶æ€æ–‡ä»¶

#### æœåŠ¡ç«¯æ¸…ç†
- âœ… `../../Storage-node/data/index_db.json` - ç´¢å¼•æ•°æ®åº“
- âœ… `../../Storage-node/data/search_db.json` - æœç´¢æ•°æ®åº“
- âœ… `../../Storage-node/data/metadata/*` - æ‰€æœ‰å…ƒæ•°æ®æ–‡ä»¶
- âœ… `../../Storage-node/data/EncFiles/*` - æ‰€æœ‰åŠ å¯†æ–‡ä»¶

**ä»£ç ä½ç½®**: `system_test/insert_files/insert_test.cpp` Lines 287-389

```cpp
bool InsertPerformanceTest::cleanupData() {
    std::cout << "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" << std::endl;
    std::cout << "ğŸ§¹ æ¸…ç†æ‰€æœ‰æ•°æ®åº“å’Œæµ‹è¯•æ•°æ®" << std::endl;
    std::cout << "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" << std::endl;

    // æ¸…ç†å®¢æˆ·ç«¯äº§ç”Ÿçš„æ–‡ä»¶
    // ... (æ¸…ç†EncFiles, MetaFiles, Insert, keyword_states.json)

    // æ¸…ç†æœåŠ¡ç«¯æ•°æ®åº“
    // ... (æ¸…ç†index_db.json, search_db.json, metadata, EncFiles)

    return true;
}
```

**è°ƒç”¨ä½ç½®**: `InsertPerformanceTest::runTest()` å¼€å§‹æ—¶è°ƒç”¨

---

### 2. æœç´¢æ€§èƒ½æµ‹è¯• - cleanupData()

**æ¸…ç†æ—¶æœº**: æ¯æ¬¡è¿è¡Œ `search_perf_test` ä¹‹å‰

**æ¸…ç†èŒƒå›´**: **åªæ¸…ç†æœç´¢æµ‹è¯•äº§ç”Ÿçš„æ–‡ä»¶ï¼Œä¸æ¸…ç†æ•°æ®åº“**

#### å®¢æˆ·ç«¯æ¸…ç†
- âœ… `../../vds-client/data/Search/*.json` - æ‰€æœ‰æœç´¢Tokenæ–‡ä»¶

#### æœåŠ¡ç«¯æ¸…ç†
- âœ… `../../Storage-node/data/SearchProof/*.json` - æ‰€æœ‰æœç´¢è¯æ˜æ–‡ä»¶

#### ä¿ç•™çš„æ•°æ®ï¼ˆä¾èµ–æ’å…¥æµ‹è¯•ï¼‰
- âš ï¸ **ä¸æ¸…ç†** `index_db.json` - æœç´¢éœ€è¦ç´¢å¼•æ•°æ®åº“
- âš ï¸ **ä¸æ¸…ç†** `search_db.json` - æœç´¢éœ€è¦æœç´¢æ•°æ®åº“
- âš ï¸ **ä¸æ¸…ç†** `EncFiles/*` - æœç´¢éœ€è¦åŠ å¯†æ–‡ä»¶
- âš ï¸ **ä¸æ¸…ç†** `metadata/*` - æœç´¢éœ€è¦å…ƒæ•°æ®

**ä»£ç ä½ç½®**: `system_test/search_files/search_test.cpp` Lines 287-324

```cpp
bool SearchPerformanceTest::cleanupData() {
    std::cout << "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" << std::endl;
    std::cout << "ğŸ§¹ æ¸…ç†æœç´¢æµ‹è¯•äº§ç”Ÿçš„æ•°æ®" << std::endl;
    std::cout << "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" << std::endl;

    // æ¸…ç†å®¢æˆ·ç«¯æœç´¢Tokenæ–‡ä»¶
    // ... (åªæ¸…ç†Searchç›®å½•çš„.jsonæ–‡ä»¶)

    // æ¸…ç†æœåŠ¡ç«¯æœç´¢è¯æ˜æ–‡ä»¶
    // ... (åªæ¸…ç†SearchProofç›®å½•çš„.jsonæ–‡ä»¶)

    // é‡è¦ï¼šä¸æ¸…ç†æ•°æ®åº“å’ŒåŠ å¯†æ–‡ä»¶ï¼ˆæœç´¢ä¾èµ–è¿™äº›æ•°æ®ï¼‰

    return true;
}
```

**è°ƒç”¨ä½ç½®**: `SearchPerformanceTest::runTest()` å¼€å§‹æ—¶è°ƒç”¨

---

### 3. éªŒè¯æ€§èƒ½æµ‹è¯• - cleanupData()

**æ¸…ç†æ—¶æœº**: æ¯æ¬¡è¿è¡Œ `verify_perf_test` ä¹‹å‰

**æ¸…ç†èŒƒå›´**: æ— éœ€æ¸…ç†ï¼ˆéªŒè¯æµ‹è¯•åªè¯»å–è¯æ˜æ–‡ä»¶ï¼‰

#### éªŒè¯æµ‹è¯•ç‰¹ç‚¹
- âœ… åªè¯»å– `SearchProof/*.json` è¯æ˜æ–‡ä»¶
- âœ… ä¸äº§ç”Ÿä»»ä½•æ–°æ–‡ä»¶
- âœ… ä¸ä¿®æ”¹ä»»ä½•æ•°æ®

**ä»£ç ä½ç½®**: `system_test/verify_files/verify_test.cpp` Lines 242-254

```cpp
bool VerifyPerformanceTest::cleanupData() {
    std::cout << "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" << std::endl;
    std::cout << "ğŸ§¹ æ¸…ç†éªŒè¯æµ‹è¯•æ•°æ®" << std::endl;
    std::cout << "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" << std::endl;

    // éªŒè¯æµ‹è¯•ä¸»è¦æ˜¯è¯»å–å’ŒéªŒè¯ï¼Œé€šå¸¸ä¸äº§ç”Ÿé¢å¤–æ–‡ä»¶
    std::cout << "[æ¸…ç†] éªŒè¯æµ‹è¯•ä¸äº§ç”Ÿéœ€è¦æ¸…ç†çš„æ•°æ®" << std::endl;
    std::cout << "[æ¸…ç†] éªŒè¯æµ‹è¯•åªè¯»å–è¯æ˜æ–‡ä»¶è¿›è¡ŒéªŒè¯\n" << std::endl;

    std::cout << "âœ… æ¸…ç†å®Œæˆ\n" << std::endl;
    return true;
}
```

**è°ƒç”¨ä½ç½®**: `VerifyPerformanceTest::runTest()` å¼€å§‹æ—¶è°ƒç”¨

---

## å®Œæ•´æµ‹è¯•æµç¨‹

### æ–¹å¼1ï¼šå®Œæ•´ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
cd system_test
./run_end_to_end_test.sh full
```

æ‰§è¡Œé¡ºåºï¼š
1. è¿è¡Œ `insert_perf_test`
   - æ¸…ç†æ‰€æœ‰æ•°æ®åº“å’Œæ–‡ä»¶
   - æ’å…¥æµ‹è¯•æ–‡ä»¶
   - ç”Ÿæˆ index_db.json, search_db.json

2. è¿è¡Œ `search_perf_test`
   - æ¸…ç†æœç´¢tokenå’Œproofæ–‡ä»¶
   - ä¿ç•™æ•°æ®åº“
   - å¯¹å…³é”®è¯æ‰§è¡Œæœç´¢
   - ç”Ÿæˆæœç´¢è¯æ˜æ–‡ä»¶

3. è¿è¡Œ `verify_perf_test`
   - ä¸æ¸…ç†ä»»ä½•æ–‡ä»¶
   - è¯»å–æœç´¢è¯æ˜æ–‡ä»¶
   - éªŒè¯è¯æ˜çš„æ­£ç¡®æ€§

### æ–¹å¼2ï¼šç‹¬ç«‹è¿è¡Œå•ä¸ªæµ‹è¯•

#### è¿è¡Œæ’å…¥æµ‹è¯•ï¼ˆæ¸…ç†æ‰€æœ‰æ•°æ®ï¼‰
```bash
cd system_test/insert_files
./insert_perf_test
```
- è‡ªåŠ¨æ¸…ç†æ‰€æœ‰æ•°æ®åº“å’Œæ–‡ä»¶
- é‡æ–°æ’å…¥æ‰€æœ‰æµ‹è¯•æ–‡ä»¶

#### è¿è¡Œæœç´¢æµ‹è¯•ï¼ˆä¿ç•™æ•°æ®åº“ï¼‰
```bash
cd system_test/search_files
./search_perf_test
```
- è‡ªåŠ¨æ¸…ç†æœç´¢tokenå’Œproofæ–‡ä»¶
- ä¾èµ–å·²å­˜åœ¨çš„æ•°æ®åº“
- âš ï¸ **å‰æ**: å¿…é¡»å…ˆè¿è¡Œè¿‡æ’å…¥æµ‹è¯•

#### è¿è¡ŒéªŒè¯æµ‹è¯•ï¼ˆåªè¯»å–ï¼‰
```bash
cd system_test/verify_files
./verify_perf_test
```
- ä¸æ¸…ç†ä»»ä½•æ–‡ä»¶
- ä¾èµ–å·²å­˜åœ¨çš„è¯æ˜æ–‡ä»¶
- âš ï¸ **å‰æ**: å¿…é¡»å…ˆè¿è¡Œè¿‡æœç´¢æµ‹è¯•

---

## æ‰‹åŠ¨æ¸…ç†å‘½ä»¤

å¦‚æœéœ€è¦æ‰‹åŠ¨æ¸…ç†æ‰€æœ‰æ•°æ®ï¼š

```bash
# æ¸…ç†å®¢æˆ·ç«¯æ•°æ®
rm -f ../../vds-client/data/EncFiles/*
rm -f ../../vds-client/data/MetaFiles/*
rm -f ../../vds-client/data/Insert/*
rm -f ../../vds-client/data/Search/*.json
rm -f ../../vds-client/data/keyword_states.json

# æ¸…ç†æœåŠ¡ç«¯æ•°æ®
rm -f ../../Storage-node/data/index_db.json
rm -f ../../Storage-node/data/search_db.json
rm -f ../../Storage-node/data/metadata/*
rm -f ../../Storage-node/data/EncFiles/*
rm -f ../../Storage-node/data/SearchProof/*.json
```

æˆ–ä½¿ç”¨Makefileæ¸…ç†ç›®æ ‡ï¼š
```bash
cd system_test/insert_files && make clean-data
cd system_test/search_files && make clean-data
cd system_test/verify_files && make clean-data
```

---

## æ³¨æ„äº‹é¡¹

1. **æ’å…¥æµ‹è¯•æ¸…ç†æœ€å½»åº•**
   - åˆ é™¤æ‰€æœ‰æ•°æ®åº“å’Œæ–‡ä»¶
   - ç¡®ä¿æ¯æ¬¡æµ‹è¯•ä»å¹²å‡€çŠ¶æ€å¼€å§‹

2. **æœç´¢æµ‹è¯•ä¿ç•™æ•°æ®åº“**
   - åªåˆ é™¤æœç´¢äº§ç”Ÿçš„tokenå’Œproofæ–‡ä»¶
   - ä¸å½±å“æ’å…¥æµ‹è¯•äº§ç”Ÿçš„æ•°æ®åº“
   - å…è®¸åå¤æµ‹è¯•æœç´¢æ€§èƒ½è€Œä¸éœ€è¦é‡æ–°æ’å…¥

3. **éªŒè¯æµ‹è¯•å®Œå…¨åªè¯»**
   - ä¸äº§ç”Ÿä»»ä½•æ–‡ä»¶
   - ä¸ä¿®æ”¹ä»»ä½•æ•°æ®
   - å¯ä»¥å®‰å…¨åœ°åå¤è¿è¡Œ

4. **æµ‹è¯•ä¾èµ–é“¾**
   ```
   æ’å…¥æµ‹è¯•ï¼ˆç‹¬ç«‹ï¼‰â†’ æœç´¢æµ‹è¯•ï¼ˆä¾èµ–æ•°æ®åº“ï¼‰â†’ éªŒè¯æµ‹è¯•ï¼ˆä¾èµ–è¯æ˜ï¼‰
   ```

5. **æ–‡ä»¶è·¯å¾„å…¼å®¹æ€§**
   - æ‰€æœ‰è·¯å¾„ä½¿ç”¨ç›¸å¯¹è·¯å¾„
   - ä»å„è‡ªçš„æµ‹è¯•ç›®å½•æ‰§è¡Œ
   - è‡ªåŠ¨é€‚é…ä¸åŒç¯å¢ƒ

---

## æ•…éšœæ’æŸ¥

### æœç´¢æµ‹è¯•å¤±è´¥ï¼šæ•°æ®åº“ä¸ºç©º

**ç—‡çŠ¶**:
```
[åˆå§‹åŒ–] ç´¢å¼•æ¡ç›®æ•°: 0
[åˆå§‹åŒ–] æœç´¢ç´¢å¼•æ¡ç›®æ•°: 0
Segmentation fault (core dumped)
```

**åŸå› **: æœªè¿è¡Œæ’å…¥æµ‹è¯•æˆ–æ•°æ®åº“è¢«æ¸…ç†

**è§£å†³**:
```bash
cd system_test/insert_files
./insert_perf_test
cd ../search_files
./search_perf_test
```

### éªŒè¯æµ‹è¯•å¤±è´¥ï¼šæ‰¾ä¸åˆ°è¯æ˜æ–‡ä»¶

**ç—‡çŠ¶**:
```
âŒ æœªæ‰¾åˆ°æœç´¢è¯æ˜æ–‡ä»¶
```

**åŸå› **: æœªè¿è¡Œæœç´¢æµ‹è¯•æˆ–è¯æ˜æ–‡ä»¶è¢«æ¸…ç†

**è§£å†³**:
```bash
cd system_test/search_files
./search_perf_test
cd ../verify_files
./verify_perf_test
```

### æ’å…¥æµ‹è¯•æ–‡ä»¶ä¸å­˜åœ¨

**ç—‡çŠ¶**:
```
âš ï¸  æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè·³è¿‡: /path/to/file
```

**åŸå› **: keywordsæ–‡ä»¶ä¸­çš„è·¯å¾„ä¸å®é™…ç¯å¢ƒä¸åŒ¹é…

**è§£å†³**: ä½¿ç”¨æä¾›çš„Pythonè„šæœ¬é‡æ–°ç”Ÿæˆkeywordsæ–‡ä»¶ï¼ˆå·²å®Œæˆï¼‰

---

## æ€»ç»“

âœ… æ¯ä¸ªæµ‹è¯•éƒ½æœ‰ç‹¬ç«‹çš„ `cleanupData()` æ–¹æ³•
âœ… æ¯ä¸ªæµ‹è¯•åœ¨ `runTest()` å¼€å§‹æ—¶è‡ªåŠ¨è°ƒç”¨æ¸…ç†
âœ… æ¸…ç†èŒƒå›´ç²¾ç¡®æ§åˆ¶ï¼Œä¸å½±å“ä¾èµ–æ•°æ®
âœ… æ”¯æŒç‹¬ç«‹è¿è¡Œå’Œç«¯åˆ°ç«¯è¿è¡Œ
âœ… ä»£ç å·²å…¨éƒ¨å®ç°å¹¶æµ‹è¯•é€šè¿‡
